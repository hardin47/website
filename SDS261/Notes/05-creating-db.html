<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Jo Hardin">
<title>Data Science, the SQL - 5&nbsp; Creating databases</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06-change-db.html" rel="next">
<link href="./p3-build-db.html" rel="prev">
<link href="./images/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/x-mathjax-config">
const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers){
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');
  
  // Will this work with TeX on its own line?
  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
  	MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
  	MathJax.Hub.Queue(function(){
      popover.setAttribute('data-content', div.innerHTML);
  	})
  }
}
</script><link rel="shortcut icon" href="figs/favicon.ico">
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script><link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="site_libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet">
<script src="site_libs/bsTable-3.3.7/bootstrapTable.js"></script><link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css2?family=Quicksand" type="text/css">
</head>
<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./p3-build-db.html">Building databases</a></li><li class="breadcrumb-item"><a href="./05-creating-db.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Creating databases</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science, the SQL</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/hardin47/SDS261-SQL" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome to Data Science, the SQL</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p1-intro-to-sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to databases and SQL</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-db.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Databases</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-sql-in-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">SQL in R and DBeaver</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p2-using-sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using SQL</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-sql-verbs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">SQL clauses</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-sql-joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Combining tables in SQL</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p3-build-db.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Building databases</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-creating-db.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Creating databases</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-change-db.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Changing databases</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-db-etc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title"><strong>SQL</strong> extras</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p4-regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regular expressions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Regular Expressions</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#preparing-to-load-data" id="toc-preparing-to-load-data" class="nav-link active" data-scroll-target="#preparing-to-load-data"><span class="header-section-number">5.1</span> Preparing to load data</a>
  <ul class="collapse">
<li><a href="#variable-types" id="toc-variable-types" class="nav-link" data-scroll-target="#variable-types"><span class="header-section-number">5.1.1</span> Variable types</a></li>
  <li><a href="#check-constraints" id="toc-check-constraints" class="nav-link" data-scroll-target="#check-constraints"><span class="header-section-number">5.1.2</span> <code>CHECK</code> constraints</a></li>
  <li><a href="#creating-keys" id="toc-creating-keys" class="nav-link" data-scroll-target="#creating-keys"><span class="header-section-number">5.1.3</span> Creating <code>KEY</code>s</a></li>
  <li><a href="#creating-indexes" id="toc-creating-indexes" class="nav-link" data-scroll-target="#creating-indexes"><span class="header-section-number">5.1.4</span> Creating <code>INDEX</code>es</a></li>
  <li><a href="#sec-load-data" id="toc-sec-load-data" class="nav-link" data-scroll-target="#sec-load-data"><span class="header-section-number">5.1.5</span> Loading data</a></li>
  <li><a href="#sec-load-duckdb" id="toc-sec-load-duckdb" class="nav-link" data-scroll-target="#sec-load-duckdb"><span class="header-section-number">5.1.6</span> Using <strong>DuckDB</strong> for loading data</a></li>
  </ul>
</li>
  <li><a href="#best-practice" id="toc-best-practice" class="nav-link" data-scroll-target="#best-practice"><span class="header-section-number">5.2</span> Best practice</a></li>
  <li><a href="#reflection-questions" id="toc-reflection-questions" class="nav-link" data-scroll-target="#reflection-questions"><span class="header-section-number">5.3</span> <i class="fas fa-lightbulb"></i> Reflection questions</a></li>
  <li><a href="#ethics-considerations" id="toc-ethics-considerations" class="nav-link" data-scroll-target="#ethics-considerations"><span class="header-section-number">5.4</span> <i class="fas fa-balance-scale"></i> Ethics considerations</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/hardin47/SDS261-SQL/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-create-db" class="quarto-section-identifier"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Creating databases</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>In order to practice creating and editing databases, you will need to install <a href="https://duckdb.org/" target="_blank">DuckDB</a> onto your own computer. Fortunately, you can do the installation using <strong>R</strong>! <strong>DuckDB</strong> is an in-process database management system that runs entirely on your own computer. Setting up a database on your own computer is a great way to work with large datasets where you are the only analyst. The data then lives in your storage (instead of your memory), and you don’t have to transfer queries or results over the internet.</p>
<p>Using <strong>DuckDB</strong> suits our purposes because it allows us to create a local database that we can edit. However, the <strong>SQL</strong> dialect used in <strong>DuckDB</strong> is slightly different from <strong>MySQL</strong>, which is important to recognize. For example, we write <code>SELECT * FROM table 10;</code> instead of <code>SELECT * FROM table 0, 10;</code>. In your future as a data scientist, you will find different dialects, depending on the <strong>SQL</strong> server. Always be aware of the dialect you are using.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"duckdb"</span><span class="op">)</span>  <span class="co"># only once, in the Console, not in the .qmd or .Rmd file</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://duckdb.org/">duckdb</a></span><span class="op">)</span>             <span class="co"># at the top of the .qmd or .Rmd file</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org">DBI</a></span><span class="op">)</span>                <span class="co"># we also still need the DBI package</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In order to create a database (on our own computer), we’ll start by creating a connection to <strong>DuckDB</strong>. Note that the database has been stored to a database directory called <code>duck_datab</code> which lives in the current <strong>R</strong> project. You won’t be able to open it like a standard folder, but it is where <strong>DuckDB</strong> stores the database files.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">con_duckdb</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/duckdb/man/duckdb.html">duckdb</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                             dbdir <span class="op">=</span> <span class="st">"duck_datab"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="preparing-to-load-data" class="level2" data-number="5.1"><h2 data-number="5.1" class="anchored" data-anchor-id="preparing-to-load-data">
<span class="header-section-number">5.1</span> Preparing to load data</h2>
<p>The <code>duckdb</code> database is currently empty, so we need to load in some data. The <code><a href="https://rdrr.io/pkg/duckdb/man/duckdb_read_csv.html">duckdb_read_csv()</a></code> function in the <strong>duckdb</strong> R package allows us to load the .csv file (available on GitHub) directly into the database without being loaded as an <strong>R</strong> object first. The function, <code><a href="https://rdrr.io/pkg/duckdb/man/duckdb_read_csv.html">duckdb_read_csv()</a></code> does some of the work for us to find data types. However, we will first learn what data types are and how to use them, and most dialects of <strong>SQL</strong> require you to specify the data types before loading in data (usually done using <code>LOAD DATA</code> but using <code>COPY</code> in <strong>Duckdb</strong>).</p>
<p>Recall that in <a href="03-sql-verbs.html#tbl-select-describe">Table&nbsp;<span>3.2</span></a> we used <code>DESCRIBE</code> to display the variable types of the database table(s). The list includes the variable name (<code>Field</code>), its <code>Type</code>, whether there are <code>NULL</code> values allowed, and whether there are keys or indexes defined on the variable. See <a href="#tbl-casts-describe">Table&nbsp;<span>5.2</span></a> for the <code>DESCRIBE</code> output on the table we are about to import.</p>
<p>Unlike <strong>R</strong>, when creating a new data table, <strong>SQL</strong> requires that you communicate each future variable (column) and that variable’s type. Variable types are <strong>not</strong> automatically generated!</p>
<p>As an example, consider the Saturday Night Live datasets available on the <a href="https://github.com/hhllcks/snldb/" target="_blank">snldb GitHub repo</a>. Data is scraped from <a href="http://www.snlarchives.net" target="_blank">http://www.snlarchives.net</a> and <a href="http://www.imdb.com/title/tt0072562" target="_blank">http://www.imdb.com/title/tt0072562</a> by <a href="https://github.com/hhllcks" target="_blank">Hendrik Hilleckes</a> and <a href="https://github.com/colinmorris" target="_blank">Colin Morris</a>. Notice that there are eleven .csv files available in the <a href="https://github.com/hhllcks/snldb/tree/master/output" target="_blank">output folder</a>.</p>
<p>Specifically, let’s consider the <a href="https://raw.githubusercontent.com/hhllcks/snldb/master/output/actors.csv" target="_blank">casts.csv</a> file.</p>
<p>Before we get into loading data into a <strong>SQL</strong> database, let’s look at the casts file in <strong>R</strong>, so that we understand the data we want to load. <code>glimpse()</code> provides the variable names and the variables types. The variables types are a mix of character strings, numeric, and logical. Variable types are very important for inputting data into a <strong>SQL</strong> server.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">casts</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/hhllcks/snldb/master/output/casts.csv"</span><span class="op">)</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">casts</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 614
Columns: 8
$ aid             &lt;chr&gt; "A. Whitney Brown", "A. Whitney Brown", "A. Whitney Br…
$ sid             &lt;dbl&gt; 11, 12, 13, 14, 15, 16, 5, 39, 40, 41, 42, 45, 46, 21,…
$ featured        &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, …
$ first_epid      &lt;dbl&gt; 19860222, NA, NA, NA, NA, NA, 19800409, 20140118, NA, …
$ last_epid       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ update_anchor   &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE…
$ n_episodes      &lt;dbl&gt; 8, 20, 13, 20, 20, 20, 5, 11, 21, 21, 21, 18, 17, 20, …
$ season_fraction &lt;dbl&gt; 0.444, 1.000, 1.000, 1.000, 1.000, 1.000, 0.250, 0.524…</code></pre>
</div>
</div>
<section id="variable-types" class="level3" data-number="5.1.1"><h3 data-number="5.1.1" class="anchored" data-anchor-id="variable-types">
<span class="header-section-number">5.1.1</span> Variable types</h3>
<p>The <code>glance()</code> function indicates that there are different variables types, here <code>chr</code> (character string), <code>dbl</code> (numerical value with double precision), and <code>lgl</code> (logical value). What are the data types in <strong>SQL</strong>?<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<section id="numbers" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="numbers">Numbers</h4>
<ul>
<li>exact numeric data types (<code>INTEGER</code>, <code>SMALLINT</code>, <code>DECIMAL</code>, and <code>NUMERIC</code>)<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>
</li>
<li>approximate numeric data types (<code>FLOAT</code>, <code>REAL</code>, and <code>DOUBLE PRECISION</code>)<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>
</li>
<li>integer types <code>INTEGER</code> (or <code>INT</code>) and <code>SMALLINT</code>, <code>TINYINT</code>, <code>MEDIUMINT</code>, and <code>BIGINT</code>
</li>
<li>
<code>DECIMAL(precision, scale)</code>. For example, in <code>DECIMAL(5,2)</code> 5 is the precision and 2 is the scale. The precision represents the number of significant digits that are stored for values, and the scale represents the number of digits that can be stored following the decimal point. <code>DECIMAL(5,2)</code> must store any value with five digits and two decimals, so values that can be stored in the salary column range from -999.99 to 999.99. <code>DECIMAL(M)</code> is equivalent to <code>DECIMAL(M,0)</code>. Similarly, the syntax <code>DECIMAL</code> is equivalent to <code>DECIMAL(M,0)</code>, where the default value of <code>M</code> is 10. If the scale is 0, <code>DECIMAL</code> values contain no decimal point or fractional part.</li>
</ul></section><section id="strings" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="strings">Strings</h4>
<ul>
<li>string data types are <code>CHAR</code>, <code>VARCHAR</code>, <code>BINARY</code>, <code>VARBINARY</code>, <code>BLOB</code>, <code>TEXT</code>, <code>ENUM</code>, and <code>SET</code>
</li>
<li>
<code>CHAR</code> and <code>VARCHAR</code> types are similar, but differ in the way they are stored and retrieved. They also differ in maximum length and in whether trailing spaces are retained.</li>
<li>
<code>CHAR</code> and <code>VARCHAR</code> types are declared with a length that indicates the maximum number of characters you want to store. For example, <code>CHAR(30)</code> can hold up to 30 characters.</li>
<li>The length of a <code>CHAR</code> column is fixed to the length that you declare when you create the table.</li>
<li>Values in <code>VARCHAR</code> columns are variable-length strings. The length can be specified as a value from 0 to 65,535.</li>
<li>
<code>BINARY</code> and <code>VARBINARY</code> types are similar to <code>CHAR</code> and <code>VARCHAR</code>, except that they store binary strings rather than nonbinary strings. That is, they store byte strings rather than character strings.</li>
<li>A <code>BLOB</code> is a binary large object that can hold a variable amount of data. The four <code>BLOB</code> types are <code>TINYBLOB</code>, <code>BLOB</code>, <code>MEDIUMBLOB</code>, and <code>LONGBLOB</code>. These differ only in the maximum length of the values they can hold. The four <code>TEXT</code> types are <code>TINYTEXT</code>, <code>TEXT</code>, <code>MEDIUMTEXT</code>, and <code>LONGTEXT</code>. These correspond to the four <code>BLOB</code> types and have the same maximum lengths and storage requirements.</li>
</ul></section><section id="date" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="date">Date</h4>
<ul>
<li>date and time data types for representing temporal values are <code>DATE</code>, <code>TIME</code>, <code>DATETIME</code>, <code>TIMESTAMP</code>, and <code>YEAR</code>
</li>
<li>
<code>DATE</code> type is used for values with a date part but no time part. <strong>MySQL</strong> retrieves and displays DATE values in ‘YYYY-MM-DD’ format. The supported range is ‘1000-01-01’ to ‘9999-12-31’.</li>
<li>
<code>DATETIME</code> type is used for values that contain both date and time parts. <strong>MySQL</strong> retrieves and displays <code>DATETIME</code> values in ‘YYYY-MM-DD hh:mm:ss’ format. The supported range is ‘1000-01-01 00:00:00’ to ‘9999-12-31 23:59:59’.</li>
<li>
<code>TIMESTAMP</code> data type is used for values that contain both date and time parts. <code>TIMESTAMP</code> has a range of ‘1970-01-01 00:00:01’ UTC to ‘2038-01-19 03:14:07’ UTC.</li>
<li>
<code>TIME</code> values in ‘hh:mm:ss’ format (or ‘hhh:mm:ss’ format for large hours values). <code>TIME</code> values may range from ‘-838:59:59’ to ‘838:59:59’. The hours part may be so large because the TIME type can be used not only to represent a time of day (which must be less than 24 hours), but also elapsed time or a time interval between two events (which may be much greater than 24 hours, or even negative).</li>
<li>
<code>YEAR</code> type is a 1-byte type used to represent year values with a display width of four characters.</li>
</ul></section></section><section id="check-constraints" class="level3" data-number="5.1.2"><h3 data-number="5.1.2" class="anchored" data-anchor-id="check-constraints">
<span class="header-section-number">5.1.2</span> <code>CHECK</code> constraints</h3>
<p>While implementing <code>CREATE TABLE</code>, constraints can be added either to individual variables (<code>CountryPopulation &gt; 0</code>) or to the table as a whole (<code>LastCensus &lt; NextCensus</code>).<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p>If an attempt is made to load data that violate the <code>CHECK</code> constraints, an error will be given.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> CountryListCensus (</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">Id</span> <span class="dt">INT</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    CountryName <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    CountryPopulation <span class="dt">INT</span> <span class="kw">CHECK</span>(CountryPopulation <span class="op">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    LastCensus <span class="dt">DATE</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    NextCensus <span class="dt">DATE</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">CHECK</span>(LastCensus<span class="op">&lt;</span>NextCensus),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (<span class="kw">Id</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="creating-keys" class="level3" data-number="5.1.3"><h3 data-number="5.1.3" class="anchored" data-anchor-id="creating-keys">
<span class="header-section-number">5.1.3</span> Creating <code>KEY</code>s</h3>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> table1 (</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  col1 <span class="op">..</span>.,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  col2 <span class="op">..</span>.,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  col3 <span class="op">..</span>.,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">PRIMARY</span> <span class="kw">KEY</span> col1,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FOREIGN</span> <span class="kw">KEY</span> col2 <span class="kw">REFERENCES</span> table2(table2col1)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Either or both of the <code>KEY</code>s could be multiple columns.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> table1 (</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  col1 <span class="op">..</span>.,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  col2 <span class="op">..</span>.,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  col3 <span class="op">..</span>.,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (col1, col3),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (col1, col2) <span class="kw">REFERENCES</span> table2(table2col1, table2col4)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="creating-indexes" class="level3" data-number="5.1.4"><h3 data-number="5.1.4" class="anchored" data-anchor-id="creating-indexes">
<span class="header-section-number">5.1.4</span> Creating <code>INDEX</code>es</h3>
<p>Indexes can be created on one or more variable. A table does not need to have an <code>INDEX</code> (or a <code>KEY</code>).</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> name_of_index <span class="kw">ON</span> <span class="kw">table</span> (col1);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> name_of_index <span class="kw">ON</span> <span class="kw">table</span> (col1, col2);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-load-data" class="level3" data-number="5.1.5"><h3 data-number="5.1.5" class="anchored" data-anchor-id="sec-load-data">
<span class="header-section-number">5.1.5</span> Loading data</h3>
<p>Once the database is set up, you will be ready to import .csv files into the database as tables. Importing .csv files as tables requires a series of steps:<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<ol type="1">
<li>a <code>USE</code> statement that ensures we are in the right schema/database.</li>
<li>a series of <code>DROP TABLE</code> statements that drop any old tables with the same names as the ones we are going to create.</li>
<li>a series of <code>CREATE TABLE</code> statements that specify the table structures.</li>
<li>a series of <code>COPY</code> statements that read the data from the .csv files into the appropriate tables.</li>
</ol>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="fas fa-triangle-exclamation"></i> Watch out!
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>DuckDB</strong> has its own dialect of <strong>SQL</strong>. To load data into a <strong>MySQL</strong> server, the final statement would be <code>LOAD DATA</code> instead of <code>COPY</code>. See <a href="https://mdsr-book.github.io/mdsr3e/16-sqlII.html#load-into-mysql-database" target="_blank">MDSR</a> for more information on loading data into a remote <strong>MySQL</strong> server.</p>
</div>
</div>
<section id="loading-step-1" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="loading-step-1">Loading step 1</h4>
<p>Use the local database that we’ve called <code>duck_datab</code>.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">USE</span> duck_datab;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="loading-step-2" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="loading-step-2">Loading step 2</h4>
<p>Make sure to “refresh” the table, in case it already exists. However, be very careful with the <code>DROP TABLE</code> statement, as it will <strong>remove</strong> the <code>casts</code> table.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">EXISTS</span> casts;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="loading-step-3" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="loading-step-3">Loading step 3</h4>
<p>Carefully define the variable types, whether or not they allow missing values, and what a default value is for that variable. Additionally, identify the key for accessing information.</p>
<p><strong>MySQL</strong> doesn’t actually have a <code>BOOLEAN</code> datatype (you would use <code>TINYINT(1)</code> instead). But <strong>DuckDB</strong> <em>does</em> have a <code>BOOLEAN</code> datatype!</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> casts (</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  aid <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="st">' '</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  sid <span class="dt">INTEGER</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="dv">0</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  featured <span class="dt">BOOLEAN</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="st">'false'</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  first_epid <span class="dt">INTEGER</span> <span class="kw">DEFAULT</span> <span class="dv">0</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  last_epid <span class="dt">INTEGER</span> <span class="kw">DEFAULT</span> <span class="dv">0</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  update_anchor <span class="dt">BOOLEAN</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="dv">0</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  n_episodes <span class="dt">INTEGER</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="dv">0</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  season_fraction <span class="dt">DECIMAL</span>(<span class="dv">21</span>,<span class="dv">20</span>) <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="dv">0</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (sid, aid)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="loading-step-4" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="loading-step-4">Loading step 4</h4>
<p>The .csv file lives on my computer, so I load it in directly. Note that the statement to load in data is slightly different in <strong>MySQL</strong>.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> casts <span class="kw">FROM</span> <span class="st">'data/casts.csv'</span> <span class="kw">HEADER</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="checking-the-loading" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="checking-the-loading">Checking the loading</h4>
<div class="cell" data-output.var="select_casts" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> casts <span class="kw">LIMIT</span> <span class="dv">8</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="cell-output-display">
<div id="tbl-select-casts" class="anchored">
<table class="table table-striped table-condensed table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;5.1: After <code>CREATE TABLE</code> where variable types are set, the <code>COPY</code> command pulls the data into the table. <code>SELECT</code> shows us that the table is as expected.</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">aid</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">featured</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">first_epid</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">last_epid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">update_anchor</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n_episodes</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">season_fraction</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A. Whitney Brown</td>
<td style="text-align: right;">11</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">19860222</td>
<td style="text-align: right;"></td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.444</td>
</tr>
<tr class="even">
<td style="text-align: left;">A. Whitney Brown</td>
<td style="text-align: right;">12</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A. Whitney Brown</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">A. Whitney Brown</td>
<td style="text-align: right;">14</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A. Whitney Brown</td>
<td style="text-align: right;">15</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">A. Whitney Brown</td>
<td style="text-align: right;">16</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Zweibel</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">19800409</td>
<td style="text-align: right;"></td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.250</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sasheer Zamata</td>
<td style="text-align: right;">39</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">20140118</td>
<td style="text-align: right;"></td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.524</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section><section id="check" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="check">Check</h4>
<p>Let’s make sure that the database exists and that the table in the database exists.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>SHOW DATABASES;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
1 records
</caption>
<thead><tr>
<th style="text-align:left;">
database_name
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:left;">
duck_datab
</td>
</tr></tbody>
</table>
</div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">TABLES</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
1 records
</caption>
<thead><tr>
<th style="text-align:left;">
name
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:left;">
casts
</td>
</tr></tbody>
</table>
</div>
</div>
<div class="cell" data-output.var="casts_describe" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>DESCRIBE casts;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="cell-output-display">
<div id="tbl-casts-describe" class="anchored">
<table class="table table-striped table-condensed table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;5.2: DESCRIBE variables in the casts table.</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">column_name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">column_type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">null</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">key</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">default</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">extra</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">aid</td>
<td style="text-align: left;">VARCHAR</td>
<td style="text-align: left;">NO</td>
<td style="text-align: left;">PRI</td>
<td style="text-align: left;">' '</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">sid</td>
<td style="text-align: left;">INTEGER</td>
<td style="text-align: left;">NO</td>
<td style="text-align: left;">PRI</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">featured</td>
<td style="text-align: left;">BOOLEAN</td>
<td style="text-align: left;">NO</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">'false'</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">first_epid</td>
<td style="text-align: left;">INTEGER</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">last_epid</td>
<td style="text-align: left;">INTEGER</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">update_anchor</td>
<td style="text-align: left;">BOOLEAN</td>
<td style="text-align: left;">NO</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">n_episodes</td>
<td style="text-align: left;">INTEGER</td>
<td style="text-align: left;">NO</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">season_fraction</td>
<td style="text-align: left;">DECIMAL(21,20)</td>
<td style="text-align: left;">NO</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0</td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section></section><section id="sec-load-duckdb" class="level3" data-number="5.1.6"><h3 data-number="5.1.6" class="anchored" data-anchor-id="sec-load-duckdb">
<span class="header-section-number">5.1.6</span> Using <strong>DuckDB</strong> for loading data</h3>
<p>The steps given in <a href="#sec-load-data"><span>Section&nbsp;5.1.5</span></a> are general to many <strong>SQL</strong> dialects and are important when working with most <strong>SQL</strong> clients. It is important to have control over the variables configurations as they make up the <strong>SQL</strong> database. However, using the <strong>duckdb</strong> package in <strong>R</strong> allows for shorthand entry of data from .csv files into the <strong>DuckDB</strong> database. Here, we take advantage of working with the <strong>DuckDB</strong> functionality in R.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/duckdb/man/duckdb_read_csv.html">duckdb_read_csv</a></span><span class="op">(</span>con <span class="op">=</span> <span class="va">con_duckdb</span>, name <span class="op">=</span> <span class="st">"hosts"</span>, files <span class="op">=</span> <span class="st">"data/hosts.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/duckdb/man/duckdb_read_csv.html">duckdb_read_csv</a></span><span class="op">(</span>con <span class="op">=</span> <span class="va">con_duckdb</span>, name <span class="op">=</span> <span class="st">"episodes"</span>, files <span class="op">=</span> <span class="st">"data/episodes.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="checking-the-loading-1" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="checking-the-loading-1">Checking the loading</h4>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">TABLES</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
3 records
</caption>
<thead><tr>
<th style="text-align:left;">
name
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
casts
</td>
</tr>
<tr>
<td style="text-align:left;">
episodes
</td>
</tr>
<tr>
<td style="text-align:left;">
hosts
</td>
</tr>
</tbody>
</table>
</div>
</div>
</section></section></section><section id="best-practice" class="level2" data-number="5.2"><h2 data-number="5.2" class="anchored" data-anchor-id="best-practice">
<span class="header-section-number">5.2</span> Best practice</h2>
<p>It is always a good idea to terminate the <strong>SQL</strong> connection when you are done with it.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html">dbDisconnect</a></span><span class="op">(</span><span class="va">con_duckdb</span>, shutdown <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="reflection-questions" class="level2" data-number="5.3"><h2 data-number="5.3" class="anchored" data-anchor-id="reflection-questions">
<span class="header-section-number">5.3</span> <i class="fas fa-lightbulb"></i> Reflection questions</h2>
<ol type="1">
<li><p>What is the difference between <strong>R</strong> and <strong>SQL</strong> in terms of communicating the different <em>data types</em>?</p></li>
<li><p>Why does it matter if the variable type is specified correctly? For example, why would it be better for a date column to be specified as <code>DATETIME</code> instead of <code>VARCHAR</code>?</p></li>
<li><p>If you are Googling some <strong>SQL</strong> syntax, why do you need to specify the dialect, for example, <strong>DuckDB</strong> or <strong>MySQL</strong>?</p></li>
<li><p>Why do we often include the <code>DROP TABLE</code> operation before the <code>CREATE TABLE</code> operation?</p></li>
</ol></section><section id="ethics-considerations" class="level2" data-number="5.4"><h2 data-number="5.4" class="anchored" data-anchor-id="ethics-considerations">
<span class="header-section-number">5.4</span> <i class="fas fa-balance-scale"></i> Ethics considerations</h2>
<ol type="1">
<li><p>When creating a database why should we worry about the provenance (origin) of the data?</p></li>
<li><p>How does a <strong>SQL</strong> database automatically hold extra information about the database (e.g., provenance)? Spoiler: it doesn’t. So what can we do?</p></li>
</ol>


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Taken from https://dev.mysql.com/doc/refman/8.0/en/data-types.html<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The keyword <code>INT</code> is a synonym for <code>INTEGER</code>, and the keywords <code>DEC</code> and <code>FIXED</code> are synonyms for <code>DECIMAL</code><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p> <strong>MySQL</strong> treats <code>DOUBLE</code> as a synonym for <code>DOUBLE PRECISION</code>. <strong>MySQL</strong> also treats <code>REAL</code> as a synonym for <code>DOUBLE PRECISION</code>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Example from https://www.sqlshack.com/how-to-use-sql-check-constraints/<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>taken from <a href="https://mdsr-book.github.io/mdsr3e/16-sqlII.html#load-into-mysql-database" target="_blank">MDSR</a>.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./p3-build-db.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Building databases</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06-change-db.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Changing databases</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Data Science, the SQL by Jo Hardin.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Built with 💚 and <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>