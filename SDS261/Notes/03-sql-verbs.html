<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Jo Hardin">
<title>Data Science, the SQL - 3&nbsp; SQL verbs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04-sql-joins.html" rel="next">
<link href="./p2-using-sql.html" rel="prev">
<link href="./images/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/x-mathjax-config">
const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers){
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');
  
  // Will this work with TeX on its own line?
  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
  	MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
  	MathJax.Hub.Queue(function(){
      popover.setAttribute('data-content', div.innerHTML);
  	})
  }
}
</script><link rel="shortcut icon" href="figs/favicon.ico">
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script><link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="site_libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet">
<script src="site_libs/bsTable-3.3.7/bootstrapTable.js"></script><link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css2?family=Quicksand" type="text/css">
</head>
<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./p2-using-sql.html">Using SQL</a></li><li class="breadcrumb-item"><a href="./03-sql-verbs.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">SQL verbs</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science, the SQL</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/hardin47/SDS261-SQL" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome to Data Science, the SQL</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p1-intro-to-sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to databases and SQL</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-db.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Databases</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-sql-in-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">SQL in R</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p2-using-sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using SQL</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-sql-verbs.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">SQL verbs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-sql-joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title"><code>join</code>ing tables in SQL</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p3-build-db.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Building databases</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-creating-db.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Creating databases</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-const-change-db.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Untitled</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p4-reg-expr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regular expressions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-reg-expr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Regular Expressions</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#looking-at-the-tables-in-the-database" id="toc-looking-at-the-tables-in-the-database" class="nav-link active" data-scroll-target="#looking-at-the-tables-in-the-database"><span class="header-section-number">3.1</span> Looking at the tables in the database</a></li>
  <li><a href="#select-from" id="toc-select-from" class="nav-link" data-scroll-target="#select-from"><span class="header-section-number">3.2</span> SELECT … FROM</a></li>
  <li><a href="#where" id="toc-where" class="nav-link" data-scroll-target="#where"><span class="header-section-number">3.3</span> WHERE</a></li>
  <li><a href="#group-by" id="toc-group-by" class="nav-link" data-scroll-target="#group-by"><span class="header-section-number">3.4</span> GROUP BY</a></li>
  <li><a href="#order-by" id="toc-order-by" class="nav-link" data-scroll-target="#order-by"><span class="header-section-number">3.5</span> ORDER BY</a></li>
  <li><a href="#having" id="toc-having" class="nav-link" data-scroll-target="#having"><span class="header-section-number">3.6</span> HAVING</a></li>
  <li><a href="#limit" id="toc-limit" class="nav-link" data-scroll-target="#limit"><span class="header-section-number">3.7</span> LIMIT</a></li>
  <li><a href="#saving-sql-queries-as-r-objects" id="toc-saving-sql-queries-as-r-objects" class="nav-link" data-scroll-target="#saving-sql-queries-as-r-objects"><span class="header-section-number">4</span> Saving <strong>SQL</strong> queries as <strong>R</strong> objects</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/hardin47/SDS261-SQL/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-sql-verbs" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">SQL verbs</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>Most of this chapter will focus on the <strong>SQL</strong> commands needed to run queries of the database. Much of the syntax is strikingly familiar to tidy verbs in <strong>R</strong>. However, this chapter starts with a few <strong>SQL</strong> specific tools used to learn about the tables in any particular database.</p>
<section id="looking-at-the-tables-in-the-database" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="looking-at-the-tables-in-the-database">
<span class="header-section-number">3.1</span> Looking at the tables in the database</h2>
<p>Consider a database of</p>
<!--
Hadley Wickham discusses how to use Sys.getenv: https://cran.r-project.org/web/packages/httr/vignettes/secrets.html
-->
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mdsr-book/mdsr">mdsr</a></span><span class="op">)</span></span>
<span><span class="va">con_taxi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mdsr/man/src_scidb.html">dbConnect_scidb</a></span><span class="op">(</span><span class="st">"nyctaxi"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">TABLES</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
1 records
</caption>
<thead><tr>
<th style="text-align:left;">
Tables_in_nyctaxi
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:left;">
yellow_old
</td>
</tr></tbody>
</table>
</div>
</div>
<p>There is only one table in the <code>nyctaxi</code> database, called <code>yellow_old</code>.</p>
<div class="cell" data-output.var="select_explain" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">EXPLAIN</span> yellow_old;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="cell-output-display">
<div id="tbl-select-explain" class="anchored">
<table class="table table-striped table-condensed table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;3.1: EXPLAIN variables in yellow_old</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Field</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Null</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Key</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Default</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Extra</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">vendor_id</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">pickup_datetime</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">dropoff_datetime</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">passenger_count</td>
<td style="text-align: left;">bigint(20)</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">trip_distance</td>
<td style="text-align: left;">double</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">pickup_longitude</td>
<td style="text-align: left;">double</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">pickup_latitude</td>
<td style="text-align: left;">double</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">rate_code</td>
<td style="text-align: left;">bigint(20)</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">store_and_fwd_flag</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">dropoff_longitude</td>
<td style="text-align: left;">double</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">dropoff_latitude</td>
<td style="text-align: left;">double</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">payment_type</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">fare_amount</td>
<td style="text-align: left;">double</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">surcharge</td>
<td style="text-align: left;">double</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">mta_tax</td>
<td style="text-align: left;">double</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">tip_amount</td>
<td style="text-align: left;">double</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">tolls_amount</td>
<td style="text-align: left;">double</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">total_amount</td>
<td style="text-align: left;">double</td>
<td style="text-align: left;">YES</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>The <code>EXPLAIN</code> command describes the 18 field names (variables) in the <code>yellow_old</code> table. Some of the variables are characters (<code>text</code>) and some are numeric (either <code>double</code> or <code>bigint</code>)</p>
<p>Most engagements with SQL are don through queries. Queries in <strong>SQL</strong> start with the <code>SELECT</code> keyword and consist of several clauses, which must be written in the following order:<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<ul>
<li>
<code>SELECT</code> allows you to list the columns, or functions operating on columns, that you want to retrieve. This is an analogous operation to the <code>select()</code> verb in <strong>dplyr</strong>, potentially combined with <code>mutate()</code> or <code>summarize()</code>.</li>
<li>
<code>FROM</code> specifies the table where the data are.</li>
<li>
<code>JOIN</code> allows you to stitch together two or more tables using a key. This is analogous to the <code>inner_join()</code> and <code>left_join()</code> commands in <strong>dplyr</strong>. More details of <code>JOIN</code> are given in <a href="04-sql-joins.html"><span>Chapter&nbsp;4</span></a>.</li>
<li>
<code>WHERE</code> allows you to filter the records according to some criteria and is an analogous operation to the <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> verb in <strong>dplyr</strong>.</li>
<li>
<code>GROUP BY</code> allows you to aggregate the records according to some shared value and is an analogous operation to the <code>group_by()</code> verb in <strong>dplyr</strong>.</li>
<li>
<code>HAVING</code> is like a <code>WHERE</code> clause that operates on the result set—not the records themselves and is analogous to applying a second <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> command in <strong>dplyr</strong>, after the rows have already been aggregated.</li>
<li>
<code>ORDER BY</code> is exactly what it sounds like—it specifies a condition for ordering the rows of the result set and is analogous to the <code>arrange()</code> verb in <strong>dplyr</strong>.</li>
<li>
<code>LIMIT</code> restricts the number of rows in the output and is similar to the <strong>R</strong> commands <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code> and <code>slice()</code>.</li>
</ul></section><section id="select-from" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="select-from">
<span class="header-section-number">3.2</span> SELECT … FROM</h2>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>R</strong> function: <code>select()</code></p>
</div>
</div>
</div>
<p>A <strong>SQL</strong> query starts with a <code>SELECT</code> command and has a corresponding <code>FROM</code> to indicate the table being queried. Columns may be specified, or the <code>*</code> will indicate that every column in the table should be returned.</p>
<p>The shortest <strong>SQL</strong> query is the following <code>SELECT</code> command. Do not run this command!!! The <code>yellow_old</code> table has 15 million rows, and we do not want to look at them simultaneously.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>DO NOT RUN<span class="sc">:</span>  SELECT <span class="sc">*</span> FROM yellow_old;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="fas fa-triangle-exclamation"></i> Watch out!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Do not run the following command unless you are <strong>certain</strong> that the table from which you are querying is small enough so that the query results fit easily into your memory.</p>
<p><code>SELECT</code> * <code>FROM</code> table;</p>
</div>
</div>
<p>Instead, to look at the top of the table, <code>SELECT</code> the first few rows. The <code>LIMIT</code> command specifies which rows to select: the first number is the number of rows to skip (0 rows skipped), the second number is the number of rows to print up to (up to row 14).</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> yellow_old <span class="kw">LIMIT</span> <span class="dv">0</span>, <span class="dv">14</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
Displaying records 1 - 10
</caption>
<thead><tr>
<th style="text-align:left;">
vendor_id
</th>
<th style="text-align:left;">
pickup_datetime
</th>
<th style="text-align:left;">
dropoff_datetime
</th>
<th style="text-align:right;">
passenger_count
</th>
<th style="text-align:right;">
trip_distance
</th>
<th style="text-align:right;">
pickup_longitude
</th>
<th style="text-align:right;">
pickup_latitude
</th>
<th style="text-align:right;">
rate_code
</th>
<th style="text-align:left;">
store_and_fwd_flag
</th>
<th style="text-align:right;">
dropoff_longitude
</th>
<th style="text-align:right;">
dropoff_latitude
</th>
<th style="text-align:left;">
payment_type
</th>
<th style="text-align:right;">
fare_amount
</th>
<th style="text-align:right;">
surcharge
</th>
<th style="text-align:right;">
mta_tax
</th>
<th style="text-align:right;">
tip_amount
</th>
<th style="text-align:right;">
tolls_amount
</th>
<th style="text-align:right;">
total_amount
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
CMT
</td>
<td style="text-align:left;">
2014-03-01 01:07:38
</td>
<td style="text-align:left;">
2014-03-01 01:16:26
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
-74.0
</td>
<td style="text-align:right;">
40.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:right;">
-73.9
</td>
<td style="text-align:right;">
40.7
</td>
<td style="text-align:left;">
CRD
</td>
<td style="text-align:right;">
9.0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
12.0
</td>
</tr>
<tr>
<td style="text-align:left;">
CMT
</td>
<td style="text-align:left;">
2014-03-01 01:08:03
</td>
<td style="text-align:left;">
2014-03-01 01:12:51
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.2
</td>
<td style="text-align:right;">
-74.0
</td>
<td style="text-align:right;">
40.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:right;">
-74.0
</td>
<td style="text-align:right;">
40.7
</td>
<td style="text-align:left;">
CRD
</td>
<td style="text-align:right;">
6.0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
8.0
</td>
</tr>
<tr>
<td style="text-align:left;">
CMT
</td>
<td style="text-align:left;">
2014-03-01 01:08:51
</td>
<td style="text-align:left;">
2014-03-01 01:13:18
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
-73.9
</td>
<td style="text-align:right;">
40.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:right;">
-74.0
</td>
<td style="text-align:right;">
40.7
</td>
<td style="text-align:left;">
CRD
</td>
<td style="text-align:right;">
5.0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
1.2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7.2
</td>
</tr>
<tr>
<td style="text-align:left;">
CMT
</td>
<td style="text-align:left;">
2014-03-01 01:09:20
</td>
<td style="text-align:left;">
2014-03-01 01:24:18
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3.5
</td>
<td style="text-align:right;">
-74.0
</td>
<td style="text-align:right;">
40.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:right;">
-74.0
</td>
<td style="text-align:right;">
40.8
</td>
<td style="text-align:left;">
CRD
</td>
<td style="text-align:right;">
14.0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
3.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
18.0
</td>
</tr>
<tr>
<td style="text-align:left;">
CMT
</td>
<td style="text-align:left;">
2014-03-01 01:09:46
</td>
<td style="text-align:left;">
2014-03-01 01:22:34
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.8
</td>
<td style="text-align:right;">
-74.0
</td>
<td style="text-align:right;">
40.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:right;">
-74.0
</td>
<td style="text-align:right;">
40.7
</td>
<td style="text-align:left;">
CRD
</td>
<td style="text-align:right;">
10.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
12.5
</td>
</tr>
<tr>
<td style="text-align:left;">
CMT
</td>
<td style="text-align:left;">
2014-03-01 01:12:41
</td>
<td style="text-align:left;">
2014-03-01 01:15:38
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
-74.0
</td>
<td style="text-align:right;">
40.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:right;">
-74.0
</td>
<td style="text-align:right;">
40.7
</td>
<td style="text-align:left;">
CRD
</td>
<td style="text-align:right;">
4.0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5.5
</td>
</tr>
<tr>
<td style="text-align:left;">
CMT
</td>
<td style="text-align:left;">
2014-03-01 01:12:11
</td>
<td style="text-align:left;">
2014-03-01 01:27:38
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3.7
</td>
<td style="text-align:right;">
-74.0
</td>
<td style="text-align:right;">
40.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:right;">
-74.0
</td>
<td style="text-align:right;">
40.7
</td>
<td style="text-align:left;">
CRD
</td>
<td style="text-align:right;">
14.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
3.1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
18.6
</td>
</tr>
<tr>
<td style="text-align:left;">
CMT
</td>
<td style="text-align:left;">
2014-03-01 01:13:55
</td>
<td style="text-align:left;">
2014-03-01 01:34:54
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5.4
</td>
<td style="text-align:right;">
-74.0
</td>
<td style="text-align:right;">
40.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:right;">
-74.0
</td>
<td style="text-align:right;">
40.7
</td>
<td style="text-align:left;">
CRD
</td>
<td style="text-align:right;">
20.0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
3.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
24.0
</td>
</tr>
<tr>
<td style="text-align:left;">
CMT
</td>
<td style="text-align:left;">
2014-03-01 01:14:06
</td>
<td style="text-align:left;">
2014-03-01 01:28:25
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3.5
</td>
<td style="text-align:right;">
-74.0
</td>
<td style="text-align:right;">
40.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:right;">
-74.0
</td>
<td style="text-align:right;">
40.8
</td>
<td style="text-align:left;">
CRD
</td>
<td style="text-align:right;">
13.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
2.9
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
17.4
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Speaking of which, how many rows are there in the <code>yellow_old</code> table? That is, how many taxi rides are recorded? Now <code>SELECT</code> is used with a summary function, <code>COUNT()</code>. Instead of using a separate summary function (like <code>mutate()</code> or <code>summarize()</code>), all the work is done inside the <code>SELECT</code> call.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">FROM</span> yellow_old;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
1 records
</caption>
<thead><tr>
<th style="text-align:right;">
COUNT(*)
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:right;">
15428128
</td>
</tr></tbody>
</table>
</div>
</div>
<p>Yikes, more than 15 million taxi rides!!!!</p>
<p>You might have noticed that the <code>yellow_old</code> table has two different datetime variables (one for pickup, the other for dropoff). We can use the information to assess the length of each ride (in time, not distance). However, the variables are stored in SQL as character strings instead of in a DateTime format (even though they <strong>look</strong> like they are stored in a DateTime format!), see <a href="#tbl-select-explain">Table&nbsp;<span>3.1</span></a>. Fortunately for us, <strong>SQL</strong> has functionality to convert a <code>text</code> Type into <code>DateTime</code> type (POSIXct is a special type of DateTime formatting).</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>      pickup_datetime, dropoff_datetime,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>      STR_TO_DATE(pickup_datetime, <span class="ot">"%Y-%m-%d %T"</span>) <span class="kw">AS</span> pickup,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>      STR_TO_DATE(dropoff_datetime, <span class="ot">"%Y-%m-%d %T"</span>) <span class="kw">AS</span> dropoff</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>   <span class="kw">FROM</span> yellow_old</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>   <span class="kw">LIMIT</span> <span class="dv">0</span>, <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
Displaying records 1 - 10
</caption>
<thead><tr>
<th style="text-align:left;">
pickup_datetime
</th>
<th style="text-align:left;">
dropoff_datetime
</th>
<th style="text-align:left;">
pickup
</th>
<th style="text-align:left;">
dropoff
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:07:38
</td>
<td style="text-align:left;">
2014-03-01 01:16:26
</td>
<td style="text-align:left;">
2014-03-01 01:07:38
</td>
<td style="text-align:left;">
2014-03-01 01:16:26
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:08:03
</td>
<td style="text-align:left;">
2014-03-01 01:12:51
</td>
<td style="text-align:left;">
2014-03-01 01:08:03
</td>
<td style="text-align:left;">
2014-03-01 01:12:51
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:08:51
</td>
<td style="text-align:left;">
2014-03-01 01:13:18
</td>
<td style="text-align:left;">
2014-03-01 01:08:51
</td>
<td style="text-align:left;">
2014-03-01 01:13:18
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:09:20
</td>
<td style="text-align:left;">
2014-03-01 01:24:18
</td>
<td style="text-align:left;">
2014-03-01 01:09:20
</td>
<td style="text-align:left;">
2014-03-01 01:24:18
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:09:46
</td>
<td style="text-align:left;">
2014-03-01 01:22:34
</td>
<td style="text-align:left;">
2014-03-01 01:09:46
</td>
<td style="text-align:left;">
2014-03-01 01:22:34
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:12:41
</td>
<td style="text-align:left;">
2014-03-01 01:15:38
</td>
<td style="text-align:left;">
2014-03-01 01:12:41
</td>
<td style="text-align:left;">
2014-03-01 01:15:38
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:12:11
</td>
<td style="text-align:left;">
2014-03-01 01:27:38
</td>
<td style="text-align:left;">
2014-03-01 01:12:11
</td>
<td style="text-align:left;">
2014-03-01 01:27:38
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:13:55
</td>
<td style="text-align:left;">
2014-03-01 01:34:54
</td>
<td style="text-align:left;">
2014-03-01 01:13:55
</td>
<td style="text-align:left;">
2014-03-01 01:34:54
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:14:06
</td>
<td style="text-align:left;">
2014-03-01 01:28:25
</td>
<td style="text-align:left;">
2014-03-01 01:14:06
</td>
<td style="text-align:left;">
2014-03-01 01:28:25
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Now that the variables are no longer strings, we can subtract them to figure out the number of minutes for each taxi ride. Unfortunately, the following code won’t run because neither of the variables <code>pickup</code> or <code>dropoff</code> are in the table <code>yellow_old</code>.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>      pickup_datetime, dropoff_datetime,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>      STR_TO_DATE(pickup_datetime, <span class="ot">"%Y-%m-%d %T"</span>) <span class="kw">AS</span> pickup,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>      STR_TO_DATE(dropoff_datetime, <span class="ot">"%Y-%m-%d %T"</span>) <span class="kw">AS</span> dropoff.</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>      TIMEDIFF(pickup, dropoff) <span class="kw">AS</span> length_min</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>   <span class="kw">FROM</span> yellow_old</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>   <span class="kw">LIMIT</span> <span class="dv">0</span>, <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Instead, we need two layers of <code>SELECT</code> commands so that the first <code>SELECT</code> (i.e., inside) layer creates the new variables, and the second <code>SELECT</code> (i.e., outside) layer subtracts the two times.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>   pickup,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>   dropoff, </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>   TIMEDIFF(pickup, dropoff) <span class="kw">AS</span> length_time </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> (</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>   <span class="kw">SELECT</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      STR_TO_DATE(pickup_datetime, <span class="ot">"%Y-%m-%d %T"</span>) <span class="kw">AS</span> pickup,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      STR_TO_DATE(dropoff_datetime, <span class="ot">"%Y-%m-%d %T"</span>) <span class="kw">AS</span> dropoff</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>   <span class="kw">FROM</span> yellow_old)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>   <span class="kw">AS</span> subquery_table</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">0</span>, <span class="dv">20</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
Displaying records 1 - 10
</caption>
<thead><tr>
<th style="text-align:left;">
pickup
</th>
<th style="text-align:left;">
dropoff
</th>
<th style="text-align:left;">
length_time
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:07:38
</td>
<td style="text-align:left;">
2014-03-01 01:16:26
</td>
<td style="text-align:left;">
00:08:48
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:08:03
</td>
<td style="text-align:left;">
2014-03-01 01:12:51
</td>
<td style="text-align:left;">
00:04:48
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:08:51
</td>
<td style="text-align:left;">
2014-03-01 01:13:18
</td>
<td style="text-align:left;">
00:04:27
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:09:20
</td>
<td style="text-align:left;">
2014-03-01 01:24:18
</td>
<td style="text-align:left;">
00:14:58
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:09:46
</td>
<td style="text-align:left;">
2014-03-01 01:22:34
</td>
<td style="text-align:left;">
00:12:48
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:12:41
</td>
<td style="text-align:left;">
2014-03-01 01:15:38
</td>
<td style="text-align:left;">
00:02:57
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:12:11
</td>
<td style="text-align:left;">
2014-03-01 01:27:38
</td>
<td style="text-align:left;">
00:15:27
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:13:55
</td>
<td style="text-align:left;">
2014-03-01 01:34:54
</td>
<td style="text-align:left;">
00:20:59
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:14:06
</td>
<td style="text-align:left;">
2014-03-01 01:28:25
</td>
<td style="text-align:left;">
00:14:19
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Alternatively, the <code>STR_TO_DATE()</code> function can be applied inside the <code>TIMEDIFF()</code> function so that the full (now only) <code>SELECT</code> command is being used only on variables that are in the original table.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>   pickup_datetime,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>   dropoff_datetime, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>   TIMEDIFF(STR_TO_DATE(pickup_datetime, <span class="ot">"%Y-%m-%d %T"</span>), </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>            STR_TO_DATE(dropoff_datetime, <span class="ot">"%Y-%m-%d %T"</span>)) <span class="kw">AS</span> length_time </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> yellow_old</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">0</span>, <span class="dv">20</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">

<table>
<caption>
Displaying records 1 - 10
</caption>
<thead><tr>
<th style="text-align:left;">
pickup_datetime
</th>
<th style="text-align:left;">
dropoff_datetime
</th>
<th style="text-align:left;">
length_time
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:07:38
</td>
<td style="text-align:left;">
2014-03-01 01:16:26
</td>
<td style="text-align:left;">
00:08:48
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:08:03
</td>
<td style="text-align:left;">
2014-03-01 01:12:51
</td>
<td style="text-align:left;">
00:04:48
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:08:51
</td>
<td style="text-align:left;">
2014-03-01 01:13:18
</td>
<td style="text-align:left;">
00:04:27
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:09:20
</td>
<td style="text-align:left;">
2014-03-01 01:24:18
</td>
<td style="text-align:left;">
00:14:58
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:09:46
</td>
<td style="text-align:left;">
2014-03-01 01:22:34
</td>
<td style="text-align:left;">
00:12:48
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:12:41
</td>
<td style="text-align:left;">
2014-03-01 01:15:38
</td>
<td style="text-align:left;">
00:02:57
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:12:11
</td>
<td style="text-align:left;">
2014-03-01 01:27:38
</td>
<td style="text-align:left;">
00:15:27
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:13:55
</td>
<td style="text-align:left;">
2014-03-01 01:34:54
</td>
<td style="text-align:left;">
00:20:59
</td>
</tr>
<tr>
<td style="text-align:left;">
2014-03-01 01:14:06
</td>
<td style="text-align:left;">
2014-03-01 01:28:25
</td>
<td style="text-align:left;">
00:14:19
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Keep in mind that there is a distinction between clauses that operate on the <em>variables of the original table</em> versus those that operate on the <em>variables of the results set</em>. The variables <code>pickup_datetime</code> and <code>dropoff_datetime</code> are columns in the original table - they are written to disk on the <strong>SQL</strong> server. The variables <code>pickup</code>, <code>dropoff</code>, and <code>length_time</code> exist only in the results set, which is passed from the server (<strong>SQL</strong> server) to the client (e.g., <strong>RStudio</strong> or <strong>DBeaver</strong>) and is not written to disk.</p>
</section><section id="where" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="where">
<span class="header-section-number">3.3</span> WHERE</h2>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>R</strong> function: <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code></p>
</div>
</div>
</div>
<p>The <code>WHERE</code> clause is analogous to the <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> function in <strong>dplyr</strong>. However, keep in mind that there are two <strong>SQL</strong> commands that resemble the <strong>dplyr</strong> <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> function. <code>WHERE</code> operates on the original data in the table and <code>HAVING</code> operates on the result set. See below for examples using <code>HAVING</code>.</p>
<p>What was the fare for those taxi rides where the <code>tip_amount</code> was more than $10 and the person used cash? (Note that in <strong>SQL</strong> the equality logical is <code>=</code> and in <strong>R</strong> the equality logical is <code>==</code>.)</p>
<div class="cell" data-output.var="select_10" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> payment_type, fare_amount, tip_amount, total_amount</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> yellow_old</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> tip_amount <span class="op">&gt;</span> <span class="dv">10</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>   <span class="kw">AND</span> payment_type <span class="op">=</span> <span class="ot">"CSH"</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">0</span>, <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="cell-output-display">
<div id="tbl-select-10" class="anchored">
<table class="table table-striped table-condensed table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;3.2: SELECT payment amounts from yellow_old</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">payment_type</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">fare_amount</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">tip_amount</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">total_amount</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CSH</td>
<td style="text-align: right;">65.5</td>
<td style="text-align: right;">15.3</td>
<td style="text-align: right;">91.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">CSH</td>
<td style="text-align: right;">52.0</td>
<td style="text-align: right;">11.6</td>
<td style="text-align: right;">69.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CSH</td>
<td style="text-align: right;">52.0</td>
<td style="text-align: right;">11.6</td>
<td style="text-align: right;">69.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">CSH</td>
<td style="text-align: right;">55.0</td>
<td style="text-align: right;">16.2</td>
<td style="text-align: right;">81.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CSH</td>
<td style="text-align: right;">71.5</td>
<td style="text-align: right;">20.0</td>
<td style="text-align: right;">103.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">CSH</td>
<td style="text-align: right;">70.0</td>
<td style="text-align: right;">16.2</td>
<td style="text-align: right;">97.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CSH</td>
<td style="text-align: right;">95.0</td>
<td style="text-align: right;">21.9</td>
<td style="text-align: right;">131.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">CSH</td>
<td style="text-align: right;">62.5</td>
<td style="text-align: right;">15.5</td>
<td style="text-align: right;">93.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CSH</td>
<td style="text-align: right;">66.0</td>
<td style="text-align: right;">15.0</td>
<td style="text-align: right;">90.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">CSH</td>
<td style="text-align: right;">65.0</td>
<td style="text-align: right;">13.2</td>
<td style="text-align: right;">79.2</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p><code>BETWEEN</code> can be used to specify a range of values for a numeric value.</p>
<div class="cell" data-output.var="select_1020a" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> payment_type, fare_amount, tip_amount, total_amount</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> yellow_old</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> tip_amount <span class="kw">BETWEEN</span> <span class="dv">10</span> <span class="kw">and</span> <span class="dv">20</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>   <span class="kw">AND</span> payment_type <span class="op">=</span> <span class="ot">"CSH"</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">0</span>, <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>IN</code> is similar to the <strong>dplyr</strong> <code>%in%</code> function which specifies distinct values for the variable.</p>
<div class="cell" data-output.var="select_1020b" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> payment_type, fare_amount, tip_amount, total_amount</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> yellow_old</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> tip_amount <span class="kw">IN</span> (<span class="dv">10</span>, <span class="dv">20</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>   <span class="kw">AND</span> payment_type <span class="op">=</span> <span class="ot">"CSH"</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">0</span>, <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>WHERE</code> clause can be established by a number of logical commands combined using either <code>AND</code> or <code>OR</code>.</p>
</section><section id="group-by" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="group-by">
<span class="header-section-number">3.4</span> GROUP BY</h2>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>R</strong> function: <code>group_by()</code></p>
</div>
</div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="order-by" class="level2" data-number="3.5"><h2 data-number="3.5" class="anchored" data-anchor-id="order-by">
<span class="header-section-number">3.5</span> ORDER BY</h2>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>R</strong> function: <code>arrange()</code></p>
</div>
</div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="having" class="level2" data-number="3.6"><h2 data-number="3.6" class="anchored" data-anchor-id="having">
<span class="header-section-number">3.6</span> HAVING</h2>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>R</strong> function: <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code></p>
</div>
</div>
</div>
<p>make the example based on the time variable (in the result set!)</p>
<p><code>WHERE</code> operates on the original data in the table and <code>HAVING</code> operates on the result set.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="limit" class="level2" data-number="3.7"><h2 data-number="3.7" class="anchored" data-anchor-id="limit">
<span class="header-section-number">3.7</span> LIMIT</h2>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>R</strong> function: <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code></p>
</div>
</div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="saving-sql-queries-as-r-objects" class="level1" data-number="4"><h1 data-number="4">
<span class="header-section-number">4</span> Saving <strong>SQL</strong> queries as <strong>R</strong> objects</h1>
<p>If you are working in <strong>R</strong> to run <strong>SQL</strong> commands, you may want to use the query output for further analysis or visualizations.</p>


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Taken directly from <a href="https://mdsr-book.github.io/mdsr3e/15-sqlI.html#the-sql-data-manipulation-language" target="_blank">Modern Data Science with R</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./p2-using-sql.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Using SQL</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04-sql-joins.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title"><code>join</code>ing tables in SQL</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Data Science, the SQL by Jo Hardin.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Built with 💚 and <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>