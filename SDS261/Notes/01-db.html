<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Jo Hardin">
<title>Data Science, the SQL - 1&nbsp; Databases</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./02-sql-in-R.html" rel="next">
<link href="./p1-intro-to-sql.html" rel="prev">
<link href="./images/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/x-mathjax-config">
const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers){
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');
  
  // Will this work with TeX on its own line?
  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
  	MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
  	MathJax.Hub.Queue(function(){
      popover.setAttribute('data-content', div.innerHTML);
  	})
  }
}
</script><link rel="shortcut icon" href="figs/favicon.ico">
<link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css2?family=Quicksand" type="text/css">
</head>
<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./p1-intro-to-sql.html">Introduction to databases and SQL</a></li><li class="breadcrumb-item"><a href="./01-db.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Databases</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science, the SQL</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/hardin47/SDS261-SQL" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome to Data Science, the SQL</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p1-intro-to-sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to databases and SQL</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-db.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Databases</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-sql-in-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">SQL in R</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p2-using-sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using SQL</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-sql-verbs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">SQL verbs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-sql-joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title"><code>join</code>ing tables in SQL</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p3-build-db.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Building databases</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-creating-db.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Creating databases</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-const-change-db.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Untitled</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p4-reg-expr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regular expressions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-reg-expr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Regular Expressions</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#sec-what-db" id="toc-sec-what-db" class="nav-link active" data-scroll-target="#sec-what-db"><span class="header-section-number">1.1</span> What is a database?</a></li>
  <li><a href="#tables-in-sql" id="toc-tables-in-sql" class="nav-link" data-scroll-target="#tables-in-sql"><span class="header-section-number">1.2</span> Tables in <strong>SQL</strong></a></li>
  <li>
<a href="#engaging-with-a-database" id="toc-engaging-with-a-database" class="nav-link" data-scroll-target="#engaging-with-a-database"><span class="header-section-number">1.3</span> Engaging with a database</a>
  <ul class="collapse">
<li><a href="#many-sql-implementations" id="toc-many-sql-implementations" class="nav-link" data-scroll-target="#many-sql-implementations"><span class="header-section-number">1.3.1</span> Many <strong>SQL</strong> implementations</a></li>
  <li><a href="#sql-interfaces" id="toc-sql-interfaces" class="nav-link" data-scroll-target="#sql-interfaces"><span class="header-section-number">1.3.2</span> <strong>SQL</strong> interfaces</a></li>
  <li><a href="#sql-in-process" id="toc-sql-in-process" class="nav-link" data-scroll-target="#sql-in-process"><span class="header-section-number">1.3.3</span> <strong>SQL</strong> in-process</a></li>
  </ul>
</li>
  <li>
<a href="#connecting-to-a-database" id="toc-connecting-to-a-database" class="nav-link" data-scroll-target="#connecting-to-a-database"><span class="header-section-number">1.4</span> Connecting to a database</a>
  <ul class="collapse">
<li><a href="#creating-a-database-connection" id="toc-creating-a-database-connection" class="nav-link" data-scroll-target="#creating-a-database-connection"><span class="header-section-number">1.4.1</span> Creating a database connection</a></li>
  <li><a href="#connecting-to-duckdb" id="toc-connecting-to-duckdb" class="nav-link" data-scroll-target="#connecting-to-duckdb"><span class="header-section-number">1.4.2</span> Connecting to Duckdb</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/hardin47/SDS261-SQL/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-db" class="quarto-section-identifier"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Databases</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>The main focus of the course will be on <strong>SQL</strong> (pronounced “sequel” by many people and “s-q-l” by others), short for structured query language. However, before we jump into learning the power of <strong>SQL</strong>, we will start with two preliminary lessons:</p>
<ol type="1">
<li>understanding what is a database and why would we ever want to use a database. See <a href="#sec-what-db"><span>Section&nbsp;1.1</span></a>.</li>
<li>using the <strong>R</strong> package <strong>dpplyr</strong> which translates <strong>dplyr</strong> code into <strong>SQL</strong>. Recall the data wrangling with which you are already familiar, including <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>, and <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>, all of which live in <strong>dplyr</strong>. See <a href="02-sql-in-R.html#sec-dplyr-seq"><span>Section&nbsp;2.1</span></a>.</li>
</ol>
<section id="sec-what-db" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="sec-what-db">
<span class="header-section-number">1.1</span> What is a database?</h2>
<p>You are likely already familiar with the concept of <em>tidy</em> data. (If you have never encountered tidy data, see <a href="https://r4ds.hadley.nz/data-tidy" target="_blank">Chapter 5 Data tidying</a> in <strong>R for Data Science</strong>.) Tidy data typically live in data frames or <strong>tables</strong>; where, importantly, they consist of columns of variables (where every column is the same type!) and the rows of observational units.</p>
<p>Conceptually, a table in a database is no different from the data frames which are used in <strong>R</strong>. They will always be rectangles with the same row and column structure.</p>
<p>There are two big differences between a stand alone data frame (e.g., in <strong>R</strong>) and a table which lives in a database (e.g., in <strong>SQL</strong>).</p>
<ol type="1">
<li>
<p>Most importantly, tables in databases can be arbitrarily large, primarily due to being stored on disk. Indeed, they are typially not stored on <strong>your</strong> computer’s disk, they are stored remotely on a hard drive outside of your own computer and work space. Data frames are stored in memory (on your computer) and can be quite limited in size.</p>
<ul>
<li><p>Memory (RAM) is the amount of data that a computer can work on simultaneously. My computer has 32 GB of RAM. The important thing about memory is that the computer has easy access to its own memory and will access it quickly (tens of GBs per second).</p></li>
<li><p>Hard Disk is the amount of data that a computer can store permanently; it is your storage space. My computer has 2 TB of storage. Accessing the disk is much slower (hundreds of MBs per second) than accessing the memory. Accessing disk space is even slower if the storage lives on a different computer and is accessed virtually (via WiFi).</p></li>
</ul>
</li>
<li><p>The tables in a database are usually linked with a <strong>key</strong>. We will cover <code>join()</code> functions in <a href="04-sql-joins.html"><span>Chapter&nbsp;4</span></a>, but keep in mind that in order to get information from one table to connect to information in another table, we need to somehow relate the rows of the first table to the rows of the second table.</p></li>
</ol>
<p>To demonstrate the difference between data frames in memory and tables in storage, we will consider the <strong>airlines</strong> data consisting of millions of individual flights going back to 1987. The full data set occupies almost 20GB when they are saved as CSV (comma separated value) files, a common way to hold data that can be represented as columns of text which are separated by commas.</p>
</section><section id="tables-in-sql" class="level2" data-number="1.2"><h2 data-number="1.2" class="anchored" data-anchor-id="tables-in-sql">
<span class="header-section-number">1.2</span> Tables in <strong>SQL</strong>
</h2>
<p>To look at the <strong>airlines</strong> data tables, we first need to connect to the database remotely. The function <code><a href="https://rdrr.io/pkg/mdsr/man/src_scidb.html">dbConnect_scidb()</a></code> in the <strong>mdsr</strong> package allows us to connect to the databases which are stored for use with the text <strong>Modern Data Science with R</strong>.</p>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl()</a></code> function (in the <strong>dplyr</strong> package) maps the tables called <code>flights</code> and <code>carriers</code> from the database to an object in <strong>R</strong>.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mdsr-book/mdsr">mdsr</a></span><span class="op">)</span></span>
<span><span class="va">db_air</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mdsr/man/src_scidb.html">dbConnect_scidb</a></span><span class="op">(</span><span class="st">"airlines"</span><span class="op">)</span></span>
<span><span class="va">flights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="va">db_air</span>, <span class="st">"flights"</span><span class="op">)</span></span>
<span><span class="va">carriers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="va">db_air</span>, <span class="st">"carriers"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now use the objects <code>flights</code> and <code>carriers</code> as if they were data frames, but they are not actually the <strong>R</strong> version of <code>data.frame</code>. Instead, they exist as a <code>tbl</code> which is a special object that behaves similarly to a <code>data.frame</code>.</p>
<p>The <code>carriers</code> data represents the name of each airline and the associated carrier code. Note that when the data are printed to screen, the number of rows is given by <code>??</code>, indicating that they are unknown. Indeed, <strong>R</strong> just needed the first few rows to print to screen, no need to spend precious computing resources looking at the entire table.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">carriers</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   table&lt;carriers&gt; [?? x 2]
# Database: mysql  [mdsr_public@mdsr.cdc7tgkkqd0n.us-east-1.rds.amazonaws.com:NA/airlines]
  carrier name                         
  &lt;chr&gt;   &lt;chr&gt;                        
1 02Q     Titan Airways                
2 04Q     Tradewind Aviation           
3 05Q     Comlux Aviation, AG          
4 06Q     Master Top Linhas Aereas Ltd.
5 07Q     Flair Airlines Ltd.          
6 09Q     Swift Air, LLC               
# ℹ more rows</code></pre>
</div>
</div>
<p>With the <code>carriers</code> data, it is possible, however, to load the entire object into <strong>R</strong> using <code><a href="https://dplyr.tidyverse.org/reference/compute.html">collect()</a></code>. Now, when the data are printed to screen, the object is a <code>tibble</code> and <strong>R</strong> knows that it has 1,610 rows.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">carriers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,610 × 2
  carrier name                         
  &lt;chr&gt;   &lt;chr&gt;                        
1 02Q     Titan Airways                
2 04Q     Tradewind Aviation           
3 05Q     Comlux Aviation, AG          
4 06Q     Master Top Linhas Aereas Ltd.
5 07Q     Flair Airlines Ltd.          
6 09Q     Swift Air, LLC               
# ℹ 1,604 more rows</code></pre>
</div>
</div>
<p>As already mentioned, working in <strong>R</strong> versus working remotely has trade-offs. Remember that the object takes up much more space in your memory if you load it into <strong>R</strong>. Consider the following which demonstrates how much more memory intensive it is to hold an object in <strong>R</strong>.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># carriers lives in the SQL database and is linked remotely</span></span>
<span><span class="va">carriers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>units <span class="op">=</span> <span class="st">"Kb"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5.2 Kb</code></pre>
</div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># carriers lives in R</span></span>
<span><span class="va">carriers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>units <span class="op">=</span> <span class="st">"Kb"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>234.8 Kb</code></pre>
</div>
</div>
<p>Indeed, the <code>flights</code> data set contains all of the flights and is much larger than the <code>carriers</code> data set. When pulled into <strong>R</strong> it takes up almost 5 GB of memory (!), but when it exists as only a connection to the <strong>SQL</strong> database is uses just a few Kb of memory.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># flights lives in the database and is linked remotely</span></span>
<span><span class="va">flights</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>units <span class="op">=</span> <span class="st">"Kb"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>6.5 Kb</code></pre>
</div>
</div>
<p>Always a good idea to terminate the <strong>SQL</strong> connection when you are done with it.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org">DBI</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html">dbDisconnect</a></span><span class="op">(</span><span class="va">db_air</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="engaging-with-a-database" class="level2" data-number="1.3"><h2 data-number="1.3" class="anchored" data-anchor-id="engaging-with-a-database">
<span class="header-section-number">1.3</span> Engaging with a database</h2>
<section id="many-sql-implementations" class="level3" data-number="1.3.1"><h3 data-number="1.3.1" class="anchored" data-anchor-id="many-sql-implementations">
<span class="header-section-number">1.3.1</span> Many <strong>SQL</strong> implementations</h3>
<p><a href="https://en.wikipedia.org/wiki/SQL" target="_blank"><strong>SQL</strong> (Structured Query Language)</a> is a programming language for working with relational databases. (The relational part means that the data sets are connected in a meaningful way, the database part means that we have lots of tables living somewhere remotely on a hard drive.) <strong>SQL</strong> has been around since the 1970s and is extremely powerful for data wrangling tasks.</p>
<p>Although <strong>SQL</strong> has been a standard for the <a href="https://en.wikipedia.org/wiki/American_National_Standards_Institute" target="_blank">American National Standards Institute (ANSI)</a> since 1986, there <a href="https://mdsr-book.github.io/mdsr3e/15-sqlI.html#the-sql-universe" target="_blank">exist many dialects</a> of <strong>SQL</strong>. Translating between the dialects is not always easy although once you learn how to program in one dialect, you will be able to pick up any of the other <strong>SQL</strong> dialects. We will use <a href="https://en.wikipedia.org/wiki/MySQL" target="_blank">MySQL</a> in this class. MySQL is among the most popular implementations of <strong>SQL</strong> and it is open source.</p>
</section><section id="sql-interfaces" class="level3" data-number="1.3.2"><h3 data-number="1.3.2" class="anchored" data-anchor-id="sql-interfaces">
<span class="header-section-number">1.3.2</span> <strong>SQL</strong> interfaces</h3>
<p><strong>MySQL</strong> is based on a client-server model. The data live on a powerful computer (the server) and you connect to the data from your own computer (the client). In this class:</p>
<ul>
<li>
<strong>SQL</strong> code will be written in the <strong>MySQL</strong> dialect</li>
<li>using both <a href="https://posit.co/products/open-source/rstudio/" target="_blank">RStudio</a> and <a href="https://dbeaver.io/" target="_blank">DBeaver</a> as the interface to</li>
<li>connect to many different remote servers.</li>
</ul></section><section id="sql-in-process" class="level3" data-number="1.3.3"><h3 data-number="1.3.3" class="anchored" data-anchor-id="sql-in-process">
<span class="header-section-number">1.3.3</span> <strong>SQL</strong> in-process</h3>
<p>Another approach to engaging with <strong>SQL</strong> is where the client and the server are both on a single computer (called in-process). You may want to set up a database on your own computer to try things out and avoid monthly charges associated with buying server space in the cloud. Indeed, for the end of the semester project, if you choose to set up a database on your own computer, a good free database management system is <a href="https://duckdb.org/" target="_blank">Duckdb</a></p>
</section></section><section id="connecting-to-a-database" class="level2" data-number="1.4"><h2 data-number="1.4" class="anchored" data-anchor-id="connecting-to-a-database">
<span class="header-section-number">1.4</span> Connecting to a database</h2>
<p>When using <strong>R</strong> to connect to a database, we need two <strong>R</strong> packages. <strong>DBI</strong> is a low-level interface that connects to databases and executes <strong>SQL</strong>; <strong>RMariaDB</strong> is a package specifically tailored for <strong>MySQL</strong> which translates generic <strong>DBI</strong> commands into the specific syntax needed for <strong>MySQL</strong>.</p>
<p>A third <strong>R</strong> pacakge, <strong>dbplyr</strong>, is a high-level interface that translates dplyr code (i.e., <strong>R</strong> code) to <strong>SQL</strong> queries then executes them with DBI.</p>
<section id="creating-a-database-connection" class="level3" data-number="1.4.1"><h3 data-number="1.4.1" class="anchored" data-anchor-id="creating-a-database-connection">
<span class="header-section-number">1.4.1</span> Creating a database connection</h3>
<p>Before we can do anything, we need to set up a connection to a <strong>MySQL</strong> database. We will call the connection <code>con</code>, and the syntax will look something like what is written below. However, the code below won’t run because values must be set for <code>dbname</code>, <code>host</code>, <code>user</code>, and <code>password</code>.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html">dbConnect</a></span><span class="op">(</span></span>
<span>  <span class="fu">RMariaDB</span><span class="fu">::</span><span class="fu"><a href="https://rmariadb.r-dbi.org/reference/dbConnect-MariaDBDriver-method.html">MariaDB</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  dbname <span class="op">=</span> <span class="st">"  "</span>,</span>
<span>  host <span class="op">=</span> <span class="st">"  "</span>,</span>
<span>  user <span class="op">=</span> <span class="st">"  "</span>,</span>
<span>  password <span class="op">=</span> <span class="st">"  "</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the function <code><a href="https://rdrr.io/pkg/mdsr/man/src_scidb.html">dbConnect_scidb()</a></code> in the <strong>mdsr</strong> package is just a wrapper of the <code><a href="https://dbi.r-dbi.org/reference/dbConnect.html">dbConnect()</a></code> function where all the arguments are filled in to connect to the <strong>mdsr</strong> database.</p>
<p>Always a good idea to terminate the <strong>SQL</strong> connection when you are done with it.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="connecting-to-duckdb" class="level3" data-number="1.4.2"><h3 data-number="1.4.2" class="anchored" data-anchor-id="connecting-to-duckdb">
<span class="header-section-number">1.4.2</span> Connecting to Duckdb</h3>
<p>Connecting to Duckdb is reasonably straightforward because the default values of the <code>duckdb()</code> function in the <strong>duckdb</strong> package create a temporary database that is deleted when you quit <strong>R</strong>.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">con_duckdb</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/duckdb/man/duckdb.html">duckdb</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Always a good idea to terminate the <strong>SQL</strong> connection when you are done with it.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html">dbDisconnect</a></span><span class="op">(</span><span class="va">con_duckdb</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./p1-intro-to-sql.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Introduction to databases and SQL</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./02-sql-in-R.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">SQL in R</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Data Science, the SQL by Jo Hardin.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Built with 💚 and <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>