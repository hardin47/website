<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Jo Hardin">
<title>Data Science, the SQL - 6&nbsp; Changing databases</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./07-db-etc.html" rel="next">
<link href="./05-creating-db.html" rel="prev">
<link href="./images/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/x-mathjax-config">
const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers){
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');
  
  // Will this work with TeX on its own line?
  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
  	MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
  	MathJax.Hub.Queue(function(){
      popover.setAttribute('data-content', div.innerHTML);
  	})
  }
}
</script><link rel="shortcut icon" href="figs/favicon.ico">
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script><link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="site_libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet">
<script src="site_libs/bsTable-3.3.7/bootstrapTable.js"></script><link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css2?family=Quicksand" type="text/css">
</head>
<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./p3-build-db.html">Building databases</a></li><li class="breadcrumb-item"><a href="./06-change-db.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Changing databases</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science, the SQL</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/hardin47/SDS261-SQL" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome to Data Science, the SQL</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p1-intro-to-sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to databases and SQL</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-db.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Databases</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-sql-in-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">SQL in R and DBeaver</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p2-using-sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using SQL</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-sql-verbs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">SQL clauses</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-sql-joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Combining tables in SQL</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p3-build-db.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Building databases</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-creating-db.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Creating databases</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-change-db.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Changing databases</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-db-etc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title"><strong>SQL</strong> extras</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./p4-regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regular expressions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Regular Expressions</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#changing-data" id="toc-changing-data" class="nav-link active" data-scroll-target="#changing-data"><span class="header-section-number">6.1</span> Changing data</a></li>
  <li><a href="#inserting-data" id="toc-inserting-data" class="nav-link" data-scroll-target="#inserting-data"><span class="header-section-number">6.2</span> Inserting data</a></li>
  <li><a href="#deleting-data" id="toc-deleting-data" class="nav-link" data-scroll-target="#deleting-data"><span class="header-section-number">6.3</span> Deleting data</a></li>
  <li><a href="#altering-the-table" id="toc-altering-the-table" class="nav-link" data-scroll-target="#altering-the-table"><span class="header-section-number">6.4</span> Altering the table</a></li>
  <li>
<a href="#temporary-tables" id="toc-temporary-tables" class="nav-link" data-scroll-target="#temporary-tables"><span class="header-section-number">6.5</span> Temporary tables</a>
  <ul class="collapse">
<li><a href="#creating-a-temporary-table" id="toc-creating-a-temporary-table" class="nav-link" data-scroll-target="#creating-a-temporary-table"><span class="header-section-number">6.5.1</span> Creating a temporary table</a></li>
  <li><a href="#using-a-temporary-table" id="toc-using-a-temporary-table" class="nav-link" data-scroll-target="#using-a-temporary-table"><span class="header-section-number">6.5.2</span> Using a temporary table</a></li>
  </ul>
</li>
  <li><a href="#best-practice" id="toc-best-practice" class="nav-link" data-scroll-target="#best-practice"><span class="header-section-number">6.6</span> Best practice</a></li>
  <li><a href="#reflection-questions" id="toc-reflection-questions" class="nav-link" data-scroll-target="#reflection-questions"><span class="header-section-number">6.7</span> <i class="fas fa-lightbulb"></i> Reflection questions</a></li>
  <li><a href="#ethics-considerations" id="toc-ethics-considerations" class="nav-link" data-scroll-target="#ethics-considerations"><span class="header-section-number">6.8</span> <i class="fas fa-balance-scale"></i> Ethics considerations</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/hardin47/SDS261-SQL/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-change-db" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Changing databases</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>As in <a href="05-creating-db.html"><span>Chapter&nbsp;5</span></a>, we will use <strong>DuckDB</strong> so that we have access to a server into which we can create and change data tables. Note that the database has been stored to a database directory called <code>duck_datab</code> which lives in the current <strong>R</strong> project. You won’t be able to open it like a standard folder, but it is where <strong>DuckDB</strong> stores the database files.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">con_duckdb</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/duckdb/man/duckdb.html">duckdb</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                             dbdir <span class="op">=</span> <span class="st">"duck_datab"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="changing-data" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="changing-data">
<span class="header-section-number">6.1</span> Changing data</h2>
<p>The <code>UPDATE</code> function allows you to change a value in a table across all rows that match a certain criteria. The <code>impressions</code> table has a <code>name</code> column indicating the person being impersonated. Let’s say, for whatever reason, that Ivanka Trump decides she doesn’t want to be affiliated with the Trump name and she changes her name to her husband’s name, becoming Ivanka Kushner. You might want to <code>UPDATE</code> the file to indicate the impressions were of <code>Ivanka Kushner</code> instead of <code>Ivanka Trump</code>. (See <a href="05-creating-db.html#sec-load-duckdb"><span>Section&nbsp;5.1.2</span></a> for loading csv files into <strong>DuckDB</strong> directly.)</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">duckdb_read_csv</span><span class="op">(</span>con <span class="op">=</span> <span class="va">con_duckdb</span>, name <span class="op">=</span> <span class="st">"impressions"</span>, files <span class="op">=</span> <span class="st">"data/impressions.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-output.var="ivanka_trump" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> impressions </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">WHERE</span> name <span class="kw">LIKE</span> <span class="st">'Ivanka%'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="cell-output-display">
<div id="tbl-ivanka-trump" class="anchored">
<table class="table table-striped table-condensed table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.1: Finding the impersonations of Ivanka Trump.</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">impid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">aid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2598</td>
<td style="text-align: left;">Scarlett Johansson</td>
<td style="text-align: left;">Ivanka Trump</td>
</tr>
<tr class="even">
<td style="text-align: right;">3716</td>
<td style="text-align: left;">Emily Blunt</td>
<td style="text-align: left;">Ivanka Trump</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3694</td>
<td style="text-align: left;">Margot Robbie</td>
<td style="text-align: left;">Ivanka Trump</td>
</tr>
<tr class="even">
<td style="text-align: right;">3679</td>
<td style="text-align: left;">Vanessa Bayer</td>
<td style="text-align: left;">Ivanka Trump</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2340</td>
<td style="text-align: left;">Maya Rudolph</td>
<td style="text-align: left;">Ivanka Trump</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>We can use the <code>UPDATE</code> function to change the value of Ivanka’s name to <code>Ivanka Kushner</code> throughout the database. Note that all rows which match the <code>WHERE</code> clause get updated.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">UPDATE</span> impressions</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">SET</span> name <span class="op">=</span> <span class="st">'Ivanka Kushner'</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>   <span class="kw">WHERE</span> name <span class="kw">LIKE</span> <span class="st">'Ivanka%'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-output.var="ivanka_kushner" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> impressions </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">WHERE</span> name <span class="kw">LIKE</span> <span class="st">'Ivanka%'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="cell-output-display">
<div id="tbl-ivanka-kushner" class="anchored">
<table class="table table-striped table-condensed table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.2: Ivanka’s last name has been <code>UPDATE</code>d to Kushner.</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">impid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">aid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2598</td>
<td style="text-align: left;">Scarlett Johansson</td>
<td style="text-align: left;">Ivanka Kushner</td>
</tr>
<tr class="even">
<td style="text-align: right;">3716</td>
<td style="text-align: left;">Emily Blunt</td>
<td style="text-align: left;">Ivanka Kushner</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3694</td>
<td style="text-align: left;">Margot Robbie</td>
<td style="text-align: left;">Ivanka Kushner</td>
</tr>
<tr class="even">
<td style="text-align: right;">3679</td>
<td style="text-align: left;">Vanessa Bayer</td>
<td style="text-align: left;">Ivanka Kushner</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2340</td>
<td style="text-align: left;">Maya Rudolph</td>
<td style="text-align: left;">Ivanka Kushner</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="fas fa-triangle-exclamation"></i> Watch out!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Be careful with <code>UPDATE</code>. A careless <code>UPDATE</code> could write over all of the data in your table. There is no <strong>undo</strong> function.</p>
</div>
</div>
</section><section id="inserting-data" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="inserting-data">
<span class="header-section-number">6.2</span> Inserting data</h2>
<p>Let’s say we want to include the more recent hosts in the <code>hosts</code> table. First, we scrape the <a href="http://www.snlarchives.net/Episodes/" target="_blank">SNL archives</a> which lists the episode id (the date) and the host. The <strong>R</strong> package <strong>rvest</strong> allows us to pull out the appropriate html elements. The <code>epid</code> and <code>aid</code> are joined together in a tibble, and <code>filter</code>ed to only include episodes which are not already in the <code>episodes</code> table. (See <a href="05-creating-db.html#sec-load-duckdb"><span>Section&nbsp;5.1.2</span></a> for loading csv files into <strong>DuckDB</strong> directly.)</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">duckdb_read_csv</span><span class="op">(</span>con <span class="op">=</span> <span class="va">con_duckdb</span>, name <span class="op">=</span> <span class="st">"hosts"</span>, files <span class="op">=</span> <span class="st">"data/hosts.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By searching the <a href="http://www.snlarchives.net/Episodes/" target="_blank">SNL archives</a>, we can see that the next host, chronologically was Elon Musk on May 8, 2021.</p>
<div class="cell" data-output.var="hosts_orig" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> hosts</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ORDER</span> <span class="kw">BY</span> epid <span class="kw">DESC</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="cell-output-display">
<div id="tbl-hosts-orig" class="anchored">
<table class="table table-striped table-condensed table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.3: Most recent hosts in the original <code>hosts</code> table.</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">epid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">aid</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">20210410</td>
<td style="text-align: left;">Carey Mulligan</td>
</tr>
<tr class="even">
<td style="text-align: right;">20210403</td>
<td style="text-align: left;">Daniel Kaluuya</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20210327</td>
<td style="text-align: left;">Maya Rudolph</td>
</tr>
<tr class="even">
<td style="text-align: right;">20210227</td>
<td style="text-align: left;">Nick Jonas</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20210220</td>
<td style="text-align: left;">Rege-Jean Page</td>
</tr>
<tr class="even">
<td style="text-align: right;">20210213</td>
<td style="text-align: left;">Regina King</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20210206</td>
<td style="text-align: left;">Dan Levy</td>
</tr>
<tr class="even">
<td style="text-align: right;">20210130</td>
<td style="text-align: left;">John Krasinski</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20201219</td>
<td style="text-align: left;">Kristen Wiig</td>
</tr>
<tr class="even">
<td style="text-align: right;">20201212</td>
<td style="text-align: left;">Timothee Chalamet</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p><code>INSERT</code> allows us to add the relevant information associated with the episode of SNL that Elon Musk hosted.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> hosts (epid, aid)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">VALUES</span> (<span class="st">'20210508'</span>, <span class="st">'Elon Musk'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-output.var="hosts_elon" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> hosts</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ORDER</span> <span class="kw">BY</span> epid <span class="kw">DESC</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="cell-output-display">
<div id="tbl-hosts-elon" class="anchored">
<table class="table table-striped table-condensed table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.4: <code>hosts</code> table including the added observation from May 8, 2021.</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">epid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">aid</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">20210508</td>
<td style="text-align: left;">Elon Musk</td>
</tr>
<tr class="even">
<td style="text-align: right;">20210410</td>
<td style="text-align: left;">Carey Mulligan</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20210403</td>
<td style="text-align: left;">Daniel Kaluuya</td>
</tr>
<tr class="even">
<td style="text-align: right;">20210327</td>
<td style="text-align: left;">Maya Rudolph</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20210227</td>
<td style="text-align: left;">Nick Jonas</td>
</tr>
<tr class="even">
<td style="text-align: right;">20210220</td>
<td style="text-align: left;">Rege-Jean Page</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20210213</td>
<td style="text-align: left;">Regina King</td>
</tr>
<tr class="even">
<td style="text-align: right;">20210206</td>
<td style="text-align: left;">Dan Levy</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20210130</td>
<td style="text-align: left;">John Krasinski</td>
</tr>
<tr class="even">
<td style="text-align: right;">20201219</td>
<td style="text-align: left;">Kristen Wiig</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>It would be tedious to <code>INSERT</code> all of the most recent host information by hand. Instead, we’ll scrape the <a href="http://www.snlarchives.net/Episodes/" target="_blank">SNL archives</a> using the <strong>R</strong> package <strong>rvest</strong>, which allows us to pull out the appropriate html elements. The <code>epid</code> and <code>aid</code> are joined together in a tibble, and <code>filter</code>ed to only include episodes which are not already in the <code>episodes</code> table.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rvest.tidyverse.org/">rvest</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">recent_hosts</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="st">"http://www.snlarchives.net/Episodes/"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rvest.tidyverse.org/reference/rename.html">html_nodes</a></span><span class="op">(</span><span class="st">"tr"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html">map_df</a></span><span class="op">(</span> <span class="op">~</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>    epid <span class="op">=</span> <span class="va">.x</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rvest.tidyverse.org/reference/rename.html">html_node</a></span><span class="op">(</span><span class="st">"a.ms-2.me-2"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_attr.html">html_attr</a></span><span class="op">(</span><span class="st">"href"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">str_extract</span><span class="op">(</span><span class="st">"\\d+"</span><span class="op">)</span>,</span>
<span>    aid <span class="op">=</span> <span class="va">.x</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rvest.tidyverse.org/reference/rename.html">html_node</a></span><span class="op">(</span><span class="st">"td:nth-child(2)"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_text.html">html_text2</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">str_extract</span><span class="op">(</span><span class="st">"[\\w\\. \\w\\.]+(?=/|$)"</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">epid</span> <span class="op">&gt;</span> <span class="fl">20210508</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">write_csv</span><span class="op">(</span><span class="va">recent_hosts</span>, <span class="st">"data/recent_hosts.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> hosts</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>   <span class="kw">FROM</span> READ_CSV(<span class="st">'data/recent_hosts.csv'</span>, AUTO_DETECT <span class="op">=</span> <span class="kw">TRUE</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-output.var="hosts_update" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> hosts</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ORDER</span> <span class="kw">BY</span> epid <span class="kw">DESC</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="cell-output-display">
<div id="tbl-hosts-update" class="anchored">
<table class="table table-striped table-condensed table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.5: The full <code>hosts</code> table, updated through December 16, 2023.</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">epid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">aid</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">20231216</td>
<td style="text-align: left;">Kate McKinnon</td>
</tr>
<tr class="even">
<td style="text-align: right;">20231209</td>
<td style="text-align: left;">Adam Driver</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20231202</td>
<td style="text-align: left;">Emma Stone</td>
</tr>
<tr class="even">
<td style="text-align: right;">20231118</td>
<td style="text-align: left;">Jason Momoa</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20231111</td>
<td style="text-align: left;">Timothée Chalamet</td>
</tr>
<tr class="even">
<td style="text-align: right;">20231028</td>
<td style="text-align: left;">Nate Bargatze</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20231021</td>
<td style="text-align: left;">Bad Bunny</td>
</tr>
<tr class="even">
<td style="text-align: right;">20231014</td>
<td style="text-align: left;">Pete Davidson</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20230415</td>
<td style="text-align: left;">Ana de Armas</td>
</tr>
<tr class="even">
<td style="text-align: right;">20230408</td>
<td style="text-align: left;">Molly Shannon</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section><section id="deleting-data" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="deleting-data">
<span class="header-section-number">6.3</span> Deleting data</h2>
<p>You might change your mind and decide that you really only want hosts from years up to 2022. The <code>DELETE</code> function deletes any rows specified by the <code>WHERE</code> clause.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DELETE</span> <span class="kw">FROM</span> hosts</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">WHERE</span> epid <span class="op">&gt;</span> <span class="dv">20221231</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-output.var="hosts_delete" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> hosts</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ORDER</span> <span class="kw">BY</span> epid <span class="kw">DESC</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="cell-output-display">
<div id="tbl-hosts-delete" class="anchored">
<table class="table table-striped table-condensed table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.6: The <code>hosts</code> table, after 2023 has been <code>DELETE</code>d.</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">epid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">aid</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">20221217</td>
<td style="text-align: left;">Austin Butler</td>
</tr>
<tr class="even">
<td style="text-align: right;">20221210</td>
<td style="text-align: left;">Martin Short</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20221203</td>
<td style="text-align: left;">Keke Palmer</td>
</tr>
<tr class="even">
<td style="text-align: right;">20221112</td>
<td style="text-align: left;">Dave Chappelle</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20221105</td>
<td style="text-align: left;">Amy Schumer</td>
</tr>
<tr class="even">
<td style="text-align: right;">20221029</td>
<td style="text-align: left;">Jack Harlow</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20221015</td>
<td style="text-align: left;">Megan Thee Stallion</td>
</tr>
<tr class="even">
<td style="text-align: right;">20221008</td>
<td style="text-align: left;">Brendan Gleeson</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20221001</td>
<td style="text-align: left;">Miles Teller</td>
</tr>
<tr class="even">
<td style="text-align: right;">20220521</td>
<td style="text-align: left;">Natasha Lyonne</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section><section id="altering-the-table" class="level2" data-number="6.4"><h2 data-number="6.4" class="anchored" data-anchor-id="altering-the-table">
<span class="header-section-number">6.4</span> Altering the table</h2>
<p><code>ALTER TABLE</code> changes the structure of a table. For example, you can add or delete columns, create or destroy indexes, change the type of existing columns, or rename columns or the table itself.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>Multiple <code>ADD</code>, <code>ALTER</code>, <code>DROP</code>, and <code>CHANGE</code> clauses are permitted in a single <code>ALTER TABLE</code> statement, separated by commas.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> <span class="kw">table</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">COLUMN</span> col1,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">COLUMN</span> col2;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To alter a column to change both its name and definition, use <code>CHANGE</code>, specifying the old and new names and the new definition. For example, to rename an <code>INT NOT NULL</code> column from <code>a</code> to <code>b  and change its definition to use the</code>BIGINT<code>data type while retaining the</code>NOT NULL` attribute, do this:</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> t1 <span class="kw">CHANGE</span> a b BIGINT <span class="kw">NOT</span> <span class="kw">NULL</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To change a column definition but not its name, use <code>CHANGE</code> or <code>MODIFY</code>. With <code>CHANGE</code>, the syntax requires two column names, so you must specify the same name twice to leave the name unchanged. For example, to change the definition of column <code>b</code>:</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> t1 <span class="kw">CHANGE</span> b b <span class="dt">INT</span> <span class="kw">NOT</span> <span class="kw">NULL</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>MODIFY</code> is more convenient to change the definition without changing the name because it requires the column name only once:</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> t1 <span class="kw">MODIFY</span> b <span class="dt">INT</span> <span class="kw">NOT</span> <span class="kw">NULL</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To change a column name but not its definition, use <code>CHANGE</code> or <code>RENAME COLUMN</code>. With <code>CHANGE</code>, the syntax requires a column definition, so to leave the definition unchanged, you must respecify the definition the column currently has. For example, to rename an <code>INT NOT NULL</code> column from <code>b</code> to <code>a</code>:</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> t1 <span class="kw">CHANGE</span> b a <span class="dt">INT</span> <span class="kw">NOT</span> <span class="kw">NULL</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>RENAME COLUMN</code> is more convenient to change the name without changing the definition because it requires only the old and new names:</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> t1 <span class="kw">RENAME</span> <span class="kw">COLUMN</span> b <span class="kw">TO</span> a;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In general, you cannot rename a column to a name that already exists in the table. However, this is sometimes not the case, such as when you swap names or move them through a cycle. If a table has columns named <code>a</code>, <code>b</code>, and <code>c</code>, the following are valid operations:</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* swap a and b */</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> t1 <span class="kw">RENAME</span> <span class="kw">COLUMN</span> a <span class="kw">TO</span> b,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>               <span class="kw">RENAME</span> <span class="kw">COLUMN</span> b <span class="kw">TO</span> a;</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">/* "rotate" a, b, c through a cycle */</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> t1 <span class="kw">RENAME</span> <span class="kw">COLUMN</span> a <span class="kw">TO</span> b,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>               <span class="kw">RENAME</span> <span class="kw">COLUMN</span> b <span class="kw">TO</span> c,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>               <span class="kw">RENAME</span> <span class="kw">COLUMN</span> c <span class="kw">TO</span> a;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="temporary-tables" class="level2" data-number="6.5"><h2 data-number="6.5" class="anchored" data-anchor-id="temporary-tables">
<span class="header-section-number">6.5</span> Temporary tables</h2>
<p>Temporary tables are used to break down complex queries into smaller, more manageable steps. For example, let’s say we want to <code>JOIN</code> two tables after each has been filtered using different <code>WHERE</code> clauses. The filtered tables can each be saved into their own temporary tables and then the temporary tables can be merged.</p>
<p>Note that tables in <strong>DuckDB</strong> are saved (to disk), even when the connection is closed. However, temporary tables are saved in memory (instead of on disk) and are deleted when the connection is closed. Specific configuration of the temporary directory allows for <a href="https://duckdb.org/docs/sql/statements/create_table.html#temporary-tables" target="_blank">temporary tables to be saved</a>, even when the connection is closed.</p>
<p>Notice that most of the tables have some kind of ID which allows <code>JOIN</code>ing across tables.</p>
<div class="cell" data-output.var="select_hosts" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> hosts <span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="cell-output-display">
<div id="tbl-select-hosts" class="anchored">
<table class="table table-striped table-condensed table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.7: Note the epid and aid identifiers in the hosts table.</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">epid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">aid</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">20210410</td>
<td style="text-align: left;">Carey Mulligan</td>
</tr>
<tr class="even">
<td style="text-align: right;">20210403</td>
<td style="text-align: left;">Daniel Kaluuya</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20210327</td>
<td style="text-align: left;">Maya Rudolph</td>
</tr>
<tr class="even">
<td style="text-align: right;">20210227</td>
<td style="text-align: left;">Nick Jonas</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20210220</td>
<td style="text-align: left;">Rege-Jean Page</td>
</tr>
<tr class="even">
<td style="text-align: right;">20210213</td>
<td style="text-align: left;">Regina King</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20210206</td>
<td style="text-align: left;">Dan Levy</td>
</tr>
<tr class="even">
<td style="text-align: right;">20210130</td>
<td style="text-align: left;">John Krasinski</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20201219</td>
<td style="text-align: left;">Kristen Wiig</td>
</tr>
<tr class="even">
<td style="text-align: right;">20201212</td>
<td style="text-align: left;">Timothee Chalamet</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell" data-output.var="select_episodes" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> episodes <span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="cell-output-display">
<div id="tbl-select-episodes" class="anchored">
<table class="table table-striped table-condensed table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.8: Note the sid and epid identifiers in the episodes table.</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">sid</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">epid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">aired</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">epno</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20210410</td>
<td style="text-align: left;">April 10, 2021</td>
<td style="text-align: right;">17</td>
</tr>
<tr class="even">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20210403</td>
<td style="text-align: left;">April 3, 2021</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20210327</td>
<td style="text-align: left;">March 27, 2021</td>
<td style="text-align: right;">15</td>
</tr>
<tr class="even">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20210227</td>
<td style="text-align: left;">February 27, 2021</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="odd">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20210220</td>
<td style="text-align: left;">February 20, 2021</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="even">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20210213</td>
<td style="text-align: left;">February 13, 2021</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="odd">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20210206</td>
<td style="text-align: left;">February 6, 2021</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="even">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20210130</td>
<td style="text-align: left;">January 30, 2021</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20201219</td>
<td style="text-align: left;">December 19, 2020</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20201212</td>
<td style="text-align: left;">December 12, 2020</td>
<td style="text-align: right;">8</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<section id="creating-a-temporary-table" class="level3" data-number="6.5.1"><h3 data-number="6.5.1" class="anchored" data-anchor-id="creating-a-temporary-table">
<span class="header-section-number">6.5.1</span> Creating a temporary table</h3>
<p>The <code>episodes</code> table has an <code>aired</code> column which includes the data. Recall that if we create a new variable (e.g., <code>year</code>) using <code>aired</code>, we cannot use <code>year</code> in the <code>WHERE</code> clause (<code>WHERE</code> only works on the original table, not the results set).</p>
<p>In <strong>MySQL</strong> the function <code>STR_TO_DATE</code> allowed us to create a datetime variable from which year could be extracted. However, in <strong>DuckDB</strong>, it is more complicated to convert the character string of “April 10, 2020” to “2020-04-10”. Don’t worry about the code too much, but note that we wouldn’t want to wrangle the character date string every time we wanted to filter for year.</p>
<section id="what-does-position-do" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="what-does-position-do">What does <code>POSITION</code> do?</h4>
<p>In case you are curious about the date wrangling code… consider <code>SUBSTRING(aired, POSITION(',' IN aired) + 2)</code></p>
<ol type="1">
<li><p><code>POSITION(',' IN aired)</code>: This part of the expression uses the <code>POSITION</code> function to find the position of the first occurrence of the comma (<code>,</code>) in the string <code>aired</code>. The result is the index (position) of the comma within the string.</p></li>
<li><p><code>POSITION(',' IN aired) + 2</code>: This adds 2 to the index of the comma. The <code>+ 2</code> is used to move the starting point of the substring two positions to the right of the comma. This is done to exclude the comma itself and any following spaces.</p></li>
<li><p><code>SUBSTRING(aired, POSITION(',' IN aired) + 2)</code>: This part uses the SUBSTRING function to extract a substring from the string <code>aired</code>. The starting position of the substring is determined by <code>POSITION(',' IN aired) + 2</code>, and it goes until the end of the string. This effectively removes the part of the string that comes before and including the first comma.</p></li>
</ol>
<p>In summary, the entire expression is extracting a substring from the original string <code>aired</code>, starting from two positions to the right of the first comma and continuing until the end of the string. This can be useful in scenarios where you want to remove or isolate part of a string based on the position of a specific character (in this case, the comma).</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> TEMP <span class="kw">TABLE</span> episodes_date <span class="kw">AS</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> <span class="op">*</span>, <span class="cf">CASE</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>             <span class="cf">WHEN</span> POSITION(<span class="st">','</span> <span class="kw">IN</span> aired) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">THEN</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">EXTRACT</span>(<span class="dt">YEAR</span> <span class="kw">FROM</span> <span class="fu">CAST</span>(</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                SUBSTRING(aired, POSITION(<span class="st">','</span> <span class="kw">IN</span> aired) <span class="op">+</span> <span class="dv">2</span>) <span class="op">||</span> <span class="st">'-'</span> <span class="op">||</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                <span class="cf">CASE</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">WHEN</span> POSITION(<span class="st">'January'</span> <span class="kw">IN</span> aired) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">THEN</span> <span class="st">'01'</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">WHEN</span> POSITION(<span class="st">'February'</span> <span class="kw">IN</span> aired) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">THEN</span> <span class="st">'02'</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">WHEN</span> POSITION(<span class="st">'March'</span> <span class="kw">IN</span> aired) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">THEN</span> <span class="st">'03'</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">WHEN</span> POSITION(<span class="st">'April'</span> <span class="kw">IN</span> aired) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">THEN</span> <span class="st">'04'</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">WHEN</span> POSITION(<span class="st">'May'</span> <span class="kw">IN</span> aired) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">THEN</span> <span class="st">'05'</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">WHEN</span> POSITION(<span class="st">'June'</span> <span class="kw">IN</span> aired) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">THEN</span> <span class="st">'06'</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">WHEN</span> POSITION(<span class="st">'July'</span> <span class="kw">IN</span> aired) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">THEN</span> <span class="st">'07'</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">WHEN</span> POSITION(<span class="st">'August'</span> <span class="kw">IN</span> aired) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">THEN</span> <span class="st">'08'</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">WHEN</span> POSITION(<span class="st">'September'</span> <span class="kw">IN</span> aired) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">THEN</span> <span class="st">'09'</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">WHEN</span> POSITION(<span class="st">'October'</span> <span class="kw">IN</span> aired) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">THEN</span> <span class="st">'10'</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">WHEN</span> POSITION(<span class="st">'November'</span> <span class="kw">IN</span> aired) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">THEN</span> <span class="st">'11'</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">WHEN</span> POSITION(<span class="st">'December'</span> <span class="kw">IN</span> aired) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">THEN</span> <span class="st">'12'</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">ELSE</span> <span class="st">'01'</span> <span class="co">-- Default to January if no month is found</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">END</span> <span class="op">||</span> <span class="st">'-'</span> <span class="op">||</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>                SUBSTRING(aired, POSITION(<span class="st">' '</span> <span class="kw">IN</span> aired) <span class="op">+</span> <span class="dv">1</span>, <span class="dv">2</span>) <span class="kw">AS</span> <span class="dt">DATE</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>            ))</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">END</span> <span class="kw">AS</span> <span class="dt">year</span> <span class="kw">FROM</span> episodes;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-output.var="episodes_date" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> episodes_date <span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="cell-output-display">
<div id="tbl-episodes-date" class="anchored">
<table class="table table-striped table-condensed table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.9: The temporary table called <code>episodes_date</code> that has identifiers of sid, epid, and epno.</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">sid</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">epid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">aired</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">epno</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20210410</td>
<td style="text-align: left;">April 10, 2021</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">2021</td>
</tr>
<tr class="even">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20210403</td>
<td style="text-align: left;">April 3, 2021</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">2021</td>
</tr>
<tr class="odd">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20210327</td>
<td style="text-align: left;">March 27, 2021</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">2021</td>
</tr>
<tr class="even">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20210227</td>
<td style="text-align: left;">February 27, 2021</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">2021</td>
</tr>
<tr class="odd">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20210220</td>
<td style="text-align: left;">February 20, 2021</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">2021</td>
</tr>
<tr class="even">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20210213</td>
<td style="text-align: left;">February 13, 2021</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">2021</td>
</tr>
<tr class="odd">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20210206</td>
<td style="text-align: left;">February 6, 2021</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">2021</td>
</tr>
<tr class="even">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20210130</td>
<td style="text-align: left;">January 30, 2021</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">2021</td>
</tr>
<tr class="odd">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20201219</td>
<td style="text-align: left;">December 19, 2020</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: right;">46</td>
<td style="text-align: right;">20201212</td>
<td style="text-align: left;">December 12, 2020</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">2020</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section></section><section id="using-a-temporary-table" class="level3" data-number="6.5.2"><h3 data-number="6.5.2" class="anchored" data-anchor-id="using-a-temporary-table">
<span class="header-section-number">6.5.2</span> Using a temporary table</h3>
<p>Now that the <code>year</code> variable has been created in the new temporary table called <code>episodes_date</code>, we can use <code>episode_date</code> to query and find, for example, all of the hosts in 2019.</p>
<div class="cell" data-output.var="hosts_2019" data-fig.asp="0.618">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> hosts.aid, ep.aired, ep.<span class="dt">year</span> <span class="kw">FROM</span> hosts </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> episodes_date <span class="kw">AS</span> ep <span class="kw">ON</span> hosts.epid <span class="op">=</span> ep.epid</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> <span class="dt">year</span> <span class="op">=</span> <span class="dv">2019</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">25</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-fig.asp="0.618">
<div class="cell-output-display">
<div id="tbl-hosts-2019" class="anchored">
<table class="table table-striped table-condensed table-sm small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.10: SNL hosts in 2019.</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">aid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">aired</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Eddie Murphy</td>
<td style="text-align: left;">December 21, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="even">
<td style="text-align: left;">Scarlett Johansson</td>
<td style="text-align: left;">December 14, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jennifer Lopez</td>
<td style="text-align: left;">December 7, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="even">
<td style="text-align: left;">Will Ferrell</td>
<td style="text-align: left;">November 23, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Harry Styles</td>
<td style="text-align: left;">November 16, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kristen Stewart</td>
<td style="text-align: left;">November 2, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Chance the Rapper</td>
<td style="text-align: left;">October 26, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="even">
<td style="text-align: left;">David Harbour</td>
<td style="text-align: left;">October 12, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Phoebe Waller-Bridge</td>
<td style="text-align: left;">October 5, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="even">
<td style="text-align: left;">Woody Harrelson</td>
<td style="text-align: left;">September 28, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paul Rudd</td>
<td style="text-align: left;">May 18, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="even">
<td style="text-align: left;">Emma Thompson</td>
<td style="text-align: left;">May 11, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adam Sandler</td>
<td style="text-align: left;">May 4, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="even">
<td style="text-align: left;">Emma Stone</td>
<td style="text-align: left;">April 13, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Kit Harington</td>
<td style="text-align: left;">April 6, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sandra Oh</td>
<td style="text-align: left;">March 30, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Idris Elba</td>
<td style="text-align: left;">March 9, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="even">
<td style="text-align: left;">John Mulaney</td>
<td style="text-align: left;">March 2, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Don Cheadle</td>
<td style="text-align: left;">February 16, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="even">
<td style="text-align: left;">Halsey</td>
<td style="text-align: left;">February 9, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="odd">
<td style="text-align: left;">James McAvoy</td>
<td style="text-align: left;">January 26, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rachel Brosnahan</td>
<td style="text-align: left;">January 19, 2019</td>
<td style="text-align: right;">2019</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section></section><section id="best-practice" class="level2" data-number="6.6"><h2 data-number="6.6" class="anchored" data-anchor-id="best-practice">
<span class="header-section-number">6.6</span> Best practice</h2>
<p>It is always a good idea to terminate the <strong>SQL</strong> connection when you are done with it.</p>
<div class="cell" data-fig.asp="0.618">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">dbDisconnect</span><span class="op">(</span><span class="va">con_duckdb</span>, shutdown <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="reflection-questions" class="level2" data-number="6.7"><h2 data-number="6.7" class="anchored" data-anchor-id="reflection-questions">
<span class="header-section-number">6.7</span> <i class="fas fa-lightbulb"></i> Reflection questions</h2>
</section><section id="ethics-considerations" class="level2" data-number="6.8"><h2 data-number="6.8" class="anchored" data-anchor-id="ethics-considerations">
<span class="header-section-number">6.8</span> <i class="fas fa-balance-scale"></i> Ethics considerations</h2>


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Information and examples in this section taken from https://dev.mysql.com/doc/refman/8.0/en/alter-table.html#alter-table-add-drop-column<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./05-creating-db.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Creating databases</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./07-db-etc.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title"><strong>SQL</strong> extras</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Data Science, the SQL by Jo Hardin.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Built with 💚 and <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>