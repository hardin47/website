<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Randomization &amp; Permutation Tests | Computational Statistics</title>
  <meta name="description" content="Class notes for Math 154 at Pomona College: Computational Statistics. The notes are based extensively on An Introduction to Statistical Learning by James, Witten, Hastie, and Tibshirani as well as Modern Data Science with R by Baumer, Kaplan, and Horton." />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Randomization &amp; Permutation Tests | Computational Statistics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Class notes for Math 154 at Pomona College: Computational Statistics. The notes are based extensively on An Introduction to Statistical Learning by James, Witten, Hastie, and Tibshirani as well as Modern Data Science with R by Baumer, Kaplan, and Horton." />
  <meta name="github-repo" content="hardin47/website/Math154/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Randomization &amp; Permutation Tests | Computational Statistics" />
  
  <meta name="twitter:description" content="Class notes for Math 154 at Pomona College: Computational Statistics. The notes are based extensively on An Introduction to Statistical Learning by James, Witten, Hastie, and Tibshirani as well as Modern Data Science with R by Baumer, Kaplan, and Horton." />
  

<meta name="author" content="Jo Hardin" />


<meta name="date" content="2019-09-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sims.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Computational Statistics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Class Information</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#Sep3"><i class="fa fa-check"></i><b>1.1</b> 9/3/19 Agenda</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#course-logistics"><i class="fa fa-check"></i><b>1.2</b> Course Logistics</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#course-content"><i class="fa fa-check"></i><b>1.3</b> Course Content</a><ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#topics"><i class="fa fa-check"></i><b>1.3.1</b> Topics</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#vocabulary"><i class="fa fa-check"></i><b>1.3.2</b> Vocabulary</a></li>
<li class="chapter" data-level="1.3.3" data-path="intro.html"><a href="intro.html#the-workflow"><i class="fa fa-check"></i><b>1.3.3</b> The Workflow</a></li>
<li class="chapter" data-level="1.3.4" data-path="intro.html"><a href="intro.html#principles-for-the-data-science-process-tldr"><i class="fa fa-check"></i><b>1.3.4</b> Principles for the Data Science Process tl;dr</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#Sep5"><i class="fa fa-check"></i><b>1.4</b> 9/5/19 Agenda</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#repro"><i class="fa fa-check"></i><b>1.5</b> Reproducibility</a><ul>
<li class="chapter" data-level="1.5.1" data-path="intro.html"><a href="intro.html#need-for-reproducibility"><i class="fa fa-check"></i><b>1.5.1</b> Need for Reproducibility</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#example-1"><i class="fa fa-check"></i>Example 1</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#example-2"><i class="fa fa-check"></i>Example 2</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#example-3"><i class="fa fa-check"></i>Example 3</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#example-4"><i class="fa fa-check"></i>Example 4</a></li>
<li class="chapter" data-level="1.5.2" data-path="intro.html"><a href="intro.html#the-reproducible-data-analysis-process"><i class="fa fa-check"></i><b>1.5.2</b> The reproducible data analysis process</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#data-examples"><i class="fa fa-check"></i><b>1.6</b> Data Examples</a><ul>
<li class="chapter" data-level="1.6.1" data-path="intro.html"><a href="intro.html#college-rankings-systems"><i class="fa fa-check"></i><b>1.6.1</b> College Rankings Systems</a></li>
<li class="chapter" data-level="1.6.2" data-path="intro.html"><a href="intro.html#trump-and-twitter"><i class="fa fa-check"></i><b>1.6.2</b> Trump and Twitter</a></li>
<li class="chapter" data-level="1.6.3" data-path="intro.html"><a href="intro.html#can-twitter-predict-election-results"><i class="fa fa-check"></i><b>1.6.3</b> Can Twitter Predict Election Results?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>2</b> Visualization</a><ul>
<li class="chapter" data-level="2.1" data-path="visualization.html"><a href="visualization.html#Sep10"><i class="fa fa-check"></i><b>2.1</b> 9/10/19 Agenda</a></li>
<li class="chapter" data-level="2.2" data-path="visualization.html"><a href="visualization.html#examples"><i class="fa fa-check"></i><b>2.2</b> Examples</a><ul>
<li class="chapter" data-level="2.2.1" data-path="visualization.html"><a href="visualization.html#cholera-via-tufte"><i class="fa fa-check"></i><b>2.2.1</b> Cholera via Tufte</a></li>
<li class="chapter" data-level="2.2.2" data-path="visualization.html"><a href="visualization.html#challenger-via-tufte"><i class="fa fa-check"></i><b>2.2.2</b> Challenger via Tufte</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="visualization.html"><a href="visualization.html#thoughts"><i class="fa fa-check"></i><b>2.3</b> Thoughts on Plotting</a><ul>
<li class="chapter" data-level="2.3.1" data-path="visualization.html"><a href="visualization.html#advice"><i class="fa fa-check"></i><b>2.3.1</b> Advice</a></li>
<li class="chapter" data-level="2.3.2" data-path="visualization.html"><a href="visualization.html#an-example-from-information-is-beautiful"><i class="fa fa-check"></i><b>2.3.2</b> An example from Information is Beautiful</a></li>
<li class="chapter" data-level="2.3.3" data-path="visualization.html"><a href="visualization.html#assessing-graphics-and-other-analyses"><i class="fa fa-check"></i><b>2.3.3</b> Assessing Graphics (and Other Analyses)</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="visualization.html"><a href="visualization.html#Sep12"><i class="fa fa-check"></i><b>2.4</b> 9/12/19 Agenda</a></li>
<li class="chapter" data-level="2.5" data-path="visualization.html"><a href="visualization.html#deconstruct"><i class="fa fa-check"></i><b>2.5</b> Deconstructing a graph</a><ul>
<li class="chapter" data-level="2.5.1" data-path="visualization.html"><a href="visualization.html#gg"><i class="fa fa-check"></i><b>2.5.1</b> The Grammar of Graphics (<code>gg</code>)</a></li>
<li class="chapter" data-level="2.5.2" data-path="visualization.html"><a href="visualization.html#ggplot2"><i class="fa fa-check"></i><b>2.5.2</b> <code>ggplot2</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="wrang.html"><a href="wrang.html"><i class="fa fa-check"></i><b>3</b> Data Wrangling</a><ul>
<li class="chapter" data-level="3.1" data-path="wrang.html"><a href="wrang.html#Sep17"><i class="fa fa-check"></i><b>3.1</b> 9/17/19 Agenda</a></li>
<li class="chapter" data-level="3.2" data-path="wrang.html"><a href="wrang.html#datastruc"><i class="fa fa-check"></i><b>3.2</b> Structure of Data</a><ul>
<li class="chapter" data-level="3.2.1" data-path="wrang.html"><a href="wrang.html#building-tidy-data"><i class="fa fa-check"></i><b>3.2.1</b> Building Tidy Data</a></li>
<li class="chapter" data-level="3.2.2" data-path="wrang.html"><a href="wrang.html#examples-of-chaining"><i class="fa fa-check"></i><b>3.2.2</b> Examples of Chaining</a></li>
<li class="chapter" data-level="3.2.3" data-path="wrang.html"><a href="wrang.html#data-verbs-on-single-data-frames"><i class="fa fa-check"></i><b>3.2.3</b> Data Verbs (on single data frames)</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="wrang.html"><a href="wrang.html#r-examples-basic-verbs"><i class="fa fa-check"></i><b>3.3</b> R examples, basic verbs</a><ul>
<li class="chapter" data-level="3.3.1" data-path="wrang.html"><a href="wrang.html#datasets"><i class="fa fa-check"></i><b>3.3.1</b> Datasets</a></li>
<li class="chapter" data-level="3.3.2" data-path="wrang.html"><a href="wrang.html#examples-of-chaining-1"><i class="fa fa-check"></i><b>3.3.2</b> Examples of Chaining</a></li>
<li class="chapter" data-level="3.3.3" data-path="wrang.html"><a href="wrang.html#data-verbs"><i class="fa fa-check"></i><b>3.3.3</b> Data Verbs</a></li>
<li class="chapter" data-level="3.3.4" data-path="wrang.html"><a href="wrang.html#summarize-and-group_by"><i class="fa fa-check"></i><b>3.3.4</b> <code>summarize</code> and <code>group_by</code></a></li>
<li class="chapter" data-level="3.3.5" data-path="wrang.html"><a href="wrang.html#babynames"><i class="fa fa-check"></i><b>3.3.5</b> babynames</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="wrang.html"><a href="wrang.html#Sep19"><i class="fa fa-check"></i><b>3.4</b> 9/19/19 Agenda</a></li>
<li class="chapter" data-level="3.5" data-path="wrang.html"><a href="wrang.html#highverb"><i class="fa fa-check"></i><b>3.5</b> Higher Level Data Verbs</a></li>
<li class="chapter" data-level="3.6" data-path="wrang.html"><a href="wrang.html#r-examples-higher-level-verbs"><i class="fa fa-check"></i><b>3.6</b> R examples, higher level verbs</a><ul>
<li class="chapter" data-level="3.6.1" data-path="wrang.html"><a href="wrang.html#pivot_longer"><i class="fa fa-check"></i><b>3.6.1</b> <code>pivot_longer</code></a></li>
<li class="chapter" data-level="3.6.2" data-path="wrang.html"><a href="wrang.html#pivot_wider"><i class="fa fa-check"></i><b>3.6.2</b> <code>pivot_wider</code></a></li>
<li class="chapter" data-level="3.6.3" data-path="wrang.html"><a href="wrang.html#join-use-join-to-merge-two-datasets"><i class="fa fa-check"></i><b>3.6.3</b> <code>join</code> (use <code>join</code> to <strong>merge</strong> two datasets)</a></li>
<li class="chapter" data-level="3.6.4" data-path="wrang.html"><a href="wrang.html#lubridate"><i class="fa fa-check"></i><b>3.6.4</b> <code>lubridate</code></a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="wrang.html"><a href="wrang.html#reprex"><i class="fa fa-check"></i><b>3.7</b> <code>reprex</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sims.html"><a href="sims.html"><i class="fa fa-check"></i><b>4</b> Simulating</a><ul>
<li class="chapter" data-level="4.1" data-path="sims.html"><a href="sims.html#Sep24"><i class="fa fa-check"></i><b>4.1</b> 9/24/19 Agenda</a></li>
<li class="chapter" data-level="4.2" data-path="sims.html"><a href="sims.html#simmodels"><i class="fa fa-check"></i><b>4.2</b> Simulating Complicated Models</a><ul>
<li class="chapter" data-level="4.2.1" data-path="sims.html"><a href="sims.html#goals-of-simulating-complicated-models"><i class="fa fa-check"></i><b>4.2.1</b> Goals of Simulating Complicated Models</a></li>
<li class="chapter" data-level="4.2.2" data-path="sims.html"><a href="sims.html#examples-of-pigs-and-blackjack"><i class="fa fa-check"></i><b>4.2.2</b> Examples of Pigs and Blackjack</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="sims.html"><a href="sims.html#Sep26"><i class="fa fa-check"></i><b>4.3</b> 9/26/19 Agenda</a></li>
<li class="chapter" data-level="4.4" data-path="sims.html"><a href="sims.html#simsens"><i class="fa fa-check"></i><b>4.4</b> Simulating to Assess Sensitivity</a><ul>
<li class="chapter" data-level="4.4.1" data-path="sims.html"><a href="sims.html#bias-in-models"><i class="fa fa-check"></i><b>4.4.1</b> Bias in Models</a></li>
<li class="chapter" data-level="4.4.2" data-path="sims.html"><a href="sims.html#technical-conditions"><i class="fa fa-check"></i><b>4.4.2</b> Technical Conditions</a></li>
<li class="chapter" data-level="4.4.3" data-path="sims.html"><a href="sims.html#generating-random-numbers"><i class="fa fa-check"></i><b>4.4.3</b> Generating random numbers</a></li>
<li class="chapter" data-level="4.4.4" data-path="sims.html"><a href="sims.html#generating-other-rvs-the-inverse-transform-method"><i class="fa fa-check"></i><b>4.4.4</b> Generating other RVs: <strong>The Inverse Transform Method</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="perms.html"><a href="perms.html"><i class="fa fa-check"></i><b>5</b> Randomization &amp; Permutation Tests</a><ul>
<li class="chapter" data-level="5.1" data-path="perms.html"><a href="perms.html#Oct1"><i class="fa fa-check"></i><b>5.1</b> 10/1/19 Agenda</a></li>
<li class="chapter" data-level="5.2" data-path="perms.html"><a href="perms.html#algs"><i class="fa fa-check"></i><b>5.2</b> Inference Algorithms</a><ul>
<li class="chapter" data-level="5.2.1" data-path="perms.html"><a href="perms.html#hypothesis-test-algorithm"><i class="fa fa-check"></i><b>5.2.1</b> Hypothesis Test Algorithm</a></li>
<li class="chapter" data-level="5.2.2" data-path="perms.html"><a href="perms.html#permutation-tests-algorithm"><i class="fa fa-check"></i><b>5.2.2</b> Permutation Tests Algorithm</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="perms.html"><a href="perms.html#Oct3"><i class="fa fa-check"></i><b>5.3</b> 10/3/19 Agenda</a></li>
<li class="chapter" data-level="5.4" data-path="perms.html"><a href="perms.html#perms"><i class="fa fa-check"></i><b>5.4</b> Permutation tests</a><ul>
<li class="chapter" data-level="5.4.1" data-path="perms.html"><a href="perms.html#permutation-vs.randomization-tests"><i class="fa fa-check"></i><b>5.4.1</b> Permutation vs. Randomization Tests</a></li>
<li class="chapter" data-level="5.4.2" data-path="perms.html"><a href="perms.html#ci-from-permutation-tests"><i class="fa fa-check"></i><b>5.4.2</b> CI from Permutation Tests</a></li>
<li class="chapter" data-level="5.4.3" data-path="perms.html"><a href="perms.html#permutationrandomization-examples"><i class="fa fa-check"></i><b>5.4.3</b> Permutation/Randomization Examples</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://st47s.com/Math154" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Computational Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="perms" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Randomization &amp; Permutation Tests</h1>
<div id="Oct1" class="section level2">
<h2><span class="header-section-number">5.1</span> 10/1/19 Agenda</h2>
<ol style="list-style-type: decimal">
<li>Review: logic of hypothesis testing</li>
<li>Logic of permutation tests</li>
<li>Examples - 2 samples and beyond</li>
</ol>
<!--
Just use repeated measures????
-->
<div id="motivation" class="section level5 unnumbered">
<h5>Motivation:</h5>
<ul>
<li>Great video of how/why computational statistical methods can be extremely useful. And it’s about beer and mosquitos! John Rauser from Pintrest gives the keynote address at Strata + Hadoop World Conference October 16, 2014. David Smith, Revolution Analytics blog, October 17, 2014. <a href="http://blog.revolutionanalytics.com/2014/10/statistics-doesnt-have-to-be-that-hard.html" class="uri">http://blog.revolutionanalytics.com/2014/10/statistics-doesnt-have-to-be-that-hard.html</a></li>
<li>A more complicated scenario with the same tools being applied. Here the point is to understand gerrymandering. <a href="https://www.youtube.com/watch?v=gRCZR_BbjTo&amp;t=125s" class="uri">https://www.youtube.com/watch?v=gRCZR_BbjTo&amp;t=125s</a></li>
</ul>
<blockquote>
<p>The big lesson here, IMO, is that so many statistical problems can seem complex, but you can actually get a lot of insight by recognizing that your data is just one possible instance of a random process. If you have a hypothesis for what that process is, you can simulate it, and get an intuitive sense of how surprising your data is. R has excellent tools for simulating data, and a couple of hours spent writing code to simulate data can often give insights that will be valuable for the formal data analysis to come. (David Smith)</p>
</blockquote>
<p>Rauser says that the in order to follow a statistical argument that uses simulation, you need three things:</p>
<ol style="list-style-type: decimal">
<li>Ability to follow a simple logical argument.</li>
<li>Random number generation.</li>
<li>Iteration</li>
</ol>
</div>
</div>
<div id="algs" class="section level2">
<h2><span class="header-section-number">5.2</span> Inference Algorithms</h2>
<div id="hypothesis-test-algorithm" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Hypothesis Test Algorithm</h3>
<p>Before working out the nitty gritty details, recall the structure of hypothesis testing. Consider the applet on Simulating ANOVA Tables (Chance &amp; Rossman) <a href="http://www.rossmanchance.com/applets/AnovaSim.html" class="uri">http://www.rossmanchance.com/applets/AnovaSim.html</a></p>
<ol style="list-style-type: decimal">
<li>Choose a statistic that measures the effect you are looking for. For example, the ANOVA F statistic is:</li>
</ol>
<p><span class="math display">\[\begin{align}
F &amp;=&amp; \frac{\text{between-group variability}}{\text{within-group variability}}\\
&amp;=&amp; \frac{\sum_i n_i(\overline{X}_{i\cdot} - \overline{X})^2/(K-1)}{\sum_{ij} (X_{ij}-\overline{X}_{i\cdot})^2/(N-K)}
\end{align}\]</span></p>
<ol start="2" style="list-style-type: decimal">
<li><p>Construct the sampling distribution that this statistic would have if the effect were <em>not</em> present in the population. [The sampling distributions for t statistics and F statistics are based on the Central Limit Theorem and derived in Math 152.]</p></li>
<li><p>Locate the observed statistic in this distribution. A value in the main body of the distribution could easily occur just by chance. A value in the tail would rarely occur by chance and so is evidence that something other than chance is operating. [This piece is going to happen in permutation tests as well as in analytic tests – the point is to see if the observed data is consistent with the null distribution.]</p></li>
</ol>
<div id="p-value---is-the-probability-of-the-observed-data-or-more-extreme-if-the-null-hypothesis-is-true.-also-true-for-both-types-of-tests" class="section level5">
<h5><span class="header-section-number">5.2.1.0.1</span> p-value {-} is the probability of the observed data or more extreme if the null hypothesis is true. [Also true for both types of tests!]</h5>
<p>To estimate the p-value for a test of significance, estimate the sampling distribution of the test statistic when the null hypothesis is true by resampling in a manner that is consistent with the null hypothesis.</p>
</div>
</div>
<div id="permutation-tests-algorithm" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Permutation Tests Algorithm</h3>
<p>To evaluate the p-value for a permutation test, estimate the sampling distribution of the test statistic when the null hypothesis is true by resampling in a manner that is consistent with the null hypothesis (the number of resamples is finite but can be large!).</p>
<p><strong>Procedure</strong>
1. Choose a test statistic
2. Shuffle the data (enforce the null hypothesis to be true)
3. Create a null sampling distribution of the test statistic (under <span class="math inline">\(H_0\)</span>)
4. Find the observed test statistic on the null sampling distribution and compute the p-value (observed data or more extreme). The p-value can be one or two-sided.</p>
<div id="assumptions" class="section level4 unnumbered">
<h4>Assumptions</h4>
<p>Permutation tests fall into a broad class of tests called “non-parametric” tests. The label indicates that there are no distributional assumptions made on the data (i.e., no assumption that the data come from a normal or binomial distribution). However, a test which is ``non-parametric&quot; does not meant that there are no assumptions on the data, simply that there are no <em>distributional or parametric</em> assumptions on the data. </p>
<p>For permutation tests, we are not basing the test on population parameters, so we don’t need to make any assumptions about them (i.e., that they are the mean of a particular distribution).</p>
<ul>
<li><strong>Permutation</strong> The different treatments have the same effect. [Note: exchangeability, same population, etc.] <em>If the null hypothesis is true, the labels assigning groups are interchangeable.</em>
<ul>
<li>Note that it is our choice of *statistic} which makes the test more sensitive to some kinds of difference (e.g., difference in mean) than other kinds (e.g., difference in variance).</li>
</ul></li>
<li><strong>Parametric</strong> The different populations have the same mean.</li>
</ul>
</div>
</div>
</div>
<div id="Oct3" class="section level2">
<h2><span class="header-section-number">5.3</span> 10/3/19 Agenda</h2>
<ol style="list-style-type: decimal">
<li>R code, examples</li>
<li>Assumptions, exchangeability, random structure</li>
<li>Different statistics within the permutation test</li>
<li>Permutation vs. Randomization tests (Binomial)</li>
<li>Other test statistics</li>
</ol>
</div>
<div id="perms" class="section level2">
<h2><span class="header-section-number">5.4</span> Permutation tests</h2>
<p>How is the test interpreted given the different types of sampling which are possibly used to collect the data?
* <strong>Random Sample</strong> The concept of a p-value usually comes from the idea of taking a sample from a population and comparing it to a sampling distribution (from many many random samples).
* <strong>Random Experiment</strong> In the context of a <strong>randomized experiment</strong>, the p-value represents the observed data compared to “happening by chance.”
* The interpretation is easy: if there is only a very small chance that the observed statistic would take such an extreme value, as a result only of the randomization of cases: we reject the null treatment effect hypothesis. CAUSAL!
* <strong>Observational Study</strong> In the context of <strong>observational studies</strong> the results are less strong, but it is reasonable to conclude that the effect observed in the sample reflects an effect present in the population.
* In a sample, consider the difference (or ratio) and ask “Is this difference so large it would rarely occur by chance in a particular sample constructed under the null setting?”
* If the data come from a random sample, then the sample (or results from the sample) are probably consistent with the population [i.e., we can infer the results back to the larger population].</p>
<div id="other-test-statistics" class="section level4">
<h4><span class="header-section-number">5.4.0.1</span> Other Test Statistics</h4>
<p>The example in class used a modification of the ANOVA F-statistic to compare the observed data with the permuted data test statistics. Depending on the data and question, the permuted test statistic can take on any of a variety of forms.</p>
<table>
<thead>
<tr class="header">
<th>Data</th>
<th align="center">Hypothesis Question</th>
<th align="center">Statistic</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2 categorical</td>
<td align="center">diff in prop</td>
<td align="center"><span class="math inline">\(\hat{p}_1 - \hat{p}_2\)</span> or <span class="math inline">\(\chi^2\)</span></td>
</tr>
<tr class="even">
<td>variables</td>
<td align="center">ratio of prop</td>
<td align="center"><span class="math inline">\(\hat{p}_1 / \hat{p}_2\)</span></td>
</tr>
<tr class="odd">
<td>1 numeric</td>
<td align="center">diff in means</td>
<td align="center"><span class="math inline">\(\overline{X}_1 - \overline{X}_2\)</span></td>
</tr>
<tr class="even">
<td>1 binary</td>
<td align="center">ratio of means</td>
<td align="center"><span class="math inline">\(\overline{X}_1 / \overline{X}_2\)</span></td>
</tr>
<tr class="odd">
<td></td>
<td align="center">diff in medians</td>
<td align="center"><span class="math inline">\(\mbox{median}_1 - \mbox{median}_2\)</span></td>
</tr>
<tr class="even">
<td></td>
<td align="center">ratio of medians</td>
<td align="center"><span class="math inline">\(\mbox{median}_1 / \mbox{median}_2\)</span></td>
</tr>
<tr class="odd">
<td></td>
<td align="center">diff in SD</td>
<td align="center"><span class="math inline">\(s_1 - s_2\)</span></td>
</tr>
<tr class="even">
<td></td>
<td align="center">diff in var</td>
<td align="center"><span class="math inline">\(s^2_1 - s^2_2\)</span></td>
</tr>
<tr class="odd">
<td></td>
<td align="center">ratio of SD or VAR</td>
<td align="center">$ s_1 / s_2$</td>
</tr>
<tr class="even">
<td>1 numeric</td>
<td align="center">diff in means</td>
<td align="center"><span class="math inline">\(\sum n_i (\overline{X}_i - \overline{X})^2\)</span> or</td>
</tr>
<tr class="odd">
<td>k groups</td>
<td align="center"></td>
<td align="center">F stat</td>
</tr>
<tr class="even">
<td>paired or</td>
<td align="center">(permute <em>within</em> row)</td>
<td align="center"><span class="math inline">\(\overline{X}_1 - \overline{X}_2\)</span></td>
</tr>
<tr class="odd">
<td>repeated measures</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td>regression</td>
<td align="center">correlation</td>
<td align="center">least sq slope</td>
</tr>
<tr class="odd">
<td>time series</td>
<td align="center">no serial core</td>
<td align="center">lag 1 autocross</td>
</tr>
</tbody>
</table>
<p>Depending on the data, hypotheses, and original data collection structure (e.g., random sampling vs random allocation), the choice of statistic for the permutation test will vary.</p>
</div>
<div id="permutation-vs.randomization-tests" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Permutation vs. Randomization Tests</h3>
<p>We will call <strong>randomization tests</strong> those that enumerate <em>all</em> possible data permutations. <strong>permutation tests</strong>, on the other hand, will permute the data <span class="math inline">\(B\)</span> ($&lt; &lt; $ all) times. Some authors call a permutation test applied to a randomized experiment a randomization test.</p>
<ul>
<li>Main difference: randomization tests consider every possible permutation of the labels, permutation tests take a random sample of permutations of the labels.</li>
<li>Both can only be applied to a comparison situation (e.g., no one sample t-tests).</li>
<li>Both permute labels under <span class="math inline">\(H_0\)</span>, for example, <span class="math inline">\(H_0: F(x) = G(x)\)</span>.</li>
<li>Both can be used in situations where sampling distributions are unknown (e.g., differences in medians).</li>
<li>Both can be used in situations where sampling distributions are based on population distributions (e.g., ratio of variances).</li>
<li>Randomization tests were the first nonparametric tests conceived (R.A. Fisher, 1935).</li>
</ul>
<div id="randomization-p-value" class="section level4 unnumbered">
<h4>Randomization p-value</h4>
<p>Let <span class="math inline">\(t^*\)</span> be the observed test statistic. For a two sample test with <span class="math inline">\(N\)</span> total observations and <span class="math inline">\(n\)</span> observations in group 1, there are <span class="math inline">\({N \choose n}\)</span> randomizations, all of which are equally likely under <span class="math inline">\(H_0\)</span>. The p-value then becomes:
<span class="math display">\[\begin{align}
p_R &amp;=&amp; P(T \leq t^* | H_0) = \frac{\sum_{i=1}^{ {N \choose n}} I(t_i \leq t*)}{ {N \choose n}}
\end{align}\]</span>
If we choose a significance level of <span class="math inline">\(\alpha = k/{N \choose n}\)</span>, then the type I error rate is:
<span class="math display">\[\begin{align}
P(\text{type I error}) &amp;=&amp; P(p_R \leq \alpha | H_0)\\
&amp;=&amp; P\bigg(\sum_{i=1}^{ {N \choose n}} I(t_i \leq t*) \leq k | H_0 \bigg)\\
&amp;=&amp; \frac{k}{{N \choose n} }= \alpha\\
\text{alternatively }  k&amp;=&amp; \alpha {N \choose n}
\end{align}\]</span>
The point of which is to say that the randomization test controls the probability of a Type I error under the very minimal conditions that the subjects are randomized to treatments (minimal assumption, but hard to do in practice!!)</p>
</div>
<div id="permutation-p-value" class="section level4 unnumbered">
<h4>Permutation p-value</h4>
<p>Now consider a permutation test that randomly permutes the data <span class="math inline">\(B\)</span> times (instead of all <span class="math inline">\({N \choose n}\)</span> times). A permutation test approximates a randomization test. In fact, the permutation test can be analyzed using the following binomial random variable:
<span class="math display">\[\begin{align}
X_P &amp;=&amp; \# \ \mbox{permutations out of B that give a more extreme value than the observed test statistic}\\
X_P &amp;\sim&amp; Bin(p_R, B)\\
SE(X_P) &amp;=&amp; \sqrt{\frac{p_R (1-p_R)}{B}} \approx \sqrt{\frac{\hat{p}_P (1-\hat{p}_P)}{B}}
\end{align}\]</span></p>
<p>Consider a situation where interest is in a small effect, say p-value<span class="math inline">\(\approx 0.01\)</span>. The SE should be less than 0.001.
<span class="math display">\[\begin{align}
0.001 &amp;=&amp; \sqrt{ (0.01)\cdot(0.99) / B}\\
B &amp;=&amp; (0.01) \cdot (0.99) / (0.001)^2\\
&amp;=&amp; 9900
\end{align}\]</span></p>
<p>Another way to look at the same problem is to use the estimated p-value = <span class="math inline">\(\hat{p}_P = \frac{X_P}{B}\)</span> to come up with a confidence interval for <span class="math inline">\(p_R\)</span>.</p>
<p>CI for <span class="math inline">\(p_R \approx \hat{p}_P \pm 1.96 \sqrt{\frac{\hat{p}_P (1-\hat{p}_P)}{B}}\)</span></p>
</div>
</div>
<div id="ci-from-permutation-tests" class="section level3">
<h3><span class="header-section-number">5.4.2</span> CI from Permutation Tests</h3>
<p>Use shifts or rescaling to create a CI for a parameter value using permutation tests. That is, consider a situation with data from <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> Use one of the following transformation (depending on the study):
<span class="math display">\[\begin{align}
W &amp;=&amp; Y + a\\
\mbox{or } Y &amp;=&amp; Y / b
\end{align}\]</span>
and run the permutation test of interest on <span class="math inline">\(X\)</span> vs. <span class="math inline">\(W\)</span> or <span class="math inline">\(X\)</span> vs. <span class="math inline">\(U\)</span>. For a series of <span class="math inline">\(a\)</span> or <span class="math inline">\(b\)</span> values we can find which we don’t reject at a particular level of significance (<span class="math inline">\(\alpha\)</span>) to create a <span class="math inline">\((1-\alpha)100\%\)</span> confidence interval.</p>
<p>Usually, however, we use bootstrapping for confidence intervals and permutation tests for hypothesis testing.</p>
</div>
<div id="permutationrandomization-examples" class="section level3">
<h3><span class="header-section-number">5.4.3</span> Permutation/Randomization Examples</h3>
<div id="fishers-exact-test-computationally-efficient-randomization-test" class="section level4">
<h4><span class="header-section-number">5.4.3.1</span> Fisher’s Exact Test – computationally efficient randomization test</h4>
<ul>
<li>N observations are classified into a 2x2 table.</li>
<li>Each observation is classified into exactly one cell.</li>
<li>Row and column totals are fixed.</li>
</ul>
<p>Given fixed row and column totals, we can easily calculate the interior distribution using the hypergeometric. Note that once a single cell is filled, all other cells are determined.</p>
<table>
<thead>
<tr class="header">
<th align="center"></th>
<th align="center">Col 1</th>
<th align="center">Col 2</th>
<th align="center">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Row 1</td>
<td align="center">X</td>
<td align="center">r-X</td>
<td align="center">r</td>
</tr>
<tr class="even">
<td align="center">Row 2</td>
<td align="center">c-X</td>
<td align="center">N-r-c+X</td>
<td align="center">N-r</td>
</tr>
<tr class="odd">
<td align="center">Total</td>
<td align="center">c</td>
<td align="center">N-c</td>
<td align="center">N</td>
</tr>
</tbody>
</table>
<p><span class="math display">\[\begin{align}
P(X=x) &amp;=&amp; \frac{ {r \choose x}{{N-r} \choose {c-x}}}{ {N \choose c}}\\
&amp;&amp; \mbox{out of those in col 1, how many are in row 1?}\\
P(X \leq x) &amp;=&amp; \sum_{i=0}^x \frac{ {r \choose i}{{N-r} \choose {c-i}}}{ {N \choose c}}\\
&amp;=&amp; \mbox{p-value}
\end{align}\]</span></p>
<p>Not common for both row and column totals to be fixed. (More likely for just column totals to be fixed, e.g., men and women.) Instead, consider all subsets of the sample space with <span class="math inline">\(N\)</span> observations. For any particular combination of row and column totals (<span class="math inline">\(rc\)</span>):</p>
<p><span class="math display">\[\begin{align}
P(\mbox{rejecting } H_0 | rc, H_0) &amp;\leq&amp; \alpha\\
P(\mbox{rejecting } H_0 \ \ \forall \mbox{ subsets } | H_0) &amp;\leq&amp; \sum_{rc \ combos} P(\mbox{rejecting } H_0 | rc, H_0) P(rc | H_0)\\
&amp;\leq&amp; \alpha
\end{align}\]</span></p>
<p>(Note: assume $P(rc | H_0) = 1 / # rc $ combos.) The test will be valid at any <span class="math inline">\(\alpha\)</span> level, but it won’t be as powerful as one in which fixed columns/rows is actually meaningful.</p>
</div>
<div id="r-times-c-tables" class="section level4">
<h4><span class="header-section-number">5.4.3.2</span> <span class="math inline">\(r \times c\)</span> tables</h4>
<ul>
<li>permute data in a new way</li>
<li>new test stat
<span class="math display">\[\begin{align}
T = \sum_{i,j} \frac{(O_{i,j} - E_{i,j})^2}{E_{i,j}}
\end{align}\]</span></li>
<li>2-sided p-value. what do we expect?
<span class="math display">\[\begin{align}
E_{i,j} = \frac{R_i C_j}{N}
\end{align}\]</span></li>
</ul>
<div id="example-observer" class="section level5">
<h5><span class="header-section-number">5.4.3.2.1</span> Example: Observer</h5>
<p>In a study published in the <em>Journal of Personality and Social Psychology</em> (Butler and Baumeister, 1998), researchers investigated a conjecture that having an observer with a vested interest would decrease subjects’ performance on a skill-based task. Subjects were given time to practice playing a video game that required them to navigate an obstacle course as quickly as possible. They were then told to play the game on final time with an observer present. Subjects were randomly assigned to one of two groups:</p>
<ul>
<li>Group A was told that the participant and the observer would each win $3 if the participant beat a certain threshold.</li>
<li>Group B was told that only that the participant would win the prize if the threshold was beaten.</li>
</ul>
<p>The goal of this data analysis is to determine whether or not there is an effect from the observer on the performance. That is, like the <span class="math inline">\(\chi^2\)</span> test, our hypotheses are:</p>
<p><span class="math inline">\(H_0:\)</span> there is no association between the two variables
<span class="math inline">\(H_a:\)</span> there is an association between the two variables</p>
<p>The data from the 24 subjects is given below:</p>
<table>
<thead>
<tr class="header">
<th align="center"></th>
<th align="center">A: shares prize</th>
<th align="center">B: no sharing</th>
<th align="center">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Beat threshold</td>
<td align="center">3</td>
<td align="center">8</td>
<td align="center">11</td>
</tr>
<tr class="even">
<td align="center">Did not beat threshold</td>
<td align="center">9</td>
<td align="center">4</td>
<td align="center">13</td>
</tr>
<tr class="odd">
<td align="center">Total</td>
<td align="center">12</td>
<td align="center">12</td>
<td align="center">24</td>
</tr>
</tbody>
</table>
<ol style="list-style-type: decimal">
<li>Card simulation (to demonstrate how the permutation test works)</li>
<li>Permutation Test (see Chance and Rossman applet for automated permutation test, <a href="http://www.rossmanchance.com/applets/ChisqShuffle.htm?FET=1" class="uri">http://www.rossmanchance.com/applets/ChisqShuffle.htm?FET=1</a>)</li>
</ol>
<p><span class="math display">\[\begin{align}
SE(\mbox{p-value}) = \sqrt{\frac{\hat{p}_r (1-\hat{p}_r)}{100}} = 0.02
\end{align}\]</span></p>
<ol start="3" style="list-style-type: decimal">
<li>Randomization Test
<span class="math display">\[\begin{align}
P(X \leq 3) = \sum_{i=0}^3 \frac{ { 11 \choose i}{12 \choose {12-i}}}{ { 24 \choose 12 }} = 0.0436
\end{align}\]</span></li>
</ol>
</div>
</div>
<div id="two-sample-test-computationally-very-difficult-to-do-a-randomization-test" class="section level4">
<h4><span class="header-section-number">5.4.3.3</span> Two sample test – computationally very difficult to do a randomization test</h4>
<div id="example-cloud-seeding" class="section level5">
<h5><span class="header-section-number">5.4.3.3.1</span> Example: Cloud Seeding</h5>
<p>Cloud seeding data: seeding or not seeding was randomly allocated to 52 days when seeding was appropriate. The pilot did not know whether or not the plane was seeding. Rain is measured in acre-feet.</p>
<p>After running tests to compare means and variances we obtain the following p-values:</p>
<table>
<thead>
<tr class="header">
<th></th>
<th align="center">comparison of means</th>
<th align="center"></th>
<th align="center">comparison of variances</th>
<th align="center"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td align="center">Permutation</td>
<td align="center">t-test</td>
<td align="center">Permutation</td>
<td align="center">F-test</td>
</tr>
<tr class="even">
<td>Raw Data</td>
<td align="center">0.031</td>
<td align="center">0.054</td>
<td align="center">0.068</td>
<td align="center">0.000067</td>
</tr>
<tr class="odd">
<td>Logged Data</td>
<td align="center">0.010</td>
<td align="center">0.014</td>
<td align="center">0.535</td>
<td align="center">0.897</td>
</tr>
</tbody>
</table>
<div id="r-code" class="section level6">
<h6><span class="header-section-number">5.4.3.3.1.1</span> R code</h6>
<p>Before doing anything, let’s look at the data. Here, we visualize with both boxplots and histograms. Also, we visualize on the raw scale as well as the log scale. Certainly, the log10 scale indicates that a transformation makes the data more symmetric.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb315-1" data-line-number="1">clouds &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="st">&quot;https://dasl.datadescription.com/download/data/3117/cloud-seeding.txt&quot;</span>, </a>
<a class="sourceLine" id="cb315-2" data-line-number="2">     <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">escape_double =</span> <span class="ot">FALSE</span>, <span class="dt">trim_ws =</span> <span class="ot">TRUE</span>) </a>
<a class="sourceLine" id="cb315-3" data-line-number="3"></a>
<a class="sourceLine" id="cb315-4" data-line-number="4"><span class="kw">names</span>(clouds) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;unseeded&quot;</span>, <span class="st">&quot;seeded&quot;</span>)</a>
<a class="sourceLine" id="cb315-5" data-line-number="5">clouds &lt;-<span class="st"> </span>tidyr<span class="op">::</span><span class="kw">pivot_longer</span>(clouds, <span class="dt">cols =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">names_to =</span> <span class="st">&quot;seeding&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;rainfall&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb315-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">seeding =</span> <span class="kw">as.factor</span>(seeding))</a>
<a class="sourceLine" id="cb315-7" data-line-number="7"></a>
<a class="sourceLine" id="cb315-8" data-line-number="8">clouds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb315-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>seeding, <span class="dt">y=</span>rainfall)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="05-permutation_files/figure-html/unnamed-chunk-2-1.png" width="480" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb316-1" data-line-number="1">clouds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb316-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>rainfall)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">20</span>) <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>seeding)</a></code></pre></div>
<p><img src="05-permutation_files/figure-html/unnamed-chunk-2-2.png" width="480" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb317-1" data-line-number="1">clouds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb317-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>seeding, <span class="dt">y=</span>rainfall)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_log10</span>()</a></code></pre></div>
<p><img src="05-permutation_files/figure-html/unnamed-chunk-3-1.png" width="480" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb318-1" data-line-number="1">clouds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb318-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>rainfall)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">20</span>) <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>seeding) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_log10</span>()</a></code></pre></div>
<p><img src="05-permutation_files/figure-html/unnamed-chunk-3-2.png" width="480" style="display: block; margin: auto;" /></p>
<p>#unlogged data:</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb319-1" data-line-number="1">clouds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb319-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lnrain =</span> <span class="kw">log</span>(rainfall)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb319-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(seeding) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb319-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">meanrain =</span> <span class="kw">mean</span>(rainfall), <span class="dt">meanlnrain =</span> <span class="kw">mean</span>(lnrain))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   seeding  meanrain meanlnrain
##   &lt;fct&gt;       &lt;dbl&gt;      &lt;dbl&gt;
## 1 seeded       442.       5.13
## 2 unseeded     165.       3.99</code></pre>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb321-1" data-line-number="1">clouds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb321-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lnrain =</span> <span class="kw">log</span>(rainfall)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb321-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(seeding) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb321-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">meanrain =</span> <span class="kw">mean</span>(rainfall), <span class="dt">meanlnrain =</span> <span class="kw">mean</span>(lnrain)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb321-5" data-line-number="5"><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">diff</span>(meanrain), <span class="kw">diff</span>(meanlnrain))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   `diff(meanrain)` `diff(meanlnrain)`
##              &lt;dbl&gt;              &lt;dbl&gt;
## 1            -277.              -1.14</code></pre>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb323-1" data-line-number="1">raindiffs &lt;-<span class="st"> </span>clouds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb323-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lnrain =</span> <span class="kw">log</span>(rainfall)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb323-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(seeding) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb323-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">meanrain =</span> <span class="kw">mean</span>(rainfall), <span class="dt">meanlnrain =</span> <span class="kw">mean</span>(lnrain)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb323-5" data-line-number="5"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">diffrain =</span> <span class="kw">diff</span>(meanrain), <span class="dt">difflnrain =</span> <span class="kw">diff</span>(meanlnrain))</a>
<a class="sourceLine" id="cb323-6" data-line-number="6"></a>
<a class="sourceLine" id="cb323-7" data-line-number="7">raindiffs</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   diffrain difflnrain
##      &lt;dbl&gt;      &lt;dbl&gt;
## 1    -277.      -1.14</code></pre>
<p>Below, we’ve formally gone through a permutation. hhere, the resampling is not coded in a particularly tidy way, but there is a tidy way to code loops! Generally, loops are not the fasted way to code in R, so if you need to quickly run code that seems like it should go in a loop, it is very likely that <code>purrr</code> is the direction you want to go, <a href="https://purrr.tidyverse.org/" class="uri">https://purrr.tidyverse.org/</a>.</p>
</div>
</div>
<div id="difference-in-means-after-permuting" class="section level5">
<h5><span class="header-section-number">5.4.3.3.2</span> Difference in means after permuting</h5>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb325-1" data-line-number="1">reps &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb325-2" data-line-number="2">permdiffs &lt;-<span class="st"> </span><span class="kw">c</span>()</a>
<a class="sourceLine" id="cb325-3" data-line-number="3"></a>
<a class="sourceLine" id="cb325-4" data-line-number="4"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>reps){</a>
<a class="sourceLine" id="cb325-5" data-line-number="5">  onediff &lt;-<span class="st"> </span>clouds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb325-6" data-line-number="6"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">permseed =</span> <span class="kw">sample</span>(seeding)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb325-7" data-line-number="7"><span class="st">    </span><span class="kw">group_by</span>(permseed) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb325-8" data-line-number="8"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">meanrain =</span> <span class="kw">mean</span>(rainfall)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb325-9" data-line-number="9"><span class="st">    </span><span class="kw">summarize</span>(<span class="kw">diff</span>(meanrain)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>()</a>
<a class="sourceLine" id="cb325-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb325-11" data-line-number="11">permdiffs &lt;-<span class="st"> </span><span class="kw">c</span>(permdiffs, onediff)</a>
<a class="sourceLine" id="cb325-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb325-13" data-line-number="13"></a>
<a class="sourceLine" id="cb325-14" data-line-number="14">permdiffs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb325-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> permdiffs)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins=</span><span class="dv">30</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> raindiffs<span class="op">$</span>diffrain, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)</a></code></pre></div>
<p><img src="05-permutation_files/figure-html/unnamed-chunk-5-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="ratio-of-variances-after-permuting" class="section level5">
<h5><span class="header-section-number">5.4.3.3.3</span> Ratio of variances after permuting</h5>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb326-1" data-line-number="1">rainvarratio &lt;-<span class="st"> </span>clouds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb326-2" data-line-number="2"><span class="st">    </span><span class="kw">group_by</span>(seeding) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb326-3" data-line-number="3"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">varrain =</span> <span class="kw">var</span>(rainfall)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb326-4" data-line-number="4"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">rainratio =</span> varrain[<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>varrain[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb326-5" data-line-number="5"></a>
<a class="sourceLine" id="cb326-6" data-line-number="6"></a>
<a class="sourceLine" id="cb326-7" data-line-number="7">reps &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb326-8" data-line-number="8">permvars &lt;-<span class="st"> </span><span class="kw">c</span>()</a>
<a class="sourceLine" id="cb326-9" data-line-number="9"></a>
<a class="sourceLine" id="cb326-10" data-line-number="10"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>reps){</a>
<a class="sourceLine" id="cb326-11" data-line-number="11">  oneratio &lt;-<span class="st"> </span>clouds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb326-12" data-line-number="12"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">permseed =</span> <span class="kw">sample</span>(seeding)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb326-13" data-line-number="13"><span class="st">    </span><span class="kw">group_by</span>(permseed) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb326-14" data-line-number="14"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">varrain =</span> <span class="kw">var</span>(rainfall)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb326-15" data-line-number="15"><span class="st">    </span><span class="kw">summarize</span>(varrain[<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>varrain[<span class="dv">2</span>]) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>()</a>
<a class="sourceLine" id="cb326-16" data-line-number="16">  </a>
<a class="sourceLine" id="cb326-17" data-line-number="17">permvars &lt;-<span class="st"> </span><span class="kw">c</span>(permvars, oneratio)</a>
<a class="sourceLine" id="cb326-18" data-line-number="18">}</a>
<a class="sourceLine" id="cb326-19" data-line-number="19"></a>
<a class="sourceLine" id="cb326-20" data-line-number="20">permvars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb326-21" data-line-number="21"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> permvars)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins=</span><span class="dv">30</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> rainvarratio<span class="op">$</span>rainratio , <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)</a></code></pre></div>
<p><img src="05-permutation_files/figure-html/unnamed-chunk-6-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="testing-differences-in-means-or-ratios-of-variances" class="section level5">
<h5><span class="header-section-number">5.4.3.3.4</span> Testing differences in means or ratios of variances</h5>
<p>As evidenced in the histograms above,</p>
<ul>
<li><p>the permutation test (one-sided) for the difference in means will count the number of permuted differences that are less than or equal to the observed difference in means, just over 1%.</p></li>
<li><p>the permutation test (one-sided) for the ratio of variances will count the number of permuted ratios that are greater than or equal to the observered ratio of varances, about 7%.</p></li>
</ul>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb327-1" data-line-number="1">(<span class="kw">sum</span>(raindiffs<span class="op">$</span>diffrain <span class="op">&gt;=</span><span class="st"> </span>permdiffs) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="dv">1000</span></a></code></pre></div>
<pre><code>## [1] 0.027</code></pre>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb329-1" data-line-number="1">(<span class="kw">sum</span>(rainvarratio<span class="op">$</span>rainratio <span class="op">&lt;=</span><span class="st"> </span>permvars)<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">1000</span></a></code></pre></div>
<pre><code>## [1] 0.081</code></pre>
<!--

need to add b to one side before permuting.  R code was getting complicated.

#####  How can permutations be used to create confidence intervals?

To find a CI for the difference in locations of the distributions of the seeded vs. unseeded rainfall, we shift the unseeded values by some amount, and do our usual hypothesis test.  Our CI will be those values we don't reject for a given $\alpha$. Here:

|   | b test value  |   |   |   |   |   |   |   |   |   |
|---    |:------------: |:----: |:----: |:----: |:----: |:----: |:----: |:----: |:----: |:----: |
|   | 0     | 20    | 50    | 100   | 300   | 400   | 500   | 550   | 570   | 600   |
| p     | 0.027     | 0.03  | 0.05  | 0.11  | 0.56  | 0.80  | 0.94  | 0.98  | 0.98  | 0.99  |


where p is the proportion of simulated test statistics greater than or equal to our observed value (after shifting by an amount "b").


```r
reps <- 1000
raindiffs <- clouds %>%
  mutate(lnrain = log(rainfall)) %>%
  group_by(seeding) %>%
  summarize(meanrain = mean(rainfall)) %>%
  summarize(diffrain = diff(meanrain))

for(b in c(0,20,50,100,300,400,500,550,570,600)){
  

permdiffs <- c()

for(i in 1:reps){
  onediff <- clouds %>%
    mutate(permseed = sample(seeding)) %>%
    group_by(permseed) %>%
    summarize(meanrain = mean(rainfall)) %>%
    summarize(diff(meanrain)) %>% pull()
  
permdiffs <- c(permdiffs, onediff)
}

cloud.ci<-cbind(rainfall=c(cloud[,1]+c(rep(b,26),rep(0,26))),cloud[,2])

obs.um.ci.stat<-tapply(cloud.ci[,1],cloud.ci[,2],mean)[2] -
tapply(cloud.ci[,1],cloud.ci[,2],mean)[1]


perm.um.ci.stat<-c()

for(i in 1:3999){
     cloud.ci2<-sample(cloud.ci[,1],52,replace=F)
     perm.um.ci.stat<-c(perm.um.ci.stat,tapply(cloud.ci2,cloud[,2],mean)[1] -
    tapply(cloud.ci2,cloud[,2],mean)[2])
    }

print((sum(obs.um.ci.stat>=perm.um.ci.stat)+1)/4000)
}
```

-->

</div>
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sims.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05-permutation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["Math-154-Notes.pdf", "Math-154-Notes.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
