<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 12 Analysis of variance (ANOVA) | Linear Models</title>
<meta name="author" content="Jo Hardin">
<meta name="description" content="12.1 Analysis of variance (ANOVA)  Main Idea: Decompose the total variation on the outcome into: the variation that can be explained by the each of the variables in the model the variation that...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 12 Analysis of variance (ANOVA) | Linear Models">
<meta property="og:type" content="book">
<meta property="og:description" content="12.1 Analysis of variance (ANOVA)  Main Idea: Decompose the total variation on the outcome into: the variation that can be explained by the each of the variables in the model the variation that...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 12 Analysis of variance (ANOVA) | Linear Models">
<meta name="twitter:description" content="12.1 Analysis of variance (ANOVA)  Main Idea: Decompose the total variation on the outcome into: the variation that can be explained by the each of the variables in the model the variation that...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script type="text/x-mathjax-config">
    const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
    for (let popover of popovers){
      const div = document.createElement('div');
      div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
      div.innerHTML = popover.getAttribute('data-content');
      
      // Will this work with TeX on its own line?
      var has_math = div.querySelector("span.math");
      if (has_math) {
        document.body.appendChild(div);
      	MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
      	MathJax.Hub.Queue(function(){
          popover.setAttribute('data-content', div.innerHTML);
      	})
      }
    }
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Linear Models</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Class Information</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="wrang.html"><span class="header-section-number">2</span> Data Wrangling</a></li>
<li><a class="" href="viz.html"><span class="header-section-number">3</span> Visualization</a></li>
<li><a class="" href="slr.html"><span class="header-section-number">4</span> Simple Linear Regression</a></li>
<li><a class="" href="infslr.html"><span class="header-section-number">5</span> Inference on SLR Parameters</a></li>
<li><a class="" href="diag1.html"><span class="header-section-number">6</span> Diagnostic Measures I</a></li>
<li><a class="" href="simult.html"><span class="header-section-number">7</span> Simultaneous Inference</a></li>
<li><a class="" href="la.html"><span class="header-section-number">8</span> Regression using Matrices</a></li>
<li><a class="" href="mlr.html"><span class="header-section-number">9</span> Multiple Linear Regression</a></li>
<li><a class="" href="process.html"><span class="header-section-number">10</span> Modeling as a Process6</a></li>
<li><a class="" href="build.html"><span class="header-section-number">11</span> Statistical Model Building</a></li>
<li><a class="active" href="analysis-of-variance-anova.html"><span class="header-section-number">12</span> Analysis of variance (ANOVA)</a></li>
<li><a class="" href="diag2.html"><span class="header-section-number">13</span> Diagnostics II</a></li>
<li><a class="" href="shrink.html"><span class="header-section-number">14</span> Shrinkage Methods</a></li>
<li><a class="" href="smooth.html"><span class="header-section-number">15</span> Smoothing Methods</a></li>
<li><a class="" href="anova.html"><span class="header-section-number">16</span> ANOVA</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/hardin47/website">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="analysis-of-variance-anova" class="section level1" number="12">
<h1>
<span class="header-section-number">12</span> Analysis of variance (ANOVA)<a class="anchor" aria-label="anchor" href="#analysis-of-variance-anova"><i class="fas fa-link"></i></a>
</h1>
<div id="analysis-of-variance-anova-1" class="section level2" number="12.1">
<h2>
<span class="header-section-number">12.1</span> Analysis of variance (ANOVA)<a class="anchor" aria-label="anchor" href="#analysis-of-variance-anova-1"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>
<strong>Main Idea:</strong> Decompose the total variation on the outcome into:
<ul>
<li><p>the variation that can be explained by the each of the variables in the model</p></li>
<li><p>the variation that <strong>can’t</strong> be explained by the model (left in the residuals)</p></li>
</ul>
</li>
<li>If the variation that can be explained by the variables in the model is greater than the variation in the residuals, this signals that the model might be “valuable” (at least one of the <span class="math inline">\(\beta\)</span>s not equal to 0)</li>
</ul>
</div>
<div id="anova-output-1" class="section level2" number="12.2">
<h2>
<span class="header-section-number">12.2</span> ANOVA output<a class="anchor" aria-label="anchor" href="#anova-output-1"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb516"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">tip_fit</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/generics/man/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu">kable</span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:right;">
sumsq
</th>
<th style="text-align:right;">
meansq
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Party
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1189
</td>
<td style="text-align:right;">
1188.64
</td>
<td style="text-align:right;">
285.71
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
Age
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
38
</td>
<td style="text-align:right;">
19.01
</td>
<td style="text-align:right;">
4.57
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:left;">
Residuals
</td>
<td style="text-align:right;">
165
</td>
<td style="text-align:right;">
686
</td>
<td style="text-align:right;">
4.16
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="anova-output-with-totals" class="section level2" number="12.3">
<h2>
<span class="header-section-number">12.3</span> ANOVA output, with totals<a class="anchor" aria-label="anchor" href="#anova-output-with-totals"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:right;">
sumsq
</th>
<th style="text-align:left;">
meansq
</th>
<th style="text-align:left;">
statistic
</th>
<th style="text-align:left;">
p.value
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Party
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1189
</td>
<td style="text-align:left;">
1188.64
</td>
<td style="text-align:left;">
285.71
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Age
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
38
</td>
<td style="text-align:left;">
19.01
</td>
<td style="text-align:left;">
4.57
</td>
<td style="text-align:left;">
0.01
</td>
</tr>
<tr>
<td style="text-align:left;">
Residuals
</td>
<td style="text-align:right;">
165
</td>
<td style="text-align:right;">
686
</td>
<td style="text-align:left;">
4.16
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Total
</td>
<td style="text-align:right;">
168
</td>
<td style="text-align:right;">
1913
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="sum-of-squares" class="section level2" number="12.4">
<h2>
<span class="header-section-number">12.4</span> Sum of squares<a class="anchor" aria-label="anchor" href="#sum-of-squares"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:right;">
sumsq
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Party
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;background-color: #D9E3E4 !important;">
1189
</td>
</tr>
<tr>
<td style="text-align:left;">
Age
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;background-color: #D9E3E4 !important;">
38
</td>
</tr>
<tr>
<td style="text-align:left;">
Residuals
</td>
<td style="text-align:right;">
165
</td>
<td style="text-align:right;background-color: #D9E3E4 !important;">
686
</td>
</tr>
<tr>
<td style="text-align:left;">
Total
</td>
<td style="text-align:right;">
168
</td>
<td style="text-align:right;background-color: #D9E3E4 !important;">
1913
</td>
</tr>
</tbody>
</table></div>
<ul>
<li>
<span class="math inline">\(SS_{Total}\)</span>: Total sum of squares, variability of outcome, <span class="math inline">\(\sum_{i = 1}^n (y_i - \bar{y})^2\)</span>
</li>
<li>
<span class="math inline">\(SS_{Error}\)</span>: Residual sum of squares, variability of residuals, <span class="math inline">\(\sum_{i = 1}^n (y_i - \hat{y})^2\)</span>
</li>
<li>
<span class="math inline">\(SS_{Model} = SS_{Total} - SS_{Error}\)</span>: Variability explained by the model</li>
</ul>
</div>
<div id="r-example-sat-scores" class="section level2" number="12.5">
<h2>
<span class="header-section-number">12.5</span> R: example: SAT scores<a class="anchor" aria-label="anchor" href="#r-example-sat-scores"><i class="fas fa-link"></i></a>
</h2>
<p>These notes belong at the end… I’m putting them here to highlight them before the full analysis.</p>
<ul>
<li>Notice that <span class="math inline">\(C_p\)</span> and F-tests use a “full” model MSE. Typically, the MSE will only be an unbiased predictor of <span class="math inline">\(\sigma^2\)</span> in backwards variable selection.</li>
<li>BIC usually results in fewer parameters in the model than AIC.</li>
<li>Using different selection criteria may lead to different models (there is no one best model).</li>
<li>The order in which variables are entered does not necessarily represent their importance. As a variable entered early on can be dropped at a later stage because it is predicted well from the other explanatory variables that have been subsequently added to the model.</li>
</ul>
<p>Consider the multiple regression model:
<span class="math display">\[\begin{eqnarray*}
E[Y] &amp;=&amp; \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \beta_3 X_3 + \beta_4 X_4 + \beta_5 X_5 + \beta_6 X_6\\
Y &amp;=&amp; \mbox{state ave SAT score}\\
X_1 &amp;=&amp; \% \mbox{ of eligible seniors who took the exam, } takers\\
X_2 &amp;=&amp; \mbox{median income of families of test takers, } income\\
X_3 &amp;=&amp; \mbox{ave number of years of formal eduction, } years\\
X_4 &amp;=&amp; \% \mbox{ of test takers who attend public school, } public\\
X_5 &amp;=&amp; \mbox{total state expenditure on public secondary schools (\$100 /student), } expend \\
X_6 &amp;=&amp; \mbox{median percentile rank of test takers within their secondary school class, } rank
\end{eqnarray*}\]</span></p>
<div class="sourceCode" id="cb517"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sat_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/readr/man/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"http://pages.pomona.edu/~jsh04747/courses/math158/sat.csv"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>ltakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">takers</span><span class="op">)</span><span class="op">)</span>

<span class="va">sat_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sat_data</span><span class="op">)</span>  <span class="co"># always be wary of missing rows, though!</span></code></pre></div>
<div id="aic-and-bic-in-r" class="section level3 unnumbered">
<h3>AIC and BIC in R<a class="anchor" aria-label="anchor" href="#aic-and-bic-in-r"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>The model with no variables</li>
</ol>
<div class="sourceCode" id="cb518"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">sat</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">sat_data</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/generics/man/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)     948.      10.2      92.9 7.89e-56</code></pre>
<div class="sourceCode" id="cb520"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">sat</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">sat_data</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/generics/man/glance.html">glance</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>mse <span class="op">=</span> <span class="va">sigma</span><span class="op">^</span><span class="fl">2</span>, sse <span class="op">=</span> <span class="va">mse</span><span class="op">*</span><span class="va">df.residual</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html">select</a></span><span class="op">(</span><span class="va">mse</span>, <span class="va">sse</span>, <span class="va">AIC</span>, <span class="va">BIC</span>, <span class="va">df.residual</span>, <span class="va">nobs</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##     mse     sse   AIC   BIC df.residual  nobs
##   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;
## 1 5112. 245376.  560.  564.          48    49</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>The model on <code>ltakers</code>
</li>
</ol>
<div class="sourceCode" id="cb522"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">sat</span> <span class="op">~</span> <span class="va">ltakers</span>, data <span class="op">=</span> <span class="va">sat_data</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/generics/man/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)   1112.      12.4       89.8 3.11e-54
## 2 ltakers        -59.2      4.17     -14.2 1.27e-18</code></pre>
<div class="sourceCode" id="cb524"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">sat</span> <span class="op">~</span> <span class="va">ltakers</span>, data <span class="op">=</span> <span class="va">sat_data</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/generics/man/glance.html">glance</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>mse <span class="op">=</span> <span class="va">sigma</span><span class="op">^</span><span class="fl">2</span>, sse <span class="op">=</span> <span class="va">mse</span><span class="op">*</span><span class="va">df.residual</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html">select</a></span><span class="op">(</span><span class="va">mse</span>, <span class="va">sse</span>, <span class="va">AIC</span>, <span class="va">BIC</span>, <span class="va">df.residual</span>, <span class="va">nobs</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##     mse    sse   AIC   BIC df.residual  nobs
##   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;
## 1  987. 46369.  481.  487.          47    49</code></pre>
</div>
<div id="best-possible-subsets" class="section level3 unnumbered">
<h3>Best possible subsets<a class="anchor" aria-label="anchor" href="#best-possible-subsets"><i class="fas fa-link"></i></a>
</h3>
<p>Note that the outcome is the best model with one variable, the best model with two variables, etc. Therefore, the selection is based on SSE only. It is your job as the analyst to differentiate between the models of different sizes. You could use <span class="math inline">\(R_{adj}^2\)</span>, AIC, BIC, etc. Here is seems like the 4 variable model is a good contender for best model.</p>
<div class="sourceCode" id="cb526"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">best_lms</span><span class="op">&lt;-</span> <span class="fu">leaps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/leaps/man/regsubsets.html">regsubsets</a></span><span class="op">(</span><span class="va">sat</span> <span class="op">~</span> <span class="va">ltakers</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">years</span> <span class="op">+</span> <span class="va">public</span> <span class="op">+</span> <span class="va">expend</span> <span class="op">+</span> <span class="va">rank</span>, 
        data<span class="op">=</span><span class="va">sat_data</span>, nvmax <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb527"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">best_lms</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/generics/man/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 11
##   `(Intercept)` ltakers income years public expend rank  r.squared adj.r.squared
##   &lt;lgl&gt;         &lt;lgl&gt;   &lt;lgl&gt;  &lt;lgl&gt; &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
## 1 TRUE          TRUE    FALSE  FALSE FALSE  FALSE  FALSE     0.811         0.807
## 2 TRUE          TRUE    FALSE  FALSE FALSE  TRUE   FALSE     0.895         0.890
## 3 TRUE          TRUE    FALSE  TRUE  FALSE  TRUE   FALSE     0.900         0.893
## 4 TRUE          TRUE    FALSE  TRUE  FALSE  TRUE   TRUE      0.911         0.903
## 5 TRUE          TRUE    TRUE   TRUE  FALSE  TRUE   TRUE      0.913         0.903
## 6 TRUE          TRUE    TRUE   TRUE  TRUE   TRUE   TRUE      0.913         0.900
## # … with 2 more variables: BIC &lt;dbl&gt;, mallows_cp &lt;dbl&gt;</code></pre>
</div>
<div id="forward-variable-selection-f-tests" class="section level3 unnumbered">
<h3>Forward Variable Selection: F-tests<a class="anchor" aria-label="anchor" href="#forward-variable-selection-f-tests"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb529"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/add1.html">add1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">sat</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">sat_data</span><span class="op">)</span>, <span class="va">sat</span> <span class="op">~</span> <span class="va">ltakers</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">years</span> <span class="op">+</span> 
       <span class="va">public</span> <span class="op">+</span> <span class="va">expend</span> <span class="op">+</span> <span class="va">rank</span>, test <span class="op">=</span> <span class="st">"F"</span><span class="op">)</span></code></pre></div>
<pre><code>## Single term additions
## 
## Model:
## sat ~ 1
##         Df Sum of Sq    RSS AIC F value  Pr(&gt;F)    
## &lt;none&gt;               245376 419                    
## ltakers  1    199007  46369 340  201.71 &lt; 2e-16 ***
## income   1    102026 143350 395   33.45 5.7e-07 ***
## years    1     26338 219038 416    5.65   0.022 *  
## public   1      1232 244144 421    0.24   0.629    
## expend   1       386 244991 421    0.07   0.787    
## rank     1    190297  55079 348  162.38 &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<div class="sourceCode" id="cb531"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/add1.html">add1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">sat</span> <span class="op">~</span> <span class="va">ltakers</span>, data <span class="op">=</span> <span class="va">sat_data</span><span class="op">)</span>, <span class="va">sat</span> <span class="op">~</span> <span class="va">ltakers</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">years</span> <span class="op">+</span> 
       <span class="va">public</span> <span class="op">+</span> <span class="va">expend</span> <span class="op">+</span> <span class="va">rank</span>, test <span class="op">=</span> <span class="st">"F"</span><span class="op">)</span></code></pre></div>
<pre><code>## Single term additions
## 
## Model:
## sat ~ ltakers
##        Df Sum of Sq   RSS AIC F value  Pr(&gt;F)    
## &lt;none&gt;              46369 340                    
## income  1       785 45584 341    0.79  0.3781    
## years   1      6364 40006 335    7.32  0.0095 ** 
## public  1       449 45920 341    0.45  0.5058    
## expend  1     20523 25846 313   36.53 2.5e-07 ***
## rank    1       871 45498 341    0.88  0.3529    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<div class="sourceCode" id="cb533"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/add1.html">add1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">sat</span> <span class="op">~</span> <span class="va">ltakers</span> <span class="op">+</span> <span class="va">expend</span>, data <span class="op">=</span> <span class="va">sat_data</span><span class="op">)</span>, <span class="va">sat</span> <span class="op">~</span> <span class="va">ltakers</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">years</span> <span class="op">+</span> 
       <span class="va">public</span> <span class="op">+</span> <span class="va">expend</span> <span class="op">+</span> <span class="va">rank</span>, test <span class="op">=</span> <span class="st">"F"</span><span class="op">)</span></code></pre></div>
<pre><code>## Single term additions
## 
## Model:
## sat ~ ltakers + expend
##        Df Sum of Sq   RSS AIC F value Pr(&gt;F)
## &lt;none&gt;              25846 313               
## income  1        53 25792 315    0.09   0.76
## years   1      1248 24598 313    2.28   0.14
## public  1         1 25845 315    0.00   0.96
## rank    1      1054 24792 313    1.91   0.17</code></pre>
<p>Note: <code>Sum of Sq</code> refers to the SSR(new variable <span class="math inline">\(|\)</span> current model) (additional reduction in SSE). <code>RSS</code> is the SSE for the model that contains the current variables and the new variable.</p>
</div>
<div id="backward-variable-selection-f-tests" class="section level3 unnumbered">
<h3>Backward Variable Selection: F-tests<a class="anchor" aria-label="anchor" href="#backward-variable-selection-f-tests"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb535"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># all the variables</span>
<span class="fu"><a href="https://rdrr.io/r/stats/add1.html">drop1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">sat</span> <span class="op">~</span> <span class="va">ltakers</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">years</span> <span class="op">+</span> <span class="va">public</span> <span class="op">+</span> <span class="va">expend</span> <span class="op">+</span> <span class="va">rank</span>, 
         data<span class="op">=</span><span class="va">sat_data</span><span class="op">)</span>, test<span class="op">=</span><span class="st">"F"</span><span class="op">)</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## sat ~ ltakers + income + years + public + expend + rank
##         Df Sum of Sq   RSS AIC F value  Pr(&gt;F)    
## &lt;none&gt;               21397 312                    
## ltakers  1      2150 23547 315    4.22   0.046 *  
## income   1       340 21737 311    0.67   0.418    
## years    1      2532 23928 315    4.97   0.031 *  
## public   1        20 21417 310    0.04   0.844    
## expend   1     10964 32361 330   21.52 3.4e-05 ***
## rank     1      2679 24076 316    5.26   0.027 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<div class="sourceCode" id="cb537"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># less public</span>
<span class="fu"><a href="https://rdrr.io/r/stats/add1.html">drop1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">sat</span> <span class="op">~</span> <span class="va">ltakers</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">years</span> <span class="op">+</span> <span class="va">expend</span> <span class="op">+</span> <span class="va">rank</span>, 
         data<span class="op">=</span><span class="va">sat_data</span><span class="op">)</span>, test<span class="op">=</span><span class="st">"F"</span><span class="op">)</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## sat ~ ltakers + income + years + expend + rank
##         Df Sum of Sq   RSS AIC F value Pr(&gt;F)    
## &lt;none&gt;               21417 310                   
## ltakers  1      2552 23968 313    5.12  0.029 *  
## income   1       505 21922 309    1.01  0.319    
## years    1      3011 24428 314    6.05  0.018 *  
## expend   1     12465 33882 330   25.03  1e-05 ***
## rank     1      3162 24578 315    6.35  0.016 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>If you <code>add1</code> here (to see if it makes sense to add either public or income back), neither is significant.</p>
<div class="sourceCode" id="cb539"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># less income</span>
<span class="fu"><a href="https://rdrr.io/r/stats/add1.html">drop1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">sat</span> <span class="op">~</span> <span class="va">ltakers</span> <span class="op">+</span> <span class="va">years</span> <span class="op">+</span> <span class="va">expend</span> <span class="op">+</span> <span class="va">rank</span>, 
         data<span class="op">=</span><span class="va">sat_data</span><span class="op">)</span>, test<span class="op">=</span><span class="st">"F"</span><span class="op">)</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## sat ~ ltakers + years + expend + rank
##         Df Sum of Sq   RSS AIC F value  Pr(&gt;F)    
## &lt;none&gt;               21922 309                    
## ltakers  1      5094 27016 317   10.22  0.0026 ** 
## years    1      2870 24792 313    5.76  0.0207 *  
## expend   1     13620 35542 331   27.34 4.5e-06 ***
## rank     1      2676 24598 313    5.37  0.0252 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div id="forward-stepwise-aic" class="section level3 unnumbered">
<h3>Forward Stepwise: AIC<a class="anchor" aria-label="anchor" href="#forward-stepwise-aic"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb541"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># lives in the base R stats package, but can be overwritten by other functions</span>
<span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/step.html">step</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">sat</span> <span class="op">~</span> <span class="fl">1</span>, data<span class="op">=</span><span class="va">sat_data</span><span class="op">)</span>, 
     <span class="va">sat</span> <span class="op">~</span> <span class="va">ltakers</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">years</span> <span class="op">+</span> <span class="va">public</span> <span class="op">+</span> <span class="va">expend</span> <span class="op">+</span> <span class="va">rank</span>,
     direction <span class="op">=</span> <span class="st">"forward"</span><span class="op">)</span></code></pre></div>
<pre><code>## Start:  AIC=419
## sat ~ 1
## 
##           Df Sum of Sq    RSS AIC
## + ltakers  1    199007  46369 340
## + rank     1    190297  55079 348
## + income   1    102026 143350 395
## + years    1     26338 219038 416
## &lt;none&gt;                 245376 419
## + public   1      1232 244144 421
## + expend   1       386 244991 421
## 
## Step:  AIC=340
## sat ~ ltakers
## 
##          Df Sum of Sq   RSS AIC
## + expend  1     20523 25846 313
## + years   1      6364 40006 335
## &lt;none&gt;                46369 340
## + rank    1       871 45498 341
## + income  1       785 45584 341
## + public  1       449 45920 341
## 
## Step:  AIC=313
## sat ~ ltakers + expend
## 
##          Df Sum of Sq   RSS AIC
## + years   1      1248 24598 313
## + rank    1      1054 24792 313
## &lt;none&gt;                25846 313
## + income  1        53 25792 315
## + public  1         1 25845 315
## 
## Step:  AIC=313
## sat ~ ltakers + expend + years
## 
##          Df Sum of Sq   RSS AIC
## + rank    1      2676 21922 309
## &lt;none&gt;                24598 313
## + public  1       288 24310 314
## + income  1        19 24578 315
## 
## Step:  AIC=309
## sat ~ ltakers + expend + years + rank
## 
##          Df Sum of Sq   RSS AIC
## &lt;none&gt;                21922 309
## + income  1       505 21417 310
## + public  1       185 21737 311</code></pre>
<pre><code>## 
## Call:
## lm(formula = sat ~ ltakers + expend + years + rank, data = sat_data)
## 
## Coefficients:
## (Intercept)      ltakers       expend        years         rank  
##       399.1        -38.1          4.0         13.1          4.4</code></pre>
</div>
<div id="backward-stepwise-bic" class="section level3 unnumbered">
<h3>Backward Stepwise: BIC<a class="anchor" aria-label="anchor" href="#backward-stepwise-bic"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb544"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># lives in the base R stats package, but can be overwritten by other functions</span>
<span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/step.html">step</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">sat</span> <span class="op">~</span> <span class="op">(</span><span class="va">ltakers</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">years</span> <span class="op">+</span> <span class="va">public</span> <span class="op">+</span> <span class="va">expend</span> <span class="op">+</span> <span class="va">rank</span><span class="op">)</span>, 
        data<span class="op">=</span><span class="va">sat_data</span><span class="op">)</span>,
     direction <span class="op">=</span> <span class="st">"backward"</span>, k<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">sat_n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Start:  AIC=325
## sat ~ (ltakers + income + years + public + expend + rank)
## 
##           Df Sum of Sq   RSS AIC
## - public   1        20 21417 321
## - income   1       340 21737 322
## &lt;none&gt;                 21397 325
## - ltakers  1      2150 23547 326
## - years    1      2532 23928 327
## - rank     1      2679 24076 327
## - expend   1     10964 32361 342
## 
## Step:  AIC=321
## sat ~ ltakers + income + years + expend + rank
## 
##           Df Sum of Sq   RSS AIC
## - income   1       505 21922 319
## &lt;none&gt;                 21417 321
## - ltakers  1      2552 23968 323
## - years    1      3011 24428 324
## - rank     1      3162 24578 324
## - expend   1     12465 33882 340
## 
## Step:  AIC=319
## sat ~ ltakers + years + expend + rank
## 
##           Df Sum of Sq   RSS AIC
## &lt;none&gt;                 21922 319
## - rank     1      2676 24598 320
## - years    1      2870 24792 321
## - ltakers  1      5094 27016 325
## - expend   1     13620 35542 338</code></pre>
<pre><code>## 
## Call:
## lm(formula = sat ~ ltakers + years + expend + rank, data = sat_data)
## 
## Coefficients:
## (Intercept)      ltakers        years       expend         rank  
##       399.1        -38.1         13.1          4.0          4.4</code></pre>
<p>To get an idea of how complicated your models can get, try this:</p>
<pre><code>step(lm(sat ~ (ltakers + income + years + public + expend + rank)^2),
            direction = "backward")</code></pre>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="build.html"><span class="header-section-number">11</span> Statistical Model Building</a></div>
<div class="next"><a href="diag2.html"><span class="header-section-number">13</span> Diagnostics II</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#analysis-of-variance-anova"><span class="header-section-number">12</span> Analysis of variance (ANOVA)</a></li>
<li><a class="nav-link" href="#analysis-of-variance-anova-1"><span class="header-section-number">12.1</span> Analysis of variance (ANOVA)</a></li>
<li><a class="nav-link" href="#anova-output-1"><span class="header-section-number">12.2</span> ANOVA output</a></li>
<li><a class="nav-link" href="#anova-output-with-totals"><span class="header-section-number">12.3</span> ANOVA output, with totals</a></li>
<li><a class="nav-link" href="#sum-of-squares"><span class="header-section-number">12.4</span> Sum of squares</a></li>
<li>
<a class="nav-link" href="#r-example-sat-scores"><span class="header-section-number">12.5</span> R: example: SAT scores</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#aic-and-bic-in-r">AIC and BIC in R</a></li>
<li><a class="nav-link" href="#best-possible-subsets">Best possible subsets</a></li>
<li><a class="nav-link" href="#forward-variable-selection-f-tests">Forward Variable Selection: F-tests</a></li>
<li><a class="nav-link" href="#backward-variable-selection-f-tests">Backward Variable Selection: F-tests</a></li>
<li><a class="nav-link" href="#forward-stepwise-aic">Forward Stepwise: AIC</a></li>
<li><a class="nav-link" href="#backward-stepwise-bic">Backward Stepwise: BIC</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/hardin47/website/blob/master/04b-build.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/hardin47/website/edit/master/04b-build.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Linear Models</strong>" was written by Jo Hardin. It was last built on 2022-03-07.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
