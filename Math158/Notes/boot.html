<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 8 Bootstrapping | Linear Models</title>
<meta name="author" content="Jo Hardin">
<meta name="description" content="8.1 Introduction As we did with permutation tests, we are going to use random samples to describe the population (assuming we have a simple random sample). Main idea: we will be able to estimate...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 8 Bootstrapping | Linear Models">
<meta property="og:type" content="book">
<meta property="og:description" content="8.1 Introduction As we did with permutation tests, we are going to use random samples to describe the population (assuming we have a simple random sample). Main idea: we will be able to estimate...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 8 Bootstrapping | Linear Models">
<meta name="twitter:description" content="8.1 Introduction As we did with permutation tests, we are going to use random samples to describe the population (assuming we have a simple random sample). Main idea: we will be able to estimate...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11.3/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script type="text/x-mathjax-config">
    const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
    for (let popover of popovers){
      const div = document.createElement('div');
      div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
      div.innerHTML = popover.getAttribute('data-content');
      
      // Will this work with TeX on its own line?
      var has_math = div.querySelector("span.math");
      if (has_math) {
        document.body.appendChild(div);
      	MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
      	MathJax.Hub.Queue(function(){
          popover.setAttribute('data-content', div.innerHTML);
      	})
      }
    }
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Linear Models</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Class Information</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="wrang.html"><span class="header-section-number">2</span> Data Wrangling</a></li>
<li><a class="" href="viz.html"><span class="header-section-number">3</span> Visualization</a></li>
<li><a class="" href="slr.html"><span class="header-section-number">4</span> Simple Linear Regression</a></li>
<li><a class="" href="diagnostics.html"><span class="header-section-number">5</span> Diagnostic Measures</a></li>
<li><a class="" href="simult.html"><span class="header-section-number">6</span> Simultaneous Inference</a></li>
<li><a class="" href="permschp.html"><span class="header-section-number">7</span> Permutation Tests</a></li>
<li><a class="active" href="boot.html"><span class="header-section-number">8</span> Bootstrapping</a></li>
<li><a class="" href="class.html"><span class="header-section-number">9</span> Classification</a></li>
<li><a class="" href="unsup.html"><span class="header-section-number">10</span> Unsupervised Methods</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/hardin47/website">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="boot" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Bootstrapping<a class="anchor" aria-label="anchor" href="#boot"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction"><i class="fas fa-link"></i></a>
</h2>
<p>As we did with permutation tests, we are going to use random samples to describe the population (assuming we have a simple random sample).</p>
<p>Main idea: we will be able to estimate the <strong>variability</strong> of the estimator (difference in medians, ordinary least square with non-normal errors, etc.).</p>
<ul>
<li>It’s not so strange to get <span class="math inline">\(\hat{\theta}\)</span> and SE(<span class="math inline">\(\hat{\theta}\)</span>) from the data (consider <span class="math inline">\(\hat{p}\)</span> &amp; <span class="math inline">\(\sqrt{\hat{p}(1-\hat{p})/n}\)</span> and <span class="math inline">\(\overline{X}\)</span> &amp; <span class="math inline">\(s/\sqrt{n}\)</span>).</li>
<li>We’ll only consider confidence intervals for now.</li>
<li>Bootstrapping doesn’t help get around small samples.</li>
</ul>
<p>The following applets may be helpful:</p>
<ul>
<li>The logic of confidence intervals <a href="http://www.rossmanchance.com/applets/ConfSim.html" class="uri">http://www.rossmanchance.com/applets/ConfSim.html</a>
</li>
<li>Bootstrapping from actual datasets <a href="http://lock5stat.com/statkey/index.html" class="uri">http://lock5stat.com/statkey/index.html</a>
</li>
</ul>
</div>
<div id="BSnotation" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> Basics &amp; Notation<a class="anchor" aria-label="anchor" href="#BSnotation"><i class="fas fa-link"></i></a>
</h2>
<p>Let <span class="math inline">\(\theta\)</span> be the parameter of interest, and let <span class="math inline">\(\hat{\theta}\)</span> be the estimate of <span class="math inline">\(\theta\)</span>. If we could, we’d take lots of samples of size <span class="math inline">\(n\)</span> from the population to create a <strong>sampling distribution</strong> for <span class="math inline">\(\hat{\theta}\)</span>. Consider taking <span class="math inline">\(B\)</span> random samples from <span class="math inline">\(F\)</span>:</p>
<p><span class="math display">\[\begin{align}
\hat{\theta}(\cdot) = \frac{1}{B} \sum_{i=1}^B \hat{\theta}_i
\end{align}\]</span>
is the best guess for <span class="math inline">\(\theta\)</span>. If <span class="math inline">\(\hat{\theta}\)</span> is very different from <span class="math inline">\(\theta\)</span>, we would call it <strong>biased</strong>.
<span class="math display">\[\begin{align}
SE(\hat{\theta}) &amp;= \bigg[ \frac{1}{B-1} \sum_{i=1}^B(\hat{\theta}_i - \hat{\theta}(\cdot))^2 \bigg]^{1/2}\\
q_1 &amp;= [0.25 B] \ \ \ \ \hat{\theta}^{(q_1)} = \mbox{25}\% \mbox{ cutoff}\\
q_3 &amp;= [0.75 B] \ \ \ \ \hat{\theta}^{(q_3)} = \mbox{75}\% \mbox{ cutoff}\\
\end{align}\]</span></p>
<p>If we could, we would completely characterize the sampling distribution (as a function of <span class="math inline">\(\theta\)</span>) which would allow us to make inference on <span class="math inline">\(\theta\)</span> when we only had <span class="math inline">\(\hat{\theta}\)</span>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-2"></span>
<img src="figs/BSlogic.png" alt="From Hesterberg et al., Chapter 16 of Introduction to the Practice of Statistics by  Moore, McCabe, and Craig" width="100%"><p class="caption">
Figure 1.2: From Hesterberg et al., Chapter 16 of Introduction to the Practice of Statistics by Moore, McCabe, and Craig
</p>
</div>
<div id="the-plug-in-principle" class="section level3" number="8.2.1">
<h3>
<span class="header-section-number">8.2.1</span> The Plug-in Principle<a class="anchor" aria-label="anchor" href="#the-plug-in-principle"><i class="fas fa-link"></i></a>
</h3>
<p>Recall
<span class="math display">\[\begin{align}
F(x) &amp;= P(X \leq x)\\
\hat{F}(x) &amp;= S(x) = \frac{\# \{X_i \leq x\} }{n}
\end{align}\]</span>
<span class="math inline">\(\hat{F}(x)\)</span> is a sufficient statistic for <span class="math inline">\(F(x)\)</span>. That is, all the information about <span class="math inline">\(F\)</span> that is in the data is contained in <span class="math inline">\(\hat{F}(x)\)</span>. Additionally, <span class="math inline">\(\hat{F}(x)\)</span> is the MLE of <span class="math inline">\(F(x)\)</span> (they are both probabilities, so it’s a binomial argument).</p>
<p>Note that, in general, we are interested in a parameter, <span class="math inline">\(\theta\)</span>.
<span class="math display">\[\begin{align}
\theta = t(F) \ \ \ \ [\mbox{e.g., } \mu = \int x f(x) dx ]
\end{align}\]</span></p>
<p>The <em>plug-in estimate</em> of <span class="math inline">\(\theta\)</span> is:
<span class="math display">\[\begin{align}
\hat{\theta} = t(\hat{F}) \ \ \ \ [\mbox{e.g., } \overline{X} = \frac{1}{n} \sum X_i ]
\end{align}\]</span></p>
<p>That is: <em>to estimate a parameter, use the statistic that is the corresponding quantity for the sample.</em></p>
<p><span class="math display">\[\begin{align}
\mbox{Ideal Real World} &amp; \mbox{Boostrap World}\\
F \rightarrow x &amp;\Rightarrow \hat{F} \rightarrow x^*\\
\downarrow &amp;  \downarrow\\
\hat{\theta}  &amp; \hat{\theta}^*
\end{align}\]</span></p>
<p>The idea of boostrapping (and in fact, the bootstrap samples themselves), depends on the double arrow. We must have a random sample: that is, <span class="math inline">\(\hat{F}\)</span> must do a good job of estimating <span class="math inline">\(F\)</span> in order for bootstrap concepts to be meaningful.</p>
<p>Note that you’ve seen the plug-in-principle before:
<span class="math display">\[\begin{align}
\sqrt{\frac{p(1-p)}{n}} &amp;\approx&amp; \sqrt{\frac{\hat{p}(1-\hat{p})}{n}}\\
\end{align}\]</span>
<!--
%\mbox{Fisher's Information: } I(\theta) &\approx& I(\hat{\theta})
--></p>
</div>
<div id="the-bootstrap-idea" class="section level3" number="8.2.2">
<h3>
<span class="header-section-number">8.2.2</span> The Bootstrap Idea<a class="anchor" aria-label="anchor" href="#the-bootstrap-idea"><i class="fas fa-link"></i></a>
</h3>
<p>We can <em>resample</em> from the <em>sample</em> to represent samples from the actual population! The <em>boostrap distribution</em> of a statistic, based on many resamples, represents the <strong>sampling distribution</strong> of the statistic based on many samples. Is this okay?? What are we assuming?</p>
<ol style="list-style-type: decimal">
<li><p>As <span class="math inline">\(n \rightarrow \infty\)</span>, <span class="math inline">\(\hat{F}(x) \rightarrow F(x)\)</span></p></li>
<li><p>As <span class="math inline">\(B \rightarrow \infty\)</span>, <span class="math inline">\(\hat{F}(\hat{\theta}^*) \rightarrow F(\hat{\theta})\)</span> (with large <span class="math inline">\(n\)</span>). Or really, what we typically see if <span class="math inline">\(\hat{F}(\hat{\theta}^* / \hat{\theta}) \rightarrow F(\hat{\theta} / \theta)\)</span> or <span class="math inline">\(\hat{F}(\hat{\theta}^* - \hat{\theta}) \rightarrow F(\hat{\theta} - \theta)\)</span></p></li>
</ol>
</div>
<div id="bootstrap-procedure" class="section level3" number="8.2.3">
<h3>
<span class="header-section-number">8.2.3</span> Bootstrap Procedure<a class="anchor" aria-label="anchor" href="#bootstrap-procedure"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>Resample data <strong>with replacement</strong> from the original sample.</li>
<li>Calculate the statistic of interest for each resample.</li>
<li>Repeat 1. and 2. <span class="math inline">\(B\)</span> times.</li>
<li>Use the bootstrap distribution for inference.</li>
</ol>
</div>
<div id="bootstrap-notation" class="section level3" number="8.2.4">
<h3>
<span class="header-section-number">8.2.4</span> Bootstrap Notation<a class="anchor" aria-label="anchor" href="#bootstrap-notation"><i class="fas fa-link"></i></a>
</h3>
<p>Take many (<span class="math inline">\(B\)</span>) resamples of size <span class="math inline">\(n\)</span> from the sample, <span class="math inline">\(\hat{F}(x)\)</span> (instead of from the population, <span class="math inline">\(F(x)\)</span> ) to create a bootstrap distribution for <span class="math inline">\(\hat{\theta}^*\)</span> (instead of the sampling distribution for <span class="math inline">\(\hat{\theta}\)</span>).</p>
<p>Let <span class="math inline">\(\hat{\theta}^*(b)\)</span> be the calculated statistic of interest for the <span class="math inline">\(b^{th}\)</span> bootstrap sample. The best guess for <span class="math inline">\(\theta\)</span> is:
<span class="math display">\[\begin{align}
\hat{\theta}^* = \frac{1}{B} \sum_{b=1}^B \hat{\theta}^*(b)
\end{align}\]</span>
(if <span class="math inline">\(\hat{\theta}^*\)</span> is very different from <span class="math inline">\(\hat{\theta}\)</span>, we call it biased.) And the estimated value for the standard error of the estimate is
<span class="math display">\[\begin{align}
\hat{SE}^* = \bigg[ \frac{1}{B-1} \sum_{b=1}^B ( \hat{\theta}^*(b) - \hat{\theta}^*)^2 \bigg]^{1/2}
\end{align}\]</span></p>
<p>Just like repeatedly taking samples from the population, taking resamples from the sample allows us to characterize the bootstrap distribution which approximates the sampling distribution. The bootstrap distribution approximates the <strong>shape, spread, &amp; bias</strong> of the actual sampling distribution.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-3"></span>
<img src="figs/BShesterberg1.png" alt="From Hesterberg et al., Chapter 16 of Introduction to the Practice of Statistics by  Moore, McCabe, and Craig.  The left image represents the mean with n=50.  The center image represents the mean with n=9.  The right image represents the median with n=15." width="30%"><img src="figs/BShesterberg2.png" alt="From Hesterberg et al., Chapter 16 of Introduction to the Practice of Statistics by  Moore, McCabe, and Craig.  The left image represents the mean with n=50.  The center image represents the mean with n=9.  The right image represents the median with n=15." width="30%"><img src="figs/BShesterberg3.png" alt="From Hesterberg et al., Chapter 16 of Introduction to the Practice of Statistics by  Moore, McCabe, and Craig.  The left image represents the mean with n=50.  The center image represents the mean with n=9.  The right image represents the median with n=15." width="30%"><p class="caption">
Figure 1.3: From Hesterberg et al., Chapter 16 of Introduction to the Practice of Statistics by Moore, McCabe, and Craig. The left image represents the mean with n=50. The center image represents the mean with n=9. The right image represents the median with n=15.
</p>
</div>
<!--
#### How accurate is a bootstrap distribution?
\begin{itemize}
\item
**Almost all** of the variation in a bootstrap distribution comes from the selection of the original sample.  (That is,  boostrapping does not overcome issues associated with small sample or non-random samples.)
\item
Resampling $B>1000$ does not typically reduce variability more.
\end{itemize}

Again,
\begin{enumerate}
\item
As $n \rightarrow \infty$, $\hat{F}(x) \rightarrow F(x)$
\item
As $B \rightarrow \infty$, $\hat{F^*}(\hat{\theta}^*) \rightarrow F(\hat{\theta})$  (with large $n$)
\end{enumerate}


#### When does the bootstrap not work?

Consider $X \sim U[0,1]$ (note this would also work with $U[a,b]$).  Let $Y = \max(X_i)$.
\begin{align}
F_Y(y) = P(Y \leq y) &= P( \mbox{ all } X_i \leq y)\\
&= P(X_i \leq y ) ^n\\
&= y^n\\
f_Y(y) &= \frac{\partial F_Y(y)}{\partial y}\\
&= n y^{n-1} \\
\end{align}

Note that the Bootstrap sampling distributions are a poor approximation to the true sampling distribution.  The problem is that $\hat{F}$ is not a good estimate of the true distribution $F$ in the extreme tail.  Options to fix this problem include using a parametric bootstrap (with knowledge of the population distribution) or smoothing $\hat{F}$ to approximate $F$ better.

Bias of the sample max:

\begin{align}
bias_F &= E[\hat{\theta}] - \theta\\
E[\hat{\theta}] &= E [\max(X_i)] \\
&= \int_0^1 y n y^{n-1} dy\\
&= \frac{n}{n+1} y^{n+1} \bigg|_0^1\\
&= \frac{n}{n+1}\\
bias_F &= \frac{n}{n+1} -1 = \frac{-1}{n+1}
\end{align}

We can think about the bootstrap bias in the same way:
\begin{align}
bias_{\hat{F}} &= E[\theta^*]- \hat{\theta}\\
&\approx& \hat{\theta}^* - \hat{\theta}\\
\hat{\theta} &= 0.9997507\\
\hat{\theta}^* &= 0.9805526\\
\hat{bias}_{\hat{F}} &=  0.01919808\\
1/51 &=  0.01960784\\
\end{align}

Consider a population of 82 law schools.  Two measurements were made on the entering class of each school (in 1973!).  LSAT, the average score for the class on a national law test, and GPA, the average undergraduate grade-point average for the class.  A random sample of 15 schools is selected from the population, and the correlation between GPA and LSAT score was found to be 0.776.

In a perfect world, how would we then proceed to think about this problem?  What do we want to know?  What do we want to say about the population? We'd want to know the **sampling distribution** of r...$\hat{\theta}$.

Before we go any further...  Fisher worked on the correlation coefficient and had two interesting results:

\begin{enumerate}
\item
Fisher (1915) proved that the expected value of the correlation coefficient based on random sampling from a normal population is approximately:
\begin{align}
E[r] = \rho - \frac{\rho(1-\rho^2)}{2n}
\end{align}
Solving for $\rho$ gives an approximately unbiased estimator of the population correlation:
\begin{align}
\hat{\rho} = r \Big[ 1 + \frac{(1-r^2)}{2n} \Big]
\end{align}
Further work has been done (Fisher (1915), Kenny and Keeping (1951), Sawkins (1944), and Olkin and Pratt (1958)) the later which recommend using
\begin{align}
\hat{\rho} = r \Big[ 1 + \frac{(1-r^2)}{2(n-3)} \Big]
\end{align}
Note that the bias decreases as $n$ increases and as $\rho$ approaches zero.  Note also that if the data are distributed normally:
\begin{align}
SE(r) = \frac{(1-\rho^2)}{\sqrt{n-2}}
\end{align}
(No other distribution leads to a simple formula for the SE of the correlation.)
\item
Fisher also introduced the $r$ to $Z$ transformation:
\begin{align}
Z = \frac{1}{2} \ln \Big[\frac{1+r}{1-r}\Big]
\end{align}
We think of this as the non-linear transformation that normalizes the sampling distribution of r.  (Note: it is an inverse hyperbolic tangent function.)
\end{enumerate}
-->
<p>The StatKey applets which demonstrate bootstrapping are here: <a href="http://www.lock5stat.com/StatKey/" class="uri">http://www.lock5stat.com/StatKey/</a></p>
<!--
https://www.unc.edu/courses/2007spring/biol/145/001/docs/lectures/Sep17.html
-->
</div>
</div>
<div id="BSCI" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Bootstrap Confidence Intervals<a class="anchor" aria-label="anchor" href="#BSCI"><i class="fas fa-link"></i></a>
</h2>
<div id="normal-standard-ci-with-bootse-typenorm" class="section level3" number="8.3.1">
<h3>
<span class="header-section-number">8.3.1</span> Normal (standard) CI with BootSE: <code>type="norm"</code><a class="anchor" aria-label="anchor" href="#normal-standard-ci-with-bootse-typenorm"><i class="fas fa-link"></i></a>
</h3>
<p>Keep in mind that what we are trying to do is approximate the sampling distribution of <span class="math inline">\(\hat{\theta}\)</span>. In fact, what we are really able to do here is to estimate the sampling distribution of <span class="math inline">\(\frac{\hat{\theta} - \theta}{SE(\hat{\theta})}\)</span>. We hope that:</p>
<p><span class="math display">\[\begin{align}
\hat{F}\Big(\frac{\hat{\theta}^*(b) - \hat{\theta}}{\hat{SE}^*(b)} \Big) \rightarrow F\Big(\frac{\hat{\theta} - \theta}{SE(\hat{\theta})}\Big)
\end{align}\]</span></p>
<p>Recall the derivation of conventional confidence intervals (based on the assumption that the sampling distribution of the test statistic is normal or close):</p>
<p><span class="math display">\[\begin{align}
P\bigg(z_{(\alpha/2)} \leq \frac{\hat{\theta} - \theta}{SE(\hat{\theta})} \leq z_{(1-\alpha/2)}\bigg)&amp;= 1 - \alpha\\
P\bigg(\hat{\theta} - z_{(1-\alpha/2)} SE(\hat{\theta}) \leq \theta \leq \hat{\theta} - z_{(\alpha/2)} SE(\hat{\theta})\bigg) &amp;= 1 - \alpha\\
\end{align}\]</span></p>
<p>That is, it’s the endpoints that are random, and we have a 0.95 probability that we’ll get a random sample which will produce endpoints which will capture the true parameter.</p>
<p>A 95% CI for <span class="math inline">\(\theta\)</span> would then be: <span class="math display">\[\hat{\theta} \pm z_{(\alpha/2)} \hat{SE}^*\]</span></p>
</div>
<div id="bootstrap-t-confidence-intervals-typestud" class="section level3" number="8.3.2">
<h3>
<span class="header-section-number">8.3.2</span> Bootstrap-t Confidence Intervals: <code>type="stud"</code><a class="anchor" aria-label="anchor" href="#bootstrap-t-confidence-intervals-typestud"><i class="fas fa-link"></i></a>
</h3>
<p>(The idea here is that we are calculating the “t-multiplier” that is used in the CI. It was William Gosset who went my the pseudonym of “Student” who originally figured out the distribution of the t-multiplier, so the following intervals are called either “studentized” or “t” bootstrap confidence intervals.)</p>
<p>Recall the derivation of conventional confidence intervals:</p>
<p><span class="math display">\[\begin{align}
P\bigg(z_{(\alpha/2)} \leq \frac{\hat{\theta} - \theta}{SE(\hat{\theta})} \leq z_{(1-\alpha/2)}\bigg)&amp;= 1 - \alpha\\
P\bigg(\hat{\theta} - z_{(1-\alpha/2)} SE(\hat{\theta}) \leq \theta \leq \hat{\theta} - z_{(\alpha/2)} SE(\hat{\theta})\bigg) &amp;= 1 - \alpha\\
\end{align}\]</span></p>
<p>That is, it’s the endpoints that are random, and we have a 0.95 probability that we’ll get a random sample which will produce endpoints which will capture the true parameter.</p>
<ol style="list-style-type: decimal">
<li><p>We could use the Boot SE within the CI formula (and did for the interval above). The problem is that such an interval will only be accurate if the distribution for <span class="math inline">\(\hat{\theta}\)</span> is reasonably normal. If there is any bias or skew, the CI will not have desired coverage levels (<span class="citation"><a href="references.html#ref-efrontibs" role="doc-biblioref">Efron and Tibshirani</a> (<a href="references.html#ref-efrontibs" role="doc-biblioref">1993</a>)</span>, pg 161 and chapter 22).</p></li>
<li><p>Now consider using the bootstrap to estimate the distribution for <span class="math inline">\(\frac{\hat{\theta} - \theta}{SE(\hat{\theta})}\)</span>.
<span class="math display">\[\begin{align}
T^*(b) &amp;= \frac{\hat{\theta}^*(b) - \hat{\theta}}{\hat{SE}^*(b)}
\end{align}\]</span></p></li>
</ol>
<p>where <span class="math inline">\(\hat{\theta}^*(b)\)</span> is the value of <span class="math inline">\(\hat{\theta}\)</span> for the <span class="math inline">\(b^{th}\)</span> bootstrap sample, and <span class="math inline">\(\hat{SE}^*(b)\)</span> is the estimated standard error of <span class="math inline">\(\hat{\theta}^*(b)\)</span> for the <span class="math inline">\(b^{th}\)</span> bootstrap sample. The <span class="math inline">\(\alpha^{th}\)</span> percentile of <span class="math inline">\(T^*(b)\)</span> is estimated by the value of <span class="math inline">\(\hat{t}^*_\alpha\)</span> such that</p>
<p><span class="math display">\[\begin{align}
\frac{\# \{T^*(b) \leq \hat{t}^*_{\alpha/2} \} }{B} = \alpha/2
\end{align}\]</span></p>
<p>For example, if <span class="math inline">\(B=1000\)</span>, the estimate of the 5% point is the <span class="math inline">\(50^{th}\)</span> smallest value of the <span class="math inline">\(T^*(b)\)</span>s, and the estimate of the 95% point is the <span class="math inline">\(950^{th}\)</span> smallest value of the <span class="math inline">\(T^*(b)\)</span>s.</p>
<p>Finally, the boostrap-t confidence interval is:
<span class="math display" id="eq:BSt">\[\begin{equation} 
(\hat{\theta} - \hat{t}^*_{1-\alpha/2}\hat{SE}^*,  \hat{\theta} - \hat{t}^*_{\alpha/2}\hat{SE}^*) \tag{8.1}
\end{equation}\]</span></p>
<p>To find a bootstrap-t interval, we have to bootstrap twice. The algorithm is as follows:</p>
<ol style="list-style-type: decimal">
<li><p>Generate <span class="math inline">\(B_1\)</span> bootstrap samples, and for each sample <span class="math inline">\(\underline{X}^{*b}\)</span> compute the bootstrap estimate <span class="math inline">\(\hat{\theta}^*(b)\)</span>.</p></li>
<li><p>Take <span class="math inline">\(B_2\)</span> bootstrap samples from <span class="math inline">\(\underline{X}^{*b}\)</span>, and estimate the standard error, <span class="math inline">\(\hat{SE}^*(b)\)</span>.</p></li>
<li><p>Find <span class="math inline">\(B_1\)</span> values for <span class="math inline">\(T^*(b)\)</span>. Calculate <span class="math inline">\(\hat{t}^*_\alpha/2\)</span> and <span class="math inline">\(\hat{t}^*_{1-\alpha/2}\)</span>.</p></li>
<li><p>Calculate the CI as in equation (<a href="boot.html#eq:BSt">(8.1)</a>).</p></li>
</ol>
<ul>
<li><p>If <span class="math inline">\(B\cdot \alpha\)</span> is not an integer, use <span class="math inline">\(k=\lfloor (B+1) \alpha \rfloor\)</span> and <span class="math inline">\(B+1-k\)</span>.</p></li>
<li><p>Bootstrap-t intervals are somewhat erratic and can be influenced by a few outliers. Percentile methods can be more reliable. [The balance of which is best when is an open question depending a lot on the data distribution and statistic of interest.]</p></li>
<li><p><span class="math inline">\(B=100\)</span> or 200 is probably not enough for a bootstrap-t CI (500 or 1000 is better). However, <span class="math inline">\(B=25\)</span> may be enough to estimate the SE in the inner-Bootprocedure. (<span class="math inline">\(B=1000\)</span> is needed for computing percentiles.)</p></li>
<li>
<p>In choosing the appropriate multiplier:</p>
<ul>
<li>When it is the correct multiplier to use, the normal multiplier (<span class="math inline">\(z\)</span>) is good for all <span class="math inline">\(n\)</span> and all samples.</li>
<li>When it is the correct multiplier to use, the t multiplier is good for all samples but a specified <span class="math inline">\(n\)</span>.</li>
<li>When it is the correct multiplier to use, the bootstrap-t multiplier is good for <em>this</em> sample only.</li>
</ul>
</li>
<li><p>The resulting intervals will typically not be symmetric (that is <span class="math inline">\(\hat{t}^*_\alpha \ne - \hat{t}^*_{1-\alpha}\)</span>). This is part of the improvement over <span class="math inline">\(z\)</span> or <span class="math inline">\(t\)</span> intervals.</p></li>
<li><p>Bootstrap-t intervals are good for location statistics (mean, quantiles, trimmed means) but cannot be trusted for other statistics like the correlation (which do not necessarily vary based on ideas of shift).</p></li>
</ul>
</div>
<div id="percentile-confidence-intervals-typeperc" class="section level3" number="8.3.3">
<h3>
<span class="header-section-number">8.3.3</span> Percentile Confidence Intervals: <code>type="perc"</code><a class="anchor" aria-label="anchor" href="#percentile-confidence-intervals-typeperc"><i class="fas fa-link"></i></a>
</h3>
<p>The interval between the <span class="math inline">\(\alpha/2\)</span> and <span class="math inline">\(1-\alpha/2\)</span> quantiles of the bootstrap distribution of a statistic is a <span class="math inline">\((1-\alpha)100\%\)</span> bootstrap percentile confidence interval for the corresponding parameter:</p>
<p><span class="math display">\[\begin{align}
[\hat{\theta}^*_{\alpha/2}, \hat{\theta}^*_{1-\alpha/2}]
\end{align}\]</span></p>
<p style="color:red">
You do not need to know <em>why</em> the percentile interval works… but isn’t it so cool to see how it works???
</p>
<p>Why does it work? It isn’t immediately obvious that the interval above will capture the true parameter, <span class="math inline">\(\theta\)</span>, at a rate or 95%. Consider a skewed sampling distribution. If the observed <span class="math inline">\(\hat{\theta}\)</span> comes from the long tail, is it obvious that the short tail side of the CI will get up to the true parameter value at the correct rate? (Hall (*The Bootstrap and Edgeworth Expansion}, Springer, 1992, and earlier papers) refers to these as Efron’s “backwards” intervals.) Or, if the sampling distribution is biased, the percentiles of the bootstrap interval won’t capture the parameter with the correct rate.</p>
<p>To see how / why percentiles intervals work, we first start by considering normal sampling distributions for a function of the statistic. Let <span class="math inline">\(\phi = g(\theta), \hat{\phi} = g(\hat{\theta}), \hat{\phi}^* = g(\hat{\theta}^*)\)</span>, where g is a monotonic function (assume wlog that g is increasing). The point is to choose (if possible) <span class="math inline">\(g(\cdot)\)</span> such that</p>
<p><span class="math display" id="eq:phidist">\[\begin{equation}
 \hat{\phi}^* - \hat{\phi} \sim \hat{\phi} - \phi \sim N(0, \sigma^2) \tag{8.2}.
 \end{equation}\]</span>
Again, consider the logic for the conventional confidence interval. Because <span class="math inline">\(\hat{\phi} - \phi \sim N(0, \sigma^2)\)</span>, the interval for <span class="math inline">\(\theta\)</span> is derived by:</p>
<p><span class="math display" id="eq:phiint">\[\begin{align}
P(z_{0.05} \leq \frac{\hat{\phi} - \phi}{\sigma}  ) = 0.95  \nonumber \\
P(-\infty \leq \phi \leq \hat{\phi} - z_{0.05} \sigma) = 0.95  \nonumber \\
P(-\infty \leq \phi \leq \hat{\phi} + z_{0.95} \sigma) = 0.95  \nonumber \\
P(-\infty \leq \theta \leq g^{-1}(\hat{\phi} + z_{0.95} \sigma)) = 0.95  \nonumber \\
\Rightarrow \mbox{CI for } \theta: \ \ \ (-\infty, g^{-1}(\hat{\phi} + \sigma z_{1-\alpha})) \tag{8.3}
\end{align}\]</span></p>
<p>where <span class="math inline">\(z_{1-\alpha}\)</span> is the <span class="math inline">\(100(1-\alpha)\)</span> percent point of the standard normal distribution. Ideally, if we knew <span class="math inline">\(g\)</span> and <span class="math inline">\(\sigma\)</span>, we’d be able to do the transformation and find <span class="math inline">\(g^{-1}(\hat{\phi} + \sigma z_{1-\alpha})\)</span> (which would give the endpoint of the confidence interval).</p>
<p>Going back to (<a href="boot.html#eq:phidist">(8.2)</a>) indicates that <span class="math inline">\(\hat{\phi} + \sigma z_{1-\alpha} = F^{-1}_{\hat{\phi}^*}(1-\alpha)\)</span> (because <span class="math inline">\(\hat{\phi} ^* \sim N(\hat{\phi}, \sigma^2)\)</span>). Further, since <span class="math inline">\(g\)</span> is monotonically increasing, <span class="math inline">\(F^{-1}_{\hat{\phi}^*}(1-\alpha) = g(F^{-1}_{\hat{\theta}^*}(1-\alpha)).\)</span>
Substituting in (<a href="boot.html#eq:phiint">(8.3)</a>), gives the percentile interval for <span class="math inline">\(\theta\)</span>,</p>
<p><span class="math display">\[\begin{align}
(-\infty, F^{-1}_{\hat{\theta}^*}(1-\alpha)).
\end{align}\]</span></p>
<p>(A similar argument gives the same derivation of the two sided confidence interval. Proof from <span class="citation"><a href="references.html#ref-carp2000" role="doc-biblioref">Carpenter and Bithell</a> (<a href="references.html#ref-carp2000" role="doc-biblioref">2000</a>)</span>) In order for a percentile interval to be appropriate, the technical condition is only that a normalizing transformation <strong>exists</strong>. We do not need to actually find the transformation!</p>
<!--
\begin{align}
P\bigg(t_{(\alpha/2), df} \leq \frac{\hat{\theta} - \theta}{SE(\theta)} \leq t_{(1-\alpha/2), df}\bigg)&= 1 - \alpha\\
P\bigg(\hat{\theta} - t_{(1-\alpha/2), df} SE(\theta) \leq \theta \leq \hat{\theta} - t_{(\alpha/2), df} SE(\theta)\bigg) &= 1 - \alpha\\
\end{align}
Let's think about the endpoints in a way that is convenient for bootstrap CIs.  Let $\hat{\theta}^*$ indicate a random variable drawn from the distribution $N(\hat{\theta}, \hat{SE}^2)$.  That is, assume (for a minute) that the true sampling distribution for $\hat{\theta}$ (and for $\hat{\theta}^*$) is normal.
\begin{align}
\hat{\theta}^* \sim N(\hat{\theta}, \hat{SE}^2)
\end{align}
Then $\hat{\theta}_{lo} = \hat{\theta} - t_{(1-\alpha/2), df} \hat{SE} \approx \hat{\theta} - t_{(1-\alpha/2), df} SE(\theta)$ and $\hat{\theta}_{up} = \hat{\theta} - t_{(\alpha/2), df} \hat{SE} \approx \hat{\theta} - t_{(\alpha/2), df} SE(\theta)$ are the $100\alpha^{th}$ and $100(1-\alpha)^{th}$ percentiles for the distribution of $\hat{\theta}^*$.   In other words:
\begin{align}
\hat{\theta}_{lo} &= \hat{\theta}^*_\alpha = 100 \alpha^{th} \mbox{ percentile of the distribution for } \hat{\theta}^*\\
\hat{\theta}_{up} &= \hat{\theta}^*_{1-\alpha} = 100 (1-\alpha)^{th} \mbox{ percentile of the distribution for } \hat{\theta}^*\\
\end{align}

That is, if in fact $\hat{\theta}^*$ has a normal distribution, the percentiles will equal the appropriate CI bounds, and so we know that the probability theory will hold.
-->
<p><strong>The transformation respecting property</strong> A CI is transformation respecting if, for any monotone transformation, the CI for the transformed parameter is (exactly) the transformed CI for the unstransformed parameter. Let <span class="math inline">\(\phi = m(\theta)\)</span>.</p>
<p><span class="math display">\[\begin{align}
[\phi_{lo}, \phi_{up}] = [m(\theta_{lo}), m(\theta_{up})]
\end{align}\]</span></p>
<p>Note that the idea has to do with the process of creating the CI. That is, if we create the confidence interval using <span class="math inline">\(\phi\)</span>, we’ll get the same thing as if we created the CI using <span class="math inline">\(\theta\)</span> and then transformed it. It is straightforward to see that the percentile CI is transformation respecting. That is, for any monotone transformation of the statistic and parameter, the CI will be transformed appropriately.</p>
<p>Let
<span class="math display">\[\begin{align}
\hat{\phi} &amp;= 0.5 \ln\bigg(\frac{1+r}{1-r}\bigg)\\
r &amp;=\frac{e^{2\phi}+1}{e^{2\phi}-1}\\
\end{align}\]</span></p>
<p>We know that <span class="math inline">\(\hat{\phi}\)</span> does have an approximated normal distribution. So, the percentile CI for <span class="math inline">\(\phi\)</span> will approximate the normal theory CI which we know to be correct (for a given <span class="math inline">\(\alpha\)</span>). But once we have a CI for <span class="math inline">\(\phi\)</span> we can find the CI for <span class="math inline">\(\rho\)</span> by taking the inverse monotonic transformation; or rather… we can just use the r percentile CI to start with!</p>
<!--
**Percentile interval lemma** (@efrontibs pg 173, 1993)  Suppose the transformation for $\hat{\phi} = m(\hat{\theta})$ perfectly normalizes the distribution of $\hat{\theta}$:
\begin{align}
\hat{\phi} \sim N (\phi, 1)
\end{align}
Then the percentile interval based on $\hat{\theta}$ equals $[m^{-1}(\hat{\phi} - z_{1-\alpha/2} ), m^{-1}(\hat{\phi} - z_{\alpha/2} )]$.

And we can approximate $[m^{-1}(\hat{\phi} - z_{1-\alpha/2} ), m^{-1}(\hat{\phi} - z_{\alpha/2} )]$ using $[\hat{\theta}^*_{\alpha/2}, \hat{\theta}^*_{1-\alpha/2}]$

In order for a percentile interval to be appropriate, the technical condition is that a normalizing transformation exists.  We do not need to actually find the transformation! [In complete disclosure, the transformation doesn't have to be to a normal distribution.  But it must be a monotonic transformation to a distribution which is symmetric about zero.]

See Charlotte's example on bootstrapping a loess smooth for her thesis data (carryingcap.r).  The idea was this:  Charlotte had some data that she wanted to model (using differential equations).  She asked me how to tell whether or not her new model was reflective of the data / population.  So, we fit a loess spline to see the shape of the data.  Then we bootstrapped the data and fit 1000 more loess splines.  Using the percentile CI method, we created a CI for a population loess spline fit.

Keeping in mind that the theory we've covered here doesn't exactly work for this situation (the work has been on simple parameter estimation), you can imagine that many of the ideas we've talked about do apply to Charlotte's situation.  We just have to be careful about multiple comparisons and non-independent data values.
-->
<p><strong>The range preserving property</strong> Another advantage of the percentile interval is that it is range preserving. That is, the CI always produces endpoints that fall within the allowable range of the parameter.</p>
<p><strong>Bias</strong> The percentile interval is not, however, perfect. If the statistic is a biased estimator of the parameter, there will not exist a transformation such that the distribution is centered around the correct function of the parameter. Formally, if
<span class="math display">\[\begin{align}
\hat{\theta} \sim N(\theta + bias, \hat{SE}^2)
\end{align}\]</span>
no transformation <span class="math inline">\(\phi = m(\theta)\)</span> can fix things up. Keep in mind that standard intervals can fail in a variety of ways, and the percentile method has only fixed the specific situation of the sampling distribution being is non-normal.</p>
</div>
<div id="what-makes-a-ci-procedure-good" class="section level3" number="8.3.4">
<h3>
<span class="header-section-number">8.3.4</span> What makes a CI procedure good?<a class="anchor" aria-label="anchor" href="#what-makes-a-ci-procedure-good"><i class="fas fa-link"></i></a>
</h3>
<p>The following qualities that may or may not result from a confidence interval procedure are what determines the choice of method for the researcher.</p>
<ul>
<li>Symmetry (??): the interval is symmetric, pivotal around some value. Not necessarily a good thing. Maybe a bad thing to force?</li>
<li>Resistant: BS-t is particularly not resistant to outliers or crazy sampling distributions of the statistic (can make it more robust with a variance stabilizing transformation)</li>
<li>Range preserving: the CI always contains only values that fall within an allowable range (<span class="math inline">\(p, \rho\)</span>,…)</li>
<li>Transformation respecting: for any monotone transformation, <span class="math inline">\(\phi = m(\theta)\)</span>, the interval for <span class="math inline">\(\theta\)</span> is mapped directly by <span class="math inline">\(m(\theta)\)</span>. If <span class="math inline">\([\hat{\theta}_{(lo)},\hat{\theta}_{(hi)}]\)</span> is a <span class="math inline">\((1-\alpha)100\)</span>% interval for <span class="math inline">\(\theta\)</span>, then</li>
</ul>
<p><span class="math display">\[\begin{align}
[\hat{\phi}_{(lo)},\hat{\phi}_{(hi)}] = [m(\hat{\theta}_{(lo)}),m(\hat{\theta}_{(hi)})]
\end{align}\]</span>
are exactly the same interval.</p>
<ul>
<li>Level of confidence: A central (not symmetric) confidence interval, <span class="math inline">\([\hat{\theta}_{(lo)},\hat{\theta}_{(hi)}]\)</span> should have probability <span class="math inline">\(\alpha/2\)</span> of not covering <span class="math inline">\(\theta\)</span> from above or below:</li>
</ul>
<p><span class="math display">\[\begin{align}
P(\theta &lt; \hat{\theta}_{(lo)})&amp;=\alpha/2\\
P(\theta &gt; \hat{\theta}_{(hi)})&amp;=\alpha/2\\
\end{align}\]</span></p>
<ul>
<li>
<p>Note: all of the intervals are approximate. We judge them based on how accurately they cover <span class="math inline">\(\theta\)</span>.</p>
<ul>
<li><p>A CI is first order accurate if:
<span class="math display">\[\begin{align}
P(\theta &lt; \hat{\theta}_{(lo)})&amp;=\alpha/2 + \frac{const_{lo}}{\sqrt{n}}\\
P(\theta &gt; \hat{\theta}_{(hi)})&amp;=\alpha/2+ \frac{const_{hi}}{\sqrt{n}}\\
\end{align}\]</span></p></li>
<li><p>A CI is second order accurate if:
<span class="math display">\[\begin{align}
P(\theta &lt; \hat{\theta}_{(lo)})&amp;=\alpha/2 + \frac{const_{lo}}{n}\\
P(\theta &gt; \hat{\theta}_{(hi)})&amp;=\alpha/2+ \frac{const_{hi}}{n}\\
\end{align}\]</span></p></li>
</ul>
</li>
</ul>
<p>BS-t is <span class="math inline">\(2^{nd}\)</span> order accurate for a large general class of functions. However, in practice, the coverage rate doesn’t kick in for small/med sample sizes unless appropriate transformations make the distribution more bell-shaped. <span class="citation">(<a href="references.html#ref-tibs88" role="doc-biblioref">Tibshirani 1988</a>)</span></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="center">CI</th>
<th align="center">Symmetric</th>
<th align="center">Range Resp</th>
<th align="center">Trans Resp</th>
<th align="center">Accuracy</th>
<th align="center">Normal Samp Dist?</th>
<th>Other</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">BootSE</td>
<td align="center">Yes</td>
<td align="center">No</td>
<td align="center">No</td>
<td align="center">
<span class="math inline">\(1^{st}\)</span> order</td>
<td align="center">Yes</td>
<td>param assump <span class="math inline">\(F(\hat{\theta})\)</span>
</td>
</tr>
<tr class="even">
<td align="center">BS-t</td>
<td align="center">No</td>
<td align="center">No</td>
<td align="center">No</td>
<td align="center">
<span class="math inline">\(2^{nd}\)</span> order</td>
<td align="center">Yes/No</td>
<td>computer intensive</td>
</tr>
<tr class="odd">
<td align="center">perc</td>
<td align="center">No</td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="center">
<span class="math inline">\(1^{st}\)</span> order</td>
<td align="center">No</td>
<td>small <span class="math inline">\(n \rightarrow\)</span> low accuracy</td>
</tr>
<tr class="even">
<td align="center">BCa</td>
<td align="center">No</td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="center">
<span class="math inline">\(2^{nd}\)</span> order</td>
<td align="center">No</td>
<td>limited param assump</td>
</tr>
</tbody>
</table></div>
<p>All of the above criteria speak to the coverage rates of the parameters. But note that they must be taken in context. Much also depends on:
the choice of statistic itself; the original data distribution; any outlying observations; etc.</p>
<div id="advantages-and-disadvantages" class="section level4" number="8.3.4.1">
<h4>
<span class="header-section-number">8.3.4.1</span> Advantages and Disadvantages<a class="anchor" aria-label="anchor" href="#advantages-and-disadvantages"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Normal Approximation
<ul>
<li>
<strong>Advantages</strong> similar to the familiar parametric approach; useful with a normally distributed <span class="math inline">\(\hat{\theta}\)</span>; requires the least computation (<span class="math inline">\(B=50-200\)</span>)</li>
<li>
<strong>Disadvantages</strong> fails to use the entire <span class="math inline">\(\hat{F}^*(\hat{\theta}^*)\)</span>; only works if <span class="math inline">\(\hat{\theta}\)</span> is reasonably normal to start with</li>
</ul>
</li>
<li>Bootstrap-t Confidence Interval
<ul>
<li>
<strong>Advantages</strong> highly accurate CI in many cases; handles skewed <span class="math inline">\(F(\hat{\theta})\)</span> better than the percentile method</li>
<li>
<strong>Disadvantages</strong> not invariant to transformations; computationally expensive with the double bootstrap; coverage probabilities are best if the distribution of <span class="math inline">\(\hat{\theta}\)</span> is nice (e.g., normal)</li>
</ul>
</li>
<li>Percentile
<ul>
<li>
<strong>Advantages</strong> uses the entire <span class="math inline">\(\hat{F}^*(\hat{\theta}^*)\)</span>; allows <span class="math inline">\(F(\hat{\theta})\)</span> to be asymmetrical; invariant to transformations; range respecting; simple to execute</li>
<li>
<strong>Disadvantages</strong> small samples may result in low accuracy (because of the dependence on the tail behavior); assumes <span class="math inline">\(\hat{F}^*(\hat{\theta}^*)\)</span> to be unbiased</li>
</ul>
</li>
<li>BCa
<ul>
<li>
<strong>Advantages</strong>
all of those of the percentile method; allows for bias in <span class="math inline">\(\hat{F}^*(\hat{\theta}^*)\)</span>; <span class="math inline">\(z_0\)</span> can be calculated easily from <span class="math inline">\(\hat{F}^*(\hat{\theta}^*)\)</span>
</li>
<li>
<strong>Disadvantages</strong> requires a limited parametric assumption; more computational than other intervals</li>
</ul>
</li>
</ul>
</div>
<div id="bootstrap-ci-and-hypothesis-testing" class="section level4" number="8.3.4.2">
<h4>
<span class="header-section-number">8.3.4.2</span> Bootstrap CI and Hypothesis Testing<a class="anchor" aria-label="anchor" href="#bootstrap-ci-and-hypothesis-testing"><i class="fas fa-link"></i></a>
</h4>
<p>If a null value for a parameter is not contained in a CI, we reject the null hypothesis; similarly, we do not reject a null value if it does lie inside the CI. Using BootCIs, we can apply the same logic, and test any hypothesis of interest (note: we can always create one-sided intervals as well!). But using CIs leaves out the p-value information. How do we get a p-value from a CI? Consider an alternative definition for the p-value:</p>
<p><strong>p-value:</strong> The smallest level of significance at which you would reject <span class="math inline">\(H_0\)</span>.</p>
<p>So, what we want is for the null value (<span class="math inline">\(\theta_0\)</span>) to be one of the endpoints of the confidence interval with some level of confidence <span class="math inline">\(1-2\alpha_0\)</span>. <span class="math inline">\(\alpha_0\)</span> will then be the one-sided p-value, <span class="math inline">\(2\alpha_0\)</span> will be the two-sided p-value.</p>
<p>For percentile intervals,
<span class="math display">\[\begin{align}
p-value = \alpha_0 = \frac{\# \hat{\theta}^*(b) &lt; \theta_0}{B}
\end{align}\]</span>
(without loss of generality, assuming we set <span class="math inline">\(\hat{\theta}^*_{lo} = \theta_0\)</span>).</p>
<!--
% Print out this section of notes for a handout
%\begin{flushright}
%Math 152, Fall 2012\\
%Jo Hardin
%\end{flushright}
%\vspace*{-1.4cm}
-->
<h3 style="color:red">
BCa CI: <code>type="bca"</code>
<a class="anchor" aria-label="anchor" href="#bootstrap-ci-and-hypothesis-testing"><i class="fas fa-link"></i></a>
</h3>
<p style="color:red">
Another cool bootstrap CI method that we won’t have time to cover. You are not responsible for the remainder of the bootstrap material in these notes.
</p>
<p>In the percentile method, we’ve assumed that there exists a transformation of <span class="math inline">\(\theta\)</span>, <span class="math inline">\(\phi(\theta)\)</span>, such that
<span class="math display">\[\begin{align}
\phi(\hat{\theta}) - \phi(\theta) \sim N(0,1)
\end{align}\]</span>
The transformation assumes that neither <span class="math inline">\(\theta\)</span> nor <span class="math inline">\(\phi\)</span> are biased, and it assumes that the variance is constant for all values of the parameter. That is, in the percentage intervals, we assume the normalizing transformation creates a sampling distribution that is unbiased and variance stabilizing. Consider a monotone transformation that *normalizes} the sampling distribution (we no longer assume unbiased or constant variance).</p>
<p>We now consider the case where <span class="math inline">\(\theta\)</span> is a biased estimator. That is:
<span class="math display">\[\begin{align}
\frac{\phi(\hat{\theta}) - \phi(\theta)}{c} \sim N(-z_0,1)
\end{align}\]</span>
We’ve corrected for the bias, but if there is non-constant variance, we need a further adjustment to stabilize the variance:</p>
<p><span class="math display">\[\begin{align}
\phi(\hat{\theta}) - \phi(\theta) \sim N(-z_0 \sigma_\phi,\sigma_\phi), \ \ \ \ \ \ \sigma_\phi = 1 + a \phi
\end{align}\]</span>
That is, there must exist a monotone transformation <span class="math inline">\(\phi\)</span> such that <span class="math inline">\(\phi(\hat{\theta}) \sim N\)</span> where
<span class="math display">\[\begin{align}
E(\phi(\hat{\theta})) = \phi(\theta) - z_0 [1 + a \phi(\theta)] &amp; SE(\phi(\hat{\theta})) = 1 + a \phi(\theta)
\end{align}\]</span>
(Note: in the expected value and SE we’ve assumed that <span class="math inline">\(c=1\)</span>. If <span class="math inline">\(c\ne1\)</span>, then we can always choose a different transformation, <span class="math inline">\(\phi'\)</span> so that <span class="math inline">\(c=1\)</span>.) Then
<span class="math display">\[\begin{align}
P(z_{\alpha/2} \leq \frac{\phi(\hat{\theta}) - \phi(\theta)}{1 + a \phi(\theta)} + z_0 \leq z_{1-\alpha/2}) = 1 - \alpha
\end{align}\]</span>
A $(1-)$100% CI for <span class="math inline">\(\phi(\theta)\)</span> is
<span class="math display">\[\begin{align}
\bigg[ \frac{\phi(\hat{\theta}) - (z_{1-\alpha/2} - z_0)}{1 + a (z_{1-\alpha/2} - z_0)}, \frac{\phi(\hat{\theta}) - (z_{\alpha/2} - z_0)}{1 + a (z_{\alpha/2} - z_0)} \bigg]
\end{align}\]</span>
Let’s consider an interesting probability question:
<span class="math display">\[\begin{align}
P\bigg( \phi(\hat{\theta}^*) &amp;\leq \frac{\phi(\hat{\theta}) - (z_{1-\alpha/2} - z_0)}{(1 + a (z_{1-\alpha/2} - z_0))} \bigg) = ?\\
= P\bigg( \frac{\phi(\hat{\theta}^*) - \phi(\hat{\theta})}{1 + a \phi(\hat{\theta})} &amp;\leq \frac{\phi(\hat{\theta}) - (z_{1-\alpha/2} - z_0) - \phi(\hat{\theta}) - \phi(\hat{\theta})a(z_{1-\alpha/2} - z_0)}{(1 + a (z_{1-\alpha/2} - z_0))(1+a \phi(\hat{\theta}))} \bigg)\\
= P\bigg( \frac{\phi(\hat{\theta}^*) - \phi(\hat{\theta})}{1 + a \phi(\hat{\theta})} &amp;\leq \frac{ - (z_{1-\alpha/2} - z_0) - \phi(\hat{\theta})a(z_{1-\alpha/2} - z_0)}{(1 + a (z_{1-\alpha/2} - z_0))(1+a \phi(\hat{\theta}))} \bigg)\\
= P\bigg( \frac{\phi(\hat{\theta}^*) - \phi(\hat{\theta})}{1 + a \phi(\hat{\theta})} &amp;\leq \frac{ -(1+a \phi(\hat{\theta})) (z_{1-\alpha/2} - z_0) }{(1 + a (z_{1-\alpha/2} - z_0))(1+a \phi(\hat{\theta}))} \bigg)\\
= P\bigg( \frac{\phi(\hat{\theta}^*) - \phi(\hat{\theta})}{1 + a \phi(\hat{\theta})} &amp;\leq \frac{ - (z_{1-\alpha/2} - z_0) }{(1 + a (z_{1-\alpha/2} - z_0))} \bigg)\\
= P\bigg( \frac{\phi(\hat{\theta}^*) - \phi(\hat{\theta})}{1 + a \phi(\hat{\theta})} &amp;\leq \frac{ (z_{\alpha/2} + z_0) }{(1 - a (z_{\alpha/2} + z_0))} \bigg)\\
= P\bigg( \frac{\phi(\hat{\theta}^*) - \phi(\hat{\theta})}{1 + a \phi(\hat{\theta})} + z_0 &amp;\leq \frac{ (z_{\alpha/2} + z_0) }{(1 - a (z_{\alpha/2} + z_0))} + z_0 \bigg)\\
= P\bigg( Z &amp;\leq \frac{ (z_{\alpha/2} + z_0) }{(1 - a (z_{\alpha/2} + z_0))} + z_0 \bigg) = \gamma_1\\
\mbox{where } \gamma_1 &amp;= \Phi \bigg(\frac{ (z_{\alpha/2} + z_0) }{(1 - a (z_{\alpha/2} + z_0))} + z_0 \bigg)\\
 &amp;= \verb;pnorm; \bigg(\frac{ (z_{\alpha/2} + z_0) }{(1 - a (z_{\alpha/2} + z_0))} + z_0 \bigg)
\end{align}\]</span></p>
<p>What we’ve shown is that the <span class="math inline">\(\gamma_1\)</span> quantile of the <span class="math inline">\(\phi(\hat{\theta}^*)\)</span> sampling distribution will be a good estimate for the lower bound of the confidence interval for <span class="math inline">\(\phi(\theta)\)</span>. Using the same argument on the upper bound, we find a $(1-)$100% confidence interval for <span class="math inline">\(\phi(\theta)\)</span> to be:</p>
<p><span class="math display">\[\begin{align}
&amp;[\phi(\hat{\theta}^*)_{\gamma_1}, \phi(\hat{\theta}^*)_{\gamma_2}]\\
&amp; \\
\mbox{where } \gamma_1 &amp;= \Phi\bigg(\frac{ (z_{\alpha/2} + z_0) }{(1 - a (z_{\alpha/2} + z_0))} + z_0 \bigg)\\
 \gamma_2 &amp;= \Phi \bigg(\frac{ (z_{1-\alpha/2} + z_0) }{(1 - a (z_{1-\alpha/2} + z_0))} + z_0 \bigg)\\
\end{align}\]</span></p>
<p>Using the transformation respecting property of percentile intervals, we know that a $(1-)$100% confidence interval for <span class="math inline">\(\theta\)</span> is:</p>
<p><span class="math display">\[\begin{align}
&amp;[\hat{\theta}^*_{\gamma_1}, \hat{\theta}^*_{\gamma_2}]
\end{align}\]</span></p>
<p><strong>How do we estimate <span class="math inline">\(a\)</span> and <span class="math inline">\(z_0\)</span>?</strong></p>
<ul>
<li>
<strong>bias:</strong>
<span class="math inline">\(z_0\)</span> is a measure of the bias. Recall:</li>
</ul>
<p><span class="math display">\[\begin{align}
bias &amp;= E(\hat{\theta}) - \theta\\
\hat{bias} &amp;= \hat{\theta}^* - \hat{\theta}\\
\end{align}\]</span></p>
<p>But remember that <span class="math inline">\(z_0\)</span> represents the bias for <span class="math inline">\(\phi(\hat{\theta})\)</span>, not for <span class="math inline">\(\hat{\theta}\)</span> (and we don’t know <span class="math inline">\(\phi\)</span>!). So, we use <span class="math inline">\(\theta\)</span> to see what proportion of <span class="math inline">\(\theta\)</span> values are too low, and we can map it back to the <span class="math inline">\(\phi\)</span> space using the normal distribution:</p>
<p><span class="math display">\[\begin{align}
\hat{z}_0 &amp;= \Phi^{-1} \bigg( \frac{ \# \hat{\theta}^*(b) &lt; \hat{\theta}}{B} \bigg)
\end{align}\]</span>
That is, if <span class="math inline">\(\hat{\theta}^*\)</span> underestimates <span class="math inline">\(\hat{\theta}\)</span>, then <span class="math inline">\(\hat{\theta}\)</span> likely underestimates <span class="math inline">\(\theta\)</span>; <span class="math inline">\(z_0 &gt; 0\)</span>. We think of <span class="math inline">\(z_0\)</span> and the normal quantile associated with the proportion of Bootreplicates less than <span class="math inline">\(\hat{\theta}\)</span>.</p>
<ul>
<li>
<strong>skew:</strong>
<span class="math inline">\(a\)</span> is a measure of skew.
<span class="math display">\[\begin{align}
bias&amp;= E(\hat{\theta} - \theta)\\
var &amp;= E(\hat{\theta} - \theta)^2 = \sigma^2\\
skew &amp;= E(\hat{\theta} - \theta)^3 / \sigma^3\\
\end{align}\]</span>
We can think of the skew as the rate of chance of the standard error on a normalized scale. If there is no skew, we will estimate <span class="math inline">\(a=0\)</span>. The estimate of <span class="math inline">\(a\)</span> comes from a procedure known as the jackknife.</li>
</ul>
<p><span class="math display">\[\begin{align}
\hat{a} = \frac{\sum_{i=1}^n (\hat{\theta} - \hat{\theta}_{(i)})^3}{6 [ \sum_{i=1}^n (\hat{\theta} - \hat{\theta}_{(i)})^2 ] ^{3/2}}
\end{align}\]</span></p>
</div>
</div>
</div>
<div id="r-example-heroin" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> R example: Heroin<a class="anchor" aria-label="anchor" href="#r-example-heroin"><i class="fas fa-link"></i></a>
</h2>
<p>Hesketh and Everitt (2000) report on a study by Caplehorn and Bell (1991) that investigated the times (in days) spent a clinic for methadone maintenance treatment for people addicted to heroin. The data in <code>heroin.txt</code> include the amount of time that the subjects stayed in the facility until treatment was terminated (column 4). For about 37% of the subjects, the study ended while they were still the in clinic (status=0). Thus, their survival time has been truncated. For this reason we might not want to estimate the mean survival time, but rather some other measure of typical survival time. Below we explore using the median as well as the 25% trimmed mean. We treat the group of 238 patients as representative of the population. <span class="citation">(From <a href="references.html#ref-ISCAM" role="doc-biblioref">Chance and Rossman 2018</a>, Investigation 4.5.3)</span></p>
<div id="why-bootstrap" class="section level4 unnumbered">
<h4>Why bootstrap?<a class="anchor" aria-label="anchor" href="#why-bootstrap"><i class="fas fa-link"></i></a>
</h4>
<p>Motivation: to estimate the variability of a statistic (<em>not</em> dependent on <span class="math inline">\(H_0\)</span> being true).</p>
</div>
<div id="reading-in-the-data" class="section level4 unnumbered">
<h4>Reading in the data<a class="anchor" aria-label="anchor" href="#reading-in-the-data"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">heroin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/readr/man/read_table.html">read_table</a></span><span class="op">(</span><span class="st">"http://www.rossmanchance.com/iscam2/data/heroin.txt"</span><span class="op">)</span>
<span class="va">heroin</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">prison</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 238 × 5
##       id clinic status times  dose
##    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1      1      1   428    50
##  2     2      1      1   275    55
##  3     3      1      1   262    55
##  4     4      1      1   183    30
##  5     5      1      1   259    65
##  6     6      1      1   714    55
##  7     7      1      1   438    65
##  8     8      1      0   796    60
##  9     9      1      1   892    50
## 10    10      1      1   393    65
## # … with 228 more rows</code></pre>
</div>
<div id="observed-test-statistics" class="section level4 unnumbered">
<h4>Observed Test Statistic(s)<a class="anchor" aria-label="anchor" href="#observed-test-statistics"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb305"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">heroin</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/summarise.html">summarize</a></span><span class="op">(</span>obs_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">median</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>, 
            obs_tr_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">times</span>, trim <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   obs_med obs_tr_mean
##     &lt;dbl&gt;       &lt;dbl&gt;
## 1    368.        378.</code></pre>
</div>
<div id="bootstrapped-data" class="section level4 unnumbered">
<h4>Bootstrapped data!<a class="anchor" aria-label="anchor" href="#bootstrapped-data"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">4747</span><span class="op">)</span>

<span class="va">heroin</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/sample_n.html">sample_frac</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/summarise.html">summarize</a></span><span class="op">(</span>boot_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">median</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>, 
            boot_tr_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">times</span>, trim <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   boot_med boot_tr_mean
##      &lt;dbl&gt;        &lt;dbl&gt;
## 1      368         372.</code></pre>
</div>
<div id="need-to-bootstrap-a-lot-of-times" class="section level4 unnumbered">
<h4>Need to bootstrap a lot of times…<a class="anchor" aria-label="anchor" href="#need-to-bootstrap-a-lot-of-times"><i class="fas fa-link"></i></a>
</h4>
<p>Below is the code showing how to bootstrap using for loops (nested to create the t multipliers needed for the BS-t intervals). (There is a package <strong>boot</strong> which will bootstrap for you, but you need to write functions to use it.)</p>
<p><strong>set variables</strong></p>
<div class="sourceCode" id="cb309"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n_rep1</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">n_rep2</span> <span class="op">&lt;-</span> <span class="fl">20</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">4747</span><span class="op">)</span></code></pre></div>
<p><strong>boot stat function</strong></p>
<div class="sourceCode" id="cb310"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_stat_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">{</span> 
    <span class="va">df</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>obs_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">median</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>,
           obs_tr_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">times</span>, trim <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/sample_n.html">sample_frac</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/summarise.html">summarize</a></span><span class="op">(</span>boot_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">median</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>, 
              boot_tr_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">times</span>, trim <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span>,
              obs_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">obs_med</span><span class="op">)</span>,
              obs_tr_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">obs_tr_mean</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></code></pre></div>
<p><strong>resample function</strong></p>
<div class="sourceCode" id="cb311"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_1_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">{</span>
  <span class="va">df</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/sample_n.html">sample_frac</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><strong>bootstrapping</strong></p>
<div class="sourceCode" id="cb312"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_df</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_rep1</span>, <span class="op">~</span><span class="fu">boot_stat_func</span><span class="op">(</span>df <span class="op">=</span> <span class="va">heroin</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 100 × 4
##    boot_med boot_tr_mean obs_med obs_tr_mean
##       &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;
##  1     368          372.    368.        378.
##  2     358          363.    368.        378.
##  3     431          421.    368.        378.
##  4     332.         350.    368.        378.
##  5     310.         331.    368.        378.
##  6     376          382.    368.        378.
##  7     366          365.    368.        378.
##  8     378.         382.    368.        378.
##  9     394          386.    368.        378.
## 10     392.         402.    368.        378.
## # … with 90 more rows</code></pre>
</div>
<div id="what-do-the-data-distributions-look-like" class="section level4 unnumbered">
<h4>What do the <strong>data</strong> distributions look like?<a class="anchor" aria-label="anchor" href="#what-do-the-data-distributions-look-like"><i class="fas fa-link"></i></a>
</h4>
<p><img src="04-MLR_files/figure-html/unnamed-chunk-11-1.png" width="384" style="display: block; margin: auto;"><img src="04-MLR_files/figure-html/unnamed-chunk-11-2.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div id="what-do-the-sampling-distributions-look-like" class="section level4 unnumbered">
<h4>What do the sampling distributions look like?<a class="anchor" aria-label="anchor" href="#what-do-the-sampling-distributions-look-like"><i class="fas fa-link"></i></a>
</h4>
<p>The distributions of both the median and the trimmed mean are symmetric and bell-shaped. However, the trimmed mean has a more normal distribution (as evidenced by the points of the qq plot falling on the line y=x).</p>
<p><img src="04-MLR_files/figure-html/unnamed-chunk-12-1.png" width="480" style="display: block; margin: auto;"><img src="04-MLR_files/figure-html/unnamed-chunk-12-2.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="what-does-the-boot-output-look-like" class="section level4 unnumbered">
<h4>What does the boot output look like?<a class="anchor" aria-label="anchor" href="#what-does-the-boot-output-look-like"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb314"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_df</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_rep1</span>, <span class="op">~</span><span class="fu">boot_stat_func</span><span class="op">(</span>df <span class="op">=</span> <span class="va">heroin</span><span class="op">)</span><span class="op">)</span>

<span class="va">boot_stats</span></code></pre></div>
<pre><code>## # A tibble: 100 × 4
##    boot_med boot_tr_mean obs_med obs_tr_mean
##       &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;
##  1     362          373.    368.        378.
##  2     342.         345.    368.        378.
##  3     388.         393.    368.        378.
##  4     452          428.    368.        378.
##  5     400.         400.    368.        378.
##  6     348          363.    368.        378.
##  7     399          405.    368.        378.
##  8     394          398.    368.        378.
##  9     358          359.    368.        378.
## 10     299          332.    368.        378.
## # … with 90 more rows</code></pre>
</div>
<div id="normal-ci-with-boot-se" class="section level4 unnumbered">
<h4>95% normal CI with Boot SE<a class="anchor" aria-label="anchor" href="#normal-ci-with-boot-se"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_stats</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/summarise.html">summarize</a></span><span class="op">(</span>low_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">obs_med</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">0.025</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">sd</a></span><span class="op">(</span><span class="va">boot_med</span><span class="op">)</span>, 
         up_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">obs_med</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">sd</a></span><span class="op">(</span><span class="va">boot_med</span><span class="op">)</span>,
         low_tr_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">obs_tr_mean</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">0.025</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">sd</a></span><span class="op">(</span><span class="va">boot_tr_mean</span><span class="op">)</span>, 
         up_tr_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">obs_tr_mean</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">sd</a></span><span class="op">(</span><span class="va">boot_tr_mean</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 4
##   low_med up_med low_tr_mean up_tr_mean
##     &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;
## 1    301.   434.        332.       425.</code></pre>
</div>
<div id="percentile-ci" class="section level4 unnumbered">
<h4>95% Percentile CI<a class="anchor" aria-label="anchor" href="#percentile-ci"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb318"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_stats</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/summarise.html">summarize</a></span><span class="op">(</span>perc_CI_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">quantile</a></span><span class="op">(</span><span class="va">boot_med</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span>, 
            perc_CI_tr_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">quantile</a></span><span class="op">(</span><span class="va">boot_tr_mean</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span>, 
            q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   perc_CI_med perc_CI_tr_mean     q
##         &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt;
## 1        319.            329. 0.025
## 2        448.            423. 0.975</code></pre>
</div>
<div id="bootstrap-t-ci" class="section level4 unnumbered">
<h4>95% Bootstrap-t CI<a class="anchor" aria-label="anchor" href="#bootstrap-t-ci"><i class="fas fa-link"></i></a>
</h4>
<p>Note that the t-value is needed (which requires a different SE for each bootstrap sample). It is necessary to bootstrap twice.</p>
<p><strong>re-resample function</strong></p>
<div class="sourceCode" id="cb320"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_2_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">reps</span><span class="op">)</span><span class="op">{</span>
  <span class="va">resample2</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">reps</span>
  <span class="va">df</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/summarise.html">summarize</a></span><span class="op">(</span>boot_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">median</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>, boot_tr_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">times</span>, trim <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">resample2</span>, <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_df</a></span><span class="op">(</span><span class="va">resample2</span>, <span class="op">~</span><span class="va">df</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span> 
             <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/sample_n.html">sample_frac</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
             <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/summarise.html">summarize</a></span><span class="op">(</span>boot_2_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">median</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>, 
                       boot_2_tr_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">times</span>, trim <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">resample2</span>, <span class="fu"><a href="https://rdrr.io/pkg/tidyselect/man/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>]</p>
<p><strong>double bootstrap!</strong></p>
<div class="sourceCode" id="cb321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_2_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>resample1 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_rep1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>first_boot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_rep1</span>, <span class="op">~</span><span class="fu">boot_1_func</span><span class="op">(</span>df <span class="op">=</span> <span class="va">heroin</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>second_boot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map</a></span><span class="op">(</span><span class="va">first_boot</span>, <span class="va">boot_2_func</span>, reps <span class="op">=</span> <span class="va">n_rep2</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
</div>
<div id="summarizing-the-double-bootstrap" class="section level4" number="8.4.0.1">
<h4>
<span class="header-section-number">8.4.0.1</span> Summarizing the double bootstrap<a class="anchor" aria-label="anchor" href="#summarizing-the-double-bootstrap"><i class="fas fa-link"></i></a>
</h4>
<p><strong>results</strong></p>
<div class="sourceCode" id="cb322"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_2_stats</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/nest.html">unnest</a></span><span class="op">(</span><span class="va">second_boot</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/nest.html">unnest</a></span><span class="op">(</span><span class="va">first_boot</span><span class="op">)</span> </code></pre></div>
<pre><code>## # A tibble: 476,000 × 12
##    resample1    id clinic status times prison  dose resample2 boot_med
##        &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;     &lt;int&gt;    &lt;dbl&gt;
##  1         1   137      2      0   563      0    70         1      372
##  2         1    91      1      0   840      0    80         1      372
##  3         1   250      1      1   117      0    40         1      372
##  4         1   168      2      0   788      0    70         1      372
##  5         1    67      1      1   386      0    60         1      372
##  6         1     3      1      1   262      0    55         1      372
##  7         1   104      2      0   713      0    50         1      372
##  8         1   251      1      1   175      1    60         1      372
##  9         1    68      1      0   439      0    80         1      372
## 10         1   118      2      0   532      0    70         1      372
## # … with 475,990 more rows, and 3 more variables: boot_tr_mean &lt;dbl&gt;,
## #   boot_2_med &lt;dbl&gt;, boot_2_tr_mean &lt;dbl&gt;</code></pre>
<p><strong>summary for resample 1</strong></p>
<div class="sourceCode" id="cb324"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_2_stats</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/nest.html">unnest</a></span><span class="op">(</span><span class="va">second_boot</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/nest.html">unnest</a></span><span class="op">(</span><span class="va">first_boot</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">resample1</span>, <span class="va">resample2</span>, <span class="fu"><a href="https://rdrr.io/pkg/tidyselect/man/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">resample1</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">boot_med</span>, <span class="va">boot_tr_mean</span>, <span class="va">boot_2_med</span>, <span class="va">boot_2_tr_mean</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu">skim_without_charts</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/tibble/man/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">skim_variable</span>, <span class="va">numeric.mean</span>, <span class="va">numeric.sd</span>, <span class="va">numeric.p50</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 4 × 4
##   skim_variable  numeric.mean numeric.sd numeric.p50
##   &lt;chr&gt;                 &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;
## 1 boot_med               372         0          372 
## 2 boot_tr_mean           378.        0          378.
## 3 boot_2_med             370.       46.6        365.
## 4 boot_2_tr_mean         372.       24.7        370.</code></pre>
<p><strong>summary for all resamples</strong></p>
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_t_stats</span> <span class="op">&lt;-</span> <span class="va">boot_2_stats</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/nest.html">unnest</a></span><span class="op">(</span><span class="va">second_boot</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/nest.html">unnest</a></span><span class="op">(</span><span class="va">first_boot</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/group_by.html">group_by</a></span><span class="op">(</span><span class="va">resample1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/summarise.html">summarize</a></span><span class="op">(</span>boot_se_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">sd</a></span><span class="op">(</span><span class="va">boot_2_med</span><span class="op">)</span>,
            boot_se_tr_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">sd</a></span><span class="op">(</span><span class="va">boot_2_tr_mean</span><span class="op">)</span>,
            boot_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">boot_med</span><span class="op">)</span>,  <span class="co"># doesn't do anything, just copies over</span>
            boot_tr_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">boot_tr_mean</span><span class="op">)</span><span class="op">)</span>  <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span> <span class="co"># the variables into the output</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>boot_t_med <span class="op">=</span> <span class="op">(</span><span class="va">boot_med</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">boot_med</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">boot_se_med</span>,
            boot_t_tr_mean <span class="op">=</span> <span class="op">(</span><span class="va">boot_tr_mean</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">boot_tr_mean</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">boot_se_tr_mean</span><span class="op">)</span>

  
<span class="va">boot_t_stats</span></code></pre></div>
<pre><code>## # A tibble: 100 × 7
##    resample1 boot_se_med boot_se_tr_mean boot_med boot_tr_mean boot_t_med
##        &lt;int&gt;       &lt;dbl&gt;           &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;
##  1         1        46.6            24.7     372          378.     0.0222
##  2         2        24.8            25.3     344          370.    -1.09  
##  3         3        36.9            24.2     372.         380.     0.0145
##  4         4        20.8            19.7     354          359.    -0.817 
##  5         5        30.1            22.0     308          331.    -2.09  
##  6         6        25.5            24.5     318          336.    -2.08  
##  7         7        24.9            20.3     367          378.    -0.159 
##  8         8        46.3            25.0     402          393.     0.670 
##  9         9        32.3            20.8     388.         380.     0.512 
## 10        10        18.1            15.1     381          384.     0.555 
## # … with 90 more rows, and 1 more variable: boot_t_tr_mean &lt;dbl&gt;</code></pre>
<div class="inline-figure"><img src="04-MLR_files/figure-html/unnamed-chunk-21-1.png" width="480" style="display: block; margin: auto;"></div>
<div class="inline-figure"><img src="04-MLR_files/figure-html/unnamed-chunk-22-1.png" width="480" style="display: block; margin: auto;"></div>
</div>
<div id="bootstrap-t-ci-1" class="section level4 unnumbered">
<h4>95% Bootstrap-t CI<a class="anchor" aria-label="anchor" href="#bootstrap-t-ci-1"><i class="fas fa-link"></i></a>
</h4>
<p>Note that the t-value is needed (which requires a different SE for each bootstrap sample).</p>
<p><strong>t-values</strong></p>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_t_stats</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">boot_t_med</span>, <span class="va">boot_t_tr_mean</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 100 × 2
##    boot_t_med boot_t_tr_mean
##         &lt;dbl&gt;          &lt;dbl&gt;
##  1     0.0222          0.140
##  2    -1.09           -0.160
##  3     0.0145          0.257
##  4    -0.817          -0.767
##  5    -2.09           -1.98 
##  6    -2.08           -1.56 
##  7    -0.159           0.202
##  8     0.670           0.764
##  9     0.512           0.280
## 10     0.555           0.625
## # … with 90 more rows</code></pre>
<p>]</p>
<p><strong>multipliers</strong></p>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_q</span> <span class="op">&lt;-</span> <span class="va">boot_t_stats</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">boot_t_med</span>, <span class="va">boot_t_tr_mean</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/summarise.html">summarize</a></span><span class="op">(</span>q_t_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">quantile</a></span><span class="op">(</span><span class="va">boot_t_med</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span>, 
            q_t_tr_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">quantile</a></span><span class="op">(</span><span class="va">boot_t_tr_mean</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span>,
            q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span>

<span class="va">boot_q</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   q_t_med q_t_tr_mean     q
##     &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1   -2.08       -2.01 0.025
## 2    2.25        2.03 0.975</code></pre>
<p><strong>pull numbers</strong></p>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_q_med</span> <span class="op">&lt;-</span> <span class="va">boot_q</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">q_t_med</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/pull.html">pull</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">boot_q_med</span></code></pre></div>
<pre><code>##  2.5% 97.5% 
## -2.08  2.25</code></pre>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_q_tr_mean</span> <span class="op">&lt;-</span> <span class="va">boot_q</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">q_t_tr_mean</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/pull.html">pull</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">boot_q_tr_mean</span></code></pre></div>
<pre><code>##  2.5% 97.5% 
## -2.01  2.03</code></pre>
<p><strong>BS-t CI</strong></p>
<div class="sourceCode" id="cb336"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_t_stats</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/summarise.html">summarize</a></span><span class="op">(</span>boot_t_CI_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">boot_med</span><span class="op">)</span> <span class="op">+</span> 
                                  <span class="va">boot_q_med</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">sd</a></span><span class="op">(</span><span class="va">boot_med</span><span class="op">)</span>,
            boot_t_CI_tr_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">boot_tr_mean</span><span class="op">)</span> <span class="op">+</span> 
                                  <span class="va">boot_q_tr_mean</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">sd</a></span><span class="op">(</span><span class="va">boot_tr_mean</span><span class="op">)</span>,
            q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   boot_t_CI_med boot_t_CI_tr_mean     q
##           &lt;dbl&gt;             &lt;dbl&gt; &lt;dbl&gt;
## 1          306.              330. 0.025
## 2          441.              418. 0.975</code></pre>
</div>
<div id="comparison-of-intervals" class="section level4" number="8.4.0.2">
<h4>
<span class="header-section-number">8.4.0.2</span> Comparison of intervals<a class="anchor" aria-label="anchor" href="#comparison-of-intervals"><i class="fas fa-link"></i></a>
</h4>
<p>The first three columns correspond to the CIs for the true median of the survival times. The second three columns correspond to the CIs for the true trimmed mean of the survival times.</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>CI</th>
<th>lower</th>
<th>obs Med</th>
<th>upper</th>
<th>lower</th>
<th>obs Tr Mean</th>
<th>upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Percentile</td>
<td>321</td>
<td>367.50</td>
<td>434.58</td>
<td>334.86</td>
<td>378.30</td>
<td>429.77</td>
</tr>
<tr class="even">
<td>w BS SE</td>
<td>309.98</td>
<td>367.50</td>
<td>425.01</td>
<td>336.90</td>
<td>378.30</td>
<td>419.77</td>
</tr>
<tr class="odd">
<td>BS-t</td>
<td>309.30</td>
<td>367.50</td>
<td>425.31</td>
<td>331.02</td>
<td>378.30</td>
<td>421.17</td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="permschp.html"><span class="header-section-number">7</span> Permutation Tests</a></div>
<div class="next"><a href="class.html"><span class="header-section-number">9</span> Classification</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#boot"><span class="header-section-number">8</span> Bootstrapping</a></li>
<li><a class="nav-link" href="#introduction"><span class="header-section-number">8.1</span> Introduction</a></li>
<li>
<a class="nav-link" href="#BSnotation"><span class="header-section-number">8.2</span> Basics &amp; Notation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#the-plug-in-principle"><span class="header-section-number">8.2.1</span> The Plug-in Principle</a></li>
<li><a class="nav-link" href="#the-bootstrap-idea"><span class="header-section-number">8.2.2</span> The Bootstrap Idea</a></li>
<li><a class="nav-link" href="#bootstrap-procedure"><span class="header-section-number">8.2.3</span> Bootstrap Procedure</a></li>
<li><a class="nav-link" href="#bootstrap-notation"><span class="header-section-number">8.2.4</span> Bootstrap Notation</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#BSCI"><span class="header-section-number">8.3</span> Bootstrap Confidence Intervals</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#normal-standard-ci-with-bootse-typenorm"><span class="header-section-number">8.3.1</span> Normal (standard) CI with BootSE: type="norm"</a></li>
<li><a class="nav-link" href="#bootstrap-t-confidence-intervals-typestud"><span class="header-section-number">8.3.2</span> Bootstrap-t Confidence Intervals: type="stud"</a></li>
<li><a class="nav-link" href="#percentile-confidence-intervals-typeperc"><span class="header-section-number">8.3.3</span> Percentile Confidence Intervals: type="perc"</a></li>
<li><a class="nav-link" href="#what-makes-a-ci-procedure-good"><span class="header-section-number">8.3.4</span> What makes a CI procedure good?</a></li>
<li><a class="nav-link" href="#bootstrap-ci-and-hypothesis-testing">
BCa CI: type="bca"
</a></li>
</ul>
</li>
<li><a class="nav-link" href="#r-example-heroin"><span class="header-section-number">8.4</span> R example: Heroin</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/hardin47/website/blob/master/04-MLR.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/hardin47/website/edit/master/04-MLR.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Linear Models</strong>" was written by Jo Hardin. It was last built on 2022-01-13.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
