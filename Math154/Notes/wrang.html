<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Data Wrangling | Computational Statistics</title>
  <meta name="description" content="Class notes for Math 154 at Pomona College: Computational Statistics. The notes are based extensively on An Introduction to Statistical Learning by James, Witten, Hastie, and Tibshirani as well as Modern Data Science with R by Baumer, Kaplan, and Horton." />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Data Wrangling | Computational Statistics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Class notes for Math 154 at Pomona College: Computational Statistics. The notes are based extensively on An Introduction to Statistical Learning by James, Witten, Hastie, and Tibshirani as well as Modern Data Science with R by Baumer, Kaplan, and Horton." />
  <meta name="github-repo" content="hardin47/website/Math154/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Data Wrangling | Computational Statistics" />
  
  <meta name="twitter:description" content="Class notes for Math 154 at Pomona College: Computational Statistics. The notes are based extensively on An Introduction to Statistical Learning by James, Witten, Hastie, and Tibshirani as well as Modern Data Science with R by Baumer, Kaplan, and Horton." />
  

<meta name="author" content="Jo Hardin" />


<meta name="date" content="2019-09-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="visualization.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Computational Statistics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Class Information</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#Sep3"><i class="fa fa-check"></i><b>1.1</b> 9/3/19 Agenda</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#course-logistics"><i class="fa fa-check"></i><b>1.2</b> Course Logistics</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#course-content"><i class="fa fa-check"></i><b>1.3</b> Course Content</a><ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#vocabulary"><i class="fa fa-check"></i><b>1.3.1</b> Vocabulary</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#the-workflow"><i class="fa fa-check"></i><b>1.3.2</b> The Workflow</a></li>
<li class="chapter" data-level="1.3.3" data-path="intro.html"><a href="intro.html#principles-for-the-data-science-process-tldr"><i class="fa fa-check"></i><b>1.3.3</b> Principles for the Data Science Process tl;dr</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#Sep5"><i class="fa fa-check"></i><b>1.4</b> 9/5/19 Agenda</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#repro"><i class="fa fa-check"></i><b>1.5</b> Reproducibility</a><ul>
<li class="chapter" data-level="1.5.1" data-path="intro.html"><a href="intro.html#need-for-reproducibility"><i class="fa fa-check"></i><b>1.5.1</b> Need for Reproducibility</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#example-1"><i class="fa fa-check"></i>Example 1</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#example-2"><i class="fa fa-check"></i>Example 2</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#example-3"><i class="fa fa-check"></i>Example 3</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#example-4"><i class="fa fa-check"></i>Example 4</a></li>
<li class="chapter" data-level="1.5.2" data-path="intro.html"><a href="intro.html#the-reproducible-data-analysis-process"><i class="fa fa-check"></i><b>1.5.2</b> The reproducible data analysis process</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#data-examples"><i class="fa fa-check"></i><b>1.6</b> Data Examples</a><ul>
<li class="chapter" data-level="1.6.1" data-path="intro.html"><a href="intro.html#college-rankings-systems"><i class="fa fa-check"></i><b>1.6.1</b> College Rankings Systems</a></li>
<li class="chapter" data-level="1.6.2" data-path="intro.html"><a href="intro.html#trump-and-twitter"><i class="fa fa-check"></i><b>1.6.2</b> Trump and Twitter</a></li>
<li class="chapter" data-level="1.6.3" data-path="intro.html"><a href="intro.html#can-twitter-predict-election-results"><i class="fa fa-check"></i><b>1.6.3</b> Can Twitter Predict Election Results?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>2</b> Visualization</a><ul>
<li class="chapter" data-level="2.1" data-path="visualization.html"><a href="visualization.html#Sep10"><i class="fa fa-check"></i><b>2.1</b> 9/10/19 Agenda</a></li>
<li class="chapter" data-level="2.2" data-path="visualization.html"><a href="visualization.html#examples"><i class="fa fa-check"></i><b>2.2</b> Examples</a><ul>
<li class="chapter" data-level="2.2.1" data-path="visualization.html"><a href="visualization.html#cholera-via-tufte"><i class="fa fa-check"></i><b>2.2.1</b> Cholera via Tufte</a></li>
<li class="chapter" data-level="2.2.2" data-path="visualization.html"><a href="visualization.html#challenger-via-tufte"><i class="fa fa-check"></i><b>2.2.2</b> Challenger via Tufte</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="visualization.html"><a href="visualization.html#thoughts"><i class="fa fa-check"></i><b>2.3</b> Thoughts on Plotting</a><ul>
<li class="chapter" data-level="2.3.1" data-path="visualization.html"><a href="visualization.html#advice"><i class="fa fa-check"></i><b>2.3.1</b> Advice</a></li>
<li class="chapter" data-level="2.3.2" data-path="visualization.html"><a href="visualization.html#an-example-from-information-is-beautiful"><i class="fa fa-check"></i><b>2.3.2</b> An example from Information is Beautiful</a></li>
<li class="chapter" data-level="2.3.3" data-path="visualization.html"><a href="visualization.html#assessing-graphics-and-other-analyses"><i class="fa fa-check"></i><b>2.3.3</b> Assessing Graphics (and Other Analyses)</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="visualization.html"><a href="visualization.html#Sep12"><i class="fa fa-check"></i><b>2.4</b> 9/12/19 Agenda</a></li>
<li class="chapter" data-level="2.5" data-path="visualization.html"><a href="visualization.html#deconstruct"><i class="fa fa-check"></i><b>2.5</b> Deconstructing a graph</a><ul>
<li class="chapter" data-level="2.5.1" data-path="visualization.html"><a href="visualization.html#gg"><i class="fa fa-check"></i><b>2.5.1</b> The Grammar of Graphics (<code>gg</code>)</a></li>
<li class="chapter" data-level="2.5.2" data-path="visualization.html"><a href="visualization.html#ggplot2"><i class="fa fa-check"></i><b>2.5.2</b> <code>ggplot2</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="wrang.html"><a href="wrang.html"><i class="fa fa-check"></i><b>3</b> Data Wrangling</a><ul>
<li class="chapter" data-level="3.1" data-path="wrang.html"><a href="wrang.html#Sep17"><i class="fa fa-check"></i><b>3.1</b> 9/17/19 Agenda</a></li>
<li class="chapter" data-level="3.2" data-path="wrang.html"><a href="wrang.html#datastruc"><i class="fa fa-check"></i><b>3.2</b> Structure of Data</a><ul>
<li class="chapter" data-level="3.2.1" data-path="wrang.html"><a href="wrang.html#building-tidy-data"><i class="fa fa-check"></i><b>3.2.1</b> Building Tidy Data</a></li>
<li class="chapter" data-level="3.2.2" data-path="wrang.html"><a href="wrang.html#examples-of-chaining"><i class="fa fa-check"></i><b>3.2.2</b> Examples of Chaining</a></li>
<li class="chapter" data-level="3.2.3" data-path="wrang.html"><a href="wrang.html#data-verbs-on-single-data-frames"><i class="fa fa-check"></i><b>3.2.3</b> Data Verbs (on single data frames)</a></li>
<li class="chapter" data-level="3.2.4" data-path="wrang.html"><a href="wrang.html#examples-of-data-verbs-in-use"><i class="fa fa-check"></i><b>3.2.4</b> Examples of Data Verbs in Use</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="wrang.html"><a href="wrang.html#Sep19"><i class="fa fa-check"></i><b>3.3</b> 9/19/19 Agenda</a></li>
<li class="chapter" data-level="3.4" data-path="wrang.html"><a href="wrang.html#highverb"><i class="fa fa-check"></i><b>3.4</b> Higher Level Data Verbs</a><ul>
<li class="chapter" data-level="3.4.1" data-path="wrang.html"><a href="wrang.html#examples-of-data-verbs-in-use-more-sophisticated"><i class="fa fa-check"></i><b>3.4.1</b> Examples of Data Verbs in Use (more sophisticated)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://st47s.com/Math154" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Computational Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="wrang" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Data Wrangling</h1>
<div id="Sep17" class="section level2">
<h2><span class="header-section-number">3.1</span> 9/17/19 Agenda</h2>
<ol style="list-style-type: decimal">
<li>Tidy Data (structure of data)</li>
<li>Piping / chaining</li>
<li>Basic data Verbs</li>
<li>babynames / NHANES examples</li>
</ol>
<blockquote>
<p>Information is what we want, but data are what we’ve got. <span class="citation">(Kaplan <a href="#ref-Kaplan15">2015</a>)</span></p>
</blockquote>
</div>
<div id="datastruc" class="section level2">
<h2><span class="header-section-number">3.2</span> Structure of Data</h2>
<p>For plotting, analyses, model building, etc., it’s important that the data be structured in a very particular way. Hadley Wickham provides a thorough discussion and advice for cleaning up the data in <span class="citation">Wickham (<a href="#ref-Wickham14">2014</a>)</span>.</p>
<ul>
<li><em>Tidy Data</em>: rows (cases/observational units) and columns (variables). The key is that <em>every</em> row is a case and *every} column is a variable. No exceptions.</li>
<li>Creating tidy data is not trivial. We work with objects (often data tables), functions, and arguments (often variables).</li>
</ul>
<p>The Active Duty data are not tidy! What are the cases? How are the data not tidy? What might the data look like in tidy form? Suppose that the case was “an individual in the armed forces.” What variables would you use to capture the information in the following table?</p>
<p><a href="https://docs.google.com/spreadsheets/d/1Ow6Cm4z-Z1Yybk3i352msulYCEDOUaOghmo9ALajyHo/edit#gid=1811988794" class="uri">https://docs.google.com/spreadsheets/d/1Ow6Cm4z-Z1Yybk3i352msulYCEDOUaOghmo9ALajyHo/edit#gid=1811988794</a></p>
<p><img src="figs/activedutyTidy.png" /></p>
<p><strong>Problem:</strong> totals and different sheets</p>
<p><strong>Better for R:</strong> longer format with columns - grade, gender, status, service, count (case is still the total pay grade)</p>
<p><strong>Case is individual (?)</strong>: grade, gender, status, service (no count because each row does the counting)</p>
<div id="building-tidy-data" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Building Tidy Data</h3>
<p>Within R (really within any type of computing language, Python, SQL, Java, etc.), we need to understand how to build data using the patterns of the language. Some things to consider:</p>
<ul>
<li><code>object_name = function_name(arguments)</code> is a way of using a function to create a new object.</li>
<li><p><code>object_name = data_table %&gt;% function_name(arguments)</code> uses chaining syntax as an extension of the ideas of functions. In chaining, the value on the left side of <code>%&gt;%</code> becomes the <em>first argument</em> to the function on the right side.</p></li>
<li></li>
</ul>
<pre><code>object_name = data_table %&gt;%
function_name(arguments) %&gt;% 
function_name(arguments)</code></pre>
<p>is extended chaining. <code>%&gt;%</code> is never at the front of the line, it is always connecting one idea with the continuation of that idea on the next line.
* In R, all functions take arguments in round parentheses (as opposed to subsetting observations or variables from data objects which happen with square parentheses). Additionally, the spot to the left of <code>%&gt;%</code> is always a data table.
* The pipe syntax should be read as <em>then</em>, <code>%&gt;%</code>.</p>
</div>
<div id="examples-of-chaining" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Examples of Chaining</h3>
<p>The pipe syntax (<code>%&gt;%</code>) takes a data frame (or data table) and sends it to the argument of a function. The mapping goes to the first available argument in the function. For example:</p>
<p><code>x %&gt;% f(y)</code> is the same as <code>f(x, y)</code></p>
<p><code>y %&gt;% f(x, ., z)</code> is the same as <code>f(x,y,z)</code></p>
<div id="little-bunny-foo-foo" class="section level4">
<h4><span class="header-section-number">3.2.2.1</span> Little Bunny Foo Foo</h4>
<p>From Hadley Wickham, how to think about tidy data.</p>
<blockquote>
<p>Little bunny Foo Foo
Went hopping through the forest
Scooping up the field mice
And bopping them on the head</p>
</blockquote>
<p>The nursery rhyme could be created by a series of steps where the output from each step is saved as an object along the way.</p>
<pre><code>foo_foo &lt;- little_bunny()
foo_foo_1 &lt;- hop(foo_foo, through = forest)
foo_foo_2 &lt;- scoop(foo_foo_2, up = field_mice)
foo_foo_3 &lt;- bop(foo_foo_2, on = head)</code></pre>
<p>Another approach is to concatenate the functions so that there is only one output.</p>
<pre><code>bop(
   scoop(
      hop(foo_foo, through = forest),
      up = field_mice),
   on = head)</code></pre>
<p>Or even worse, as one line:</p>
<pre><code>bop(scoop(hop(foo_foo, through = forest), up = field_mice), on = head)))</code></pre>
<p>Instead, the code can be written using the pipe in the <strong>order</strong> in which the function is evaluated:</p>
<pre><code>foo_foo %&gt;%
   hop(through = forest) %&gt;%
       scoop(up = field_mice) %&gt;%
           bop(on = head)</code></pre>
<p><strong>babynames</strong> Each year, the US Social Security Administration publishes a list of the most popular names given to babies. In 2014, <a href="http://www.ssa.gov/oact/babynames/#ht=2" class="uri">http://www.ssa.gov/oact/babynames/#ht=2</a> shows Emma and Olivia leading for girls, Noah and Liam for boys.</p>
<p>The <code>babynames</code> data table in the <code>babynames</code> package comes from the Social Security Administration’s listing of the names givens to babies in each year, and the number of babies of each sex given that name. (Only names with 5 or more babies are published by the SSA.)</p>
<p>See wrangExamp.pdf for more examples.</p>
</div>
</div>
<div id="data-verbs-on-single-data-frames" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Data Verbs (on single data frames)</h3>
<blockquote>
<p>Super important resource: The RStudio <code>dplyr</code> cheat sheet: <a href="https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf" class="uri">https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf</a></p>
</blockquote>
<p><strong>Data verbs take data tables as input and give data tables as output (that’s how we can use the chaining syntax!).</strong> We will use the R package <code>dplyr</code> to do much of our data wrangling. Below is a list of verbs which will be helpful in wrangling many different types of data. See the Data Wrangling cheat sheet from RStudio for additional help. <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" class="uri">https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf</a>}</p>
<ul>
<li><code>sample_n()</code> take a random row(s)</li>
<li><code>head()</code> grab the first few rows</li>
<li><code>tail()</code> grab the last few rows</li>
<li><code>filter()</code> removes unwanted *cases}</li>
<li><code>arrange()</code> reorders the cases</li>
<li><code>select()</code> removes unwanted *variables} (and <code>rename()</code> )</li>
<li><code>distinct()</code> returns the unique values in a table</li>
<li><code>mutate()</code> transforms the variable (and <code>transmute()</code> like mutate, returns only new variables)</li>
<li><code>group_by()</code>
<code>group_by</code> tells R that SUCCESSIVE functions keep in mind that there are groups of items. So <code>group_by</code> only makes sense with variables later on (like <code>summarize</code>).</li>
<li><code>summarize()</code> collapses a data frame to a single row. Not useful yet (will be useful with <code>group_by()</code>). Some functions that are used within <code>summarize()</code> include:
\begin{itemize}</li>
<li><code>min(), max(), mean(), sum(), sd(), median()</code>, and <code>IQR()</code></li>
<li><code>n()</code>: number of observations in the current group</li>
<li><code>n_distinct(x)</code>: count the number of unique values in <code>x</code></li>
<li><code>first_value(x), last_value(x)</code> and <code>nth_value(x, n)</code>: work similarly to <code>x[1], x[length(x)]</code>, and <code>x[n]</code></li>
</ul>
</div>
<div id="examples-of-data-verbs-in-use" class="section level3">
<h3><span class="header-section-number">3.2.4</span> Examples of Data Verbs in Use</h3>
<p><strong>NHANES</strong> From <code>?NHANES</code>: NHANES is survey data collected by the US National Center for Health Statistics (NCHS) which has conducted a series of health and nutrition surveys since the early 1960’s. Since 1999 approximately 5,000 individuals of all ages are interviewed in their homes every year and complete the health examination component of the survey. The health examination is conducted in a mobile examination centre (MEC).</p>
<p>See <a href="http://pages.pomona.edu/~jsh04747/courses/math154/wrangExamp.pdf" class="uri">http://pages.pomona.edu/~jsh04747/courses/math154/wrangExamp.pdf</a> for more examples.</p>
<!--
The following Shiny app ("Visualizing data manipulation operations") is for demonstrating how to work with dplyr/tidyr data manipulation.  It includes tabs for data selection, `filter` and `select`, `mutate`, `group_by` and `summarize`, `group_by` and `mutate`, and `join`.   http://rstudio.calvin.edu:3838/rpruim/dataOps/
-->
</div>
</div>
<div id="Sep19" class="section level2">
<h2><span class="header-section-number">3.3</span> 9/19/19 Agenda</h2>
<ol style="list-style-type: decimal">
<li>Higher level data verbs: <code>gather</code>, <code>spread</code>, <code>join</code></li>
<li><code>lubridate</code></li>
</ol>
</div>
<div id="highverb" class="section level2">
<h2><span class="header-section-number">3.4</span> Higher Level Data Verbs</h2>
<p>There are more complicated verbs which may be important for more sophisticated analyses. See the RStudio <code>dplyr</code> cheat sheet, <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" class="uri">https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf</a>}.</p>
<ul>
<li><code>gather</code> makes many columns into 2 columns: gather(data, key, value, columns)</li>
<li><code>spread</code> makes one column into multiple columns: spread(data, key, value)</li>
<li><code>left_join</code> returns all rows from the left table, and any rows with matching keys from the right table.</li>
<li><code>inner_join</code> returns only the rows in which the left table have matching keys in the right table (i.e., matching rows in both sets).</li>
<li><code>full_join</code> returns all rows from both tables, join records from the left which have matching keys in the right table.</li>
</ul>
<p>Good practice: always specify the <code>by</code> argument when joining data frames.</p>
<div id="examples-of-data-verbs-in-use-more-sophisticated" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Examples of Data Verbs in Use (more sophisticated)</h3>
<p>See wrangExamp.pdf for more examples.</p>
<p>In class example on babynames via Nick <a href="http://dtkaplan.github.io/CVC/Summer2015/Learn/BabyNames/WhatHappenedToJane.Rmd" class="uri">http://dtkaplan.github.io/CVC/Summer2015/Learn/BabyNames/WhatHappenedToJane.Rmd</a> <a href="http://dtkaplan.github.io/CVC/Summer2015/Learn/BabyNames/WhatHappenedToJane-answers.pdf" class="uri">http://dtkaplan.github.io/CVC/Summer2015/Learn/BabyNames/WhatHappenedToJane-answers.pdf</a></p>
<div id="lubridate" class="section level4">
<h4><span class="header-section-number">3.4.1.1</span> lubridate</h4>
<p><code>lubridate</code> is a another R package meant for data wrangling <span class="citation">(Grolemund and Wickham <a href="#ref-lubridate">2011</a>)</span>. In particular, <code>lubridate</code> makes it very easy to work with days, times, and dates. The base idea is to start with dates in a <code>ymd</code> (year month day) format and transform the information into whatever you want. The linked table is from the original paper and provides many of the basic <code>lubridate</code> commands: <a href="http://blog.yhathq.com/static/pdf/R_date_cheat_sheet.pdf" class="uri">http://blog.yhathq.com/static/pdf/R_date_cheat_sheet.pdf</a>}.</p>
<p>Example from <a href="https://cran.r-project.org/web/packages/lubridate/vignettes/lubridate.html" class="uri">https://cran.r-project.org/web/packages/lubridate/vignettes/lubridate.html</a></p>
</div>
<div id="if-anyone-drove-a-time-machine-they-would-crash" class="section level4">
<h4><span class="header-section-number">3.4.1.2</span> If anyone drove a time machine, they would crash</h4>
<p>The length of months and years change so often that doing arithmetic with them can be unintuitive. Consider a simple operation, January 31st + one month. Should the answer be:</p>
<ol style="list-style-type: decimal">
<li>February 31st (which doesn’t exist)</li>
<li>March 4th (31 days after January 31), or</li>
<li>February 28th (assuming its not a leap year)</li>
</ol>
<p>A basic property of arithmetic is that a + b - b = a. Only solution 1 obeys the mathematical property, but it is an invalid date. Wickham wants to make lubridate as consistent as possible by invoking the following rule: if adding or subtracting a month or a year creates an invalid date, lubridate will return an NA.</p>
<p>If you thought solution 2 or 3 was more useful, no problem. You can still get those results with clever arithmetic, or by using the special <code>%m+%</code> and <code>%m-%</code> operators. <code>%m+%</code> and <code>%m-%</code> automatically roll dates back to the last day of the month, should that be necessary.</p>
<div id="some-basics-in-lubridate" class="section level5 unnumbered">
<h5>Some basics in lubridate</h5>
<p>(See wrangExamp.pdf for output/worked out examples.)</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1"><span class="kw">require</span>(lubridate)</a>
<a class="sourceLine" id="cb56-2" data-line-number="2">rightnow &lt;-<span class="st"> </span><span class="kw">now</span>()</a>
<a class="sourceLine" id="cb56-3" data-line-number="3"></a>
<a class="sourceLine" id="cb56-4" data-line-number="4"><span class="kw">day</span>(rightnow)</a></code></pre></div>
<pre><code>## [1] 15</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1"><span class="kw">week</span>(rightnow)</a></code></pre></div>
<pre><code>## [1] 37</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="kw">month</span>(rightnow, <span class="dt">label=</span><span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## [1] 9</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1"><span class="kw">month</span>(rightnow, <span class="dt">label=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] Sep
## 12 Levels: Jan &lt; Feb &lt; Mar &lt; Apr &lt; May &lt; Jun &lt; Jul &lt; Aug &lt; Sep &lt; ... &lt; Dec</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1"><span class="kw">year</span>(rightnow)</a></code></pre></div>
<pre><code>## [1] 2019</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1"><span class="kw">minute</span>(rightnow)</a></code></pre></div>
<pre><code>## [1] 28</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1"><span class="kw">hour</span>(rightnow)</a></code></pre></div>
<pre><code>## [1] 20</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1"><span class="kw">yday</span>(rightnow)</a></code></pre></div>
<pre><code>## [1] 258</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1"><span class="kw">mday</span>(rightnow)</a></code></pre></div>
<pre><code>## [1] 15</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1"><span class="kw">wday</span>(rightnow, <span class="dt">label=</span><span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1"><span class="kw">wday</span>(rightnow, <span class="dt">label=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] Sun
## Levels: Sun &lt; Mon &lt; Tue &lt; Wed &lt; Thu &lt; Fri &lt; Sat</code></pre>
</div>
<div id="but-how-do-i-create-a-date-object" class="section level5 unnumbered">
<h5>But how do I create a date object?</h5>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1">jan31 &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">&quot;2013-01-31&quot;</span>)</a>
<a class="sourceLine" id="cb78-2" data-line-number="2">jan31 <span class="op">+</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">11</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;2013-01-31&quot; NA           &quot;2013-03-31&quot; NA           &quot;2013-05-31&quot;
##  [6] NA           &quot;2013-07-31&quot; &quot;2013-08-31&quot; NA           &quot;2013-10-31&quot;
## [11] NA           &quot;2013-12-31&quot;</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1"><span class="kw">floor_date</span>(jan31, <span class="st">&quot;month&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">11</span>) <span class="op">+</span><span class="st"> </span><span class="kw">days</span>(<span class="dv">31</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;2013-02-01&quot; &quot;2013-03-04&quot; &quot;2013-04-01&quot; &quot;2013-05-02&quot; &quot;2013-06-01&quot;
##  [6] &quot;2013-07-02&quot; &quot;2013-08-01&quot; &quot;2013-09-01&quot; &quot;2013-10-02&quot; &quot;2013-11-01&quot;
## [11] &quot;2013-12-02&quot; &quot;2014-01-01&quot;</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1">jan31 <span class="op">+</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">11</span>) <span class="op">+</span><span class="st"> </span><span class="kw">days</span>(<span class="dv">31</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;2013-03-03&quot; NA           &quot;2013-05-01&quot; NA           &quot;2013-07-01&quot;
##  [6] NA           &quot;2013-08-31&quot; &quot;2013-10-01&quot; NA           &quot;2013-12-01&quot;
## [11] NA           &quot;2014-01-31&quot;</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1">jan31 <span class="op">%m+%</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">11</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;2013-01-31&quot; &quot;2013-02-28&quot; &quot;2013-03-31&quot; &quot;2013-04-30&quot; &quot;2013-05-31&quot;
##  [6] &quot;2013-06-30&quot; &quot;2013-07-31&quot; &quot;2013-08-31&quot; &quot;2013-09-30&quot; &quot;2013-10-31&quot;
## [11] &quot;2013-11-30&quot; &quot;2013-12-31&quot;</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1"><span class="kw">library</span>(nycflights13)</a>
<a class="sourceLine" id="cb86-2" data-line-number="2"><span class="kw">names</span>(flights)</a></code></pre></div>
<pre><code>##  [1] &quot;year&quot;           &quot;month&quot;          &quot;day&quot;            &quot;dep_time&quot;      
##  [5] &quot;sched_dep_time&quot; &quot;dep_delay&quot;      &quot;arr_time&quot;       &quot;sched_arr_time&quot;
##  [9] &quot;arr_delay&quot;      &quot;carrier&quot;        &quot;flight&quot;         &quot;tailnum&quot;       
## [13] &quot;origin&quot;         &quot;dest&quot;           &quot;air_time&quot;       &quot;distance&quot;      
## [17] &quot;hour&quot;           &quot;minute&quot;         &quot;time_hour&quot;</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1">flightsWK &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">ymdday =</span> <span class="kw">ymd</span>(<span class="kw">paste</span>(year, month,day, <span class="dt">sep=</span><span class="st">&quot;-&quot;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb88-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">weekdy =</span> <span class="kw">wday</span>(ymdday, <span class="dt">label=</span><span class="ot">TRUE</span>), <span class="dt">whichweek =</span> <span class="kw">week</span>(ymdday))</a>
<a class="sourceLine" id="cb88-3" data-line-number="3"><span class="kw">head</span>(flightsWK)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 22
##    year month   day dep_time sched_dep_time dep_delay arr_time
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
## 1  2013     1     1      517            515         2      830
## 2  2013     1     1      533            529         4      850
## 3  2013     1     1      542            540         2      923
## 4  2013     1     1      544            545        -1     1004
## 5  2013     1     1      554            600        -6      812
## 6  2013     1     1      554            558        -4      740
## # … with 15 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;, ymdday &lt;date&gt;, weekdy &lt;ord&gt;, whichweek &lt;dbl&gt;</code></pre>
<!--
## Scraping Data

Need to talk about this!  Scraping from HTML. 

* Example / instructions:  Beginner's Guide on Web Scraping in R (using rvest) with hands-on example
by Saurav Kaushik   https://www.analyticsvidhya.com/blog/2017/03/beginners-guide-on-web-scraping-in-r-using-rvest-with-hands-on-knowledge/
* Mine Dogucu at eCOTS18  https://www.causeweb.org/cause/ecots/ecots18/tech-talk/1
* La Quinta vs. Dennys (Colin Rundel & Mine Cetinkaya-Rundel )  https://github.com/rundel/Dennys_LaQuinta_Chance Webinar about the study:  https://www.rstudio.com/resources/webinars/data-science-case-study/  OR what if you look at Holiday Inn???)
-->

</div>
</div>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-lubridate">
<p>Grolemund, G., and H. Wickham. 2011. “Dates and Times Made Easy with lubridate.” <em>Journal of Statistical Software</em> 40 (3). <a href="http://www.jstatsoft.org/v40/i03/paper">http://www.jstatsoft.org/v40/i03/paper</a>.</p>
</div>
<div id="ref-Kaplan15">
<p>Kaplan, Daniel. 2015. <em>Data Computing: An Introduction to Wrangling and Visualization with R</em>. Project Mosaic Books.</p>
</div>
<div id="ref-Wickham14">
<p>Wickham, Hadley. 2014. “Tidy Data.” <em>Journal of Statistical Software</em> 59 (10). <a href="http://www.jstatsoft.org/v59/i10/paper">http://www.jstatsoft.org/v59/i10/paper</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="visualization.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/03-wrangling.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["Math-150-Notes.pdf", "Math-150-Notes.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
