<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 10 Misc | Computational Statistics</title>
<meta name="author" content="Jo Hardin">
<meta name="description" content="10.1 11/26/19 Agenda API / authenticating parallel computing cloud computing reticulate (Python in R!) SQL  10.2 API   Figure 1.2: xkcd, https://xkcd.com/1481/  What is an API? (Application...">
<meta name="generator" content="bookdown 0.23 with bs4_book()">
<meta property="og:title" content="Chapter 10 Misc | Computational Statistics">
<meta property="og:type" content="book">
<meta property="og:description" content="10.1 11/26/19 Agenda API / authenticating parallel computing cloud computing reticulate (Python in R!) SQL  10.2 API   Figure 1.2: xkcd, https://xkcd.com/1481/  What is an API? (Application...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 10 Misc | Computational Statistics">
<meta name="twitter:description" content="10.1 11/26/19 Agenda API / authenticating parallel computing cloud computing reticulate (Python in R!) SQL  10.2 API   Figure 1.2: xkcd, https://xkcd.com/1481/  What is an API? (Application...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11.1/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script type="text/x-mathjax-config">
    const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
    for (let popover of popovers){
      const div = document.createElement('div');
      div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
      div.innerHTML = popover.getAttribute('data-content');
      
      // Will this work with TeX on its own line?
      var has_math = div.querySelector("span.math");
      if (has_math) {
        document.body.appendChild(div);
      	MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
      	MathJax.Hub.Queue(function(){
          popover.setAttribute('data-content', div.innerHTML);
      	})
      }
    }
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Computational Statistics</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Class Information</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="visualization.html"><span class="header-section-number">2</span> Visualization</a></li>
<li><a class="" href="wrang.html"><span class="header-section-number">3</span> Data Wrangling</a></li>
<li><a class="" href="sims.html"><span class="header-section-number">4</span> Simulating</a></li>
<li><a class="" href="permschp.html"><span class="header-section-number">5</span> Permutation Tests</a></li>
<li><a class="" href="boot.html"><span class="header-section-number">6</span> Bootstrapping</a></li>
<li><a class="" href="ethics.html"><span class="header-section-number">7</span> Ethics</a></li>
<li><a class="" href="class.html"><span class="header-section-number">8</span> Classification</a></li>
<li><a class="" href="unsup.html"><span class="header-section-number">9</span> Unsupervised Methods</a></li>
<li><a class="active" href="misc.html"><span class="header-section-number">10</span> Misc</a></li>
<li><a class="" href="compstat.html"><span class="header-section-number">11</span> Computational Statistics</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/hardin47/website">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="misc" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> Misc<a class="anchor" aria-label="anchor" href="#misc"><i class="fas fa-link"></i></a>
</h1>
<div id="Nov26" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> 11/26/19 Agenda<a class="anchor" aria-label="anchor" href="#Nov26"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li>API / authenticating</li>
<li>parallel computing</li>
<li>cloud computing</li>
<li>
<code>reticulate</code> (Python in R!)</li>
<li>SQL</li>
</ol>
</div>
<div id="api" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> API<a class="anchor" aria-label="anchor" href="#api"><i class="fas fa-link"></i></a>
</h2>
<div style="float:right;position: relative; top: -30px;">
<div class="figure" style="text-align: right">
<span style="display:block;" id="fig:unnamed-chunk-2"></span>
<img src="figs/api_xkcd.png" alt="xkcd, https://xkcd.com/1481/" width="60%"><p class="caption">
Figure 1.2: xkcd, <a href="https://xkcd.com/1481/" class="uri">https://xkcd.com/1481/</a>
</p>
</div>
</div>
<p>What is an API? (Application Programming Interface)</p>
<p>Think of an API as a restaurant menu. The menu provides a list of what the restaurant has to offer, and you order off the menu by choosing the dish that you want. After you order, the restaurant figures out how to bring the food from the kitchen to your table in the way that you’ve specified.</p>
<p>An API is an intermediary that allows two applications to talk to one another. It is not the database or the server, instead it is the <em>code</em> that allows communication.</p>
<div id="examples-of-apis" class="section level4 unnumbered">
<h4>Examples of APIs<a class="anchor" aria-label="anchor" href="#examples-of-apis"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li><p>When you use an app on your phone, the app connects to the internet and sends information to a server somewhere. The server retrieves the data, interprets is, does what it does, and sends it back to you. The application which takes the data from the server and presents it to you in a readable way is an API.</p></li>
<li><p>Let’s say you are booking a flight on United. You choose all the details, you interact with the airline’s website. BUT INSTEAD, what if you are interacting with a software like Expedia? Then Expedia has to talk to United’s API to get all the information about available flights, costs, seats, etc.</p></li>
<li><p>If you’ve ever been to a third party site and clicked on “Share on Facebook” or “Share on Twitter” your third party site is communicating with the Facebook API or the Twitter API.</p></li>
<li><p>You sign up to go to a concert, and StubHub asks whether you want to add the concert to your Google calendar. StubHub needs to talk to Google via Google’s API.</p></li>
<li><p>What if you want some Twitter data? How might you get it? Well, you could email Twitter and ask someone for it. <strong>Instead</strong> Twitter provides information about how their data is stored, and allows you to query their data in an automated way.</p></li>
</ul>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-3"></span>
<img src="figs/API_weather.png" alt="Image taken from https://rigor.com/blog/what-is-an-api-a-brief-intro" width="60%"><p class="caption">
Figure 1.3: Image taken from <a href="https://rigor.com/blog/what-is-an-api-a-brief-intro" class="uri">https://rigor.com/blog/what-is-an-api-a-brief-intro</a>
</p>
</div>
</div>
<div id="authenticating" class="section level3" number="10.2.1">
<h3>
<span class="header-section-number">10.2.1</span> Authenticating<a class="anchor" aria-label="anchor" href="#authenticating"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>
<strong>Authenticating</strong> is stating who you are</li>
<li>
<strong>Authorization</strong> is asking for access to a resources (and happens after authentication)</li>
</ul>
<p>DO NOT post your credentials and keys to a public GitHub repo!!</p>
<p>In almost all cases, in order to communicate with an API, you must tell the API who you are and that you should have access to the information the API is providing.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-4"></span>
<img src="figs/auth.png" alt="Image taken from https://blog.restcase.com/restful-api-authentication-basics/" width="60%"><p class="caption">
Figure 1.4: Image taken from <a href="https://blog.restcase.com/restful-api-authentication-basics/" class="uri">https://blog.restcase.com/restful-api-authentication-basics/</a>
</p>
</div>
</div>
</div>
<div id="parallel-computing" class="section level2" number="10.3">
<h2>
<span class="header-section-number">10.3</span> Parallel Computing<a class="anchor" aria-label="anchor" href="#parallel-computing"><i class="fas fa-link"></i></a>
</h2>
<p>(Taken from the Teach Data Science blog: <a href="https://teachdatascience.com/parallel/" class="uri">https://teachdatascience.com/parallel/</a>)</p>
<p>To demonstrate what parallel computing is, we’ll perform tasks that are <strong>embarrassingly parallel</strong> which means there is no dependency or communication between the parallel tasks. Again, parallel computing can be powerful in ways that link computational tasks in complicated ways. But we believe that as a <em>first</em> pass at teaching parallel computing, we should teach the parallel structure before bringing in dependence across the parallel tasks. Examples of <a href="https://en.wikipedia.org/wiki/Embarrassingly_parallel">embarrassingly parallel</a> algorithms include: Monte Carlo analysis, bootstrapping, growing trees for Random Forests, <code>group_by</code> analyses, and cross-validation. Additionally, data science methods increasingly use <a href="https://en.wikipedia.org/wiki/Randomized_algorithm">randomized algorithms</a> which can often be written in parallel.</p>
<p>Indeed, it isn’t always easy to know when to use a parallel construction. Because of existing overhead processes (e.g., copying data across many threads, bring results together, etc.) an algorithm run on 10 parallel strands will not reduce an original (non-parallel) run time by 10-fold. Figuring out when a parallel implementation is appropriate is beyond the scope of this blog but should be carefully considered before embarking on large projects.</p>
<div id="some-parallel-examples" class="section level4 unnumbered">
<h4>Some parallel examples<a class="anchor" aria-label="anchor" href="#some-parallel-examples"><i class="fas fa-link"></i></a>
</h4>
<p>Before running code in parallel, it is valuable to know how many cores your computer has to work with. Note that the <code>detectCores</code> function will provide information about the specific device you are using (<code>logical = FALSE</code> tells you only the physical cores which is likely what you want). Note that after <code>makeCluster</code> the separate threads have information. [The argument <code>setup_strategy = "sequential"</code> is a fix for working with R 4.0+.] After <code>stopCluster</code>, the code is no longer connecting to the cluster structure.</p>
<div class="sourceCode" id="cb526"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span>
<span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span>logical<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">P</span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<div class="sourceCode" id="cb528"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">makeCluster</a></span><span class="op">(</span><span class="va">P</span>, setup_strategy <span class="op">=</span> <span class="st">"sequential"</span><span class="op">)</span>
<span class="va">cl</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>## node of a socket cluster on host 'localhost' with pid 75490</code></pre>
<div class="sourceCode" id="cb530"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span>
<span class="va">cl</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>## Error in summary.connection(connection): invalid connection</code></pre>
</div>
<div id="embarrassingly-embarrassing-example" class="section level4 unnumbered">
<h4>Embarrassingly embarrassing example<a class="anchor" aria-label="anchor" href="#embarrassingly-embarrassing-example"><i class="fas fa-link"></i></a>
</h4>
<p>In the example below, we generate some Cauchy data and find the max of each sample. Note that for the current device there are 8 cores, so the process will happen 100/P = 12.5 times on each core. The second argument of <code>clusterApply</code> is a sequence of numbers that gets passed to each worker as the (first) argument of <code>func1</code>. Below, I’ve specified that the value 50 (number of reps) should be passed separately to 100 different workers.</p>
<div class="sourceCode" id="cb532"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">W</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">P</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span>logical<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">makeCluster</a></span><span class="op">(</span><span class="va">P</span>, setup_strategy <span class="op">=</span> <span class="st">"sequential"</span><span class="op">)</span>

<span class="va">func1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">reps</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Cauchy.html">rcauchy</a></span><span class="op">(</span><span class="va">reps</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>


<span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html">clusterApply</a></span><span class="op">(</span><span class="va">cl</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">50</span>,<span class="va">W</span><span class="op">)</span>, fun <span class="op">=</span> <span class="va">func1</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 36.44004
## 
## [[2]]
## [1] 41.72103
## 
## [[3]]
## [1] 74.68404</code></pre>
<div class="sourceCode" id="cb534"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></code></pre></div>
<p>There are many R functions which implement parallel processing. For example, the same code from above can be processed using <code>foreach</code>.</p>
<div class="sourceCode" id="cb535"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">doParallel</span><span class="op">)</span>
<span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">makeCluster</a></span><span class="op">(</span><span class="va">P</span>, setup_strategy <span class="op">=</span> <span class="st">"sequential"</span><span class="op">)</span>

<span class="fu">doParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">registerDoParallel</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span>
<span class="fu">foreach</span><span class="op">(</span>reps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>, .combine <span class="op">=</span> <span class="st">'c'</span><span class="op">)</span> <span class="op">%dopar%</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Cauchy.html">rcauchy</a></span><span class="op">(</span><span class="va">reps</span><span class="op">)</span><span class="op">)</span>
       <span class="op">}</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## [1]  43.14389 274.16503  19.45930</code></pre>
<div class="sourceCode" id="cb537"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></code></pre></div>
</div>
<div id="example-bootstrapping" class="section level4 unnumbered">
<h4>Example bootstrapping<a class="anchor" aria-label="anchor" href="#example-bootstrapping"><i class="fas fa-link"></i></a>
</h4>
<p>A slightly less embarrassingly parallel example comes with bootstrapping. Below we have used parallel implementation to bootstrap the mean of the iris data petal length (Virginica only).</p>
<div class="sourceCode" id="cb538"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>

<span class="va">iris_bs</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">==</span> <span class="st">"virginica"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Petal.Length</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb539"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">makeCluster</a></span><span class="op">(</span><span class="va">P</span>, setup_strategy <span class="op">=</span> <span class="st">"sequential"</span><span class="op">)</span>

<span class="fu">doParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">registerDoParallel</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span>
<span class="va">bsmean_PL</span> <span class="op">&lt;-</span> <span class="fu">foreach</span><span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, .combine <span class="op">=</span> <span class="st">'c'</span><span class="op">)</span> <span class="op">%dopar%</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/resample.html">sample</a></span><span class="op">(</span><span class="va">iris_bs</span><span class="op">$</span><span class="va">Petal.Length</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">bootstrap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">bsmean_PL</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">bootstrap</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">bsmean_PL</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Histogram of 100 Bootstrapped Means using foreach"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-misc_files/figure-html/unnamed-chunk-9-1.png" width="480" style="display: block; margin: auto;"></div>
</div>
<div id="spark-and-sparklyr" class="section level3" number="10.3.1">
<h3>
<span class="header-section-number">10.3.1</span> Spark and <code>sparklyr</code><a class="anchor" aria-label="anchor" href="#spark-and-sparklyr"><i class="fas fa-link"></i></a>
</h3>
<p>Some of you may be familiar with <a href="http://spark.apache.org/">Apache Spark</a> which is an open-source product for distributed cluster-computing. You may want to learn more about its capabilities, including scheduling workflow, dispatching tasks, and consolidating end results. While incredibly powerful, there has historically been a steep learning curve to getting R to work smoothly with a Spark connection. Recently, RStudio has come out with a new package <a href="https://spark.rstudio.com/"><code>sparklyr</code></a> which integrates R and Spark seamlessly. Note that in the example below, we’ve set up a local connection just for the purposes of the example. For your work, you may want to connect to a cluster or cloud space with many cores.</p>
<p>The <a href="https://spark.rstudio.com/">RStudio <code>sparklyr</code> webpage</a> provides a plethora of good examples demonstrating the sophistication and power of the technology. <code>sparklyr</code> has particularly strong connections to the suite of <code>tidyverse</code> functions. Indeed, the power of <code>sparklyr</code> is more about distributing the computing than about parallelizing it. For example, with <code>sparklyr</code> the computations are delayed until you need the results. Additionally, Spark is doing the heavy lifting and only at the very end (when your results are called) do you need to worry about the size of the table, results, or computational space. The example below repeats the bootstrapping work that was done previously.</p>
<p>Note, it is important to look at your data structures and variables names. For example, when copying the local dataframe <code>iris_samps</code> to the remote data source called <code>iris_samps_tbl</code>, the variable <code>Petal.Length</code> was changed to <code>Petal_Length</code>.</p>
<div class="sourceCode" id="cb540"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">sparklyr</span><span class="op">)</span>
<span class="fu">spark_install</span><span class="op">(</span><span class="op">)</span>

<span class="va">sc</span> <span class="op">&lt;-</span> <span class="fu">spark_connect</span><span class="op">(</span>master <span class="op">=</span> <span class="st">"local"</span><span class="op">)</span>

<span class="va">n_sim</span> <span class="op">=</span> <span class="fl">100</span>
<span class="va">iris_samps</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">==</span> <span class="st">"virginica"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">rep.int</span>, times<span class="op">=</span><span class="va">n_sim</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>replicate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_sim</span>, each <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">replicate</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="fl">50</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">iris_samps_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/copy_to.html">copy_to</a></span><span class="op">(</span><span class="va">sc</span>, <span class="va">iris_samps</span><span class="op">)</span>

<span class="va">iris_samps_tbl</span> <span class="op">%&gt;%</span> 
  <span class="fu">spark_apply</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Petal_Length</span><span class="op">)</span><span class="op">}</span>, 
    group_by <span class="op">=</span> <span class="st">"replicate"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">result</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Histogram of 100 Bootstrapped Means using sparklyr"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-misc_files/figure-html/unnamed-chunk-10-1.png" width="480" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb541"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">spark_disconnect</span><span class="op">(</span><span class="va">sc</span><span class="op">)</span></code></pre></div>
<p>For our particular application, the adept reader has probably noticed that the average of a variable using <code>group_by</code> is a very quick and easy task for <code>dplyr</code>. Indeed, the use of <code>sparklyr</code> above is overkill and is presented only as a way to demonstrate using <code>sparklyr</code>. If you are working with big datasets that require large computing infrastructure, the RStudio help pages on <code>sparklyr</code> are fantastic. Additionally, there are many instances of working with <code>Spark</code> in the wild, and you might consider working through someone else’s <code>Spark</code> analysis like this <a href="https://livefreeordichotomize.com/2019/06/04/using_awk_and_r_to_parse_25tb/">fantastic example</a> on splitting up large amounts of raw DNA sequencing to get data for a given genetic location.</p>
<div class="sourceCode" id="cb542"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris_samps</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">replicate</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>result <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">Petal.Length</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">result</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Histogram of 100 Bootstrapped Means using dplyr"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-misc_files/figure-html/unnamed-chunk-11-1.png" width="480" style="display: block; margin: auto;"></div>
<p>While an introduction to parallel and cloud computing will help you become more adept and less apprehensive about using the tools, there is also a recognition that sufficient background in computer science is needed to be able to fully engage with principles of high performance computing.</p>
<div id="learn-more" class="section level4 unnumbered">
<h4>Learn more<a class="anchor" aria-label="anchor" href="#learn-more"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Hana Sevcikova <a href="https://channel9.msdn.com/Events/useR-international-R-User-conferences/useR-International-R-User-2017-Conference/Introduction-to-parallel-computing-with-R">Introduction to parallel computing with R</a> useR 2017 in Brussels, <a href="https://rawgit.com/PPgp/useR2017public/master/tutorial.html">tutorial here</a>
</li>
<li>
<code>sparklyr</code> to do <a href="https://blog.rstudio.com/2018/05/14/sparklyr-0-8/">parallel cross-validation</a>
</li>
<li>
<a href="https://www.rstudio.com/resources/cheatsheets/" class="uri">https://www.rstudio.com/resources/cheatsheets/</a>
<ul>
<li>
<a href="https://www.rstudio.com/resources/cheatsheets/#sparklyr" class="uri">https://www.rstudio.com/resources/cheatsheets/#sparklyr</a><br>
</li>
<li><a href="https://github.com/rstudio/cheatsheets/raw/master/parallel_computation.pdf" class="uri">https://github.com/rstudio/cheatsheets/raw/master/parallel_computation.pdf</a></li>
</ul>
</li>
<li>Great blog <a href="https://thecodeforest.github.io/post/two_flavors_of_parallel_simulation.html">Two Flavors of Parallel Simulation</a> by Mark LeBoeuf comparing different ways to process code in parallel.</li>
</ul>
</div>
</div>
</div>
<div id="cloud-computing" class="section level2" number="10.4">
<h2>
<span class="header-section-number">10.4</span> Cloud Computing<a class="anchor" aria-label="anchor" href="#cloud-computing"><i class="fas fa-link"></i></a>
</h2>
<p>A great overview on high performance computing (HPC) what it is and what it isn’t is given here: <a href="https://www.slideshare.net/raamana/high-performance-computing-with-checklist-and-tips-optimal-cluster-usage" class="uri">https://www.slideshare.net/raamana/high-performance-computing-with-checklist-and-tips-optimal-cluster-usage</a></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-12"></span>
<img src="figs/notHPC.png" alt="Image from Pradeep Redddy Raamana [High performance computing tutorial, with checklist and tips to optimize cluster usage](https://www.slideshare.net/raamana/high-performance-computing-with-checklist-and-tips-optimal-cluster-usage)" width="45%"><img src="figs/whenHPC.png" alt="Image from Pradeep Redddy Raamana [High performance computing tutorial, with checklist and tips to optimize cluster usage](https://www.slideshare.net/raamana/high-performance-computing-with-checklist-and-tips-optimal-cluster-usage)" width="45%"><p class="caption">
Figure 1.8: Image from Pradeep Redddy Raamana <a href="https://www.slideshare.net/raamana/high-performance-computing-with-checklist-and-tips-optimal-cluster-usage">High performance computing tutorial, with checklist and tips to optimize cluster usage</a>
</p>
</div>
<p>(The rest, below, is taken from the Teach Data Science blog: <a href="https://teachdatascience.com/cloud2/" class="uri">https://teachdatascience.com/cloud2/</a>, this entry written by Nick Horton)</p>
<p>The R package <code>parallel</code> is designed to send tasks to each of multiple cores. Today’s computers (even small laptops!) typically have multiple cores, and any server or cloud computing infrastructure can easily handle dozens or hundreds of parallel tasks. The structure of the R <code>parallel</code> implementation sends tasks to workers that don’t talk to one another until compiling their results at the end. In her <a href="https://rawgit.com/PPgp/useR2017public/master/tutorial.html">2017 UseR! tutorial</a>, Hana Sevcikova describes the function of workers which run code/functions/iterations separately before results are subsequently combined.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-13"></span>
<img src="figs/flow.png" alt="Image from Sevcikova UseR! 2017 [tutorial on parallel computing](https://rawgit.com/PPgp/useR2017public/master/tutorial.html)" width="65%"><p class="caption">
Figure 1.9: Image from Sevcikova UseR! 2017 <a href="https://rawgit.com/PPgp/useR2017public/master/tutorial.html">tutorial on parallel computing</a>
</p>
</div>
<p>As computing infrastructure becomes more sophisticated, it is important to have the language to describe how connected components work. Parallel processing allows for a conversation on the <a href="https://en.wikipedia.org/wiki/Grid_computing">differences between</a> distributed computing, cluster computing, and grid computing, and generally, the framework of high performance computing. The benefit of parallel computing as an introduction to the larger infrastructure is that the task of each worker is clear, important, and easy to describe.</p>
<p>This discussion is motivated by several recent papers and blog posts that describe how complex, real-world data science computation can be structured in ways that would not have been feasible in past years without herculean efforts. It is worth noting the <a href="https://livefreeordichotomize.com/2019/06/04/using_awk_and_r_to_parse_25tb/">fantastic example</a> that described multiple iterations needed to parse huge amounts of raw DNA sequencing data to undertake analyses for a given set of genetic locations. In <a href="https://hdsr.mitpress.mit.edu/pub/9mdn32tq">“Ambitious data science can be painless”</a> Monajemi et al. describe workflows that take advantage of new software stacks to undertake massive cloud-based experiments. While a few years older, Chamandy et al.’s <a href="https://www.tandfonline.com/doi/full/10.1080/00031305.2015.1089790">Teaching statistics at Google scale</a> described three examples where modern data challenges were overcome with creative statistical thinking (see companion report on <a href="https://ai.google/research/pubs/pub43157">Estimating uncertainty for massive data streams</a> ). Finally, the NSF-funded workshop report on <a href="https://dl.acm.org/citation.cfm?id=3233928">“Enabling computer and information science and engineering research and education in the cloud”</a> highlights opportunities as university computing migrates to cloud solutions more and more.</p>
<p>And last, you may enjoy reading the recent <a href="https://www.r-bloggers.com/three-strategies-for-working-with-big-data-in-r/">Three strategies for working with Big Data in R</a> blog post.</p>
<p>How can we prepare for cloud computing in an undergraduate course?</p>
<div id="getting-started" class="section level4 unnumbered">
<h4>Getting started<a class="anchor" aria-label="anchor" href="#getting-started"><i class="fas fa-link"></i></a>
</h4>
<p>What are the steps to exploring cloud-based systems? Each of the main cloud providers have active educational outreach programs.</p>
<ul>
<li><p><a href="https://edu.google.com/programs/faculty/?modal_active=none">Google Compute Platform</a> allows faculty to apply to receive $100 in GCP credits and $50 per student. Credits can be used in courses, student clubs, and other faculty-sponsored events. (To replicate our example later in this blog, you’ll want to set up an account and request credits.)</p></li>
<li><p><a href="https://azure.microsoft.com/en-us/education/">Azure for Education</a> provides access for educators to open source content for classes and $200 in Azure credits, plus free services.</p></li>
<li><p><a href="https://aws.amazon.com/education/awseducate/">Amazon Web Services Educate</a> provides between $75 and $200 in AWS annual credits per educator (depending on membership status) and between $30 and $100 for students.</p></li>
</ul>
<p>You should sign up and start to explore! The world of cloud computing is quickly changing. By gaining experience through investment in time in learning these tools will help instructors provide guidance to their students in use of these modern computational tools.</p>
</div>
<div id="an-example-bigquery-in-googles-gcp" class="section level4 unnumbered">
<h4>An example: BigQuery in Google’s GCP<a class="anchor" aria-label="anchor" href="#an-example-bigquery-in-googles-gcp"><i class="fas fa-link"></i></a>
</h4>
<p>Consider an example using GCP (kudos to <a href="https://www.shukryzablah.com">Shukry Zablah</a> for his assistance).</p>
<p><a href="https://cloud.google.com/bigquery/">BigQuery</a> is Google’s serverless, highly-scalable, cloud data warehouse. A <a href="https://cloud.google.com/bigquery/docs/quickstarts">quickstart</a> document is available which discusses use of the web user interface and the GCP console as well as access through an API interface. The <a href="https://github.com/r-dbi/bigrquery">bigrquery</a> package in R makes it easy to work with data stored in Google BigQuery through queries to BigQuery tables.</p>
<p>The first step is to request GCP credits (see above) and use the online interface to create a project (below called “Test Project for Blog”).</p>
<div class="sourceCode" id="cb543"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">bigrquery</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org">forcats</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb544"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">projectId</span> <span class="op">&lt;-</span> <span class="st">"bigquery-public-data"</span>  <span class="co"># replace with your own project</span>
<span class="va">billingId</span> <span class="op">&lt;-</span> <span class="st">"test-project-for-blog"</span> <span class="co"># replace with your own billing ID</span>
<span class="va">datasetName</span> <span class="op">&lt;-</span> <span class="st">"samples"</span>
<span class="va">tableName</span> <span class="op">&lt;-</span> <span class="st">"wikipedia"</span></code></pre></div>
<p>BigQuery includes a number of <a href="https://cloud.google.com/bigquery/public-data/">public datasets</a>.
Below is an analysis of the public dataset of the revisions of Wikipedia articles up to April 2010, hosted in GCP BigQuery. The size of the table is 35.69GB. The queries take only seconds to run.</p>
<div class="sourceCode" id="cb545"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">query</span> <span class="op">&lt;-</span> <span class="st">"SELECT  title, COUNT(title) as n
          FROM `bigquery-public-data.samples.wikipedia` 
          GROUP BY title
          ORDER BY n DESC
          LIMIT 500"</span></code></pre></div>
<p>For safety, always try to make sure that your queries have the <code>LIMIT</code> set on your queries.</p>
<div class="sourceCode" id="cb546"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mostRevisions_tb</span> <span class="op">&lt;-</span> 
  <span class="fu">bigrquery</span><span class="fu">::</span><span class="fu">bq_project_query</span><span class="op">(</span>x <span class="op">=</span> <span class="va">billingId</span>, 
    query <span class="op">=</span> <span class="va">query</span><span class="op">)</span> <span class="co">#creates temporary table</span></code></pre></div>
<p>When the previous <code>bq_project_query()</code> function is run within RStudio, a connection is made to Google (GCP) and an authentication window will open up in a local browser.</p>
<p>All the heavy lifting we perform is done on the database end (note that we are billed for it, though the first 1TB of accesses are free). The local machine only receives the data once we try to display it. Right now <code>mostRevisions_tb</code> is just a reference to a temporary table online. The query accessed 7GB of data.</p>
<p>We can get a copy of the data on our local machine once we are confident that it is what we want.</p>
<div class="sourceCode" id="cb547"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mostRevisions</span> <span class="op">&lt;-</span> <span class="fu">bq_table_download</span><span class="op">(</span><span class="va">mostRevisions_tb</span><span class="op">)</span> </code></pre></div>
<div class="sourceCode" id="cb548"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">mostRevisions</span><span class="op">)</span></code></pre></div>
<pre><code>## Observations: 500
## Variables: 2
## $ title &lt;chr&gt; "Wikipedia:Administrator intervention against vandalism", …
## $ n     &lt;int&gt; 643271, 419695, 326337, 257893, 226802, 204469, 191679, 18…</code></pre>
<div class="sourceCode" id="cb550"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clean</span> <span class="op">&lt;-</span> <span class="va">mostRevisions</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Wikipedia|User|Template|Talk"</span>, <span class="va">title</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op">(</span><span class="va">title</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#to sort levels</span>
  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## Observations: 272
## Variables: 2
## $ title &lt;fct&gt; George W. Bush, List of World Wrestling Entertainment empl…
## $ n     &lt;int&gt; 43652, 30572, 27433, 23245, 21768, 20814, 20546, 20529, 20…</code></pre>
<p>Let’s plot the top 10 entries.</p>
<div class="sourceCode" id="cb552"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">clean</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">title</span>, y <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Article Title"</span>,
       y <span class="op">=</span> <span class="st">"Number of Revisions"</span>,
       title <span class="op">=</span> <span class="st">"Most Revised Wikipedia Articles (Up to April 2010)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"darkblue"</span>, high <span class="op">=</span> <span class="st">"darkred"</span>, guide <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">20</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="10-misc_files/figure-html/unnamed-chunk-22-1.png" width="480" style="display: block; margin: auto;"></div>
<p>We’ve obviously just scratched the surface here. There are lots of other examples out there to consider replicating in your classroom (e.g., <a href="https://www.mikejohnpage.com/blog/returning-tweets-on-a-schedule-in-r-using-aws-ec2-rds-and-cron/">returning tweets on a schedule</a>). Hopefully you are intrigued enough to request some credits for you and your students and start to explore. Not sure where to begin? Check out the <a href="https://www.youtube.com/playlist?list=PLIivdWyY5sqKh1gDR0WpP9iIOY00IE0xL">GCP Essentials Videos</a> series.</p>
</div>
</div>
<div id="reticulate" class="section level2" number="10.5">
<h2>
<span class="header-section-number">10.5</span> <code>reticulate</code><a class="anchor" aria-label="anchor" href="#reticulate"><i class="fas fa-link"></i></a>
</h2>
<p>(Taken from the Teach Data Science blog: <a href="https://teachdatascience.com/reticulate/" class="uri">https://teachdatascience.com/reticulate/</a>)</p>
<div id="connect-to-python-within-rstudio" class="section level3 unnumbered">
<h3>Connect to Python within RStudio<a class="anchor" aria-label="anchor" href="#connect-to-python-within-rstudio"><i class="fas fa-link"></i></a>
</h3>
<p>For many statisticians, the go-to software language is R. However, there is no doubt that Python is a very important language in data science. Why not do both??</p>
<div class="sourceCode" id="cb553"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/reticulate">reticulate</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/reticulate/man/use_python.html">use_virtualenv</a></span><span class="op">(</span><span class="st">"r-reticulate"</span><span class="op">)</span>
<span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reticulate/man/import.html">import</a></span><span class="op">(</span><span class="st">"statsmodels"</span><span class="op">)</span></code></pre></div>
<pre><code>## Module(statsmodels)</code></pre>
<div id="i-can-run-python-inside-r" class="section level4 unnumbered">
<h4>I can run Python inside R??<a class="anchor" aria-label="anchor" href="#i-can-run-python-inside-r"><i class="fas fa-link"></i></a>
</h4>
<p><img src="figs/pychunk1.png" width="65%" style="display: block; margin: auto auto auto 0;"><img src="figs/pychunk2.png" width="65%" style="display: block; margin: auto 0 auto auto;"></p>
<ul>
<li>
<code>pandas</code> for data wrangling.<br>
</li>
<li>In R, the chunk is specified to be a Python chunk (RStudio is now running Python).</li>
</ul>
<pre><code>```{python}
import pandas
flights = pandas.read_csv("flights.csv")
flights = flights[flights["dest"] == "ORD"]
flights = flights[['carrier', 'dep_delay', 'arr_delay']]
flights = flights.dropna()
```</code></pre>
<p>A view of the Python chunk which is actually run:</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb556-1"><a href="misc.html#cb556-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas</span>
<span id="cb556-2"><a href="misc.html#cb556-2" aria-hidden="true" tabindex="-1"></a>flights <span class="op">=</span> pandas.read_csv(<span class="st">"flights.csv"</span>)</span>
<span id="cb556-3"><a href="misc.html#cb556-3" aria-hidden="true" tabindex="-1"></a>flights <span class="op">=</span> flights[flights[<span class="st">"dest"</span>] <span class="op">==</span> <span class="st">"ORD"</span>]</span>
<span id="cb556-4"><a href="misc.html#cb556-4" aria-hidden="true" tabindex="-1"></a>flights <span class="op">=</span> flights[[<span class="st">'carrier'</span>, <span class="st">'dep_delay'</span>, <span class="st">'arr_delay'</span>]]</span>
<span id="cb556-5"><a href="misc.html#cb556-5" aria-hidden="true" tabindex="-1"></a>flights <span class="op">=</span> flights.dropna()</span></code></pre></div>
</div>
<div id="learn-about-the-dataset" class="section level4 unnumbered">
<h4>Learn about the dataset<a class="anchor" aria-label="anchor" href="#learn-about-the-dataset"><i class="fas fa-link"></i></a>
</h4>
<pre><code>```{python}
flights.shape
flights.head(3)
flights.describe()
```</code></pre>
<div class="sourceCode" id="cb558"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb558-1"><a href="misc.html#cb558-1" aria-hidden="true" tabindex="-1"></a>flights.shape</span></code></pre></div>
<pre><code>## (12590, 3)</code></pre>
<div class="sourceCode" id="cb560"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb560-1"><a href="misc.html#cb560-1" aria-hidden="true" tabindex="-1"></a>flights.head(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##    carrier  dep_delay  arr_delay
## 4       UA       -4.0       12.0
## 5       AA       -2.0        8.0
## 22      AA       -1.0       14.0</code></pre>
<div class="sourceCode" id="cb562"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb562-1"><a href="misc.html#cb562-1" aria-hidden="true" tabindex="-1"></a>flights.describe()</span></code></pre></div>
<pre><code>##           dep_delay     arr_delay
## count  12590.000000  12590.000000
## mean      11.709770      2.917951
## std       39.409704     44.885155
## min      -20.000000    -62.000000
## 25%       -6.000000    -22.000000
## 50%       -2.000000    -10.000000
## 75%        9.000000     10.000000
## max      466.000000    448.000000</code></pre>
</div>
<div id="computations-using-pandas" class="section level4 unnumbered">
<h4>Computations using <code>pandas</code><a class="anchor" aria-label="anchor" href="#computations-using-pandas"><i class="fas fa-link"></i></a>
</h4>
<pre><code>```{python}
flights = pandas.read_csv("flights.csv")
flights = flights[['carrier', 'dep_delay', 'arr_delay']]
flights.groupby("carrier").mean()
```</code></pre>
<div class="sourceCode" id="cb565"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb565-1"><a href="misc.html#cb565-1" aria-hidden="true" tabindex="-1"></a>flights <span class="op">=</span> pandas.read_csv(<span class="st">"flights.csv"</span>)</span>
<span id="cb565-2"><a href="misc.html#cb565-2" aria-hidden="true" tabindex="-1"></a>flights <span class="op">=</span> flights[[<span class="st">'carrier'</span>, <span class="st">'dep_delay'</span>, <span class="st">'arr_delay'</span>]]</span>
<span id="cb565-3"><a href="misc.html#cb565-3" aria-hidden="true" tabindex="-1"></a>flights.groupby(<span class="st">"carrier"</span>).mean()</span></code></pre></div>
<pre><code>##          dep_delay  arr_delay
## carrier                      
## AA        8.586016   0.364291
## AS        5.804775  -9.930889
## DL        9.264505   1.644341
## UA       12.106073   3.558011
## US        3.782418   2.129595</code></pre>
</div>
<div id="from-python-chunk-to-r-chunk" class="section level4 unnumbered">
<h4>From Python chunk to R chunk<a class="anchor" aria-label="anchor" href="#from-python-chunk-to-r-chunk"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>
<code>py$x</code> accesses an <code>x</code> variable created within Python from R</li>
<li>
<code>r.x</code> accesses an <code>x</code> variable created within R from Python</li>
</ul>
<div class="sourceCode" id="cb567"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">py</span><span class="op">$</span><span class="va">flights</span>, 
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">carrier</span>, 
           y<span class="op">=</span><span class="va">arr_delay</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-misc_files/figure-html/unnamed-chunk-30-1.png" width="480" style="display: block; margin: auto;"></div>
</div>
<div id="from-r-chunk-to-python-chunk" class="section level4 unnumbered">
<h4>From R chunk to Python chunk<a class="anchor" aria-label="anchor" href="#from-r-chunk-to-python-chunk"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb568"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">diamonds</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">diamonds</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 10
##   carat cut       color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.23  Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43
## 2 0.21  Premium   E     SI1      59.8    61   326  3.89  3.84  2.31
## 3 0.23  Good      E     VS1      56.9    65   327  4.05  4.07  2.31
## 4 0.290 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63
## 5 0.31  Good      J     SI2      63.3    58   335  4.34  4.35  2.75
## 6 0.24  Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48</code></pre>
</div>
<div id="python-chunks" class="section level4 unnumbered">
<h4>Python chunks<a class="anchor" aria-label="anchor" href="#python-chunks"><i class="fas fa-link"></i></a>
</h4>
<p>Note that we’re calling Python code on an R object.</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb570-1"><a href="misc.html#cb570-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r.diamonds.describe())</span></code></pre></div>
<pre><code>##               carat         depth  ...             y             z
## count  53940.000000  53940.000000  ...  53940.000000  53940.000000
## mean       0.797940     61.749405  ...      5.734526      3.538734
## std        0.474011      1.432621  ...      1.142135      0.705699
## min        0.200000     43.000000  ...      0.000000      0.000000
## 25%        0.400000     61.000000  ...      4.720000      2.910000
## 50%        0.700000     61.800000  ...      5.710000      3.530000
## 75%        1.040000     62.500000  ...      6.540000      4.040000
## max        5.010000     79.000000  ...     58.900000     31.800000
## 
## [8 rows x 7 columns]</code></pre>
<div class="sourceCode" id="cb572"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb572-1"><a href="misc.html#cb572-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb572-2"><a href="misc.html#cb572-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> smf.ols(<span class="st">'price ~ carat'</span>, data <span class="op">=</span> r.diamonds).fit()</span>
<span id="cb572-3"><a href="misc.html#cb572-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code></pre></div>
<pre><code>##                             OLS Regression Results                            
## ==============================================================================
## Dep. Variable:                  price   R-squared:                       0.849
## Model:                            OLS   Adj. R-squared:                  0.849
## Method:                 Least Squares   F-statistic:                 3.041e+05
## Date:                Sun, 19 Jul 2020   Prob (F-statistic):               0.00
## Time:                        08:22:16   Log-Likelihood:            -4.7273e+05
## No. Observations:               53940   AIC:                         9.455e+05
## Df Residuals:                   53938   BIC:                         9.455e+05
## Df Model:                           1                                         
## Covariance Type:            nonrobust                                         
## ==============================================================================
##                  coef    std err          t      P&gt;|t|      [0.025      0.975]
## ------------------------------------------------------------------------------
## Intercept  -2256.3606     13.055   -172.830      0.000   -2281.949   -2230.772
## carat       7756.4256     14.067    551.408      0.000    7728.855    7783.996
## ==============================================================================
## Omnibus:                    14025.341   Durbin-Watson:                   0.986
## Prob(Omnibus):                  0.000   Jarque-Bera (JB):           153030.525
## Skew:                           0.939   Prob(JB):                         0.00
## Kurtosis:                      11.035   Cond. No.                         3.65
## ==============================================================================
## 
## Warnings:
## [1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
<div id="running-just-python" class="section level4 unnumbered">
<h4>Running just Python<a class="anchor" aria-label="anchor" href="#running-just-python"><i class="fas fa-link"></i></a>
</h4>
<div class="inline-figure"><img src="figs/PyScript.png" width="120%" style="display: block; margin: auto;"></div>
</div>
<div id="full-disclosure" class="section level4 unnumbered">
<h4>Full disclosure<a class="anchor" aria-label="anchor" href="#full-disclosure"><i class="fas fa-link"></i></a>
</h4>
<p><code>reticulate</code> is not always trivial to set up. Indeed, I’ve had trouble figuring out which Python version is talking to R and where different module versions live.</p>
</div>
<div id="learn-more-1" class="section level4 unnumbered">
<h4>Learn more<a class="anchor" aria-label="anchor" href="#learn-more-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li><a href="https://rstudio.github.io/reticulate/">RStudio R Interface to Python</a></li>
</ul>
<p><a href="https://rstudio.github.io/reticulate/" class="uri">https://rstudio.github.io/reticulate/</a></p>
<ul>
<li><a href="https://blog.rstudio.com/2018/10/09/rstudio-1-2-preview-reticulated-python/">RStudio blog on Reticulated Python</a></li>
</ul>
<p><a href="https://blog.rstudio.com/2018/10/09/rstudio-1-2-preview-reticulated-python" class="uri">https://blog.rstudio.com/2018/10/09/rstudio-1-2-preview-reticulated-python</a></p>
</div>
</div>
</div>
<div id="sql-in-r" class="section level2" number="10.6">
<h2>
<span class="header-section-number">10.6</span> SQL (in R)<a class="anchor" aria-label="anchor" href="#sql-in-r"><i class="fas fa-link"></i></a>
</h2>
<p>Note that there exists an R interface to work with SQL commands from within an R Markdown file. For consistency with the class notes, we’ve continued to use the R Markdown structure to demonstrate the course material.</p>
<p>(Taken from the Teach Data Science blog: <a href="https://teachdatascience.com/sql/" class="uri">https://teachdatascience.com/sql/</a>, this entry written by Nick Horton)</p>
<p>SQL (pronounced <em>sequel</em>) stands for <a href="https://en.wikipedia.org/wiki/SQL">Structured Query Language</a>; it is a language designed to manage data in a relational database system.</p>
<p>We will use a public facing MySQL <a href="http://www.science.smith.edu/wai-database/home/about">database</a> containing wideband acoustic immittance (WAI) measures made on normal ears of adults. (The project is funded by the National Institutes of Health, NIDCD, and hosted on a server at Smith College, <a href="https://projectreporter.nih.gov/project_info_description.cfm?aid=8769352&amp;icde=44962011&amp;ddparam=&amp;ddvalue=&amp;ddsub=&amp;cr=46&amp;csb=default&amp;cs=ASC&amp;pball=">PI Susan Voss, R15 DC014129-01</a>.) The database was created to enable auditory researchers to share WAI measurements and combine analyses over multiple datasets.</p>
<p>We begin by demonstrating how SQL queries can be sent to a database. It is necessary to set up a connection using the <code>dbConnect()</code> function.</p>
<div class="sourceCode" id="cb574"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ProjectMOSAIC/mosaic">mosaic</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://downloads.mariadb.org/connector-c/">RMySQL</a></span><span class="op">)</span>  
<span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">dbConnect</span><span class="op">(</span>
  <span class="fu">RMySQL</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RMySQL/man/MySQLDriver-class.html">MySQL</a></span><span class="op">(</span><span class="op">)</span>, host <span class="op">=</span> <span class="st">"scidb.smith.edu"</span>, user <span class="op">=</span> <span class="st">"waiuser"</span>, 
  password <span class="op">=</span> <span class="st">"smith_waiDB"</span>, dbname <span class="op">=</span> <span class="st">"wai"</span><span class="op">)</span></code></pre></div>
<p>Next a series of SQL queries can be sent to the database using the <code><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html">DBI::dbGetQuery()</a></code> function: each query returns an R dataframe.</p>
<div class="sourceCode" id="cb575"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="fu">dbGetQuery</span><span class="op">(</span><span class="va">con</span>, <span class="st">"SHOW TABLES"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "data.frame"</code></pre>
<p>There are multiple tables within the <code>wai</code> database.</p>
<div class="sourceCode" id="cb577"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">dbGetQuery</span><span class="op">(</span><span class="va">con</span>, <span class="st">"SHOW TABLES"</span><span class="op">)</span></code></pre></div>
<pre><code>##       Tables_in_wai
## 1          Codebook
## 2      Measurements
## 3 Measurements_2020
## 4           PI_Info
## 5       PI_Info_OLD
## 6           Subject
## 7     Subjects_2020</code></pre>
<p>The <code>EXPLAIN</code> command describes the ten field names (variables) in the <code>PI_Info</code> table.</p>
<div class="sourceCode" id="cb579"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">dbGetQuery</span><span class="op">(</span><span class="va">con</span>, <span class="st">"EXPLAIN PI_Info"</span><span class="op">)</span></code></pre></div>
<pre><code>##                 Field        Type Null Key Default Extra
## 1          Identifier varchar(50)   NO PRI    &lt;NA&gt;      
## 2                Year     int(11)   NO        &lt;NA&gt;      
## 3             Authors        text   NO        &lt;NA&gt;      
## 4    AuthorsShortList        text   NO        &lt;NA&gt;      
## 5               Title        text   NO        &lt;NA&gt;      
## 6             Journal        text   NO        &lt;NA&gt;      
## 7                 URL        text   NO        &lt;NA&gt;      
## 8            Abstract        text   NO        &lt;NA&gt;      
## 9   DataSubmitterName        text   NO        &lt;NA&gt;      
## 10 DataSubmitterEmail        text   NO        &lt;NA&gt;      
## 11      DateSubmitted        text   NO        &lt;NA&gt;      
## 12           PI_Notes        text   NO        &lt;NA&gt;</code></pre>
<p>The <code>SELECT</code> statement can be used to select all fields for eight observations in the <code>Measurements</code> table.</p>
<div class="sourceCode" id="cb581"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">eightobs</span> <span class="op">&lt;-</span> <span class="fu">dbGetQuery</span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT * FROM Measurements LIMIT 8"</span><span class="op">)</span>
<span class="va">eightobs</span></code></pre></div>
<pre><code>##   Identifier Sub_Number Session Left_Ear MEP Instrument    Freq Absorbance
## 1  Abur_2014          1       1        0  -5          1 210.938  0.0451375
## 2  Abur_2014          1       1        0  -5          1 234.375  0.0441247
## 3  Abur_2014          1       1        0  -5          1 257.812  0.0495935
## 4  Abur_2014          1       1        0  -5          1 281.250  0.0516088
## 5  Abur_2014          1       1        0  -5          1 304.688  0.0590836
## 6  Abur_2014          1       1        0  -5          1 328.125  0.0628038
## 7  Abur_2014          1       1        0  -5          1 351.562  0.0682962
## 8  Abur_2014          1       1        0  -5          1 375.000  0.0738373
##        Zmag      Zang Canal_Area
## 1 110638000 -0.228113         NA
## 2 100482000 -0.230561         NA
## 3  90561100 -0.230213         NA
## 4  83515500 -0.230959         NA
## 5  77476800 -0.229652         NA
## 6  71229100 -0.230026         NA
## 7  66615500 -0.229576         NA
## 8  61996200 -0.229327         NA</code></pre>
<p>More interesting and complicated <code>SELECT</code> calls can be used to undertake grouping and aggregation. Here we calculate the sample size for each study</p>
<div class="sourceCode" id="cb583"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">dbGetQuery</span><span class="op">(</span><span class="va">con</span>, 
  <span class="st">"SELECT Identifier, count(*) AS NUM FROM Measurements GROUP BY Identifier ORDER BY NUM"</span><span class="op">)</span></code></pre></div>
<pre><code>##       Identifier    NUM
## 1       Sun_2016   2604
## 2    Shaver_2013   2880
## 3    Feeney_2017   3162
## 4      Voss_1994   5120
## 5       Liu_2008   5520
## 6    Werner_2010   7935
## 7  Rosowski_2012  14384
## 8      Voss_2010  14880
## 9      Abur_2014  21328
## 10    Groon_2015  35469
## 11  Shahnaz_2006  58776
## 12    Lewis_2015 114716</code></pre>
<div id="accessing-a-database-using-dplyr-commands" class="section level4 unnumbered">
<h4>Accessing a database using <code>dplyr</code> commands<a class="anchor" aria-label="anchor" href="#accessing-a-database-using-dplyr-commands"><i class="fas fa-link"></i></a>
</h4>
<p>Alternatively, a connection can be made to the server by creating a series of <code>dplyr</code> tbl
objects. Connecting with familiar <code>dplyr</code> syntax is attractive because, as <a href="https://dbplyr.tidyverse.org/articles/dbplyr.html">Hadley Wickham</a> has noted, SQL and R have similar syntax (but sufficiently different to be confusing).</p>
<p>The setup process looks similar.</p>
<div class="sourceCode" id="cb585"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Measurements</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"Measurements"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">Measurements</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "tbl_MySQLConnection" "tbl_dbi"             "tbl_sql"            
## [4] "tbl_lazy"            "tbl"</code></pre>
<div class="sourceCode" id="cb587"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PI_Info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"PI_Info"</span><span class="op">)</span>
<span class="va">Subject</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"Subject"</span><span class="op">)</span></code></pre></div>
<p>We explore the <code>PI_Info</code> table using the <code><a href="https://dplyr.tidyverse.org/reference/compute.html">collect()</a></code> function used to force computation on the database (and return the results). One attractive aspect of database systems is that they feature <a href="https://en.wikipedia.org/wiki/Lazy_evaluation"><em>lazy evaluation</em></a>, where computation is optimized and postponed as long as possible.</p>
<div class="sourceCode" id="cb588"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PI_Info</span>  <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>total <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # Source:   lazy query [?? x 1]
## # Database: mysql 5.5.58-0ubuntu0.14.04.1-log [waiuser@scidb.smith.edu:/wai]
##   total
##   &lt;dbl&gt;
## 1    12</code></pre>
<div class="sourceCode" id="cb590"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PI_Info</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span>   </code></pre></div>
<pre><code>##       Identifier Year
## 1      Abur_2014 2014
## 2    Feeney_2017 2017
## 3     Groon_2015 2015
## 4     Lewis_2015 2015
## 5       Liu_2008 2008
## 6  Rosowski_2012 2012
## 7   Shahnaz_2006 2006
## 8    Shaver_2013 2013
## 9       Sun_2016 2016
## 10     Voss_1994 1994
## 11     Voss_2010 2010
## 12   Werner_2010 2010
##                                                                                                                                          Authors
## 1                                                                                              Defne Abur, Nicholas J. Horton, and Susan E. Voss
## 2   M. Patrick Feeney,  Douglas H. Keefe, Lisa L. Hunter,  Denis F. Fitzpatrick, Angela C. Garinis, Daniel B. Putterman, and Garnett P. McMillan
## 3                                               Katherine A. Groon, Daniel M. Rasetshwane, Judy G. Kopun, Michael P. Gorga, and Stephen T. Neely
## 4                                                                                                            James D. Lewis and Stephen T. Neely
## 5                                  Yi-Wen Liu, Chris A. Sanford,  John C. Ellison, Denis F. Fitzpatrick,  Michael P. Gorga, and Douglas H. Keefe
## 6  John J. Rosowski, Hideko H. Nakajima, Mohamad A. Hamade, Lorice Mahfoud, Gabrielle R. Merchant, Christopher F. Halpin, and Saumil N. Merchant
## 7                                                                                                                   Navid Shahnaz and Karin Bork
## 8                                                                                                               Mark D. Shaver and Xiao-Ming Sun
## 9                                                                                                                                  Xiao-Ming Sun
## 10                                                                                                               Susan E. Voss and Jont B. Allen
## 11                               Susan E. Voss, Modupe F. Adegoke, Nicholas J. Horton, Kevin N. Sheth, Jonathan Rosand, and Christopher A. Shera
## 12                                                                                          Lynne A. Werner, Ellen C. Levi, and Douglas H. Keefe
##    AuthorsShortList
## 1       Abur et al.
## 2     Feeney et al.
## 3      Groon et al.
## 4   Lewis and Neely
## 5        Liu et al.
## 6   Rosowski et al.
## 7  Shahnaz and Bork
## 8    Shaver and Sun
## 9               Sun
## 10   Voss and Allen
## 11      Voss et al.
## 12    Werner et al.
##                                                                                                                                     Title
## 1                                                                                          Instrasubject variability in power reflectance
## 2       Normative wideband reflectance, equivalent admittance at the tympanic membrane, and acoustic stapedius reflex threshold in adults
## 3                                                                                       Air-leak effects on ear-canal acoustic absorbance
## 4                                                                    Non-invasive estimation of middle-ear input impedance and efficiency
## 5                    Wideband absorbance tympanometry using pressure sweeps: System development and results on adults with normal hearing
## 6                                                         Ear-canal reflectance, umbo velocity, and tympanometry in normal-hearing adults
## 7                                                                       Wideband reflectance norms for caucasian and chinese young adults
## 8  Wideband energy reflectance measurements: Effects of negative middle ear pressure and application of a pressure compensation procedure
## 9                       Wideband acoustic immittance: Normative study and test-retest reliability of tympanometric measurements in adults
## 10                                                               Measurement of acoustic impedance and reflectance in the human ear canal
## 11                                                               Posture systematically alters ear-canal reflectance and DPOAE properties
## 12                                            Ear-canal wideband acoustic transfer functions of adults and two- to nine-month-old infants
##                   Journal
## 1        J Am Acad Audiol
## 2                Ear Hear
## 3                Ear Hear
## 4         J Acoust Soc Am
## 5         J Acoust Soc Am
## 6                Ear Hear
## 7                Ear Hear
## 8         J Acoust Soc Am
## 9  J Speech Lang Hear Res
## 10        J Acoust Soc Am
## 11               Hear Res
## 12               Ear Hear
##                                                                                                                   URL
## 1                                                                        https://www.ncbi.nlm.nih.gov/pubmed/25257718
## 2                                                                        https://www.ncbi.nlm.nih.gov/pubmed/28045835
## 3  https://journals.lww.com/ear-hearing/fulltext/2015/01000/Air_Leak_Effects_on_Ear_Canal_Acoustic_Absorbance.16.aspx
## 4                                                                 https://asa.scitation.org/doi/abs/10.1121/1.4927408
## 5                                                                        https://www.ncbi.nlm.nih.gov/pubmed/19206798
## 6                                                                         http://www.ncbi.nlm.nih.gov/pubmed/21857517
## 7        http://journals.lww.com/ear-hearing/Abstract/2006/12000/Wideband_Reflectance_Norms_for_Caucasian_and.15.aspx
## 8                                                            "\nhttps://asa.scitation.org/doi/full/10.1121/1.4807509"
## 9                                                                        https://www.ncbi.nlm.nih.gov/pubmed/27517667
## 10                                                                 https://asa.scitation.org/doi/abs/10.1121/1.408329
## 11                                                                       https://www.ncbi.nlm.nih.gov/pubmed/20227475
## 12                                                                       https://www.ncbi.nlm.nih.gov/pubmed/20517155
##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Abstract
## 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         "&lt;p&gt; &lt;strong&gt; Background: &lt;/strong&gt; Power reflectance measurements are an active area of research related to the development of noninvasive middle-ear assessment methods. There are limited data related to test-retest measures of power reflectance. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; Purpose: &lt;/strong&gt; This study investigates test-retest features of power reflectance, including comparisons of intrasubject versus intersubject variability and how ear-canal measurement location affects measurements. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; Research design: &lt;/strong&gt; Repeated measurements of power reflectance were made at about weekly intervals. The subjects returned for four to eight sessions. Measurements were made at three ear-canal locations: a deep insertion depth (with a foam plug flush at the entrance to the ear canal) and both 3 and 6 mm more lateral to this deep insertion. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; Study sample:&lt;/strong&gt; Repeated measurements on seven subjects are reported. All subjects were female, between 19 and 22 yr old, and enrolled at an undergraduate women's college. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; Data collection and analysis: &lt;/strong&gt; Measurements on both the right and left ears were made at three ear-canal locations during each of four to eight measurement sessions. Random-effects regression models were used for the analysis to account for repeated measures within subjects. The mean power reflectance for each position over all sessions was calculated for each subject. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; Results: &lt;/strong&gt; The comparison of power reflectance from the left and right ears of an individual subject varied greatly over the seven subjects; the difference between the power reflectance measured on the left and that measured on the right was compared at 248 frequencies, and depending on the subject, the percentage of tested frequencies for which the left and right ears differed significantly ranged from 10% to 93% (some with left values greater than right values and others with the opposite pattern). Although the individual subjects showed left-right differences, the overall population generally did not show significant differences between the left and right ears. The mean power reflectance for each measurement position over all sessions depended on the location of the probe in the ear for frequencies of less than 1000 Hz. The standard deviation between subjects' mean power reflectance after controlling for ear (left or right) was found to be greater than the standard deviation within the individual subject's mean power reflectance. The intrasubject standard deviation in power reflectance was smallest at the deepest insertion depths. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; Conclusions: &lt;/strong&gt;  All subjects had differences in power reflectance between their left and right ears at some frequencies; the percentage of frequencies at which differences occurred varied greatly across subjects. The intrasubject standard deviations were smallest for the deepest probe insertion depths, suggesting clinical measurements should be made with as deep an insertion as practically possible to minimize variability. This deep insertion will reduce both acoustic leaks and the effect of low-frequency ear-canal losses. The within-subject standard deviations were about half the magnitude of the overall standard deviations, quantifying the extent of intrasubject versus intersubject variability. &lt;/p&gt;"
## 2  "&lt;p&gt; &lt;strong&gt; Objectives: &lt;/strong&gt; Wideband acoustic immittance (WAI) measures such as\npressure reflectance, parameterized by absorbance and group delay,\nequivalent admittance at the tympanic membrane (TM), and acoustic\nstapedius reflex threshold (ASRT) describe middle ear function across a\nwide frequency range, compared with traditional tests employing a single\nfrequency. The objective of this study was to obtain normative data\nusing these tests for a group of normal-hearing adults and investigate\ntest-retest reliability using a longitudinal design. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; Design: &lt;/strong&gt; A longitudinal prospective design was used to obtain normative\ntest and retest data on clinical and WAI measures. Subjects were 13\nmales and 20 females (mean age = 26 years). Inclusion criteria included\nnormal audiometry and clinical immittance. Subjects were tested on two\nseparate visits approximately 1 month apart. Reflectance and equivalent\nadmittance at the TM were measured from 0.25 to 8.0 kHz under\nthree conditions: at ambient pressure in the ear canal and with pressure\nsweeps from positive to negative pressure (downswept) and negative to\npositive pressure (upswept). Equivalent admittance at the TM was calculated\nusing admittance measurements at the probe tip that were adjusted\nusing a model of sound transmission in the ear canal and acoustic estimates\nof ear-canal area and length. Wideband ASRTs were measured\nat tympanometric peak pressure (TPP) derived from the average TPP\nof downswept and upswept tympanograms. Descriptive statistics were\nobtained for all WAI responses, and wideband and clinical ASRTs were\ncompared. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; Results: &lt;/strong&gt; Mean absorbance at ambient pressure and TPP demonstrated\na broad band-pass pattern typical of previous studies. Test-retest differences\nwere lower for absorbance at TPP for the downswept method\ncompared with ambient pressure at frequencies between 1.0 and\n1.26 kHz. Mean tympanometric peak-to-tail differences for absorbance\nwere greatest around 1.0 to 2.0 kHz and similar for positive and negative\ntails. Mean group delay at ambient pressure and at TPP were greatest\nbetween 0.32 and 0.6 kHz at 200 to 300 &amp;mu;sec, reduced at frequencies\nbetween 0.8 and 1.5 kHz, and increased above 1.5 kHz to around 150\n&amp;mu;sec. Mean equivalent admittance at the TM had a lower level for the\nambient method than at TPP for both sweep directions below 1.2 kHz,\nbut the difference between methods was only statistically significant for\nthe comparison between the ambient method and TPP for the upswept\ntympanogram. Mean equivalent admittance phase was positive at all frequencies.\nTest-retest reliability of the equivalent admittance level ranged\nfrom 1 to 3 dB at frequencies below 1.0 kHz, but increased to 8 to 9\ndB at higher frequencies. The mean wideband ASRT for an ipsilateral\nbroadband noise activator was 12 dB lower than the clinical ASRT, but\nhad poorer reliability. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; Conclusions: &lt;/strong&gt;  Normative data for the WAI test battery revealed minor\ndifferences for results at ambient pressure compared with tympanometric methods at TPP for reflectance, group delay, and equivalent\nadmittance level at the TM for subjects with middle ear pressure within\n&amp;plusmn;100 daPa. Test-retest reliability was better for absorbance at TPP for\nthe downswept tympanogram compared with ambient pressure at frequencies\naround 1.0 kHz. Large peak-to-tail differences in absorbance\ncombined with good reliability at frequencies between about 0.7 and\n3.0 kHz suggest that this may be a sensitive frequency range for interpreting\nabsorbance at TPP. The mean wideband ipsilateral ASRT was\nlower than the clinical ASRT, consistent with previous studies. Results\nare promising for the use of a wideband test battery to evaluate middle\near function. &lt;/p&gt;\n&lt;p&gt; &lt;strong&gt; Key words: &lt;/strong&gt; Absorbed sound power, Acoustic stapedius reflex threshold,\nReflectance, Test-retest reliability, Wideband acoustic immittance. &lt;/p&gt;"
## 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   "&lt;p&gt; &lt;strong&gt; Objective: &lt;/strong&gt; Accurate ear-canal acoustic measurements, such as wideband\nacoustic admittance, absorbance, and otoacoustic emissions,\nrequire that the measurement probe be tightly sealed in the ear canal.\nAir leaks can compromise the validity of the measurements, interfere\nwith calibrations, and increase variability. There are no established procedures\nfor determining the presence of air leaks or criteria for what size\nleak would affect the accuracy of ear-canal acoustic measurements. The\npurpose of this study was to determine ways to quantify the effects of air\nleaks and to develop objective criteria to detect their presence. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; Design: &lt;/strong&gt; Air leaks were simulated by modifying the foam tips that are\nused with the measurement probe through insertion of thin plastic\ntubing. To analyze the effect of air leaks, acoustic measurements were\ntaken with both modified and unmodified foam tips in brass-tube cavities\nand human ear canals. Measurements were initially made in cavities\nto determine the range of critical leaks. Subsequently, data were collected\nin ears of 21 adults with normal hearing and normal middle-ear\nfunction. Four acoustic metrics were used for predicting the presence of\nair leaks and for quantifying these leaks: (1) low-frequency admittance\nphase (averaged over 0.1-0.2 kHz), (2) low-frequency absorbance, (3)\nthe ratio of compliance volume to physical volume (CV/PV), and (4) the\nair-leak resonance frequency. The outcome variable in this analysis was\nthe absorbance change (&amp;Delta;absorbance), which was calculated in eight\nfrequency bands. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; Results: &lt;/strong&gt; The trends were similar for both the brass cavities and the ear\ncanals. &amp;Delta;Absorbance generally increased with air-leak size and was largest\nfor the lower frequency bands (0.1-0.2 and 0.2-0.5 kHz). Air-leak\neffects were observed in frequencies up to 10 kHz, but their effects above\n1 kHz were unpredictable. These high-frequency air leaks were larger in\nbrass cavities than in ear canals. Each of the four predictor variables\nexhibited consistent dependence on air-leak size. Low-frequency admittance\nphase and CV/PV decreased, while low-frequency absorbance and\nthe air-leak resonance frequency increased. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; Conclusion: &lt;/strong&gt;  The effect of air leaks can be significant when their equivalent\ndiameter exceeds 0.01 in. The observed effects were greatest at low frequencies\nwhere air leaks caused absorbance to increase. Recommended\ncriteria for detecting air leaks include the following: when the frequency\nrange of interest extends as low as 0.1 kHz, low-frequency absorbance\nshould be &amp;#8804;0.20 and low-frequency admittance phase &amp;#8805;61 degrees. For\nfrequency ranges as low as 0.2 kHz, low-frequency absorbance should\nbe &amp;#8804;0.29 and low-frequency admittance phase &amp;#8805;44 degrees. &lt;/p&gt;"
## 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "&lt;p&gt; A method to transform the impedance measured in the ear canal, &lt;i&gt;Z&lt;sub&gt;EC&lt;/sub&gt;&lt;/i&gt;, to the plane of the eardrum,\n&lt;i&gt;Z&lt;sub&gt;ED&lt;/sub&gt;&lt;/i&gt;, is described. The portion of the canal between the probe and eardrum was modeled as a concatenated\nseries of conical segments, allowing for spatial variations in its cross-sectional area. A\nmodel of the middle ear (ME) and cochlea terminated the ear-canal model, which permitted estimation\nof ME efficiency. Acoustic measurements of &lt;i&gt;Z&lt;sub&gt;EC&lt;/sub&gt;&lt;/i&gt; were made at two probe locations in 15\nnormal-hearing subjects. &lt;i&gt;Z&lt;sub&gt;EC&lt;/sub&gt;&lt;/i&gt; was sensitive to measurement location, especially near frequencies of\ncanal resonances and anti-resonances. Transforming &lt;i&gt;Z&lt;sub&gt;EC&lt;/sub&gt;&lt;/i&gt; to &lt;i&gt;Z&lt;sub&gt;ED&lt;/sub&gt;&lt;/i&gt; reduced the influence of the canal,\ndecreasing insertion-depth sensitivity of &lt;i&gt;Z&lt;sub&gt;ED&lt;/sub&gt;&lt;/i&gt; between 1 and 12 kHz compared to &lt;i&gt;Z&lt;sub&gt;EC&lt;/sub&gt;&lt;/i&gt;. Absorbance,\nA, was less sensitive to probe placement than &lt;i&gt;Z&lt;sub&gt;EC&lt;/sub&gt;&lt;/i&gt;, but more sensitive than &lt;i&gt;Z&lt;sub&gt;ED&lt;/sub&gt;&lt;/i&gt; above 5 kHz. &lt;i&gt;Z&lt;sub&gt;ED&lt;/sub&gt;&lt;/i&gt;\nand A were similarly insensitive to probe placement between 1 and 5 kHz. The probe-placement\nsensitivity of &lt;i&gt;Z&lt;sub&gt;ED&lt;/sub&gt;&lt;/i&gt; below 1 kHz was not reduced from that of either A or &lt;i&gt;Z&lt;sub&gt;EC&lt;/sub&gt;&lt;/i&gt;. ME efficiency had a\nbandpass shape with greatest efficiency between 1 and 4 kHz. Estimates of &lt;i&gt;Z&lt;sub&gt;ED&lt;/sub&gt;&lt;/i&gt; and ME efficiency\ncould extend the diagnostic capability of wideband-acoustic immittance measurements.&lt;/p&gt;"
## 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "&lt;p&gt; A system with potential for middle-ear screening and diagnostic testing was developed for the\nmeasurement of wideband energy absorbance (EA) in the ear canal as a function of air pressure, and\ntested on adults with normal hearing. Using a click stimulus, the EA was measured at 60 frequencies\nbetween 0.226 and 8 kHz. Ambient-pressure results were similar to past studies. To perform\ntympanometry, air pressure in the ear canal was controlled automatically to sweep between &amp;#x2212;300\nand 200 daPa (ascending/descending directions) using sweep speeds of approximately 75, 100, 200,\nand 400 daPa/ s. Thus, the measurement time for wideband tympanometry ranged from 1.5 to 7 s\nand was suitable for clinical applications. A bandpass tympanogram, calculated for each ear by\nfrequency averaging EA from 0.38 to 2 kHz, had a single-peak shape; however, its tympanometric\npeak pressure (TPP) shifted as a function of sweep speed and direction. EA estimated at the TPP was\nsimilar across different sweep speeds, but was higher below 2 kHz than EA measured at ambient\npressure. Future studies of EA on normal ears of a different age group or on impaired ears may be\ncompared with the adult normal baseline obtained in this study.&lt;/p&gt;"
## 6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              "&lt;p&gt; &lt;strong&gt; Objective: &lt;/strong&gt; This study compares measurements of ear-canal reflectance\n(ECR) to other objective measurements of middle ear function including\naudiometry, umbo velocity (&lt;i&gt;V&lt;sub&gt;U&lt;/sub&gt;&lt;/i&gt;), and tympanometry in a population of\nstrictly defined normal-hearing ears. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; Design: &lt;/strong&gt; Data were prospectively gathered from 58 ears of 29 normalhearing\nsubjects, 16 females and 13 males, aged 22 to 64 yr. Subjects\nmet all of the following criteria to be considered as having normal\nhearing: (1) no history of significant middle ear disease; (2) no history\nof otologic surgery; (3) normal tympanic membrane on otoscopy; (4)\npure-tone audiometric thresholds of 20 dB HL or better for 0.25 to 8\nkHz; (5) air-bone gaps no greater than 15 dB at 0.25 kHz and 10 dB for\n0.5 to 4 kHz; (6) normal, type-A peaked tympanograms; and (7) all\nsubjects had two ""normal"" ears (as defined by these criteria). Measurements\nincluded pure-tone audiometry for 0.25 to 8 kHz, standard\n226 Hz tympanometry, ECR for 0.2 to 6 kHz at 60 dB SPL using the\nMimosa Acoustics HearID system, and umbo velocity (&lt;i&gt;V&lt;sub&gt;U&lt;/sub&gt;&lt;/i&gt;) for 0.3 to\n6 kHz at 70 to 90 dB SPL using the HLV-1000 laser Doppler\nvibrometer (Polytec Inc). &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; Results: &lt;/strong&gt; Mean power reflectance (|ECR|&lt;sup&gt;2&lt;/sup&gt;) was near 1.0 at 0.2 to 0.3 kHz,\ndecreased to a broad minimum of 0.3 to 0.4 between 1 and 4 kHz, and\nthen sharply increased to almost 0.8 by 6 kHz. The mean pressure\nreflectance phase angle (&amp;#8736;ECR) plotted on a linear frequency scale\nshowed a group delay of approximately 0.1 msec for 0.2 to 6 kHz. Small\nsignificant differences were observed in |ECR|&lt;sup&gt;2&lt;/sup&gt; at the lowest frequencies\nbetween right and left ears and between males and females at 4 kHz.\n|ECR|&lt;sup&gt;2&lt;/sup&gt; decreased with age but reached significance only at 1 kHz. Our\nECR measurements were generally similar to previous published reports.\nHighly significant negative correlations were found between\n|ECR|&lt;sup&gt;2&lt;/sup&gt; and &lt;i&gt;V&lt;sub&gt;U&lt;/sub&gt;&lt;/i&gt; for frequencies below 1 kHz. Significant correlations were\nalso found between the tympanometrically determined peak total\ncompliance and |ECR|&lt;sup&gt;2&lt;/sup&gt; and &lt;i&gt;V&lt;sub&gt;U&lt;/sub&gt;&lt;/i&gt; at frequencies below 1 kHz. The results\nsuggest that middle ear compliance contributes significantly to the\nmeasured power reflectance and umbo velocity at frequencies below 1\nkHz but not at higher frequencies. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; Conclusions: &lt;/strong&gt;  This study has established a database of objective\nmeasurements of middle ear function (ECR, umbo velocity, tympanometry)\nin a population of strictly defined normal-hearing ears. These data\nwill promote our understanding of normal middle ear function and will\nserve as a control for comparison to similar measurements made in\npathological ears. &lt;/p&gt;"
## 7                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "&lt;document&gt; &lt;p&gt; &lt;strong&gt; &lt;i&gt; Objective: &lt;/i&gt; &lt;/strong&gt; This study examined differences between\nthe middle ears of two ethnic groups, Caucasian\nand Chinese young adults with normal hearing,\nusing a new middle-ear measurement technique,\nwideband energy reflectance. The goal of this study\nwas to determine whether the Chinese group had\ndifferent middle-ear transmission properties than\nthe Caucasian group. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; &lt;i&gt; Design: &lt;/i&gt; &lt;/strong&gt; There were 126 subjects (237 ears) between\nthe ages of 18 and 32 yr, with 62 subjects in the\nCaucasian group and 64 subjects in the Chinese\ngroup. Wideband energy reflectance data were gathered\nusing Mimosa Acoustics (RMS system version\n4.0.4.4) wideband reflectance (WBR) equipment. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; &lt;i&gt; Results: &lt;/i&gt; &lt;/strong&gt; The Chinese group had significantly lower\nwideband energy reflectance than their Caucasian\ncounterparts at higher frequencies; however, the\nCaucasian group had significantly lower energy reflectance\nat lower frequencies than the Chinese\ngroup. The Chinese group also had significantly\nlower admittance magnitude than the Caucasian\ngroup at lower frequencies. Because body size indices\nare more comparable between Caucasian females and\nChinese males, the effect of body size could be potentially\nadjusted for by comparing the Caucasian female\nsubjects with the Chinese male subjects. The\ndifferences observed between the Caucasian and the\nChinese groups were no longer significant when the\nCaucasian female subjects were compared with the\nChinese male subjects. Applying the Caucasian norms\nto four Caucasian adults with surgically confirmed\notosclerosis resulted in an improved hit rate compared\nwith the combined Caucasian and Chinese\nnorms and the Chinese-only norms. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; &lt;i&gt; Conclusions: &lt;/i&gt; &lt;/strong&gt;  Body size may play a role in the observed\ndifferences between the Caucasian and Chinese\ngroups. The findings of this study suggest that\nfurther research is needed to investigate the effects\nof body size on wideband energy reflectance. It\nshould be noted that factors other than body size\nmay contribute to the observed differences. Chinese\nindividuals may simply have different middle-ear\ncharacteristics than Caucasian individuals, which\ncould affect WBR. In the meantime, overall test\nperformance may be improved by using a more homogeneous norm when evaluating the middle ear\nof Caucasian or Chinese individuals with WBR. &lt;/p&gt;\n&lt;p&gt;&lt;small&gt;(Ear &amp; Hearing 2006;27;774-788)&lt;/small&gt;&lt;/p&gt; &lt;/document&gt;"
## 8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               "&lt;p&gt; The wideband energy reflectance (ER) technique has become popular as a tool for evaluating middle\near function. Negative middle ear pressure (MEP) is a prevalent form of middle ear dysfunction,\nwhich may impact application of ER measurements in differential diagnosis. A negative MEP may\nbe countervailed by application of an equivalent negative ear canal pressure. The present study\nexamined ER in the same ears under normal and experimentally induced negative MEP conditions.\nThirty-five subjects produced at least one negative MEP each (&amp;#x2212;40 to &amp;#x2212;225 daPa). Negative MEP\nsignificantly altered ER in a frequency-specific manner that varied with MEP magnitude. ER\nincreased for low- to mid-frequencies with the largest change (~0.20 to 0.40) occurring between 1\nand 1.5 kHz. ER decreased for frequencies above 3 kHz with the largest change (~&amp;#x2212;0.10 to &amp;#x2212;0.25)\nobserved between 4.5 and 5.5 kHz. Magnitude of changes increased as MEP became more negative,\nas did the frequencies at which maximum changes occurred, and the frequency at which enhancement\ntransitioned to reduction. Ear canal pressure compensation restored ER to near baseline values.\nThis suggests that the compensation procedure adequately mitigates the effects of negative\nMEP on ER. Theoretical issues and clinical implications are discussed.&lt;/p&gt;"
## 9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "Purpose: The purpose of this study was to present normative data of tympanometric measurements of wideband acoustic immittance and to characterize wideband tympanograms.\n\nMethod: Data were collected in 84 young adults with strictly defined normal hearing and middle ear status. Energy absorbance (EA) was measured using clicks for 1/12-octave frequencies (0.236 to 8 kHz), with the ear canal air pressure systematically varied (+200 to -300 daPa). In 40 ears, 7 consecutive trials and a trial of clinical 226-Hz acoustic admittance (Ya) tympanometry followed. A cavity test was also conducted.\n\nResults: From the wideband EA tympanogram, several EA spectrums and EA tympanograms were derived. Descriptive statistics were performed, and population parameters were estimated. The immediate test-retest reliability was excellent. Effects of ear canal air pressure on EA were examined comprehensively. Differences in EA between tympanometric and ambient-pressure measurements were significant. Single-frequency EA tympanograms exemplified for half-octave frequencies were contrasted. The bandpass EA tympanogram, 0.236- and 1-kHz EA and Ya tympanograms, and 226-Hz Ya tympanogram were compared in 9 variables.\n\nConclusions: This study established a database of wideband tympanograms in healthy adults. The data analyses will promote our understanding of the middle ear transfer function. These data will serve as a reference for further studies in clinical populations."
## 10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               "&lt;p&gt; The pressure reflectance &lt;i&gt;R (&amp;omega;)&lt;/i&gt; is the transfer function which may be defined for a linear one-port\nnetwork by the ratio of the reflected complex pressure divided by the incident complex pressure.\nThe reflectance is a function that is closely related to the impedance of the 1-port. The energy\nreflectance &lt;i&gt;&amp;#8475;(&amp;omega;)&lt;/i&gt; is defined as &lt;i&gt; |R|&lt;sup&gt;2&lt;/sup&gt;&lt;/i&gt;. It represents the ratio of reflected to incident energy. In the\nhuman ear canal the energy reflectance is important because it is a measure of the inefficiency of\nthe middle ear and cochlea, and because of the insight provided by its simple frequency domain\ninterpretation. One may characterize the ear canal impedance by use of the pressure reflectance\nand its magnitude, sidestepping the difficult problems of (a) the unknown canal length from the\nmeasurement point to the eardrum, (b) the complicated geometry of the drum, and (c) the\ncross-sectional area changes in the canal as a function of distance. Reported here are acoustic\nimpedancem easurements looking into the ear canal, measured on ten young adults with normal \nhearing (ages 18-24). The measurement point in the canal was approximately 0.85 cm from the\nentrance of the canal. From these measurements, the pressure reflectance in the canal is\ncomputed and impedance and reflectance measurements from 0.1 to 15.0 kHz are compared\namong ears. The average reflectance and the standard deviation of the reflectance for the ten\nsubjects have been determined. The impedance and reflectance of two common ear simulators,\nthe Br&amp;uuml;el &amp; Kjaer 4157 and the Industrial Research Products DB-100 (Zwislocki) coupler are\nalso measured and compared to the average human measurements. All measurements are made\nusing controls that assure a uniform accuracy in the acoustic calibration across subjects. This is\ndone by the use of two standard acoustic resistors whose impedances are known. From the\nexperimental results, it is concluded that there is significant subject variability in the magnitude\nof the reflectance for the ten ear canals. This variability is believed to be due to cochlear and\nmiddle ear impedance differences. An attempt was made at modeling the reflectance but, as\ndiscussed in the paper, several problems presently stand in the way of these models. Such models\nwould be useful for acoustic virtual-reality systems and for active noise control earphones.&lt;/p&gt;"
## 11                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               "&lt;p&gt; Several studies have demonstrated that the auditory system is sensitive to changes in posture, presumably\nthrough changes in intracranial pressure (ICP) that in turn alter the intracochlear pressure, which\naffects the stiffness of the middle-ear system. This observation has led to efforts to develop an ear-canal\nbased noninvasive diagnostic measure for monitoring ICP, which is currently monitored invasively via\naccess through the skull or spine. Here, we demonstrate the effects of postural changes, and presumably\nICP changes, on distortion product otoacoustic emissions (DPOAE) magnitude, DPOAE angle, and power\nreflectance. Measurements were made on 12 normal-hearing subjects in two postural positions: upright\nat 90&amp;#176; and tilted at -45&amp;#176; to the horizontal. Measurements on each subject were repeated five times across\nfive separate measurement sessions. All three measures showed significant changes (&lt;i&gt;p&lt;/i&gt; &lt; 0.001) between\nupright and tilted for frequencies between 500 and 2000 Hz, and DPOAE angle changes were significant\nat all measured frequencies (500-4000 Hz). Intra-subject variability, assessed via standard deviations for\neach subject's multiple measurements, were generally smaller in the upright position relative to the\ntilted position.&lt;/p&gt;"
## 12                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "&lt;p&gt; &lt;strong&gt; Objectives: &lt;/strong&gt; Wideband acoustic transfer functions (WATF) measured in\nthe ear canal have been shown to be effective in the diagnosis of middle\near dysfunction in adults and in newborn infants. Although these\nmeasures would be diagnostically useful in older infants, normative data\non a large number of older infants are lacking. The goal of this study\nwas to provide such normative data. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; Design: &lt;/strong&gt; The WATF of 458 infants aged 2 to 9 mos and of 210 adults\nwere obtained. Wideband reactance (X), resistance (R), and energy\nreflectance (ER) were measured in third-octave bands between 250 and\n8000 Hz. The effects of age and gender on the WATF were examined,\nand the WATF in the left and right ears were compared. Test-retest\nreliability was assessed, and the relationship between the 226-Hz\ntympanogram and the WATF was examined. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; Results: &lt;/strong&gt; The results agreed well with previous reports testing fewer\nsubjects, which documented age-related change in these measures\nduring infancy and between infancy and adulthood. Test-retest correlations\nwithin third octaves were 0.5 to 0.7 at best, but did not vary\nsystematically with age. Infants' test-retest absolute differences within\nthird octaves for R and ER were similar to those of adults. The shape of\nthe WATF on retest was highly repeatable, and the shapes of the WATF\nin the ears of the same individual were qualitatively similar. The\nwideband impedance results were not different in the left and right ears,\nbut ER was slightly, but significantly, lower in the left ear than that in the\nright ear. Resistance and reactance magnitude were greater for females\nthan males, but there was no effect of gender on ER. Infants whose\n226-Hz tympanogram indicated reduced peak admittance (Types As and\nB) had greater resistance and reactance magnitude than those with\nnormal peak admittance (Types A and C), but no tympanometry group\ndifferences were evident in ER. &lt;/p&gt;\n\n&lt;p&gt; &lt;strong&gt; Conclusions: &lt;/strong&gt;  Age-graded norms are essential to the successful clinical\napplication of WATF. However, the effects of gender and laterality on the\nWATF are small.&lt;/p&gt;"
##                      DataSubmitterName
## 1                           Susan Voss
## 2  M. Patrick Feeney; Douglas H. Keefe
## 3                          Steve Neely
## 4                          James Lewis
## 5                        Douglas Keefe
## 6                        John Rosowski
## 7                        Navid Shahnaz
## 8                        Xiao-Ming Sun
## 9                        Xiao-Ming Sun
## 10                          Susan Voss
## 11                          Susan Voss
## 12                       Douglas Keefe
##                                   DataSubmitterEmail DateSubmitted
## 1                                    svoss@smith.edu       8/24/16
## 2  Patrick.Feeney@va.gov; Douglas.Keefe@boystown.org        6/7/18
## 3                         Stephen.Neely@boystown.org       6/18/19
## 4                                  jdlewis@uthsc.edu      10/10/18
## 5                         Douglas.Keefe@boystown.org       6/26/18
## 6                     John_Rosowski@meei.harvard.edu       11/6/15
## 7                        nshahnaz@audiospeech.ubc.ca       8/24/16
## 8                          xiao-ming.sun@wichita.edu       10/6/18
## 9                          xiao-ming.sun@wichita.edu      10/31/17
## 10                                   svoss@smith.edu        2/8/17
## 11                                   svoss@smith.edu        6/5/18
## 12                        Douglas.Keefe@boystown.org        9/1/17
##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         PI_Notes
## 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Measurements made on 7 subjects across multiple sessions and 3 probe locations for each subject.  Database includes measurements at only the deepest insertion depth (Position 1) and Channel B only.
## 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Database includes measurements on 32 subjects, most with left and right ears and most with two sessions.  Each session includes WAI measurements at ambient ear canal, and the ear canal pressurized to TPP, negative tail pressure (-300 daPa) and positive tail pressure (200 daPa) with both "Downswept" and "Upswept" conditions.  Ear-canal areas used to calculate absorbance were estimated acoustically and are listed for the ambient and TPP measurements.  Impedance measurements at the probe location are only available for the ambient ear-canal pressure measurements and are "NULL" for the pressurized canal measurements.
## 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             Data collected on system described in Rasetshwane and Neely (2011)
## 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               "Custom system ER10B+ used for measurement of ear canal impedance designed by Dr. J. H. Siegel at Northwestern University.\n\nEar canal areas were estimated from the surge impedance.\n\nImpedance was measured at 2 insertion depths (deep - session 1, shallow - session 2)."
## 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
## 6  "HearID (Mimosa Acoustics); \nNormal Criteria as follows: \n(1) There was no history of significant middle ear disease (e.g., otitis media or effusion 2 or more years previously were not considered significant if there were no known residual consequences).\n(2) There was no history of otologic surgery, with the exception of myringotomy or tympanostomy tube placement over 2 yr prior. \n(3) The external ear and TM revealed no abnormalities on otoscopic examination. \n(4) Audiometric measurements had pure-tone thresholds of 20 dB HL or better at octave frequen- cies between 0.250 and 8 kHz. \n(5) Air-bone gaps were no greater than 15 dB at 0.25 kHz and 10 dB between frequencies of 0.5 to 4 kHz. Most subjects had air and bone thresholds between 0 and 10 dB HL with an average near 8 to 9 dB HL at the highest frequencies. \n(6) Tympanograms were Type-A peaked, with peak pressures of 100 to 50 daPa, static compliance of 0.3 to 2.0 cc, total tympanometric volumes (static compliance ear canal volume) between 0.7 and 2.7 cc, and normal-appearing shape that is neither rounded nor sharp. \n(7) All subjects included in the ""normal hearing"" population were required to have two ""normal"" ears (as defined by criteria described earlier). "
## 7                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
## 8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         A research version of Titan (Interacoustics) was used. In this study, a total of five reflectance measurements at ambient pressure were taken per ear (detailed in the article).  Included in this database is the baseline session, defined as C in the paper, as the normative data.
## 9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
## 10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
## 11                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
## 12                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Used an ER-1 earphone and ER-7C microphone.  Data provided by Doug Keefe and formatted by Susan Voss with help.  Lynne Werner is retired.</code></pre>
<div class="sourceCode" id="cb592"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># be careful with collect() when dealing with large tables!</span></code></pre></div>
<p>Note how the number of rows is unknown (<code>??</code> at the top of the output above) for the lazy query.</p>
<p>Similarly, we can explore the <code>Subjects</code> table.</p>
<div class="sourceCode" id="cb593"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Subject</span>  <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>total <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # Source:   lazy query [?? x 1]
## # Database: mysql 5.5.58-0ubuntu0.14.04.1-log [waiuser@scidb.smith.edu:/wai]
##   total
##   &lt;dbl&gt;
## 1   640</code></pre>
<div class="sourceCode" id="cb595"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Subject</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># be careful with collect() with large tables!</span></code></pre></div>
<pre><code>## # A tibble: 640 x 10
##    Identifier Sub_Number Session_Total   Age Female  Race Ethnicity
##    &lt;chr&gt;      &lt;chr&gt;              &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt;     &lt;int&gt;
##  1 Voss_2010  1                      5    20      1     0         0
##  2 Voss_2010  2                      5    39      1     0         0
##  3 Voss_2010  3                      5    18      1     0         0
##  4 Voss_2010  4                      5    19      1     0         0
##  5 Voss_2010  5                      5    21      1     0         0
##  6 Voss_2010  6                      5    21      1     0         0
##  7 Voss_2010  7                      5    21      1     0         0
##  8 Voss_2010  8                      5    42      1     0         0
##  9 Voss_2010  9                      5    38      0     0         0
## 10 Voss_2010  10                     5    20      1     0         0
## # … with 630 more rows, and 3 more variables: Left_Ear_Status &lt;int&gt;,
## #   Right_Ear_Status &lt;int&gt;, Sub_Notes &lt;chr&gt;</code></pre>
<p>Let’s explore the <code>Measurements</code> table.</p>
<div class="sourceCode" id="cb597"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Measurements</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>total <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # Source:   lazy query [?? x 1]
## # Database: mysql 5.5.58-0ubuntu0.14.04.1-log [waiuser@scidb.smith.edu:/wai]
##    total
##    &lt;dbl&gt;
## 1 286774</code></pre>
<p>There are more than a quarter million observations.</p>
<p>In the next step, we will download the data from a given subject for a specific study, in this case a paper by Rosowski et al. (2012) entitled <a href="https://www.ncbi.nlm.nih.gov/pubmed/21857517">“Ear-canal reflectance, umbo velocity, and tympanometry in normal-hearing adults”</a>.</p>
<p>Arbitrarily we choose to collect data from subject number three.</p>
<div class="sourceCode" id="cb599"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">onesubj</span> <span class="op">&lt;-</span> 
  <span class="va">Measurements</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Identifier</span> <span class="op">==</span> <span class="st">"Rosowski_2012"</span>, <span class="va">Sub_Number</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="va">collect</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>SessionNum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">Session</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">onesubj</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 12
##   Identifier Sub_Number Session Left_Ear   MEP Instrument  Freq Absorbance
##   &lt;chr&gt;           &lt;int&gt;   &lt;int&gt;    &lt;int&gt; &lt;dbl&gt;      &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt;
## 1 Rosowski_…          3       1        1    NA          1  211.     0.0852
## 2 Rosowski_…          3       1        1    NA          1  234.     0.0903
## 3 Rosowski_…          3       1        1    NA          1  258.     0.112 
## 4 Rosowski_…          3       1        1    NA          1  281.     0.103 
## 5 Rosowski_…          3       1        1    NA          1  305.     0.129 
## 6 Rosowski_…          3       1        1    NA          1  328.     0.136 
## # … with 4 more variables: Zmag &lt;dbl&gt;, Zang &lt;dbl&gt;, Canal_Area &lt;dbl&gt;,
## #   SessionNum &lt;fct&gt;</code></pre>
<p>Finally we can display the results of the measurements as a function of frequency and which ear (left or right) that was used.</p>
<div class="sourceCode" id="cb601"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">onesubj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">onesubj</span>, Ear <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">Left_Ear</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"Left"</span>, <span class="st">"Right"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">onesubj</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Freq</span>, y <span class="op">=</span> <span class="va">Absorbance</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">Ear</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Absorbance by ear Rosowski subject 3"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-misc_files/figure-html/unnamed-chunk-46-1.png" width="480" style="display: block; margin: auto;"></div>
<p>Always a good idea to terminate the SQL connection.</p>
<div class="sourceCode" id="cb602"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">dbDisconnect</span><span class="op">(</span><span class="va">con</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>We note that a number of relational database systems exist, including MySQL (illustrated here), PostgreSQL, and SQLite. More information about databases within R can be found in the CRAN <a href="https://cran.r-project.org/web/views/Databases.html">Databases with R</a> Task View.</p>
<p>Setting up and managing a database is a topic for a different day: here we focused on how SQL can be used within R to access data in a flexible and powerful manner.</p>
</div>
<div id="learn-more-2" class="section level4 unnumbered">
<h4>Learn more<a class="anchor" aria-label="anchor" href="#learn-more-2"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>
<a href="https://chance.amstat.org/2015/04/setting-the-stage/" class="uri">https://chance.amstat.org/2015/04/setting-the-stage/</a> (Setting the stage for data technologies)</li>
<li>
<a href="https://www.w3schools.com/sql/sql_intro.asp" class="uri">https://www.w3schools.com/sql/sql_intro.asp</a> (Intro to SQL)</li>
<li>
<a href="http://www.science.smith.edu/wai-database/home/about/" class="uri">http://www.science.smith.edu/wai-database/home/about/</a> (WAI SQL Database)</li>
<li>
<a href="https://cran.r-project.org/web/views/Databases.html" class="uri">https://cran.r-project.org/web/views/Databases.html</a> (CRAN Task View on Databases with R)</li>
<li>
<a href="https://db.rstudio.com" class="uri">https://db.rstudio.com</a> (RStudio Database resources)</li>
<li>
<a href="https://dbplyr.tidyverse.org/articles/dbplyr.html" class="uri">https://dbplyr.tidyverse.org/articles/dbplyr.html</a> (dbplyr package)</li>
</ul>
</div>
</div>
<div id="Dec10" class="section level2" number="10.7">
<h2>
<span class="header-section-number">10.7</span> 12/10/19 Agenda<a class="anchor" aria-label="anchor" href="#Dec10"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li>Regular Expressions</li>
<li>
<em>Computational</em> and <em>Statistics</em>
</li>
</ol>
</div>
<div id="regexpr" class="section level2" number="10.8">
<h2>
<span class="header-section-number">10.8</span> Regular Expressions<a class="anchor" aria-label="anchor" href="#regexpr"><i class="fas fa-link"></i></a>
</h2>
<blockquote>
<p>A regular expression … is a sequence of characters that define a search pattern. Usually such patterns are used by string searching algorithms for “find” or “find and replace” operations on strings, or for input validation. It is a technique developed in theoretical computer science and formal language theory. [From <a href="https://en.wikipedia.org/wiki/Regular_expression" class="uri">https://en.wikipedia.org/wiki/Regular_expression</a>]</p>
</blockquote>
<div id="main-tasks-in-character-matching" class="section level4 unnumbered">
<h4>Main tasks in character matching:<a class="anchor" aria-label="anchor" href="#main-tasks-in-character-matching"><i class="fas fa-link"></i></a>
</h4>
<ol style="list-style-type: decimal">
<li>basic string operations</li>
<li>pattern matching (regular expressions)</li>
<li>sentiment analysis</li>
</ol>
<p>The ideas below are mostly taken from Jenny Bryan’s STAT545 class: <a href="https://github.com/STAT545-UBC/STAT545-UBC-original-website/blob/master/block022_regular-expression.rmd" class="uri">https://github.com/STAT545-UBC/STAT545-UBC-original-website/blob/master/block022_regular-expression.rmd</a></p>
</div>
<div id="r-packages-to-make-your-life-easier" class="section level4 unnumbered">
<h4>R packages to make your life easier<a class="anchor" aria-label="anchor" href="#r-packages-to-make-your-life-easier"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>
<a href="https://stringr.tidyverse.org/"><code>stringr</code> package</a> A core package in the <code>tidyverse</code>. It is installed via <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("tidyverse")</a></code> and also loaded via <code><a href="https://tidyverse.tidyverse.org">library(tidyverse)</a></code>. Of course, you can also install or load it individually.
<ul>
<li>Many of the main functions start with <code>str_</code>. Auto-complete is your friend.</li>
<li>Replacements for base functions re: string manipulation and regular expressions (see below).</li>
<li>Main advantages over base functions: greater consistency about inputs and outputs. Outputs are more ready for your next analytical task.</li>
<li>
<code>stringr</code> cheat sheet: <a href="https://github.com/rstudio/cheatsheets/raw/master/strings.pdf" class="uri">https://github.com/rstudio/cheatsheets/raw/master/strings.pdf</a>
</li>
</ul>
</li>
<li>
<a href="https://tidyr.tidyverse.org/"><code>tidyr</code> package</a> Especially useful for functions that split one character vector into many and vice versa: <code>separate()</code>, <code>unite()</code>, <code>extract()</code>.</li>
<li>Base functions: <code><a href="https://rdrr.io/r/base/nchar.html">nchar()</a></code>, <code><a href="https://rdrr.io/r/base/strsplit.html">strsplit()</a></code>, <code><a href="https://rdrr.io/r/base/substr.html">substr()</a></code>, <code><a href="https://rdrr.io/r/base/paste.html">paste()</a></code>, <code><a href="https://rdrr.io/r/base/paste.html">paste0()</a></code>.</li>
<li>The <code>glue</code> package is fantastic for string interpolation. If <code><a href="https://stringr.tidyverse.org/reference/str_interp.html">stringr::str_interp()</a></code> doesn’t get your job done, check out the <code>glue</code> package.</li>
</ul>
</div>
<div id="string-functions-related-to-regular-expression" class="section level4 unnumbered">
<h4>String functions related to regular expression<a class="anchor" aria-label="anchor" href="#string-functions-related-to-regular-expression"><i class="fas fa-link"></i></a>
</h4>
<p>Regular expression is a pattern that describes a specific set of strings with a common structure. It is heavily used for string matching / replacing in all programming languages, although specific syntax may differ a bit. It is truly the heart and soul for string operations. In R, many string functions in <code>base</code> R as well as in <code>stringr</code> package use regular expressions, even Rstudio’s search and replace allows regular expression:</p>
<ul>
<li>identify match to a pattern: <code><a href="https://rdrr.io/r/base/grep.html">grep(..., value = FALSE)</a></code>, <code><a href="https://rdrr.io/r/base/grep.html">grepl()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/str_detect.html">stringr::str_detect()</a></code>
</li>
<li>extract match to a pattern: <code><a href="https://rdrr.io/r/base/grep.html">grep(..., value = TRUE)</a></code>, <code><a href="https://stringr.tidyverse.org/reference/str_extract.html">stringr::str_extract()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/str_extract.html">stringr::str_extract_all()</a></code><br>
</li>
<li>locate pattern within a string, i.e. give the start position of matched patterns. <code><a href="https://rdrr.io/r/base/grep.html">regexpr()</a></code>, <code><a href="https://rdrr.io/r/base/grep.html">gregexpr()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/str_locate.html">stringr::str_locate()</a></code>, <code>string::str_locate_all()</code><br>
</li>
<li>replace a pattern: <code><a href="https://rdrr.io/r/base/grep.html">sub()</a></code>, <code><a href="https://rdrr.io/r/base/grep.html">gsub()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/str_replace.html">stringr::str_replace()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/str_replace.html">stringr::str_replace_all()</a></code><br>
</li>
<li>split a string using a pattern: <code><a href="https://rdrr.io/r/base/strsplit.html">strsplit()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/str_split.html">stringr::str_split()</a></code>
</li>
</ul>
<p>Regular expressions typically specify characters (or character classes) to seek out, possibly with information about repeats and location within the string. This is accomplished with the help of metacharacters that have specific meaning: <code>$ * + . ? [ ] ^ { } | ( ) \</code>. We will use some small examples to introduce regular expression syntax and what these metacharacters mean.</p>
</div>
<div id="escape-sequences" class="section level4 unnumbered">
<h4>Escape sequences<a class="anchor" aria-label="anchor" href="#escape-sequences"><i class="fas fa-link"></i></a>
</h4>
<p>There are some special characters in R that cannot be directly coded in a string. For example, let’s say you specify your pattern with single quotes and you want to find countries with the single quote <code>'</code>. You would have to “escape” the single quote in the pattern, by preceding it with <code>\</code>, so it is clear that it is not part of the string-specifying machinery.</p>
<p>There are other characters in R that require escaping, and this rule applies to all string functions in R, including regular expressions. See <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/Quotes.html">here</a> for a complete list of R escape sequences.</p>
<ul>
<li>
<code>\'</code>: single quote. You don’t need to escape single quote inside a double-quoted string, so we can also use <code>"'"</code> in the previous example.<br>
</li>
<li>
<code>\"</code>: double quote. Similarly, double quotes can be used inside a single-quoted string, i.e. <code>'"'</code>.<br>
</li>
<li>
<code>\n</code>: newline.<br>
</li>
<li>
<code>\r</code>: carriage return.<br>
</li>
<li>
<code>\t</code>: tab character.</li>
</ul>
<blockquote>
<p>Note: <code><a href="https://rdrr.io/r/base/cat.html">cat()</a></code> and <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> handle escape sequences differently, if you want to print a string out with these sequences interpreted, use <code><a href="https://rdrr.io/r/base/cat.html">cat()</a></code>.</p>
</blockquote>
<div class="sourceCode" id="cb604"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"a\nb"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "a\nb"</code></pre>
<div class="sourceCode" id="cb606"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"a\nb"</span><span class="op">)</span></code></pre></div>
<pre><code>## a
## b</code></pre>
</div>
<div id="quantifiers" class="section level4 unnumbered">
<h4>Quantifiers<a class="anchor" aria-label="anchor" href="#quantifiers"><i class="fas fa-link"></i></a>
</h4>
<p>Quantifiers specify how many repetitions of the pattern.</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/Arithmetic.html">*</a></code>: matches at least 0 times.<br>
</li>
<li>
<code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>: matches at least 1 times.<br>
</li>
<li>
<code><a href="https://rdrr.io/r/utils/Question.html">?</a></code>: matches at most 1 times.<br>
</li>
<li>
<code>{n}</code>: matches exactly n times.<br>
</li>
<li>
<code>{n,}</code>: matches at least n times.<br>
</li>
<li>
<code>{n,m}</code>: matches between n and m times.</li>
</ul>
<div class="sourceCode" id="cb608"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">strings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"ab"</span>, <span class="st">"acb"</span>, <span class="st">"accb"</span>, <span class="st">"acccb"</span>, <span class="st">"accccb"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "a"      "ab"     "acb"    "accb"   "acccb"  "accccb"</code></pre>
<div class="sourceCode" id="cb610"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"ac*b"</span>, <span class="va">strings</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "ab"     "acb"    "accb"   "acccb"  "accccb"</code></pre>
<div class="sourceCode" id="cb612"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"ac*b"</span>, <span class="va">strings</span>, value <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2 3 4 5 6</code></pre>
<div class="sourceCode" id="cb614"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"ac+b"</span>, <span class="va">strings</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "acb"    "accb"   "acccb"  "accccb"</code></pre>
<div class="sourceCode" id="cb616"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"ac?b"</span>, <span class="va">strings</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "ab"  "acb"</code></pre>
<div class="sourceCode" id="cb618"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"ac{2}b"</span>, <span class="va">strings</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "accb"</code></pre>
<div class="sourceCode" id="cb620"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"ac{2}b"</span>, <span class="va">strings</span>, value <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb622"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"ac{2,}b"</span>, <span class="va">strings</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "accb"   "acccb"  "accccb"</code></pre>
<div class="sourceCode" id="cb624"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"ac{2,3}b"</span>, <span class="va">strings</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "accb"  "acccb"</code></pre>
</div>
<div id="position-of-pattern-within-the-string" class="section level4 unnumbered">
<h4>Position of pattern within the string<a class="anchor" aria-label="anchor" href="#position-of-pattern-within-the-string"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/Arithmetic.html">^</a></code>: matches the start of the string.<br>
</li>
<li>
<code><a href="https://rdrr.io/r/base/Extract.html">$</a></code>: matches the end of the string.<br>
</li>
<li>
<code>\b</code>: matches the empty string at either edge of a <em>word</em>. Don’t confuse it with <code>^ $</code> which marks the edge of a <em>string</em>.<br>
</li>
<li>
<code>\B</code>: matches the empty string provided it is not at an edge of a word.</li>
</ul>
<div class="sourceCode" id="cb626"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">strings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"abcd"</span>, <span class="st">"cdab"</span>, <span class="st">"cabd"</span>, <span class="st">"c abd"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "abcd"  "cdab"  "cabd"  "c abd"</code></pre>
<div class="sourceCode" id="cb628"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"ab"</span>, <span class="va">strings</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "abcd"  "cdab"  "cabd"  "c abd"</code></pre>
<div class="sourceCode" id="cb630"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"^ab"</span>, <span class="va">strings</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "abcd"</code></pre>
<div class="sourceCode" id="cb632"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"ab$"</span>, <span class="va">strings</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "cdab"</code></pre>
<div class="sourceCode" id="cb634"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"\\bab"</span>, <span class="va">strings</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "abcd"  "c abd"</code></pre>
</div>
<div id="operators" class="section level4 unnumbered">
<h4>Operators<a class="anchor" aria-label="anchor" href="#operators"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>
<code>.</code>: matches any single character, as shown in the first example.</li>
<li>
<code>[...]</code>: a character list, matches any one of the characters inside the square brackets. We can also use <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code> inside the brackets to specify a range of characters.<br>
</li>
<li>
<code>[^...]</code>: an inverted character list, similar to <code>[...]</code>, but matches any characters <strong>except</strong> those inside the square brackets.<br>
</li>
<li>
<code>\</code>: suppress the special meaning of metacharacters in regular expression, i.e. <code>$ * + . ? [ ] ^ { } | ( ) \</code>, similar to its usage in escape sequences. Since <code>\</code> itself needs to be escaped in R, we need to escape these metacharacters with double backslash like <code>\\$</code>.<br>
</li>
<li>
<code><a href="https://rdrr.io/r/base/Logic.html">|</a></code>: an “or” operator, matches patterns on either side of the <code><a href="https://rdrr.io/r/base/Logic.html">|</a></code>.<br>
</li>
<li>
<code>(...)</code>: grouping in regular expressions. This allows you to retrieve the bits that matched various parts of your regular expression so you can alter them or use them for building up a new string. Each group can than be refer using <code>\\N</code>, with N being the No. of <code>(...)</code> used. This is called <strong>backreference</strong>.</li>
</ul>
<div class="sourceCode" id="cb636"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">strings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"^ab"</span>, <span class="st">"ab"</span>, <span class="st">"abc"</span>, <span class="st">"abd"</span>, <span class="st">"abe"</span>, <span class="st">"ab 12"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "^ab"   "ab"    "abc"   "abd"   "abe"   "ab 12"</code></pre>
<div class="sourceCode" id="cb638"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"ab."</span>, <span class="va">strings</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "abc"   "abd"   "abe"   "ab 12"</code></pre>
<div class="sourceCode" id="cb640"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"ab[c-e]"</span>, <span class="va">strings</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "abc" "abd" "abe"</code></pre>
<div class="sourceCode" id="cb642"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"ab[^c]"</span>, <span class="va">strings</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "abd"   "abe"   "ab 12"</code></pre>
<div class="sourceCode" id="cb644"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"^ab"</span>, <span class="va">strings</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "ab"    "abc"   "abd"   "abe"   "ab 12"</code></pre>
<div class="sourceCode" id="cb646"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"\\^ab"</span>, <span class="va">strings</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "^ab"</code></pre>
<div class="sourceCode" id="cb648"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"abc|abd"</span>, <span class="va">strings</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "abc" "abd"</code></pre>
<div class="sourceCode" id="cb650"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"(ab) 12"</span>, <span class="st">"\\1 34"</span>, <span class="va">strings</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "^ab"   "ab"    "abc"   "abd"   "abe"   "ab 34"</code></pre>
</div>
<div id="character-classes" class="section level4 unnumbered">
<h4>Character classes<a class="anchor" aria-label="anchor" href="#character-classes"><i class="fas fa-link"></i></a>
</h4>
<p>Character classes allow specifying entire classes of characters, such as numbers, letters, etc. There are two flavors of character classes, one uses <code>[:</code> and <code>:]</code> around a predefined name inside square brackets and the other uses <code>\</code> and a special character. They are sometimes interchangeable.</p>
<ul>
<li>
<code>[:digit:]</code> or <code>\d</code>: digits, 0 1 2 3 4 5 6 7 8 9, equivalent to <code>[0-9]</code>.<br>
</li>
<li>
<code>\D</code>: non-digits, equivalent to <code>[^0-9]</code>.<br>
</li>
<li>
<code>[:lower:]</code>: lower-case letters, equivalent to <code>[a-z]</code>.<br>
</li>
<li>
<code>[:upper:]</code>: upper-case letters, equivalent to <code>[A-Z]</code>.<br>
</li>
<li>
<code>[:alpha:]</code>: alphabetic characters, equivalent to <code>[[:lower:][:upper:]]</code> or <code>[A-z]</code>.<br>
</li>
<li>
<code>[:alnum:]</code>: alphanumeric characters, equivalent to <code>[[:alpha:][:digit:]]</code> or <code>[A-z0-9]</code>.<br>
</li>
<li>
<code>\w</code>: word characters, equivalent to <code>[[:alnum:]_]</code> or <code>[A-z0-9_]</code>.<br>
</li>
<li>
<code>\W</code>: not word, equivalent to <code>[^A-z0-9_]</code>.<br>
</li>
<li>
<code>[:xdigit:]</code>: hexadecimal digits (base 16), 0 1 2 3 4 5 6 7 8 9 A B C D E F a b c d e f, equivalent to <code>[0-9A-Fa-f]</code>.</li>
<li>
<code>[:blank:]</code>: blank characters, i.e. space and tab.<br>
</li>
<li>
<code>[:space:]</code>: space characters: tab, newline, vertical tab, form feed, carriage return, space.</li>
<li>
<code>\s</code>: space, <code></code>.<br>
</li>
<li>
<code>\S</code>: not space.<br>
</li>
<li>
<code>[:punct:]</code>: punctuation characters, ! " # $ % &amp; ’ ( ) * + , - . / : ; &lt; = &gt; ? @ [  ] ^ _ ` { | } ~.</li>
<li>
<code>[:graph:]</code>: graphical (human readable) characters: equivalent to <code>[[:alnum:][:punct:]]</code>.</li>
<li>
<code>[:print:]</code>: printable characters, equivalent to <code>[[:alnum:][:punct:]\\s]</code>.</li>
<li>
<code>[:cntrl:]</code>: control characters, like <code>\n</code> or <code>\r</code>, <code>[\x00-\x1F\x7F]</code>.</li>
</ul>
<p>Note:<br>
* <code>[:...:]</code> has to be used inside square brackets, e.g. <code>[[:digit:]]</code>.<br>
* <code>\</code> itself is a special character that needs escape, e.g. <code>\\d</code>. Do not confuse these regular expressions with R escape sequences such as <code>\t</code>.</p>
</div>
<div id="stringr" class="section level4 unnumbered">
<h4>
<code>stringr</code><a class="anchor" aria-label="anchor" href="#stringr"><i class="fas fa-link"></i></a>
</h4>
<p>In many cases, you will want to use the incredibly useful and tidy set of functions available in the <code>stringr</code> package. (<code>stringr</code> is a core package in the <code>tidyverse</code>.) For example, below we’ve extracted the first (and then last) word as a character string from the <code>StreetName</code> variable.</p>
<ul>
<li>
<code>stringr</code> cheat sheet: <a href="https://github.com/rstudio/cheatsheets/raw/master/strings.pdf" class="uri">https://github.com/rstudio/cheatsheets/raw/master/strings.pdf</a>
</li>
</ul>
<div class="sourceCode" id="cb652"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">Stat2Data</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">RailsTrails</span><span class="op">)</span>
<span class="va">RailsTrails</span> <span class="op">&lt;-</span> <span class="va">RailsTrails</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">HouseNum</span>, <span class="va">Bedrooms</span>, <span class="va">Price2014</span>, <span class="va">StreetName</span><span class="op">)</span> 
<span class="va">RailsTrails</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##   HouseNum Bedrooms Price2014      StreetName
## 1        1        3   210.729 Acrebrook Drive
## 2        2        3   204.171       Autumn Dr
## 3        3        3   338.662     Bridge Road
## 4        4        3   276.250     Bridge Road
## 5        5        4   169.173     Bridge Road
## 6        6        3   211.487 Brierwood Drive</code></pre>
<div class="sourceCode" id="cb654"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">RailsTrails</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>first_piece <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/word.html">word</a></span><span class="op">(</span><span class="va">StreetName</span>, start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##   HouseNum Bedrooms Price2014      StreetName first_piece
## 1        1        3   210.729 Acrebrook Drive   Acrebrook
## 2        2        3   204.171       Autumn Dr      Autumn
## 3        3        3   338.662     Bridge Road      Bridge
## 4        4        3   276.250     Bridge Road      Bridge
## 5        5        4   169.173     Bridge Road      Bridge
## 6        6        3   211.487 Brierwood Drive   Brierwood</code></pre>
<div class="sourceCode" id="cb656"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">RailsTrails</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>last_piece <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/word.html">word</a></span><span class="op">(</span><span class="va">StreetName</span>, start <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##   HouseNum Bedrooms Price2014      StreetName last_piece
## 1        1        3   210.729 Acrebrook Drive      Drive
## 2        2        3   204.171       Autumn Dr         Dr
## 3        3        3   338.662     Bridge Road       Road
## 4        4        3   276.250     Bridge Road       Road
## 5        5        4   169.173     Bridge Road       Road
## 6        6        3   211.487 Brierwood Drive      Drive</code></pre>
</div>
<div id="an-example-from-my-work" class="section level4 unnumbered">
<h4>An example from my work<a class="anchor" aria-label="anchor" href="#an-example-from-my-work"><i class="fas fa-link"></i></a>
</h4>
<p>Below are a handful of string characters that represent genomic sequences which were measured in an RNA Sequencing dataset. The task below is to find intergenic regions (IGR) and identify which coding sequences (CDS) bookend the intergenic regions. Note that IGRs do not code for proteins while CDSs do. Additionally, AS refers to anti-sense which identifies the genomic sequence in the opposite orientation (e.g., CGGATCC vs CCTAGGC). [The code below was written by Madison Hobbs, Scripps ’19.]</p>
<div id="the-names-of-the-genomic-pieces" class="section level5 unnumbered">
<h5>The names of the genomic pieces<a class="anchor" aria-label="anchor" href="#the-names-of-the-genomic-pieces"><i class="fas fa-link"></i></a>
</h5>
<div class="sourceCode" id="cb658"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">allCounts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Geneid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CDS:b2743:pcm:L-isoaspartate_protein_carboxylmethyltransferase_type_II:cds2705:-:626:NC_000913.3"</span>,
            <span class="st">"CDS:b2764:cysJ:sulfite_reductase2C_alpha_subunit2C_flavoprotein:cds2726:-:1799:NC_000913.3"</span>,
            <span class="st">"IGR:(CDS,b1594,mlc,glucosamine_anaerobic_growth_regulon_transcriptional_repressor3B_autorepressor,cds1581,-,1220/CDS,b1595,ynfL,LysR_family_putative_transcriptional_regulator,cds1582,-,893):+:945:NC_000913.3"</span>,
            <span class="st">"AS_IGR:(CDS,b0008,talB,transaldolase_B,cds7,+,953/CDS,b0009,mog,molybdochelatase_incorporating_molybdenum_into_molybdopterin,cds8,+,587):+:639:NC_000913.3"</span>,
            <span class="st">"IGR:(CDS,b1808,yoaA,putative_ATP-dependent_helicase2C_DinG_family,cds1798,-,1910/CDS,b1809,yoaB,putative_reactive_intermediate_deaminase,cds1799,+,344):+:396:NC_000913.3"</span><span class="op">)</span><span class="op">)</span>

<span class="va">allCounts</span><span class="op">$</span><span class="va">GeneidBackup</span> <span class="op">=</span> <span class="va">allCounts</span><span class="op">$</span><span class="va">Geneid</span></code></pre></div>
<p>First, it is important to identify which are IGR, CDS, and anti-sense.</p>
<div class="sourceCode" id="cb659"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">allCounts</span> <span class="op">&lt;-</span> <span class="va">allCounts</span> <span class="op">%&gt;%</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">Geneid</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"feature"</span>, <span class="st">"rest"</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">"[:]"</span><span class="op">)</span>
<span class="va">allCounts</span></code></pre></div>
<pre><code>##   feature
## 1     CDS
## 2     CDS
## 3     IGR
## 4  AS_IGR
## 5     IGR
##                                                                                                                                                                                        rest
## 1                                                                                                                                                                                     b2743
## 2                                                                                                                                                                                     b2764
## 3 (CDS,b1594,mlc,glucosamine_anaerobic_growth_regulon_transcriptional_repressor3B_autorepressor,cds1581,-,1220/CDS,b1595,ynfL,LysR_family_putative_transcriptional_regulator,cds1582,-,893)
## 4                                                         (CDS,b0008,talB,transaldolase_B,cds7,+,953/CDS,b0009,mog,molybdochelatase_incorporating_molybdenum_into_molybdopterin,cds8,+,587)
## 5                                       (CDS,b1808,yoaA,putative_ATP-dependent_helicase2C_DinG_family,cds1798,-,1910/CDS,b1809,yoaB,putative_reactive_intermediate_deaminase,cds1799,+,344)
##                                                                                                                                                                                                      GeneidBackup
## 1                                                                                                                CDS:b2743:pcm:L-isoaspartate_protein_carboxylmethyltransferase_type_II:cds2705:-:626:NC_000913.3
## 2                                                                                                                      CDS:b2764:cysJ:sulfite_reductase2C_alpha_subunit2C_flavoprotein:cds2726:-:1799:NC_000913.3
## 3 IGR:(CDS,b1594,mlc,glucosamine_anaerobic_growth_regulon_transcriptional_repressor3B_autorepressor,cds1581,-,1220/CDS,b1595,ynfL,LysR_family_putative_transcriptional_regulator,cds1582,-,893):+:945:NC_000913.3
## 4                                                      AS_IGR:(CDS,b0008,talB,transaldolase_B,cds7,+,953/CDS,b0009,mog,molybdochelatase_incorporating_molybdenum_into_molybdopterin,cds8,+,587):+:639:NC_000913.3
## 5                                       IGR:(CDS,b1808,yoaA,putative_ATP-dependent_helicase2C_DinG_family,cds1798,-,1910/CDS,b1809,yoaB,putative_reactive_intermediate_deaminase,cds1799,+,344):+:396:NC_000913.3</code></pre>
<p>We keep only the IGR and AS_IGR strings, and we separate the two bookends. Note, the separation comes at the backslash.</p>
<div class="sourceCode" id="cb661"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">igr</span> <span class="op">&lt;-</span> <span class="va">allCounts</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">feature</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"IGR"</span>, <span class="st">"AS_IGR"</span><span class="op">)</span><span class="op">)</span>
<span class="va">igr</span> <span class="op">&lt;-</span> <span class="va">igr</span> <span class="op">%&gt;%</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">GeneidBackup</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Geneid1"</span>, <span class="st">"Geneid2"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"[/]"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">igr</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "feature" "rest"    "Geneid1" "Geneid2"</code></pre>
<div class="sourceCode" id="cb663"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">igr</span></code></pre></div>
<pre><code>##   feature
## 1     IGR
## 2  AS_IGR
## 3     IGR
##                                                                                                                                                                                        rest
## 1 (CDS,b1594,mlc,glucosamine_anaerobic_growth_regulon_transcriptional_repressor3B_autorepressor,cds1581,-,1220/CDS,b1595,ynfL,LysR_family_putative_transcriptional_regulator,cds1582,-,893)
## 2                                                         (CDS,b0008,talB,transaldolase_B,cds7,+,953/CDS,b0009,mog,molybdochelatase_incorporating_molybdenum_into_molybdopterin,cds8,+,587)
## 3                                       (CDS,b1808,yoaA,putative_ATP-dependent_helicase2C_DinG_family,cds1798,-,1910/CDS,b1809,yoaB,putative_reactive_intermediate_deaminase,cds1799,+,344)
##                                                                                                            Geneid1
## 1 IGR:(CDS,b1594,mlc,glucosamine_anaerobic_growth_regulon_transcriptional_repressor3B_autorepressor,cds1581,-,1220
## 2                                                                AS_IGR:(CDS,b0008,talB,transaldolase_B,cds7,+,953
## 3                                 IGR:(CDS,b1808,yoaA,putative_ATP-dependent_helicase2C_DinG_family,cds1798,-,1910
##                                                                                                    Geneid2
## 1           CDS,b1595,ynfL,LysR_family_putative_transcriptional_regulator,cds1582,-,893):+:945:NC_000913.3
## 2 CDS,b0009,mog,molybdochelatase_incorporating_molybdenum_into_molybdopterin,cds8,+,587):+:639:NC_000913.3
## 3                 CDS,b1809,yoaB,putative_reactive_intermediate_deaminase,cds1799,+,344):+:396:NC_000913.3</code></pre>
<p>For each of the two bookend Genes, we need to separate out the feature from the rest. Note that we write over feature1 in the second line of code below. Both of the bookends for all sequences are CDS elements.</p>
<div class="sourceCode" id="cb665"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">igr</span><span class="op">$</span><span class="va">feature1</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">igr</span>, <span class="va">Geneid1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"feature1"</span>, <span class="st">"rest"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"[,]"</span><span class="op">)</span><span class="op">$</span><span class="va">feature1</span>
<span class="va">igr</span><span class="op">$</span><span class="va">feature1</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">igr</span>, <span class="va">feature1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rest"</span>, <span class="st">"feature1"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"[()]"</span><span class="op">)</span><span class="op">$</span><span class="va">feature1</span>
<span class="va">igr</span><span class="op">$</span><span class="va">feature2</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">igr</span>, <span class="va">Geneid2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"feature2"</span>, <span class="st">"rest"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"[,]"</span><span class="op">)</span><span class="op">$</span><span class="va">feature2</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">igr</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "feature"  "rest"     "Geneid1"  "Geneid2"  "feature1" "feature2"</code></pre>
<div class="sourceCode" id="cb667"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">igr</span></code></pre></div>
<pre><code>##   feature
## 1     IGR
## 2  AS_IGR
## 3     IGR
##                                                                                                                                                                                        rest
## 1 (CDS,b1594,mlc,glucosamine_anaerobic_growth_regulon_transcriptional_repressor3B_autorepressor,cds1581,-,1220/CDS,b1595,ynfL,LysR_family_putative_transcriptional_regulator,cds1582,-,893)
## 2                                                         (CDS,b0008,talB,transaldolase_B,cds7,+,953/CDS,b0009,mog,molybdochelatase_incorporating_molybdenum_into_molybdopterin,cds8,+,587)
## 3                                       (CDS,b1808,yoaA,putative_ATP-dependent_helicase2C_DinG_family,cds1798,-,1910/CDS,b1809,yoaB,putative_reactive_intermediate_deaminase,cds1799,+,344)
##                                                                                                            Geneid1
## 1 IGR:(CDS,b1594,mlc,glucosamine_anaerobic_growth_regulon_transcriptional_repressor3B_autorepressor,cds1581,-,1220
## 2                                                                AS_IGR:(CDS,b0008,talB,transaldolase_B,cds7,+,953
## 3                                 IGR:(CDS,b1808,yoaA,putative_ATP-dependent_helicase2C_DinG_family,cds1798,-,1910
##                                                                                                    Geneid2
## 1           CDS,b1595,ynfL,LysR_family_putative_transcriptional_regulator,cds1582,-,893):+:945:NC_000913.3
## 2 CDS,b0009,mog,molybdochelatase_incorporating_molybdenum_into_molybdopterin,cds8,+,587):+:639:NC_000913.3
## 3                 CDS,b1809,yoaB,putative_reactive_intermediate_deaminase,cds1799,+,344):+:396:NC_000913.3
##   feature1 feature2
## 1      CDS      CDS
## 2      CDS      CDS
## 3      CDS      CDS</code></pre>
<p>As CDS, it is now important to find the actual genenames for each of the IGR sequences. We also keep each element’s <code>bnum</code> which represents a unique gene identifier in <em>E. coli</em>.</p>
<p><code>bnum</code>, <code>genename</code>, <code>rna.name</code> act as place holders for the types of elements that we will need to identify the bookends of the IGRs.</p>
<div class="sourceCode" id="cb669"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bnum</span> <span class="op">=</span> <span class="st">"b[0-9]{4}"</span>
<span class="va">bnum</span></code></pre></div>
<pre><code>## [1] "b[0-9]{4}"</code></pre>
<div class="sourceCode" id="cb671"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">genename</span> <span class="op">=</span> <span class="st">",[a-z]{3}[A-Z,]."</span>
<span class="va">rna.name</span> <span class="op">=</span> <span class="st">",rna[0-9].."</span></code></pre></div>
<div class="sourceCode" id="cb672"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">igr</span><span class="op">$</span><span class="va">start.gene</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
  <span class="va">igr</span><span class="op">$</span><span class="va">feature1</span> <span class="op">==</span> <span class="st">"CDS"</span> <span class="op">~</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">igr</span><span class="op">$</span><span class="va">Geneid1</span>, <span class="va">genename</span><span class="op">)</span>,
  <span class="cn">TRUE</span> <span class="op">~</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">igr</span><span class="op">$</span><span class="va">Geneid1</span>, <span class="va">rna.name</span><span class="op">)</span><span class="op">)</span>
<span class="va">igr</span><span class="op">$</span><span class="va">end.gene</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
  <span class="va">igr</span><span class="op">$</span><span class="va">feature2</span> <span class="op">==</span> <span class="st">"CDS"</span> <span class="op">~</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">igr</span><span class="op">$</span><span class="va">Geneid2</span>, <span class="va">genename</span><span class="op">)</span>,
  <span class="cn">TRUE</span> <span class="op">~</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">igr</span><span class="op">$</span><span class="va">Geneid2</span>, <span class="va">rna.name</span><span class="op">)</span><span class="op">)</span>
<span class="va">igr</span><span class="op">$</span><span class="va">start.bnum</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
  <span class="va">igr</span><span class="op">$</span><span class="va">feature1</span> <span class="op">==</span> <span class="st">"CDS"</span> <span class="op">~</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">igr</span><span class="op">$</span><span class="va">Geneid1</span>, <span class="va">bnum</span><span class="op">)</span>,
  <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"none"</span><span class="op">)</span>
<span class="va">igr</span><span class="op">$</span><span class="va">end.bnum</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
  <span class="va">igr</span><span class="op">$</span><span class="va">feature2</span> <span class="op">==</span> <span class="st">"CDS"</span> <span class="op">~</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">igr</span><span class="op">$</span><span class="va">Geneid2</span>, <span class="va">bnum</span><span class="op">)</span>,
  <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"none"</span><span class="op">)</span>
<span class="va">igr</span> <span class="op">&lt;-</span> <span class="va">igr</span> <span class="op">%&gt;%</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">start.gene</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"comma"</span>, <span class="st">"start.gene"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"[,]"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">comma</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">end.gene</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"comma"</span>, <span class="st">"end.gene"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"[,]"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">comma</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">igr</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "feature"    "rest"       "Geneid1"    "Geneid2"    "feature1"  
##  [6] "feature2"   "start.gene" "end.gene"   "start.bnum" "end.bnum"</code></pre>
<div class="sourceCode" id="cb674"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">igr</span></code></pre></div>
<pre><code>##   feature
## 1     IGR
## 2  AS_IGR
## 3     IGR
##                                                                                                                                                                                        rest
## 1 (CDS,b1594,mlc,glucosamine_anaerobic_growth_regulon_transcriptional_repressor3B_autorepressor,cds1581,-,1220/CDS,b1595,ynfL,LysR_family_putative_transcriptional_regulator,cds1582,-,893)
## 2                                                         (CDS,b0008,talB,transaldolase_B,cds7,+,953/CDS,b0009,mog,molybdochelatase_incorporating_molybdenum_into_molybdopterin,cds8,+,587)
## 3                                       (CDS,b1808,yoaA,putative_ATP-dependent_helicase2C_DinG_family,cds1798,-,1910/CDS,b1809,yoaB,putative_reactive_intermediate_deaminase,cds1799,+,344)
##                                                                                                            Geneid1
## 1 IGR:(CDS,b1594,mlc,glucosamine_anaerobic_growth_regulon_transcriptional_repressor3B_autorepressor,cds1581,-,1220
## 2                                                                AS_IGR:(CDS,b0008,talB,transaldolase_B,cds7,+,953
## 3                                 IGR:(CDS,b1808,yoaA,putative_ATP-dependent_helicase2C_DinG_family,cds1798,-,1910
##                                                                                                    Geneid2
## 1           CDS,b1595,ynfL,LysR_family_putative_transcriptional_regulator,cds1582,-,893):+:945:NC_000913.3
## 2 CDS,b0009,mog,molybdochelatase_incorporating_molybdenum_into_molybdopterin,cds8,+,587):+:639:NC_000913.3
## 3                 CDS,b1809,yoaB,putative_reactive_intermediate_deaminase,cds1799,+,344):+:396:NC_000913.3
##   feature1 feature2 start.gene end.gene start.bnum end.bnum
## 1      CDS      CDS        mlc     ynfL      b1594    b1595
## 2      CDS      CDS       talB      mog      b0008    b0009
## 3      CDS      CDS       yoaA     yoaB      b1808    b1809</code></pre>
</div>
</div>
<div id="helpful-tutorialsfiles" class="section level4 unnumbered">
<h4>Helpful tutorials/files<a class="anchor" aria-label="anchor" href="#helpful-tutorialsfiles"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>
<code>stringr</code> vignette: <a href="https://cran.r-project.org/web/packages/stringr/vignettes/stringr.html" class="uri">https://cran.r-project.org/web/packages/stringr/vignettes/stringr.html</a>
</li>
<li><a href="https://stringr.tidyverse.org/"><code>stringr</code> package</a></li>
<li>Jenny Bryan’s STAT 545 notes: <a href="https://stat545.com/character-vectors.html" class="uri">https://stat545.com/character-vectors.html</a>
</li>
<li>Jenny Bryan’s STAT 545 lab: <a href="http://stat545.com/block022_regular-expression.html" class="uri">http://stat545.com/block022_regular-expression.html</a>
</li>
<li>Hadley Wickham’s book <a href="https://r4ds.had.co.nz/strings.html">R for Data Science</a>
</li>
<li>
<a href="http://regexpal.com/">regexpal</a><br>
</li>
<li>
<a href="http://www.regexr.com/">RegExr</a><br>
</li>
<li>Regular expression in R <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html">official document</a>.</li>
</ul>
</div>
<div id="fun-examples" class="section level4 unnumbered">
<h4>Fun examples<a class="anchor" aria-label="anchor" href="#fun-examples"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>The name Hilary: <a href="https://hilaryparker.com/2013/01/30/hilary-the-most-poisoned-baby-name-in-us-history/" class="uri">https://hilaryparker.com/2013/01/30/hilary-the-most-poisoned-baby-name-in-us-history/</a>
</li>
<li>Trump’s tweets: <a href="http://varianceexplained.org/r/trump-tweets/" class="uri">http://varianceexplained.org/r/trump-tweets/</a>
</li>
<li>Trump’s tweets, take two: <a href="http://varianceexplained.org/r/trump-followup/" class="uri">http://varianceexplained.org/r/trump-followup/</a>
</li>
</ul>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="unsup.html"><span class="header-section-number">9</span> Unsupervised Methods</a></div>
<div class="next"><a href="compstat.html"><span class="header-section-number">11</span> Computational Statistics</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#misc"><span class="header-section-number">10</span> Misc</a></li>
<li><a class="nav-link" href="#Nov26"><span class="header-section-number">10.1</span> 11/26/19 Agenda</a></li>
<li>
<a class="nav-link" href="#api"><span class="header-section-number">10.2</span> API</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#authenticating"><span class="header-section-number">10.2.1</span> Authenticating</a></li></ul>
</li>
<li>
<a class="nav-link" href="#parallel-computing"><span class="header-section-number">10.3</span> Parallel Computing</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#spark-and-sparklyr"><span class="header-section-number">10.3.1</span> Spark and sparklyr</a></li></ul>
</li>
<li><a class="nav-link" href="#cloud-computing"><span class="header-section-number">10.4</span> Cloud Computing</a></li>
<li>
<a class="nav-link" href="#reticulate"><span class="header-section-number">10.5</span> reticulate</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#connect-to-python-within-rstudio">Connect to Python within RStudio</a></li></ul>
</li>
<li><a class="nav-link" href="#sql-in-r"><span class="header-section-number">10.6</span> SQL (in R)</a></li>
<li><a class="nav-link" href="#Dec10"><span class="header-section-number">10.7</span> 12/10/19 Agenda</a></li>
<li><a class="nav-link" href="#regexpr"><span class="header-section-number">10.8</span> Regular Expressions</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/hardin47/website/blob/master/10-misc.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/hardin47/website/edit/master/10-misc.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Computational Statistics</strong>" was written by Jo Hardin. It was last built on 2021-09-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
