# Inference for numerical data

```{r global_options, include=FALSE}
knitr::opts_chunk$set(message=FALSE, warning=FALSE, fig.height=2.5,
                      fig.width=5, 
                      fig.align = "center", cache=TRUE)
library(tidyverse)
library(infer)
library(mosaic)
```


## 3/31/20 Agenda {#Mar31}
1. New statistics: mean, standard deviation, standard error of the mean
2. Sampling distribution of the sample mean

## Important measures related to quantitative (numeric) variables

### Quantitative Descriptives 

What measures can we look at to get a first sense of whether  two groups are different (let alone substantially different enough for us to conclude a difference in a related population).  We might look at what is called the **Five Number Summary**.  

* **Five Number Summary**: Min, Q1, Median, Q3, Max
  - Q1 = median of the values *below* the median
  - Q3 = median of the values *above* the median
  - IQR = Interquartile range (measure of spread/variability) = Q3 - Q1
  - 1.5 x IQR rule for possible outliers: If an observation falls more than 1.5IQR outside of Q1 or Q3, flag the observation as a possible outlier.

* Boxplot 
  - Box spans Q1 to Q3
  - Line in box marks median (M)
  - Perpendicular line extends from box to smallest and largest observations *within* 1.5IQR of Q1 and Q3.
  - Dots for observations outside of 1.5IQR

* Summaries often used when variable has a bell-shaped distribution

\begin{eqnarray*}
\mbox{sample mean} &=& \overline{X} = \frac{1}{n} \sum_{i=1}^n X_i\\
\mbox{sample standard deviation} &=& s = \sqrt{\frac{1}{n-1} \sum_{i=1}^n (X_i - \overline{X})^2}\\
\mbox{sample variance} &=& s^2 = \frac{1}{n-1} \sum_{i=1}^n (X_i - \overline{X})^2
\end{eqnarray*}

Loosely, the standard deviation is the size of the typical deviation from the mean of the data set.  Note that we divide by $n-1$ instead of by $n$ because the true deviation is defined as the average of the observations from the true mean $\mu$, and, in fact, they will always be closer to $\overline{X}$ than to $\mu$.


### Sampling distribution of a sample mean {#mean1dist}


As before, the **Central Limit Theorem** tells us that averages are normally distributed if the sample size is large enough.  Here, that means:
$$\overline{X} \sim N(\mu, \sigma/\sqrt{n})$$
where $SD(\overline{X}) = \sigma/\sqrt{n}$ and $SE(\overline{X}) = s/\sqrt{n}$.  $\mu$ is the center of the *population* of observations from which the sample data were taken.  $\sigma$ is the variability of the *population* of observations from which the sample data were taken.

As before, we won't spend much time worried about the difference between $SD(\overline{X})$ and $SE(\overline{X})$.  Generally, we'll only know / use $SE(\overline{X}) = s/\sqrt{n}$.  Typically, with quantitative variables, "large enough" is at least 30 or so observations.



Spend some time clicking through different datasets in the ICAM applet: http://www.rossmanchance.com/applets/OneSample.html?showBoth=1

You should notice:

* If the population (or sample of data) is skewed, the sampling distribution of the sample mean is normal (bell-shaped) when the sample size is large.
* The larger the sample size, the less variable the sampling distribution.
* The sample size does *not* change the distribution of the dataset (the middle graph).  The middle graph will always be a representation of the population graph (left side); although with small sample sizes, the middle graph is somewhat sparse.
* In an actual data analysis, we **only** see the middle graph.  We do not see the population graph (left side) or the sampling distribution (right side).


## 4/2/20 Agenda {#Apr2}
1. The t-distribution
2. Standardized t-score 
3. Hypothesis Testing & Confidence Intervals for one mean


## 4/7/20 Agenda {#Apr7}
1. Review of confidence interval for one mean
2. Prediction Interval for observations

## Inference for a single mean, $\mu$ {#mean1inf}

###  Mathematical model for distribution of the sample mean

Before coming up with the mathematical model appropriate for this section, it is important to notice that we almost never know the true variability of the data (i.e., $\sigma$).  Instead, we almost always have to estimate $\sigma$ using $s$, the sample standard deviation.  It turns out that when the estimate of the variability is used in the denominator, the sampling distribution becomes more variability (longer tails).  Recall that it is the tails of the distribution in which we are the most interested, so we don't want to get those wrong!!

If $\sigma$ is somehow known:  $$\frac{\overline{X} - \mu}{\sigma/\sqrt{n}} \sim N(0,1)$$

But in the more typical situation where $\sigma$ is estimated using $s$: $$\frac{\overline{X} - \mu}{s/\sqrt{n}} \sim t_{df = n-1}$$

#### Hypothesis Testing (ISRS 4.1)

If $H_0: \mu = \mu_0$ is true, then we know that: $$\frac{\overline{X} - \mu}{s/\sqrt{n}} \sim t_{df = n-1}$$

That is, we can use the $t_{df = n-1}$ distribution to find the p-value for the test.  Note, in R we we use the function `xpt` in the `mosaic` package.

####  Confidence Intervals (ISRS 4.1.4)

In the setting where there is no null hypothesis statement and an interval estimate is needed, the interval is created in the exact same way as was done with proportions using:  $$\overline{X} \pm t_{n-1}^* \cdot SE(\overline{X})$$

Which is the same thing as: $$\overline{X} \pm t_{n-1}^* \cdot s/ \sqrt{n}$$

#### Prediction Intervals (ISCAM 2.6, not in ISRS) {#predint}

A prediction interval is **different** from a confidence interval!!!  Remember that a confidence interval is a range of values that try to capture a **parameter**.   A prediction interval is meant to capture 95% of the actual observations (see below for the example on healthy body temperatures).  Note that in order to capture the variability in the observations, we combine the variability of the center of the interval ($s/\sqrt{n}$) with the variability of the observations themselves ($s$).

A $(1-\alpha)100%$ prediction interval will capture $(1-\alpha)100%$ of the observations (in the long run or in the population).

$$\overline{X} \pm t_{n-1}^* \cdot s \sqrt{1 + \frac{1}{n}}$$


### Example: healthy body temperature^[Inv 2.5, Chance & Rossman, ISCAM] 

The study at hand is meant to determine whether the average healthy body temperature is actually 98.6 F.^[Conventional wisdom says that the reason 98.6 has hung around is because it translates to 35 C. Indeed, it it agreed that, to the nearest integer, the average healthy human body temperature is 37 C.  But there is also some consensus that it is slightly lower than 37 C (if we are willing to use more significant digits).  The idea is that we have hung on to 98.6 because the decimal *feels* like a precise measurement.  In reality, it is just the conversion from 37 C to F.]

> Body temperatures (oral temperatures using a digital thermometer) were recorded for healthy men and women, aged 18-40 years, who were volunteers in Shigella vaccine trials at the University of Maryland Center for Vaccine Development, Baltimore. For these adults, the mean body temperature was found to be 98.249 F with a standard deviation of 0.733 F.^[Mackowiak, Wasserman, & Levine, *Journal of the American Medical Association*, 1992]

In order to work through the analysis it is imperative that we understand the data that was collected as part of the research.  


|          center                                  |             variability of data                                      |                                variability of sample means                   |  sample size    |
|:--------------------------------------------|:---------------------------------------------------|:---------------------------------------------------|:------|
| $\overline{X} = 98.249$ F                    | $s = 0.733$ F                                       | $SE(\overline{X}) = \frac{s}{\sqrt{n}} = \frac{0.733}{\sqrt{130}} = 0.0643$ | $n=130$ |
| $\mu$ = true ave healthy body temp (unknown!) | $\sigma$ = true sd of healthy body temps (unknown!) | $SD(\overline{X}) = \frac{\sigma}{\sqrt{n}}$ = unknown!     |      |


####  Hypothesis test on true average healthy body temperature

The first research question we want to ask is:  how surprising would it be to select a group of 13 participants who have an average healthy body temperature of 98.249 F ?

The questions is set up perfectly for a hypothesis test!

$H_0: \mu = 98.6$

$H_A: \mu \ne 98.6$

We use the t-distribution to investigate the claim.

$$t-score = \frac{98.249 - 98.6}{0.733/\sqrt{130}} = -5.46$$

How likely is the standardized version of our test statistic to happen if the null hypothesis is true?  Well, if $H_0$ is true, then the t-statistics should have a t-distribution.  So we can use the t-distribution to find the p-value (recall that the p-value is the probability of the data or more extreme if $H_0$ is true.)

The test statistic is -5.46, and even a two-sided p-value (the area doubled) is way less than 0.001.

```{r}
2 * mosaic::xpt(-5.46, df = 129, ncp = 0)
```


####  Confidence interval for true average healthy body temperature

Possibly more interesting is the confidence interval which would tell us a range of plausible values for healthy body temperatures.

The confidence interval is given by the following formula:  $$\overline{X} \pm t_{n-1}^* \cdot s/ \sqrt{n}$$

and is calculated to be (98.121, 98.376).  That is, we are 95% confident that the true average healthy body temperature is somewhere between 98.121 F and 98.376 F.  Note that 98.6 F is not in the interval!!!  Wow.

```{r}
mosaic::xqt(.975, df = 129)
98.249 - 1.9785 * 0.733 / sqrt(130)
98.249 + 1.9785 * 0.733 / sqrt(130)
```

#### Prediction interval for individual healthy body temperatures^[Inv 2.6, Chance & Rossman, ISCAM] 

Note the fundamental difference between the **goal** of the confidence interval above and the **goal** of the prediction interval calculated in this section.  A confidence interval (*always*) is an interval of plausible values for a parameter.  A prediction interval (*always*) is for individual observations.

A $(1-\alpha)100%$ prediction interval will capture $(1-\alpha)100%$ of the observations (in the long run or in the population).

Here, a 95% prediction interval for healthy body temperatures can be calculated using:

$$\overline{X} \pm t_{n-1}^* \cdot s \cdot \sqrt{1 + \frac{1}{n}}$$

$$98.249 \pm t_{129}^* \cdot 0.733 \cdot \sqrt{1 + \frac{1}{130}}$$

Which gives a 95% prediction interval of (96.79 F, 99.70 F). That is, 95% of the individuals in the population will have a healthy body temperature between 96.79 F and 99.70 F  (a **much** wider range of values than the confidence interval!)

```{r}
mosaic::xqt(.975, df = 129)

98.249 - 1.9785*0.733*sqrt(1 + 1/130)
98.249 + 1.9785*0.733*sqrt(1 + 1/130)
```

## 4/9/20 Agenda {#Apr9}
1. Sampling distirbution of $\overline{X}_1 - \overline{X}_2$
2. Hypothesis testing of $\mu_1 - \mu_2$

## 4/14/20 Agenda {#Apr14}
1. Confidence Interval for $\mu_1 - \mu_2$


## Comparing two means {#mean2inf}


##  R code for inference on 1 or 2 means.

Above, R is used primarily as a calculator and a way to find the appropriate values from the t-distribution (using `mosaic::xpt` and `mosaic::xqt`  $\rightarrow$ note that along with the first argument (either a probability or a place on the x-axis) it is important to add the degrees of freedom `df` and possibly the argument `ncp=0` which centers the graph at zero).

Consider the teacher salary data available in the OpenIntro textbook.  

>This data set contains teacher salaries from 2009-2010 for 71 teachers employed by the St. Louis Public School in Michigan, as well as several covariates.
>Posted on opendata.socrata.com by Jeff Kowalski. Original source: http://stlouis.edzone.net

```{r}
teachers <- read_delim("https://www.openintro.org/data/tab-delimited/teacher.txt", 
                       delim= "\t")
```


###  `t.test`

The function which is typically used to do t-tests is the function `t.test`.  Note that the `t.test` function requires a complete dataset, not just the summary statistics.  However, the `t.test` can be used to do any of the variety of tests we've seen (and the ones we haven't seen!):  one sample t-test, two independent samples t-test (with or without equal variances), paired t-test.

#### One sample t-test  

For example, we might be interested in testing whether the average salary (of all teachers in St Louis) is above $47,000 a year.  The p-value is extremely small. We reject $H_0$.  That is, we can claim that the true average base salary is above $47,000. (Note, to calculate a CI, use `alternative = "two.sided"`.)

$H_0: \mu = 47,000$
$H_A: \mu > 47,000$

```{r}
t.test(teachers$base, mu = 47000, alternative = "greater")
```


#### Two independent samples t-test

Or, maybe interest is in knowing whether the base salary for teachers with a BA degree is less than those with an MA degree, on average.  Note, $\mu$ denotes the average salary in the population group denoted by the subscript.  The p-value is 0.442, so we would not reject the null hypothesis.  (Note, to calculate a CI, use `alternative = "two.sided"`.)

$H_0: \mu_{BA} = \mu_{MA}$
$H_A: \mu_{BA} < \mu_{MA}$

```{r}
t.test(base ~ degree, alternative = "less", data = teachers)
```



### `infer`

We aren't going to cover the bootstrapping or randomization tests for the quantitative variables.  But notice that the `infer` syntax is almost identical to that which we covered when we were working with proportions.

Also, notice that the computational approach gives almost identical answers to the mathematical model (t-distribution) from above.

#### One sample bootstrapping on mean

```{r}
set.seed(47)
# calculate the observed test statistic
# note that we could use `stat = "median"` or `stat = "t"`
( x_bar_base <- teachers %>%
  specify(response = base) %>%
  calculate(stat = "mean") )

# create the null sampling distribution
null_dist <- teachers %>%
  specify(response = base) %>%
  hypothesize(null = "point", mu = 47000) %>%
  generate(reps = 1000, type = "bootstrap") %>%
  calculate(stat = "mean")

# visualize the null sampling distribution
visualize(null_dist) +
  shade_p_value(obs_stat = x_bar_base, direction = "greater")

# calculate the p-value
null_dist %>%
  get_p_value(obs_stat = x_bar_base, direction = "greater")
```


#### Two independent samples comparing two means

p-value is now 0.464  (very close to 0.442 given by the smooth t-distribution curve).

```{r}
set.seed(47)
# calculate the observed test statistic
( diff_x_bar_base <- teachers %>%
  specify(base ~ degree) %>%
  calculate(stat = "diff in means", order = c("MA", "BA")) )

# create the null sampling distribution
null_dist <- teachers %>%
  specify(base ~ degree) %>%
  hypothesize(null = "independence") %>%
  generate(reps = 1000, type ="permute") %>%
  calculate(stat = "diff in means", order = c("MA", "BA")) 

# visualize the null sampling distribution
visualize(null_dist) +
  shade_p_value(obs_stat = diff_x_bar_base, direction = "greater")

# calculate the p-value
null_dist %>%
  get_p_value(obs_stat = diff_x_bar_base, direction = "greater")
```


### NBA Salaries example from ISCAM Inv 4.2 


```{r eval = FALSE}
salary <- read_delim("http://www.rossmanchance.com/iscam3/data/NBASalaries2017.txt", delim = "\t", 
                     escape_double = FALSE, trim_ws = TRUE)

westmean = 0; eastmean = 0; westsd = 0; eastsd = 0

for (i in 1:1000) {
  westsample1 = sample(salary[which(conference == "western")], 20)
  eastsample1 = sample(salary[which(conference == "eastern")], 20)
  westmean[i]=mean(westsample1)
  eastmean[i]=mean(eastsample1)
  westsd[i] = sd(westsample1)
  eastsd[i] = sd(eastsample1)
}

```

Equivalently, the code can be written in a tidy way:

```{r eval=FALSE}
salary %>%
  group_by
```


## Reflection Questions

In the interest of pairing down topics for Spring 2020, I've decided to cut out the following things:
* all of the computational tests associated with two means (e.g., bootstrapping, randomization test, etc.).  This includes the following sections in the books that we will not cover:  ISCAM Inv 2.9, 4.4, 4.9, 4.11 & ISRS 4.5.
* we will not discussed paired samples (e.g., "before and after", "left and right car tires", etc.).  This includes the following sections in the books that we will not cover: ISCAM Inv 4.8, 4.9, 4.10, 4.11 & ISRS 4.2.
* we will not cover ANVOA.  This includes the following sections in the books that we will not cover: ISCAM Inv 5.4, 5.5 & ISRS 4.4.

The reflection questions below that we will not cover are marked with an asterisk *.

### 1 quantitative variable: Chapter 4, Section 1 

1. What changed about the studies (data structure) from Chapters 2 & 3?
2. What is the statistic of interest now?  What is the parameter of interest?
3. What is the difference between the distribution of the data and the distribution of the statistic?  There is a theoretical difference as well as a computational difference.
4. What is the limiting sampling distribution of the statistic?  (Note, the answer here is for big samples, that is the Central **Limit** Theorem works only where there is a limit... i.e., the sample size is big.)
5. If interest is in a statistics other than the sample mean, what is a tool we can use for finding the alternative statistic's sampling distribution?
6. * Explain the intuition behind bootstrapping.
7. * Explain how the SE for the statistic is calculated using bootstrapping.
8. What is the difference between a normal distribution and a t distribution?
9. When do we use a z and when do we use a t?
10. When would you use a confidence interval and when would you use a hypothesis test?
11. What different information does a boxplot give versus a histogram?



###  2 means (1 quantitative variable, 1 binary variable): Chapter 4, Section 3

1. What changed about the studies (data structure) from section 4.1?
2. What is the statistic of interest now?  What is the parameter of interest?
3. What is the sampling distribution for the statistic of interest?
4. How is the t-distribution become relevant?
5. What are degrees of freedom in general?  What are the actual degrees of freedom for the test in section 4.3?
6. * How is the null mechanism different across the three analysis methods in section 3.2:  randomization test, two-sample t-test, random sampling test (n.b. this is also called the parametric bootstrap)?
7. How do you create a CI?  How do you interpret the CI?
8. What if your data are NOT normal?  What strategies can you try out?

####  * (not covering in Spring 2020) Paired sample, difference in means: Chapter 4, Section 2

1. What changed about the studies (data structure) in section 4.2 as compared with 4.1 or 4.3?
2. What is the statistic of interest now?  What is the parameter of interest?
3. What is the sampling distribution for the statistic of interest?
4. What benefit does pairing have on the analysis?
5. What happens if a paired study is analyzed as if it were an independent two sample study?  (What happens to the p-value?  What happens to the CI?)
6. What is the easiest way to think of / analyze paired data?



#### * (not covering in Spring 2020) ANOVA: Chapter 4, Section 4

1. Why are these tests called ANalysis Of VAriance (ANOVA)?
2. Describe the variability in the numerator and the variability in the denominator.  What does each measure?
3. What are the null and alternative hypotheses for ANOVA?
4. What features of the data affect the power of the test?  What does power mean here?
5. What are the technical conditions?  Why do we need equal variances here?



