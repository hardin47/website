<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.4.553" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

<meta name="author" content="Jo Hardin" />

<title>Foundations of Data Science in R – 10  Grammar of graphics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<!-- htmldependencies:E3FAD763 -->
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="text/x-mathjax-config">
const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers){
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');
  
  // Will this work with TeX on its own line?
  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
  	MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
  	MathJax.Hub.Queue(function(){
      popover.setAttribute('data-content', div.innerHTML);
  	})
  }
}
</script>

<link rel="shortcut icon" href="figs/favicon.ico" />

<link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css2?family=Quicksand" type="text/css"/>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn"
      data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" 
      aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation"
      onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <h1 class="quarto-secondary-nav-title no-breadcrumbs"></h1>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" 
        aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation"
        onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="/">
      Foundations of Data Science in R
      </a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/hardin47/ds002r-fds"  title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome to Foundations of Data Science in R</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="/p0-data-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to data science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/02-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>2</span>  <span class='chapter-title'>GitHub</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="/p1-data-acquire.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data acquisition</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/03-rvest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>3</span>  <span class='chapter-title'>Web scraping</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/04-sql-in-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>4</span>  <span class='chapter-title'>SQL in R and DBeaver</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/05-sql-verbs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>5</span>  <span class='chapter-title'>SQL clauses</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/06-sql-joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>6</span>  <span class='chapter-title'>Combining tables in SQL</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="/p2-data-explore.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data exploration</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/07-wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>7</span>  <span class='chapter-title'>Data Wrangling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/08-text-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>8</span>  <span class='chapter-title'>Text analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/09-reg-expr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>9</span>  <span class='chapter-title'>Regular expressions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="/p3-data-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data visualization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/10-grammar-graphics.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class='chapter-number'>10</span>  <span class='chapter-title'>Grammar of graphics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/11-ggplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>11</span>  <span class='chapter-title'>ggplot</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="/p4-data-conclude.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data conclusions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/12-iteration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>12</span>  <span class='chapter-title'>Iteration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/13-permutation-tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>13</span>  <span class='chapter-title'>Permutation tests</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="/p5-data-communicate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data communication</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/14-version-control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>14</span>  <span class='chapter-title'>Version control</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/15-R-tip-of-the-day.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>15</span>  <span class='chapter-title'>R tip-of-the-day</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/16-reprex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>16</span>  <span class='chapter-title'>Reproducible examples</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" ></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <div id="quarto-toc-target"></div>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-grammar-graphics" class="quarto-section-identifier"><span class="chapter-number">10</span>  <span class="chapter-title">Grammar of graphics</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>

<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#examples" id="toc-examples"><span class="header-section-number">10.1</span> Examples</a>
  <ul>
  <li><a href="#cholera-via-tufte" id="toc-cholera-via-tufte"><span class="header-section-number">10.1.1</span> Cholera via Tufte</a></li>
  <li><a href="#challenger-via-tufte" id="toc-challenger-via-tufte"><span class="header-section-number">10.1.2</span> Challenger via Tufte</a></li>
  </ul></li>
  <li><a href="#thoughts" id="toc-thoughts"><span class="header-section-number">10.2</span> Thoughts on Plotting</a>
  <ul>
  <li><a href="#advice" id="toc-advice"><span class="header-section-number">10.2.1</span> Advice</a></li>
  <li><a href="#an-example-from-information-is-beautiful" id="toc-an-example-from-information-is-beautiful"><span class="header-section-number">10.2.2</span> An example from Information is Beautiful</a></li>
  <li><a href="#assessing-graphics-and-other-analyses" id="toc-assessing-graphics-and-other-analyses"><span class="header-section-number">10.2.3</span> Assessing Graphics (and Other Analyses)</a></li>
  </ul></li>
  <li><a href="#deconstruct" id="toc-deconstruct"><span class="header-section-number">10.3</span> Deconstructing a graph</a>
  <ul>
  <li><a href="#gg" id="toc-gg"><span class="header-section-number">10.3.1</span> The Grammar of Graphics (<code>gg</code>)</a></li>
  <li><a href="#ggplot2" id="toc-ggplot2"><span class="header-section-number">10.3.2</span> <code>ggplot2</code></a></li>
  </ul></li>
  <li><a href="#reflection-questions" id="toc-reflection-questions"><span class="header-section-number">10.4</span> <i class="fas fa-lightbulb"></i> Reflection questions</a></li>
  <li><a href="#ethics-considerations" id="toc-ethics-considerations"><span class="header-section-number">10.5</span> <i class="fas fa-balance-scale"></i> Ethics considerations</a></li>
  </ul>
</nav>
<p>Data visualization is integral to understanding both data and models. Computational statistics and data science sometimes focus on models or resulting predictions from the models. But there is no doubt that the structure and format of the data are the key to whether or not a model is appropriate or good. A good data analyst will always spend a lot of time and effort on exploratory data analysis, much of which includes making as many visualizations of the data as possible.</p>
<p>Depending on the introductory (or other) statistics classes you’ve had, your instructor may have focused more or less on visualizations in class. They (I) may have even said something like <em>making visualizations are incredibly important to the entire data analysis process.</em> But even if you buy the perspective, why is it that we don’t see more good graphics in our analyses? Andrew Gelman <span class="citation" data-cites="Gelman11">(<a href="#ref-Gelman11" role="doc-biblioref">Gelman 2011</a>)</span> responds by stating, “Good statistical graphics are hard to do, much harder than running regressions and making tables.” <strong>Our goal will be to create graphics and visualizations that convey statistical information.</strong></p>
<p>Nolan <span class="citation" data-cites="Nolan16">(<a href="#ref-Nolan16" role="doc-biblioref">Nolan and Perrett 2016</a>)</span> describes three important ways that graphics can be used to convey statistical information. The “guiding principles” will be used as a way of evaluating others’ figures as well as a metric for creating our own visualizations to help with statistical analysis.</p>
<ol type="1">
<li><em>Make the data stand out</em></li>
</ol>
<p>The important idea here is to find anything unusual in the data. Are there patterns? Outliers? What are the bounds of the variables? How should the axes be scaled? Are transformations warranted?</p>
<ol start="2" type="1">
<li><em>Facilitate comparison</em></li>
</ol>
<p>The second item allows us to consider the research questions at hand. What are the important variables? How do we emphasize them? Which variables should be plotted together? Can they be super-imposed? Does color, plotting character, size of plot character help to bring out the important relationships? Be aware of over plotting and issues of color blindness. http://colorbrewer2.org/</p>
<ol start="3" type="1">
<li><em>Add information</em></li>
</ol>
<p>Plots should also add context to the comparison. Figure legends, axes scales, and reference markers (e.g., a line at <span class="math inline">\(y=x\)</span>) go a long way toward helping the reader understand your message. Captions should be self-contained (and not assume the user has also read your text) and descriptive; they should summarize the content of the figure and the conclusion related to the message you want to convey.</p>
<p>Randy Pruim asks the following question to decide whether or not a plot is good: <em>Does my plot make the comparisons I am interested in…</em></p>
<ul>
<li>easily? and</li>
<li>accurately?</li>
</ul>
<p>Consider adding alt text to allow screen readers to parse the image. The DataViz Society/Nightingale by way of Amy Cesal has an article on writing good alt text for plots/graphs, <a href = "https://medium.com/nightingale/writing-alt-text-for-data-visualization-2a218ef43f81" target = "_blank">Writing Alt Text for Data Visualization</a>.</p>
<section id="examples" class="level2" data-number="10.1">
<h2 data-number="10.1"><span class="header-section-number">10.1</span> Examples</h2>
<p>The first two examples are taken from a book by Edward Tufte who is arguably the master at visualizations. The book is <em>Visual and Statistical Thinking: Displays of Evidence for Making decisions</em>. The book can be purchased at http://www.edwardtufte.com/tufte/books_textb, though there may be online versions of it that you can download.</p>
<section id="an-aside" class="level5 unnumbered">
<h5 class="unnumbered">An aside</h5>
<p>Generally, the better your graphics are, the better able you will be to communicate ideas broadly (that’s how you become rich and famous). By graphics I mean not only figures associated with analyses, but also power point presentations, posters, and information on your website provided for other scientists who might be interested in your work. Tufte is a master at understanding how to convey information visually, and I strongly recommend you look at his work. Start with Wikipedia where some of his main ideas are provided (e.g., “data-ink ratio”) and then check out his incredible texts. I have many of them in my office and am happy to let you peruse them. http://www.edwardtufte.com/tufte/books_vdqi</p>
<p>As mentioned in the booklet we are using, there are two main motivational steps to working with graphics as part of an argument <span class="citation" data-cites="Tufte97">(<a href="#ref-Tufte97" role="doc-biblioref">Tufte 1997</a>)</span>.</p>
<ol type="1">
<li>“An essential analytic task in making decisions based on evidence is to understand how things work.”</li>
<li>Making decisions based on evidence requires the appropriate display of that evidence.”</li>
</ol>
<p>Back to the examples…</p>
</section>
<section id="cholera-via-tufte" class="level3" data-number="10.1.1">
<h3 data-number="10.1.1"><span class="header-section-number">10.1.1</span> Cholera via Tufte</h3>
<p>In September 1854, the worst outbreak of cholera in London occurred in a few block radius - within 10 days, there were more than 500 fatalities. John Snow recognized the clumping of deaths, and hypothesized that they were due to contamination of the Broad Street water pump. Despite testing the water from the pump and finding no suspicious impurities, he did notice that the water quality varies from data to day. More importantly, there seemed to be no other possible causal mechanism for the outbreak. Eight days after the outbreak began, Snow described his findings to the authorities, and the Board of Guardians of St. James’s Parish ordered the Broad Street pump handle removed. The epidemic ended soon after.</p>
<p><em>Why was John Snow successful at solving the problem?</em> Some thoughts to consider (as reported in <span class="citation" data-cites="Tufte97">Tufte (<a href="#ref-Tufte97" role="doc-biblioref">1997</a>)</span>):</p>
<ol type="1">
<li><p>The bacterium <em>Vibrio cholerae</em> was not discovered until 1886, however Snow had myriad experience both as a medical doctor and in looking at patterns of of other outbreaks. He was the first to realized that cholera was transmitted through water instead of by air or other means.</p></li>
<li><p><strong>Data in Context</strong> Snow thought carefully about how to present the data. Instead of simply looking at the data as counts or frequencies, he looked at the death <em>spatially</em> - on a map of the area.</p></li>
<li><p><strong>Comparisons</strong> In order to isolate the pump as the <em>cause</em> of the outbreak, Snow needed to understand how the individuals who had died were different than the individuals who had survived. Snow found two other groups of individuals (brewers who drank only beer, and employees at a work house who had an on-site pump) who had not succumbed to the disease.</p></li>
<li><p><strong>Alternatives</strong> Whenever a theory is present, it is vitally important to contrast the theory against all possible alternative possibilities. In Snow’s case, he needed to consider all individuals who did not regularly use the Broad Street pump - he was able to understand the exceptions in every case.</p></li>
<li><p>Did removing the pump handle really <em>cause</em> the outbreak to cease? Wasn’t it already on the decline?</p></li>
<li><p><strong>Assessment of the Graphic</strong> Did the individuals die at the place on the map? Live at the place on the map? Which (types of) individuals were missing from the graph? Missing at random? What decisions did he make in creating the graph (axes, binning of histogram bars, time over which data are plotted, etc.) that change the story needing to be told?</p></li>
</ol>
</section>
<section id="challenger-via-tufte" class="level3" data-number="10.1.2">
<h3 data-number="10.1.2"><span class="header-section-number">10.1.2</span> Challenger via Tufte</h3>
<p>John Snow’s story of the successful graphical intervention in the cholera outbreak is contrasted with the fateful poor-graphical non-intervention of the Challenger disaster. On January 28, 1986, the space shuttle Challenger took off from Cape Canaveral, FL and immediately exploded, killing all seven astronauts aboard. We now know that the reason for the explosion was due to the failure of two rubber O-rings which malfunctioned due to the cold temperature of the day (<span class="math inline">\(\sim 29^\circ\)</span> F).</p>
<p>Unlike the cholera epidemic, those who understood the liability of a shuttle launch under cold conditions were unable to convince the powers that be to postpone the launch (there was much political momentum going forward to get the shuttle off the ground, including the first teacher in space, Christa McAuliffe). As seen in the Tufte chapter, the evidence was clear but not <em>communicated</em>!</p>
<p>The biggest problem (existing in many of the bullet points below) is that the engineers failed to as the important question about the data: <strong>in relation to what??</strong></p>
<ol type="1">
<li><p>The engineers who understood the problem created tables and engineering graphs which were</p>
<ol type="a">
<li>Not visually appealing.</li>
<li>Not decipherable to the layman (e.g., “At about <span class="math inline">\(50^\circ\)</span> F blow-by could be experienced in case joints”)</li>
<li>There was also no authorship (reproducibility!). <strong>Figures should always have both accountability and reproducibility.</strong></li>
</ol></li>
<li><p>The information provided included very relevant points (about temperature) and superfluous information unrelated to temperature. The univariate analysis was insufficient because the story the data were trying to tell was about the <strong>bivariate relationship between temperature and o-ring failure</strong>.</p></li>
<li><p>Missing data created an illusion of <em>lack of evidence</em>, when in fact, the true story was quite strong given the full set of information. (92% of the temperature data was missing from some of the most vital tables.)</p></li>
<li><p>Anecdotal evidence was misconstrued: SRM-15 at 57F had the most damage, but SRM-22 at 75F had the second most damage.</p></li>
<li><p>In the end, the shuttle launched on a day which was an extrapolation from the model suggested by the data. They had never launched a shuttle at temperatures of <span class="math inline">\(26^\circ-29^\circ\)</span>F.</p></li>
<li><p>Tufte goes on to describe many ways which the final presentation by the engineers to the administrators was inadequate: disappearing legend (labels), chartjunk, lack of clarity depicting cause and effect, and wrong order.</p></li>
</ol>
<p>As with the cholera outbreak, a persuasive argument could have been made if the visualizations had</p>
<ol type="1">
<li>been in context <em>plot data versus temperature not time!</em>,</li>
<li>used appropriate comparisons: <em>as compared with what?</em>,</li>
<li>consider alternative scenarios <em>when else did O-rings fail? What is the science behind O-ring failure?</em>, and</li>
<li>the graphics had been assessed <em>what is all of the extra noise? are the words being used accessible to non-engineers?</em>.</li>
</ol>
<p>Tufte <span class="citation" data-cites="Tufte97">(<a href="#ref-Tufte97" role="doc-biblioref">Tufte 1997</a>)</span> created the graphic below which should have been used before the launch to convince others to postpone. As you can see, the graphic is extremely convincing. An aside: the O-ring data are well suited for an analysis using logistic regression. Today, most scientists believe that the temperature <em>caused</em> the O-ring failure, however, the data do not speak to the causal relationship because they were not collected using a randomized experiment. That is, there could have been other confounding variables (e.g., humidity) which were possible causal mechanisms.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="images/TuftestemperatureandOringrelationshi.jpg" class="lightbox" data-glightbox="description: .lightbox-desc-1" data-gallery="quarto-lightbox-gallery-1" title="The graphic the engineers should have led with in trying to persuade the administrators not to launch. It is evident that the number of O-ring failures is quite highly associated with the ambient temperature. Note the vital information on the x-axis associated with the large number of launches at warm temperatures that had zero O-ring failures. [@Tufte97]"><img src="images/TuftestemperatureandOringrelationshi.jpg" class="img-fluid quarto-figure quarto-figure-center" width="125" alt="The graphic the engineers should have led with in trying to persuade the administrators not to launch. It is evident that the number of O-ring failures is quite highly associated with the ambient temperature. Note the vital information on the x-axis associated with the large number of launches at warm temperatures that had zero O-ring failures. (Tufte 1997)" /></a></p>
</figure>
</div>
<figcaption>The graphic the engineers should have led with in trying to persuade the administrators not to launch. It is evident that the number of O-ring failures is quite highly associated with the ambient temperature. Note the <em>vital</em> information on the x-axis associated with the large number of launches at warm temperatures that had <em>zero</em> O-ring failures. <span class="citation" data-cites="Tufte97">(<a href="#ref-Tufte97" role="doc-biblioref">Tufte 1997</a>)</span></figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="thoughts" class="level2" data-number="10.2">
<h2 data-number="10.2"><span class="header-section-number">10.2</span> Thoughts on Plotting</h2>
<section id="advice" class="level3" data-number="10.2.1">
<h3 data-number="10.2.1"><span class="header-section-number">10.2.1</span> Advice</h3>
<ul>
<li>Basic plotting
<ul>
<li>Avoid having other graph elements interfere with data</li>
<li>Use visually prominent symbols</li>
<li>Avoid over-plotting (One way to avoid over plotting: Jitter the values)</li>
<li>Different values of data may obscure each other</li>
<li>Include all or nearly all of the data</li>
<li>Fill data region</li>
</ul></li>
<li>Eliminate superfluous material
<ul>
<li>Chart junk &amp; stuff that adds no meaning, e.g. butterflies on top of barplots, background images</li>
<li>Extra tick marks and grid lines</li>
<li>Unnecessary text and arrows</li>
<li>Decimal places beyond the measurement error or the level of difference</li>
</ul></li>
<li>Facilitate Comparisons
<ul>
<li>Put juxtaposed plots on same scale</li>
<li>Make it easy to distinguish elements of superposed plots (e.g. color)</li>
<li>Emphasizes the important difference</li>
<li>Comparison: volume, area, height (be careful, volume can seem bigger than you mean it to)</li>
</ul></li>
<li>Choosing the Scale (n.b., some of the principles may go counter to one another, use your judgment.)
<ul>
<li>Keep scales on x and y axes the same for both plots to facilitate the comparison</li>
<li>Zoom in to focus on the region that contains the bulk of the data</li>
<li>Keep the scale the same throughout the plot (i.e. don’t change it mid-axis)</li>
<li>Origin need not be on the scale</li>
<li>Choose a scale that improves resolution</li>
<li>Avoid jiggling the baseline</li>
</ul></li>
<li>How to make a plot information rich
<ul>
<li>Describe what you see in the caption</li>
<li>Add context with reference markers (lines and points) including text</li>
<li>Add legends and labels</li>
<li>Use color and plotting symbols to add more information</li>
<li>Plot the same thing more than once in different ways/scales</li>
<li>Reduce clutter</li>
</ul></li>
<li>Captions should
<ul>
<li>Be comprehensive</li>
<li>Self-contained</li>
<li>Describe what has been graphed</li>
<li>Draw attention to important features</li>
<li>Describe conclusions drawn from graph</li>
</ul></li>
<li>Good Plot Making Practice
<ul>
<li>Put major conclusions in graphical form</li>
<li>Provide reference information</li>
<li>Proof read for clarity and consistency</li>
<li>Graphing is an iterative process</li>
<li>Multiplicity is OK, i.e. two plots of the same variable may provide different messages</li>
<li>Make plots data rich</li>
</ul></li>
</ul>
<p>Creating a statistical graphic is an iterative process of discovery and fine tuning. We try to model the process of creating visualizations in the course by dedicating class time to an iterative creation of a plot. We begin either with a plot that screams for correction, and we transform it step-by-step, always thinking about the goal of a graph that is data rich and presents a clear vision of the important features of the data.</p>
</section>
<section id="an-example-from-information-is-beautiful" class="level3" data-number="10.2.2">
<h3 data-number="10.2.2"><span class="header-section-number">10.2.2</span> An example from Information is Beautiful</h3>
<p>(See HW2 for details on R code)</p>
<p>Consider the plot at http://www.informationisbeautiful.net/visualizations/caffeine-and-calories/. Note that the origin is at the point (150,150). While we can get over the hurdle, it is not what is expected when looking at a graph.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="images/buzzvbulge.png" class="lightbox" data-glightbox="description: .lightbox-desc-2" data-gallery="quarto-lightbox-gallery-2" title="http://infobeautiful3.s3.amazonaws.com/2013/01/1276_buzz_v_bulge.png"><img src="images/buzzvbulge.png" class="img-fluid quarto-figure quarto-figure-center" width="204" alt="http://infobeautiful3.s3.amazonaws.com/2013/01/1276_buzz_v_bulge.png" /></a></p>
</figure>
</div>
<figcaption>http://infobeautiful3.s3.amazonaws.com/2013/01/1276_buzz_v_bulge.png</figcaption>
</figure>
</div>
</div>
</div>
<p>I have removed the vertical and horizontal lines which detracted from the idea of an origin. I have also added additional information (color) to describe the chain from which the drink comes from. Notice that an additional difference between my plot and the original plot is that I have many more observations.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="images/Math154_HW2_viz-ggdrink.png" class="lightbox" data-glightbox="description: .lightbox-desc-3" data-gallery="quarto-lightbox-gallery-3" title="Calories and Caffeine for drinks from various drinks and other items. Data source is: World Cancer Research Fund, Starbucks Beverage Nutrition Guide, Calorie Counter Database. Seemingly, the observational units (rows) are not a random sample of anything. As such, we should be careful of summarizing the data in any way - what would the ‘average’ calories even mean? Note, from the entire dataset give, the average calories is 179.8 and the average caffeine is 134.43. How do those numbers compare to the original plot?"><img src="images/Math154_HW2_viz-ggdrink.png" class="img-fluid quarto-figure quarto-figure-center" width="192" alt="Calories and Caffeine for drinks from various drinks and other items. Data source is: World Cancer Research Fund, Starbucks Beverage Nutrition Guide, Calorie Counter Database. Seemingly, the observational units (rows) are not a random sample of anything. As such, we should be careful of summarizing the data in any way - what would the ‘average’ calories even mean? Note, from the entire dataset give, the average calories is 179.8 and the average caffeine is 134.43. How do those numbers compare to the original plot?" /></a></p>
</figure>
</div>
<figcaption>Calories and Caffeine for drinks from various drinks and other items. Data source is: World Cancer Research Fund, Starbucks Beverage Nutrition Guide, Calorie Counter Database. Seemingly, the observational units (rows) are not a random sample of anything. As such, we should be careful of summarizing the data in any way - what would the ‘average’ calories even mean? Note, from the entire dataset give, the average calories is 179.8 and the average caffeine is 134.43. How do those numbers compare to the original plot?</figcaption>
</figure>
</div>
</div>
</div>
<p>Data retrieved from: https://docs.google.com/spreadsheets/d/1KYMUjrCulPtpUHwep9bVvsBvmVsDEbucdyRZ5uHCDxw/edit?hl=en_GB#gid=0</p>
<section id="fonts-matter" class="level4" data-number="10.2.2.1">
<h4 data-number="10.2.2.1"><span class="header-section-number">10.2.2.1</span> Fonts Matter</h4>
<p>At RStudio::conf 2020, <a href="https://rstudio.com/resources/rstudioconf-2020/the-glamour-of-graphics/">The Glamour of Graphics</a>, Will Chase makes some very important points about how and why making good graphics matters. The talk might be summarized by the plot below: fonts matter.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="images/fontsmatter.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="images/fontsmatter.png" class="img-fluid quarto-figure quarto-figure-center" width="500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="assessing-graphics-and-other-analyses" class="level3" data-number="10.2.3">
<h3 data-number="10.2.3"><span class="header-section-number">10.2.3</span> Assessing Graphics (and Other Analyses)</h3>
<table>
<colgroup>
<col style="width: 26%" />
<col style="width: 21%" />
<col style="width: 27%" />
<col style="width: 23%" />
</colgroup>
<thead>
<tr class="header">
<th>Critical Task</th>
<th>Needs Improvement</th>
<th>Basic</th>
<th>Surpassed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Computation</strong> Perform computations</td>
<td>Computations contain errors and extraneous code</td>
<td>Computations are correct but contain extraneous / unnecessary computations</td>
<td>Computations are correct and properly identified and labeled</td>
</tr>
<tr class="even">
<td><strong>Analysis</strong> Choose and carry out analysis appropriate for data and content(s)</td>
<td>Choice of analysis is overly simplistic, irrelevant, or missing key component</td>
<td>Analysis appropriate, but incomplete, or not important features and assumptions not made explicit</td>
<td>Analysis appropriate, complete, advanced, relevant, and informative</td>
</tr>
<tr class="odd">
<td><strong>Synthesis</strong> Identify key features of the analysis, and interpret results (including context)</td>
<td>Conclusions are missing, incorrect, or not made based on results of analysis</td>
<td>Conclusions reasonable, but is partially correct or partially complete</td>
<td>Make relevant conclusions explicitly connect to analysis and to context</td>
</tr>
<tr class="even">
<td><strong>Visual presentation</strong> Communicate findings graphically clearly, precisely, and concisely</td>
<td>Inappropriate choice of plots; poorly labeled plots; plots missing</td>
<td>Plots convey information correctly but lack context for interpretation</td>
<td>Plots convey information correctly with adequate / appropriate reference information</td>
</tr>
<tr class="odd">
<td><strong>Written</strong> Communicate findings clearly, precisely, and concisely</td>
<td>Explanation is illogical, incorrect, or incoherent</td>
<td>Explanation is partially correct but incomplete or unconvincing</td>
<td>Explanation is correct, complete, and convincing</td>
</tr>
</tbody>
</table>
<p>A rubric for assessing analysis and corresponding visualization. Note that there can be a large amount of information gained in moving from basic competency to surpassed competency. Table taken from <span class="citation" data-cites="Nolan16">Nolan and Perrett (<a href="#ref-Nolan16" role="doc-biblioref">2016</a>)</span>.</p>
<!---
% look at Di's plenary talk from rstudio::conf 2018
% (1) making many different plots from the same data, they show very different things!
% (2) ideas of null plots
--->
</section>
</section>
<section id="deconstruct" class="level2" data-number="10.3">
<h2 data-number="10.3"><span class="header-section-number">10.3</span> Deconstructing a graph</h2>
<section id="gg" class="level3" data-number="10.3.1">
<h3 data-number="10.3.1"><span class="header-section-number">10.3.1</span> The Grammar of Graphics (<code>gg</code>)</h3>
<p><span class="citation" data-cites="Yau">Yau (<a href="#ref-Yau" role="doc-biblioref">2013</a>)</span> and <span class="citation" data-cites="Wickham14">Wickham (<a href="#ref-Wickham14" role="doc-biblioref">2014</a>)</span> have come up with a <em>taxonomy</em> and a <em>grammar</em> for thinking about the parts of a figure just like we conceptualize the parts of a body or the parts of a sentence.</p>
<p>One great way of thinking of the new process: it is not longer necessary to talk about the name of the graph (e.g., boxplot). Instead we now think in glyphs (geoms), and so we can put whatever we want on the plot. Note also that the transition leads you from a passive consumer (I need to make plot XXX because everyone else does, so I just plug in the data) into an active participant (what do I want my data to say? and how can I put that information onto my graphic?)</p>
<p>The most important questions you can ask with respect to creating figures are:</p>
<ol type="1">
<li>What do we want R to do? (What is the goal?)</li>
<li>What does R need to know?</li>
</ol>
<p><span class="citation" data-cites="Yau">Yau (<a href="#ref-Yau" role="doc-biblioref">2013</a>)</span> gives us nine visual cues, and <span class="citation" data-cites="Wickham14">Wickham (<a href="#ref-Wickham14" role="doc-biblioref">2014</a>)</span> translates them into a language using <code>ggplot2</code>. (The items below are from <span class="citation" data-cites="MDSR">Baumer, Kaplan, and Horton (<a href="#ref-MDSR" role="doc-biblioref">2021</a>)</span>, chapter 2.)</p>
<ol type="1">
<li><p>Visual Cues: the aspects of the figure where we should focus.<br />
<strong>Position</strong> (numerical) where in relation to other things?<br />
<strong>Length</strong> (numerical) how big (in one dimension)?<br />
<strong>Angle</strong> (numerical) how wide? parallel to something else?<br />
<strong>Direction</strong> (numerical) at what slope? In a time series, going up or down?<br />
<strong>Shape</strong> (categorical) belonging to what group?<br />
<strong>Area</strong> (numerical) how big (in two dimensions)? Beware of improper scaling!<br />
<strong>Volume</strong> (numerical) how big (in three dimensions)? Beware of improper scaling!<br />
<strong>Shade</strong> (either) to what extent? how severely?<br />
<strong>Color</strong> (either) to what extent? how severely? Beware of red/green color blindness.</p></li>
<li><p>Coordinate System: rectangular, polar, geographic, etc.</p></li>
<li><p>Scale: numeric (linear? logarithmic?), categorical (ordered?), time</p></li>
<li><p>Context: in comparison to what (think back to ideas from Tufte)</p></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="images/Yau_viz_cues.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="images/Yau_viz_cues.png" class="img-fluid quarto-figure quarto-figure-center" style="width:100.0%" /></a></p>
</figure>
</div>
</div>
</div>
<section id="order-matters" class="level4 unnumbered">
<h4 class="unnumbered">Order Matters</h4>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="images/Yau_order.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="images/Yau_order.png" class="img-fluid quarto-figure quarto-figure-center" style="width:100.0%" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cues-together" class="level4 unnumbered">
<h4 class="unnumbered">Cues Together</h4>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="images/Yau_cuestogether.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="images/Yau_cuestogether.png" class="img-fluid quarto-figure quarto-figure-center" style="width:100.0%" /></a></p>
</figure>
</div>
</div>
</div>
<section id="what-are-the-visual-cues-on-the-plot" class="level5 unnumbered">
<h5 class="unnumbered">What are the visual cues on the plot?</h5>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-9-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<ul>
<li>position?</li>
<li>length?</li>
<li>shape?</li>
<li>area/volume?</li>
<li>shade/color?</li>
<li>coordinate System?<br />
</li>
<li>scale?</li>
</ul>
</section>
<section id="what-are-the-visual-cues-on-the-plot-1" class="level5 unnumbered">
<h5 class="unnumbered">What are the visual cues on the plot?</h5>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-10-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<ul>
<li>position?</li>
<li>length?</li>
<li>shape?</li>
<li>area/volume?</li>
<li>shade/color?</li>
<li>coordinate System?<br />
</li>
<li>scale?</li>
</ul>
</section>
<section id="what-are-the-visual-cues-on-the-plot-2" class="level5 unnumbered">
<h5 class="unnumbered">What are the visual cues on the plot?</h5>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-11-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<ul>
<li>position?</li>
<li>length?</li>
<li>shape?</li>
<li>area/volume?</li>
<li>shade/color?</li>
<li>coordinate System?<br />
</li>
<li>scale?</li>
</ul>
</section>
</section>
<section id="the-grammar-of-graphics-in-ggplot2" class="level4" data-number="10.3.1.1">
<h4 data-number="10.3.1.1"><span class="header-section-number">10.3.1.1</span> The grammar of graphics in <code>ggplot2</code></h4>
<p><strong>geom</strong>: the geometric “shape” used to display data</p>
<ul>
<li>bar, point, line, ribbon, text, etc.</li>
</ul>
<p><strong>aesthetic</strong>: an attribute controlling how geom is displayed with respect to variables</p>
<ul>
<li>x position, y position, color, fill, shape, size, etc.</li>
</ul>
<p><strong>scale</strong>: adjust information in the aesthetic to map onto the plot</p>
<ul>
<li><em>particular</em> assignment of colors, shapes, sizes, etc.; making axes continuous or constrained to a particular range of values.</li>
</ul>
<p><strong>guide</strong>: helps user convert visual data back into raw data (legends, axes)</p>
<p><strong>stat</strong>: a transformation applied to data before geom gets it</p>
<ul>
<li>example: histograms work on binned data</li>
</ul>
</section>
</section>
<section id="ggplot2" class="level3" data-number="10.3.2">
<h3 data-number="10.3.2"><span class="header-section-number">10.3.2</span> <code>ggplot2</code></h3>
<p>In <code>ggplot2</code>, an <em>aesthetic</em> refers to a mapping between a variable and the information it conveys on the plot. Further information about plotting and visualizing information is given in chapter 2 (Data visualization) of <span class="citation" data-cites="MDSR">Baumer, Kaplan, and Horton (<a href="#ref-MDSR" role="doc-biblioref">2021</a>)</span>. Much of the data in the presentation represents all births from 1978 in the US: the date, the day of the year, and the number of births.</p>
<!---
%Things to talk about:
%layers 
%facets 
%tidy data 
%scale: the computer maps the data to the aesthetic (computer doing the work) 
%guide: the aesthetic gets mapped back to the data (the human interpreting the graph) 
%frame: the variables that define the space (e.g., x & y coordinates and faceting) 
--->
<section id="goals" class="level5 unnumbered">
<h5 class="unnumbered">Goals</h5>
<p>What I will try to do</p>
<ul>
<li><p>give a tour of <code>ggplot2</code></p></li>
<li><p>explain how to think about plots the <code>ggplot2</code> way</p></li>
<li><p>prepare/encourage you to learn more later</p></li>
</ul>
<p>What I can’t do in one session</p>
<ul>
<li><p>show every bell and whistle</p></li>
<li><p>make you an expert at using <code>ggplot2</code></p></li>
</ul>
</section>
<section id="getting-help" class="level5 unnumbered">
<h5 class="unnumbered">Getting help</h5>
<ol type="1">
<li><p>One of the best ways to get started with ggplot is to google what you want to do with the word ggplot. Then look through the images that come up. More often than not, the associated code is there. There are also ggplot galleries of images, one of them is here: https://plot.ly/ggplot2/</p></li>
<li><p><code>ggplot2</code> cheat sheet: https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf</p></li>
<li><p>Look at the end of the presentation. More help options there.</p></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="images/plotly.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="images/plotly.png" class="img-fluid quarto-figure quarto-figure-center" width="152" /></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(mosaic)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(lubridate) <span class="co"># package for working with dates</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Births78)     <span class="co"># restore fresh version of Births78</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Births78, <span class="dv">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        date births wday year month day_of_year day_of_month day_of_week
1 1978-01-01   7701  Sun 1978     1           1            1           1
2 1978-01-02   7527  Mon 1978     1           2            2           2
3 1978-01-03   8825  Tue 1978     1           3            3           3</code></pre>
</div>
</div>
</section>
<section id="how-can-we-make-the-plot" class="level5 unnumbered">
<h5 class="unnumbered">How can we make the plot?</h5>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-14-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<p>Two Questions:</p>
<ol type="1">
<li><p>What do we want R to do? (What is the goal?)</p></li>
<li><p>What does R need to know?</p>
<ul>
<li><p>data source: <code>Births78</code></p></li>
<li><p>aesthetics:</p>
<ul>
<li><code>date -&gt; x</code></li>
<li><code>births -&gt; y</code></li>
<li>points (!)</li>
</ul></li>
</ul></li>
<li><p>Goal: scatterplot = a plot with points</p>
<ul>
<li><code>ggplot() + geom_point()</code></li>
</ul></li>
<li><p>What does R need to know?</p>
<ul>
<li><p>data source: <code>data = Births78</code></p></li>
<li><p>aesthetics: <code>aes(x = date, y = births)</code></p></li>
</ul></li>
</ol>
</section>
<section id="how-can-we-make-the-plot-1" class="level5 unnumbered">
<h5 class="unnumbered">How can we make the plot?</h5>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-15-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<p>What has changed?</p>
<ul>
<li>new aesthetic: mapping color to day of week</li>
</ul>
</section>
<section id="adding-day-of-week-to-the-data-set" class="level5 unnumbered">
<h5 class="unnumbered">Adding day of week to the data set</h5>
<p>The <code>wday()</code> function in the <code>lubridate</code> package computes the day of the week from a date.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Births78 <span class="ot">&lt;-</span>  </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  Births78 <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wday =</span> lubridate<span class="sc">::</span><span class="fu">wday</span>(date, <span class="at">label=</span><span class="cn">TRUE</span>))</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>Births78) <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>births, <span class="at">color=</span>wday))<span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;US Births in 1978&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-17-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="how-can-we-make-the-plot-2" class="level5 unnumbered">
<h5 class="unnumbered">How can we make the plot?</h5>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-18-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<p>Now we use lines instead of dots</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>Births78) <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>births, <span class="at">color=</span>wday)) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;US Births in 1978&quot;</span>)</span></code></pre></div>
</div>
</section>
<section id="how-can-we-make-the-plot-3" class="level5 unnumbered">
<h5 class="unnumbered">How can we make the plot?</h5>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-20-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<p>Now we have two <strong>layers</strong>, one with points and one with lines</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>Births78, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>births, <span class="at">color=</span>wday)) <span class="sc">+</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;US Births in 1978&quot;</span>)</span></code></pre></div>
</div>
<ul>
<li><p>The layers are placed one on top of the other: the points are <em>below</em> and the lines are <em>above</em>.</p></li>
<li><p><code>data</code> and <code>aes</code> specified in <code>ggplot()</code> affect all geoms</p></li>
</ul>
</section>
<section id="alternative-syntax" class="level5 unnumbered">
<h5 class="unnumbered">Alternative Syntax</h5>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>Births78 <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>births, <span class="at">color=</span>wday)) <span class="sc">+</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;US Births in 1978&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-22-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="what-does-adding-the-color-argument-do" class="level5 unnumbered">
<h5 class="unnumbered">What does adding the color argument do?</h5>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Births78 <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>births, <span class="at">color=</span><span class="st">&quot;navy&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()  <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;US Births in 1978&quot;</span>)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-24-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<p>Because there is no variable, we have <em>mapped</em> the color aesthetic to a new variable with only one value (“navy”). So all the dots get set to the same color, but it’s not navy.</p>
</section>
<section id="setting-vs.-mapping" class="level5 unnumbered">
<h5 class="unnumbered">Setting vs. Mapping</h5>
<p>If we want to <em>set</em> the color to be navy for all of the dots, we do it outside the aesthetic, without a dataset variable:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>Births78 <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>births)) <span class="sc">+</span>   <span class="co"># map x &amp; y </span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;navy&quot;</span>)   <span class="sc">+</span>     <span class="co"># set color</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;US Births in 1978&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-25-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Note that <code>color = "navy"</code> is now outside of the aesthetics list. That’s how <code>ggplot2</code> distinguishes between mapping and setting.</li>
</ul>
</section>
<section id="how-can-we-make-the-plot-4" class="level5 unnumbered">
<h5 class="unnumbered">How can we make the plot?</h5>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-26-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Births78 <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>births)) <span class="sc">+</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span>wday)) <span class="sc">+</span>       <span class="co"># map color here</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;navy&quot;</span>) <span class="sc">+</span>          <span class="co"># set color here</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;US Births in 1978&quot;</span>)</span></code></pre></div>
</div>
<ul>
<li><p><code>ggplot()</code> establishes the default data and aesthetics for the geoms, but each geom may change the defaults.</p></li>
<li><p>good practice: put into <code>ggplot()</code> the things that affect all (or most) of the layers; rest in <code>geom_blah()</code></p></li>
</ul>
</section>
<section id="setting-vs.-mapping-again" class="level5 unnumbered">
<h5 class="unnumbered">Setting vs. Mapping (again)</h5>
<p>Information gets passed to the plot via:</p>
<ol type="a">
<li><p><code>map</code> the <strong>variable</strong> information inside the aes (aesthetic) command</p></li>
<li><p><code>set</code> the <strong>non-variable</strong> information outside the aes (aesthetic) command</p></li>
</ol>
</section>
<section id="other-geoms" class="level5 unnumbered">
<h5 class="unnumbered">Other geoms</h5>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apropos</span>(<span class="st">&quot;^geom_&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] &quot;geom_abline&quot;            &quot;geom_area&quot;              &quot;geom_ash&quot;              
 [4] &quot;geom_bar&quot;               &quot;geom_bin_2d&quot;            &quot;geom_bin2d&quot;            
 [7] &quot;geom_blank&quot;             &quot;geom_boxplot&quot;           &quot;geom_col&quot;              
[10] &quot;geom_contour&quot;           &quot;geom_contour_filled&quot;    &quot;geom_count&quot;            
[13] &quot;geom_crossbar&quot;          &quot;geom_curve&quot;             &quot;geom_density&quot;          
[16] &quot;geom_density_2d&quot;        &quot;geom_density_2d_filled&quot; &quot;geom_density2d&quot;        
[19] &quot;geom_density2d_filled&quot;  &quot;geom_dotplot&quot;           &quot;geom_errorbar&quot;         
[22] &quot;geom_errorbarh&quot;         &quot;geom_freqpoly&quot;          &quot;geom_function&quot;         
[25] &quot;geom_hex&quot;               &quot;geom_histogram&quot;         &quot;geom_hline&quot;            
[28] &quot;geom_jitter&quot;            &quot;geom_label&quot;             &quot;geom_line&quot;             
[31] &quot;geom_linerange&quot;         &quot;geom_lm&quot;                &quot;geom_map&quot;              
[34] &quot;geom_path&quot;              &quot;geom_point&quot;             &quot;geom_pointrange&quot;       
[37] &quot;geom_polygon&quot;           &quot;geom_qq&quot;                &quot;geom_qq_line&quot;          
[40] &quot;geom_quantile&quot;          &quot;geom_raster&quot;            &quot;geom_rect&quot;             
[43] &quot;geom_ribbon&quot;            &quot;geom_rug&quot;               &quot;geom_segment&quot;          
[46] &quot;geom_sf&quot;                &quot;geom_sf_label&quot;          &quot;geom_sf_text&quot;          
[49] &quot;geom_smooth&quot;            &quot;geom_spline&quot;            &quot;geom_spoke&quot;            
[52] &quot;geom_step&quot;              &quot;geom_text&quot;              &quot;geom_tile&quot;             
[55] &quot;geom_violin&quot;            &quot;geom_vline&quot;            </code></pre>
</div>
</div>
<p>help pages will tell you their aesthetics, default stats, etc.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>?geom_area             <span class="co"># for example</span></span></code></pre></div>
</div>
</section>
<section id="lets-try-geom_area" class="level5 unnumbered">
<h5 class="unnumbered">Let’s try <code>geom_area</code></h5>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>Births78 <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>births, <span class="at">fill=</span>wday)) <span class="sc">+</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>()<span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;US Births in 1978&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-30-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<p>Using area does not produce a good plot</p>
<ul>
<li>over plotting is hiding much of the data</li>
<li>extending y-axis to 0 may or may not be desirable.</li>
</ul>
</section>
<section id="side-note-what-makes-a-plot-good" class="level5 unnumbered">
<h5 class="unnumbered">Side note: what makes a plot good?</h5>
<p>Most (all?) graphics are intended to help us make comparisons</p>
<ul>
<li>How does something change over time?</li>
<li>Do my treatments matter? How much?</li>
<li>Do men and women respond the same way?</li>
</ul>
<p><strong>Key plot metric:</strong> Does my plot make the comparisons I am interested in</p>
<ul>
<li>easily, and</li>
<li>accurately?</li>
</ul>
</section>
<section id="time-for-some-different-data" class="level5 unnumbered">
<h5 class="unnumbered">Time for some different data</h5>
<p><code>HELPrct</code>: Health Evaluation and Linkage to Primary care randomized clinical trial</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(HELPrct)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  age anysubstatus anysub cesd d1 daysanysub dayslink drugrisk e2b female
1  37            1    yes   49  3        177      225        0  NA      0
2  37            1    yes   30 22          2       NA        0  NA      0
3  26            1    yes   39  0          3      365       20  NA      0
4  39            1    yes   15  2        189      343        0   1      1
5  32            1    yes   39 12          2       57        0   1      0
6  47            1    yes    6  1         31      365        0  NA      1
     sex g1b homeless i1 i2 id indtot linkstatus link       mcs      pcs pss_fr
1   male yes   housed 13 26  1     39          1  yes 25.111990 58.41369      0
2   male yes homeless 56 62  2     43         NA &lt;NA&gt; 26.670307 36.03694      1
3   male  no   housed  0  0  3     41          0   no  6.762923 74.80633     13
4 female  no   housed  5  5  4     28          0   no 43.967880 61.93168     11
5   male  no homeless 10 13  5     38          1  yes 21.675755 37.34558     10
6 female  no   housed  4  4  6     29          0   no 55.508991 46.47521      5
  racegrp satreat sexrisk substance treat avg_drinks max_drinks
1   black      no       4   cocaine   yes         13         26
2   white      no       7   alcohol   yes         56         62
3   black      no       2    heroin    no          0          0
4   white     yes       4    heroin    no          5          5
5   black      no       6   cocaine    no         10         13
6   black      no       5   cocaine   yes          4          4
  hospitalizations
1                3
2               22
3                0
4                2
5               12
6                1</code></pre>
</div>
</div>
<p>Subjects admitted for treatment for addiction to one of three substances.</p>
</section>
<section id="who-are-the-people-in-the-study" class="level5 unnumbered">
<h5 class="unnumbered">Who are the people in the study?</h5>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>substance)) <span class="sc">+</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()<span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-32-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Hmm. What’s up with <code>y</code>?</p>
<ul>
<li><code>stat_bin()</code> is being applied to the data before the <code>geom_bar()</code> gets to do its thing. Binning creates the <code>y</code> values.</li>
</ul></li>
</ul>
</section>
<section id="who-are-the-people-in-the-study-1" class="level5 unnumbered">
<h5 class="unnumbered">Who are the people in the study?</h5>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>substance, <span class="at">fill=</span>sex)) <span class="sc">+</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()<span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-33-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="who-are-the-people-in-the-study-2" class="level5 unnumbered">
<h5 class="unnumbered">Who are the people in the study?</h5>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>substance, <span class="at">fill=</span>sex)) <span class="sc">+</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> percent)<span class="sc">+</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-34-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="who-are-the-people-in-the-study-3" class="level5 unnumbered">
<h5 class="unnumbered">Who are the people in the study?</h5>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>substance, <span class="at">fill=</span>sex)) <span class="sc">+</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="st">&quot;fill&quot;</span>) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;actually, percent&quot;</span>)<span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-35-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="how-old-are-people-in-the-help-study" class="level5 unnumbered">
<h5 class="unnumbered">How old are people in the HELP study?</h5>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>age)) <span class="sc">+</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-36-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-26"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<p>Notice the messages</p>
<ul>
<li><p><code>stat_bin</code>: Histograms are not mapping the raw data but binned data.<br />
<code>stat_bin()</code> performs the data transformation.</p></li>
<li><p><code>binwidth</code>: a default <code>binwidth</code> has been selected, but we should really choose our own.</p></li>
</ul>
</section>
<section id="setting-the-binwidth-manually" class="level5 unnumbered">
<h5 class="unnumbered">Setting the binwidth manually</h5>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>age)) <span class="sc">+</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-37-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="how-old-are-people-in-the-help-study-other-geoms" class="level5 unnumbered">
<h5 class="unnumbered">How old are people in the HELP study? – Other geoms</h5>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>age)) <span class="sc">+</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">binwidth=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-38-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-28"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>age)) <span class="sc">+</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()<span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-39-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-29"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="selecting-stat-and-geom-manually" class="level5 unnumbered">
<h5 class="unnumbered">Selecting stat and geom manually</h5>
<p>Every geom comes with a default stat</p>
<ul>
<li>for simple cases, the stat is <code>stat_identity()</code> which does nothing</li>
<li>we can mix and match geoms and stats however we like</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>age)) <span class="sc">+</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">stat=</span><span class="st">&quot;density&quot;</span>)<span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-40-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-30"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="selecting-stat-and-geom-manually-1" class="level5 unnumbered">
<h5 class="unnumbered">Selecting stat and geom manually</h5>
<p>Every stat comes with a default <code>geom</code>, every geom with a default stat</p>
<ul>
<li>we can specify stats instead of <code>geom</code>, if we prefer</li>
<li>we can mix and match geoms and stats however we like</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>age)) <span class="sc">+</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density</span>( <span class="at">geom=</span><span class="st">&quot;line&quot;</span>)<span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-41-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-31"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="more-combinations" class="level5 unnumbered">
<h5 class="unnumbered">More combinations</h5>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>age)) <span class="sc">+</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">stat=</span><span class="st">&quot;bin&quot;</span>, <span class="at">binwidth=</span><span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">stat=</span><span class="st">&quot;bin&quot;</span>, <span class="at">binwidth=</span><span class="dv">3</span>)  <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-42-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-32"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>age)) <span class="sc">+</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">stat=</span><span class="st">&quot;bin&quot;</span>, <span class="at">binwidth=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>) </span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-43-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-33"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>age)) <span class="sc">+</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">stat=</span><span class="st">&quot;bin&quot;</span>, <span class="at">binwidth=</span><span class="dv">3</span>, <span class="fu">aes</span>(<span class="at">size=</span>..count..)) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">stat=</span><span class="st">&quot;bin&quot;</span>, <span class="at">binwidth=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-44-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-34"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="how-much-do-they-drink-i1" class="level5 unnumbered">
<h5 class="unnumbered">How much do they drink? (i1)</h5>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>i1)) <span class="sc">+</span> <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-45-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-35"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>i1)) <span class="sc">+</span> <span class="fu">geom_density</span>()<span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-46-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-36"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb33"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>i1)) <span class="sc">+</span> <span class="fu">geom_area</span>(<span class="at">stat=</span><span class="st">&quot;density&quot;</span>)<span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-47-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-37"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="covariates-adding-in-more-variables" class="level5 unnumbered">
<h5 class="unnumbered">Covariates: Adding in more variables</h5>
<p>Using <code>color</code> and <code>linetype</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb34"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>i1, <span class="at">color=</span>substance, <span class="at">linetype=</span>sex)) <span class="sc">+</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">stat=</span><span class="st">&quot;density&quot;</span>)<span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-48-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-38"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<p>Using <code>color</code> and <code>facet</code>s</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb35"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>i1, <span class="at">color=</span>substance)) <span class="sc">+</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">stat=</span><span class="st">&quot;density&quot;</span>) <span class="sc">+</span> <span class="fu">facet_grid</span>( . <span class="sc">~</span> sex )<span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-49-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-39"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>i1, <span class="at">color=</span>substance)) <span class="sc">+</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">stat=</span><span class="st">&quot;density&quot;</span>) <span class="sc">+</span> <span class="fu">facet_grid</span>( sex <span class="sc">~</span> . )<span class="sc">+</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-50-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-40"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="boxplots" class="level5 unnumbered">
<h5 class="unnumbered">Boxplots</h5>
<p>Boxplots use <code>stat_quantile()</code> which computes a five-number summary (roughly the five quartiles of the data) and uses them to define a “box” and “whiskers”.</p>
<p>The quantitative variable must be <code>y</code>, and there must be an additional <code>x</code> variable.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>substance, <span class="at">y=</span>age, <span class="at">color=</span>sex)) <span class="sc">+</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-51-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-41"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="horizontal-boxplots" class="level5 unnumbered">
<h5 class="unnumbered">Horizontal boxplots</h5>
<p>Horizontal boxplots are obtained by flipping the coordinate system:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb38"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>substance, <span class="at">y=</span>age, <span class="at">color=</span>sex)) <span class="sc">+</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-52-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-42"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<ul>
<li><code>coord_flip()</code> may be used with other plots as well to reverse the roles of <code>x</code> and <code>y</code> on the plot.</li>
</ul>
</section>
<section id="axes-scaling-with-boxplots" class="level5 unnumbered">
<h5 class="unnumbered">Axes scaling with boxplots</h5>
<p>We can scale the continuous axis</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb39"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>substance, <span class="at">y=</span>age, <span class="at">color=</span>sex)) <span class="sc">+</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_trans</span>(<span class="at">y=</span><span class="st">&quot;log&quot;</span>)<span class="sc">+</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-53-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-43"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="give-me-some-space" class="level5 unnumbered">
<h5 class="unnumbered">Give me some space</h5>
<p>We’ve triggered a new feature: <code>dodge</code> (for dodging things left/right). We can control how much if we set the dodge manually.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb40"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>HELPrct <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>substance, <span class="at">y=</span>age, <span class="at">color=</span>sex)) <span class="sc">+</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-54-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-44"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="issues-with-bigger-data" class="level5 unnumbered">
<h5 class="unnumbered">Issues with bigger data</h5>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb41"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(NHANES)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(NHANES)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10000    76</code></pre>
</div>
<div class="sourceCode" id="cb43"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>NHANES <span class="sc">%&gt;%</span>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Height, <span class="at">y=</span>Weight)) <span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_grid</span>( Gender <span class="sc">~</span> PregnantNow ) <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;National Health and Nutrition Examination Survey&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-55-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-45"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Although we can see a generally positive association (as we would expect), the over plotting may be hiding information.</li>
</ul>
</section>
<section id="using-alpha-opacity" class="level5 unnumbered">
<h5 class="unnumbered">Using alpha (opacity)</h5>
<p>One way to deal with over plotting is to set the opacity low.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb44"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>NHANES <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Height, <span class="at">y=</span>Weight)) <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.01</span>) <span class="sc">+</span> <span class="fu">facet_grid</span>( Gender <span class="sc">~</span> PregnantNow ) <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;National Health and Nutrition Examination Survey&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-56-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-46"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_density2d" class="level5 unnumbered">
<h5 class="unnumbered">geom_density2d</h5>
<p>Alternatively (or simultaneously) we might prefer a different <code>geom</code> altogether.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb45"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>NHANES <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Height, <span class="at">y=</span>Weight)) <span class="sc">+</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density2d</span>() <span class="sc">+</span> <span class="fu">facet_grid</span>( Gender <span class="sc">~</span> PregnantNow ) <span class="sc">+</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;National Health and Nutrition Examination Survey&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-57-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-47"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="multiple-layers" class="level5 unnumbered">
<h5 class="unnumbered">Multiple layers</h5>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb46"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( <span class="at">data=</span>HELPrct, <span class="fu">aes</span>(<span class="at">x=</span>sex, <span class="at">y=</span>age)) <span class="sc">+</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.size=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha=</span>.<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-58-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-48"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="multiple-layers-1" class="level5 unnumbered">
<h5 class="unnumbered">Multiple layers</h5>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb47"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( <span class="at">data=</span>HELPrct, <span class="fu">aes</span>(<span class="at">x=</span>sex, <span class="at">y=</span>age)) <span class="sc">+</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.size=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span>.<span class="dv">6</span>, <span class="at">position=</span><span class="fu">position_jitter</span>(<span class="at">width=</span>.<span class="dv">1</span>, <span class="at">height=</span><span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-59-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-49"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid quarto-figure quarto-figure-center" width="1500" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="things-i-havent-mentioned-much" class="level5 unnumbered">
<h5 class="unnumbered">Things I haven’t mentioned (much)</h5>
<ul>
<li><p>coords (<code>coord_flip()</code> is good to know about)</p></li>
<li><p>themes (for customizing appearance)</p></li>
<li><p>position (<code>position_dodge()</code>, <code>position_jitterdodge()</code>, <code>position_stack()</code>, etc.)</p></li>
<li><p>transforming axes</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb48"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggthemes)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Births78, <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>births)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme_wsj</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-60-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-50"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid quarto-figure quarto-figure-center" width="4200" /></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb49"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>HELPrct, <span class="fu">aes</span>(<span class="at">x=</span>substance, <span class="at">y=</span>age, <span class="at">color=</span>sex)) <span class="sc">+</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">coef =</span> <span class="dv">10</span>, <span class="at">position=</span><span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>sex, <span class="at">fill=</span>sex), <span class="at">position=</span><span class="fu">position_jitterdodge</span>()) <span class="sc">+</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-61-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-51"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid quarto-figure quarto-figure-center" width="4200" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="a-little-bit-of-everything" class="level5 unnumbered">
<h5 class="unnumbered">A little bit of everything</h5>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb50"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( <span class="at">data=</span>HELPrct, <span class="fu">aes</span>(<span class="at">x=</span>substance, <span class="at">y=</span>age, <span class="at">color=</span>sex)) <span class="sc">+</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">coef =</span> <span class="dv">10</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill=</span>sex), <span class="at">alpha=</span>.<span class="dv">5</span>, </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">position=</span><span class="fu">position_jitterdodge</span>(<span class="at">dodge.width=</span><span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>homeless)<span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;HELP clinical trial at detoxification unit&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="10-grammar-graphics_files/figure-html/unnamed-chunk-62-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-52"><img src="10-grammar-graphics_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid quarto-figure quarto-figure-center" width="4200" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="want-to-learn-more" class="level4 unnumbered">
<h4 class="unnumbered">Want to learn more?</h4>
<ul>
<li><p><a href="http://docs.ggplot2.org/">docs.ggplot2.org/</a></p></li>
<li><p>Winston Chang’s: <em>R Graphics Cookbook</em></p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="images/cookbook.png" class="lightbox" data-gallery="quarto-lightbox-gallery-53"><img src="images/cookbook.png" class="img-fluid quarto-figure quarto-figure-center" width="800" /></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="what-else-can-we-do" class="level4 unnumbered">
<h4 class="unnumbered">What else can we do?</h4>
<p><code>shiny</code></p>
<ul>
<li><p>interactive graphics / modeling</p></li>
<li><p>https://shiny.rstudio.com/</p></li>
</ul>
<p><code>plotly</code></p>
<blockquote>
<p><code>Plotly</code> is an R package for creating interactive web-based graphs via plotly’s JavaScript graphing library, <code>plotly.js</code>. The <code>plotly</code> R library contains the <code>ggplotly</code> function , which will convert <code>ggplot2</code> figures into a Plotly object. Furthermore, you have the option of manipulating the Plotly object with the <code>style</code> function.</p>
</blockquote>
<ul>
<li>https://plot.ly/ggplot2/getting-started/</li>
</ul>
<p>Dynamic documents</p>
<ul>
<li>combination of <code>quarto</code>, <code>ggvis</code>, and <code>shiny</code></li>
</ul>
</section>
</section>
</section>
<section id="reflection-questions" class="level2" data-number="10.4">
<h2 data-number="10.4"><span class="header-section-number">10.4</span> <i class="fas fa-lightbulb"></i> Reflection questions</h2>
</section>
<section id="ethics-considerations" class="level2" data-number="10.5">
<h2 data-number="10.5"><span class="header-section-number">10.5</span> <i class="fas fa-balance-scale"></i> Ethics considerations</h2>
<div id="quarto-navigation-envelope" class="hidden">
<p><span class="hidden" data-render-id="quarto-int-sidebar-title">Foundations of Data Science in R</span> <span class="hidden" data-render-id="quarto-int-navbar-title">Foundations of Data Science in R</span> <span class="hidden" data-render-id="quarto-int-next"><span class="chapter-number">11</span>  <span class="chapter-title">ggplot</span></span> <span class="hidden" data-render-id="quarto-int-prev">Data visualization</span> <span class="hidden" data-render-id="quarto-int-sidebar:/index.htmlWelcome-to-Foundations-of-Data-Science-in-R">Welcome to Foundations of Data Science in R</span> <span class="hidden" data-render-id="quarto-int-sidebar:quarto-sidebar-section-1">Introduction to data science</span> <span class="hidden" data-render-id="quarto-int-sidebar:/01-intro.html&lt;span-class=&#39;chapter-number&#39;&gt;1&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Introduction&lt;/span&gt;"><span class="chapter-number">1</span>  <span class="chapter-title">Introduction</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/02-github.html&lt;span-class=&#39;chapter-number&#39;&gt;2&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;GitHub&lt;/span&gt;"><span class="chapter-number">2</span>  <span class="chapter-title">GitHub</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:quarto-sidebar-section-2">Data acquisition</span> <span class="hidden" data-render-id="quarto-int-sidebar:/03-rvest.html&lt;span-class=&#39;chapter-number&#39;&gt;3&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Web-scraping&lt;/span&gt;"><span class="chapter-number">3</span>  <span class="chapter-title">Web scraping</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/04-sql-in-R.html&lt;span-class=&#39;chapter-number&#39;&gt;4&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;SQL-in-R-and-DBeaver&lt;/span&gt;"><span class="chapter-number">4</span>  <span class="chapter-title">SQL in R and DBeaver</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/05-sql-verbs.html&lt;span-class=&#39;chapter-number&#39;&gt;5&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;SQL-clauses&lt;/span&gt;"><span class="chapter-number">5</span>  <span class="chapter-title">SQL clauses</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/06-sql-joins.html&lt;span-class=&#39;chapter-number&#39;&gt;6&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Combining-tables-in-SQL&lt;/span&gt;"><span class="chapter-number">6</span>  <span class="chapter-title">Combining tables in SQL</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:quarto-sidebar-section-3">Data exploration</span> <span class="hidden" data-render-id="quarto-int-sidebar:/07-wrangling.html&lt;span-class=&#39;chapter-number&#39;&gt;7&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Data-Wrangling&lt;/span&gt;"><span class="chapter-number">7</span>  <span class="chapter-title">Data Wrangling</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/08-text-analysis.html&lt;span-class=&#39;chapter-number&#39;&gt;8&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Text-analysis&lt;/span&gt;"><span class="chapter-number">8</span>  <span class="chapter-title">Text analysis</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/09-reg-expr.html&lt;span-class=&#39;chapter-number&#39;&gt;9&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Regular-expressions&lt;/span&gt;"><span class="chapter-number">9</span>  <span class="chapter-title">Regular expressions</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:quarto-sidebar-section-4">Data visualization</span> <span class="hidden" data-render-id="quarto-int-sidebar:/10-grammar-graphics.html&lt;span-class=&#39;chapter-number&#39;&gt;10&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Grammar-of-graphics&lt;/span&gt;"><span class="chapter-number">10</span>  <span class="chapter-title">Grammar of graphics</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/11-ggplot.html&lt;span-class=&#39;chapter-number&#39;&gt;11&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;ggplot&lt;/span&gt;"><span class="chapter-number">11</span>  <span class="chapter-title">ggplot</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:quarto-sidebar-section-5">Data conclusions</span> <span class="hidden" data-render-id="quarto-int-sidebar:/12-iteration.html&lt;span-class=&#39;chapter-number&#39;&gt;12&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Iteration&lt;/span&gt;"><span class="chapter-number">12</span>  <span class="chapter-title">Iteration</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/13-permutation-tests.html&lt;span-class=&#39;chapter-number&#39;&gt;13&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Permutation-tests&lt;/span&gt;"><span class="chapter-number">13</span>  <span class="chapter-title">Permutation tests</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:quarto-sidebar-section-6">Data communication</span> <span class="hidden" data-render-id="quarto-int-sidebar:/14-version-control.html&lt;span-class=&#39;chapter-number&#39;&gt;14&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Version-control&lt;/span&gt;"><span class="chapter-number">14</span>  <span class="chapter-title">Version control</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/15-R-tip-of-the-day.html&lt;span-class=&#39;chapter-number&#39;&gt;15&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;R-tip-of-the-day&lt;/span&gt;"><span class="chapter-number">15</span>  <span class="chapter-title">R tip-of-the-day</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/16-reprex.html&lt;span-class=&#39;chapter-number&#39;&gt;16&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Reproducible-examples&lt;/span&gt;"><span class="chapter-number">16</span>  <span class="chapter-title">Reproducible examples</span></span> <span class="hidden" data-render-id="quarto-breadcrumbs-Data-visualization">Data visualization</span> <span class="hidden" data-render-id="quarto-breadcrumbs-&lt;span-class=&#39;chapter-number&#39;&gt;10&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Grammar-of-graphics&lt;/span&gt;"><span class="chapter-number">10</span>  <span class="chapter-title">Grammar of graphics</span></span></p>
<div class="hidden" data-render-id="footer-left">
<p>Foundations of Data Science in R, by Jo Hardin.</p>
</div>
<div class="hidden" data-render-id="footer-right">
<p>Built with 💚 and <a href="https://quarto.org/">Quarto</a>.</p>
</div>
</div>
<div id="quarto-meta-markdown" class="hidden">
<p><span class="hidden" data-render-id="quarto-metatitle">Foundations of Data Science in R - <span id="sec-grammar-graphics" class="quarto-section-identifier"><span class="chapter-number">10</span>  <span class="chapter-title">Grammar of graphics</span></span></span> <span class="hidden" data-render-id="quarto-twittercardtitle">Foundations of Data Science in R - <span id="sec-grammar-graphics" class="quarto-section-identifier"><span class="chapter-number">10</span>  <span class="chapter-title">Grammar of graphics</span></span></span> <span class="hidden" data-render-id="quarto-ogcardtitle">Foundations of Data Science in R - <span id="sec-grammar-graphics" class="quarto-section-identifier"><span class="chapter-number">10</span>  <span class="chapter-title">Grammar of graphics</span></span></span> <span class="hidden" data-render-id="quarto-metasitename">Foundations of Data Science in R</span> <span class="hidden" data-render-id="quarto-twittercarddesc"></span> <span class="hidden" data-render-id="quarto-ogcardddesc"></span></p>
</div>
<div class="hidden" aria-hidden="true">
<span class="glightbox-desc lightbox-desc-1">The graphic the engineers should have led with in trying to persuade the administrators not to launch. It is evident that the number of O-ring failures is quite highly associated with the ambient temperature. Note the <em>vital</em> information on the x-axis associated with the large number of launches at warm temperatures that had <em>zero</em> O-ring failures. <span class="citation" data-cites="Tufte97">(<a href="#ref-Tufte97" role="doc-biblioref">Tufte 1997</a>)</span></span>
<span class="glightbox-desc lightbox-desc-2">http://infobeautiful3.s3.amazonaws.com/2013/01/1276_buzz_v_bulge.png</span>
<span class="glightbox-desc lightbox-desc-3">Calories and Caffeine for drinks from various drinks and other items. Data source is: World Cancer Research Fund, Starbucks Beverage Nutrition Guide, Calorie Counter Database. Seemingly, the observational units (rows) are not a random sample of anything. As such, we should be careful of summarizing the data in any way - what would the ‘average’ calories even mean? Note, from the entire dataset give, the average calories is 179.8 and the average caffeine is 134.43. How do those numbers compare to the original plot?</span>
</div>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-MDSR" class="csl-entry" role="listitem">
Baumer, Ben, Daniel Kaplan, and Nicholas Horton. 2021. <em>Modern Data Science with r</em>. CRC Press. <a href="https://mdsr-book.github.io/mdsr2e/">https://mdsr-book.github.io/mdsr2e/</a>.
</div>
<div id="ref-Gelman11" class="csl-entry" role="listitem">
Gelman, Andrew. 2011. <span>“Rejoinder.”</span> <em>Journal of Computational and Graphical Statistics</em> 20: 36–40. <a href="http://arxiv.org/abs/1503.00781">http://arxiv.org/abs/1503.00781</a>.
</div>
<div id="ref-Nolan16" class="csl-entry" role="listitem">
Nolan, Deborah, and Jamis Perrett. 2016. <span>“Teaching and Learning Data Visualization: Ideas and Assignments.”</span> <em>The American Statistician</em>.
</div>
<div id="ref-Tufte97" class="csl-entry" role="listitem">
Tufte, Edward. 1997. <span>“Visual Explanations: Images and Quantities, Evidence and Narrative.”</span> In, 27–54. Graphics Press, LLC. <a href="https://www.edwardtufte.com">www.edwardtufte.com</a>.
</div>
<div id="ref-Wickham14" class="csl-entry" role="listitem">
Wickham, Hadley. 2014. <span>“Tidy Data.”</span> <em>Journal of Statistical Software</em> 59 (10). <a href="http://www.jstatsoft.org/v59/i10/paper">http://www.jstatsoft.org/v59/i10/paper</a>.
</div>
<div id="ref-Yau" class="csl-entry" role="listitem">
Yau, Nathan. 2013. <em>Data Points: Visualization That Means Something</em>. Wiley.
</div>
</div>
</section>

</main> <!-- /main -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ds002r-fds\.netlify\.app\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a  href="/p3-data-viz.html" class="pagination-link" aria-label="Data visualization">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Data visualization</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a  href="/11-ggplot.html" class="pagination-link" aria-label="ggplot">
        <span class="nav-page-text"><span class='chapter-number'>11</span>  <span class='chapter-title'>ggplot</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <div class='footer-contents'>Foundations of Data Science in R, by Jo Hardin.
</div>  
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <div class='footer-contents'>Built with 💚 and <a href="https://quarto.org/">Quarto</a>.
</div>  
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"openEffect":"zoom","selector":".lightbox","loop":false,"closeEffect":"zoom","descPosition":"bottom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>

</body>

</html>
